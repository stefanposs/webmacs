{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"WebMACS","text":"<p>Web-based Monitoring and Control System for IoT experiments.</p> <p>WebMACS provides real-time sensor monitoring, experiment management, and telemetry for industrial IoT setups \u2014 specifically designed for Wirbelschicht (fluidised-bed) experiments at the TU Kaiserslautern Chair of Mechanical Process Engineering.</p>"},{"location":"#features","title":"Features","text":""},{"location":"#real-time-dashboard","title":"Real-Time Dashboard","text":"<p>Live sensor readings with auto-updating charts, WebSocket-first with HTTP polling fallback.</p>"},{"location":"#experiment-management","title":"Experiment Management","text":"<p>Create, start, and stop experiments. All datapoints are automatically linked to the active experiment.</p>"},{"location":"#websocket-telemetry","title":"WebSocket Telemetry","text":"<p>Dual-mode controller telemetry (HTTP / WebSocket). Frontend streams via <code>/ws/datapoints/stream</code>.</p>"},{"location":"#csv-export","title":"CSV Export","text":"<p>One-click download of all experiment datapoints as a CSV file \u2014 streamed via <code>StreamingResponse</code>.</p>"},{"location":"#pluggable-storage","title":"Pluggable Storage","text":"<p>Protocol-based repository layer. Switch between PostgreSQL and TimescaleDB via a single env var.</p>"},{"location":"#docker-compose","title":"Docker Compose","text":"<p>Four-container stack (PostgreSQL, FastAPI, Vue/Nginx, Controller) \u2014 one command to start.</p>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># Clone the repository\ngit clone https://github.com/stefanposs/webmacs.git\ncd webmacs\n\n# Copy environment defaults\ncp .env.example .env\n\n# Spin up all services\ndocker compose up --build -d\n</code></pre> <p>Open http://localhost and log in with the seeded admin account (<code>admin@webmacs.io</code> / <code>admin123</code>).</p>"},{"location":"#architecture-at-a-glance","title":"Architecture at a Glance","text":"<pre><code>graph LR\n    Controller[\"IoT Controller&lt;br/&gt;(Python)\"] --&gt;|HTTP / WS| Backend[\"FastAPI Backend\"]\n    Backend --&gt;|async| DB[(PostgreSQL)]\n    Frontend[\"Vue 3 SPA&lt;br/&gt;(Nginx)\"] --&gt;|REST + WS| Backend</code></pre> Layer Tech Stack Backend FastAPI \u00b7 SQLAlchemy 2 async \u00b7 Pydantic v2 \u00b7 Python 3.14 Frontend Vue 3 \u00b7 TypeScript \u00b7 Vite \u00b7 PrimeVue \u00b7 Pinia Controller Python 3.14 \u00b7 HTTPX \u00b7 Async WebSocket Database PostgreSQL 17 (TimescaleDB optional) Infrastructure Docker Compose \u00b7 Nginx reverse-proxy <p>Learn more \u2192 Architecture Overview</p>"},{"location":"#documentation","title":"Documentation","text":"Section Audience Description Getting Started Everyone Install, configure, run User Guide Operators Dashboard, experiments, CSV export Architecture Developers System design, WebSocket, DB protocols API Reference Developers REST + WebSocket endpoint docs Development Contributors Code style, testing, CI/CD Deployment DevOps Docker, production, env vars"},{"location":"#contributing","title":"Contributing","text":"<p>Contributions are welcome! See the Contributing Guide for development setup and workflow.</p>"},{"location":"#license","title":"License","text":"<p>MIT \u2014 see LICENSE for details.</p>"},{"location":"api/rest/","title":"REST API Reference","text":"<p>All endpoints are mounted under <code>/api/v1/</code>. Authentication uses JWT Bearer tokens unless noted otherwise.</p>"},{"location":"api/rest/#authentication","title":"Authentication","text":""},{"location":"api/rest/#post-apiv1authlogin","title":"<code>POST /api/v1/auth/login</code>","text":"<p>Authenticate and receive a JWT token.</p> <p>Request:</p> <pre><code>{\n  \"email\": \"admin@webmacs.io\",\n  \"password\": \"admin123\"\n}\n</code></pre> <p>Response <code>200</code>:</p> <pre><code>{\n  \"status\": \"success\",\n  \"message\": \"Successfully logged in.\",\n  \"access_token\": \"eyJhbGciOiJIUzI1NiIs...\",\n  \"public_id\": \"usr_abc123\",\n  \"username\": \"admin\"\n}\n</code></pre> <p>Token usage</p> <p>Include the token in all subsequent requests: <code>Authorization: Bearer &lt;access_token&gt;</code></p>"},{"location":"api/rest/#users","title":"Users","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/users</code> Admin List all users <code>GET</code> <code>/api/v1/users/{id}</code> Admin Get user by public_id <code>POST</code> <code>/api/v1/users</code> Admin Create user <code>PUT</code> <code>/api/v1/users/{id}</code> Admin Update user <code>DELETE</code> <code>/api/v1/users/{id}</code> Admin Delete user"},{"location":"api/rest/#create-user","title":"Create User","text":"<pre><code>{\n  \"email\": \"operator@example.com\",\n  \"username\": \"operator1\",\n  \"password\": \"securepassword123\"\n}\n</code></pre>"},{"location":"api/rest/#experiments","title":"Experiments","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/experiments</code> JWT List all experiments <code>GET</code> <code>/api/v1/experiments/{id}</code> JWT Get single experiment <code>POST</code> <code>/api/v1/experiments</code> JWT Create &amp; start experiment <code>PUT</code> <code>/api/v1/experiments/{id}</code> JWT Update (e.g. stop) <code>DELETE</code> <code>/api/v1/experiments/{id}</code> JWT Delete experiment <code>GET</code> <code>/api/v1/experiments/{id}/export/csv</code> JWT Download CSV"},{"location":"api/rest/#create-experiment","title":"Create Experiment","text":"<pre><code>{\n  \"name\": \"Fluidised Bed Run 07\"\n}\n</code></pre>"},{"location":"api/rest/#csv-export","title":"CSV Export","text":"<pre><code>GET /api/v1/experiments/{id}/export/csv\n</code></pre> <p>Returns <code>text/csv</code> as a streaming response. See CSV Export Guide.</p>"},{"location":"api/rest/#events","title":"Events","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/events</code> JWT List all events <code>GET</code> <code>/api/v1/events/{id}</code> JWT Get single event <code>POST</code> <code>/api/v1/events</code> JWT Create event <code>PUT</code> <code>/api/v1/events/{id}</code> JWT Update event <code>DELETE</code> <code>/api/v1/events/{id}</code> JWT Delete event"},{"location":"api/rest/#create-event","title":"Create Event","text":"<pre><code>{\n  \"name\": \"Inlet Temperature\",\n  \"type\": \"sensor\",\n  \"unit\": \"\u00b0C\",\n  \"description\": \"Temperature at the fluidised-bed inlet\"\n}\n</code></pre> <p>Event Types: <code>sensor</code>, <code>actuator</code>, <code>range</code>, <code>cmd_button</code>, <code>cmd_opened</code>, <code>cmd_closed</code></p>"},{"location":"api/rest/#datapoints","title":"Datapoints","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/datapoints</code> JWT List datapoints (paginated) <code>POST</code> <code>/api/v1/datapoints</code> JWT Create single datapoint <code>POST</code> <code>/api/v1/datapoints/bulk</code> JWT Create multiple datapoints"},{"location":"api/rest/#create-datapoint","title":"Create Datapoint","text":"<pre><code>{\n  \"value\": 23.45,\n  \"event_public_id\": \"evt_temp01\",\n  \"experiment_public_id\": \"exp_001\"\n}\n</code></pre>"},{"location":"api/rest/#query-parameters","title":"Query Parameters","text":"Param Type Default Description <code>limit</code> <code>int</code> <code>50</code> Max results per page <code>offset</code> <code>int</code> <code>0</code> Pagination offset <code>event_id</code> <code>string</code> \u2014 Filter by event <code>experiment_id</code> <code>string</code> \u2014 Filter by experiment"},{"location":"api/rest/#logs","title":"Logs","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/logs</code> JWT List log entries <code>POST</code> <code>/api/v1/logs</code> JWT Create log entry <code>PUT</code> <code>/api/v1/logs/{id}</code> JWT Update (mark read) <code>DELETE</code> <code>/api/v1/logs/{id}</code> JWT Delete log entry"},{"location":"api/rest/#create-log-entry","title":"Create Log Entry","text":"<pre><code>{\n  \"message\": \"Experiment started\",\n  \"type\": \"info\",\n  \"status\": \"unread\"\n}\n</code></pre> <p>Log types: <code>error</code>, <code>warning</code>, <code>info</code> Statuses: <code>read</code>, <code>unread</code></p>"},{"location":"api/rest/#health-check","title":"Health Check","text":""},{"location":"api/rest/#get-health","title":"<code>GET /health</code>","text":"<p>Returns <code>200 OK</code> \u2014 used by Docker healthcheck.</p> <pre><code>{\n  \"status\": \"healthy\"\n}\n</code></pre>"},{"location":"api/rest/#error-responses","title":"Error Responses","text":"<p>All errors follow a consistent format:</p> <pre><code>{\n  \"detail\": \"Not Found\"\n}\n</code></pre> Status Code Meaning <code>400</code> Bad request / validation error <code>401</code> Unauthorized \u2014 invalid or missing token <code>403</code> Forbidden \u2014 insufficient permissions <code>404</code> Resource not found <code>422</code> Validation error \u2014 Pydantic schema mismatch <code>500</code> Internal server error"},{"location":"api/rest/#openapi-documentation","title":"OpenAPI Documentation","text":"<p>FastAPI auto-generates interactive API docs:</p> <ul> <li>Swagger UI: <code>http://localhost:8000/docs</code></li> <li>ReDoc: <code>http://localhost:8000/redoc</code></li> </ul>"},{"location":"api/rest/#next-steps","title":"Next Steps","text":"<ul> <li>WebSocket API \u2014 real-time endpoints</li> <li>Schemas \u2014 Pydantic model reference</li> </ul>"},{"location":"api/schemas/","title":"Schemas","text":"<p>WebMACS uses Pydantic v2 for all request/response validation. Below is a reference of all schema models.</p>"},{"location":"api/schemas/#auth-schemas","title":"Auth Schemas","text":""},{"location":"api/schemas/#loginrequest","title":"LoginRequest","text":"<pre><code>class LoginRequest(BaseModel):\n    email: EmailStr\n    password: str  # min_length=1\n</code></pre>"},{"location":"api/schemas/#loginresponse","title":"LoginResponse","text":"<pre><code>class LoginResponse(BaseModel):\n    status: str = \"success\"\n    message: str = \"Successfully logged in.\"\n    access_token: str\n    public_id: str\n    username: str\n</code></pre>"},{"location":"api/schemas/#user-schemas","title":"User Schemas","text":""},{"location":"api/schemas/#usercreate","title":"UserCreate","text":"<pre><code>class UserCreate(BaseModel):\n    email: EmailStr\n    username: str  # min_length=2, max_length=50\n    password: str  # min_length=8\n</code></pre>"},{"location":"api/schemas/#userupdate","title":"UserUpdate","text":"<pre><code>class UserUpdate(BaseModel):\n    email: EmailStr | None = None\n    username: str | None = None  # min_length=2, max_length=50\n</code></pre>"},{"location":"api/schemas/#userresponse","title":"UserResponse","text":"<pre><code>class UserResponse(BaseModel):\n    public_id: str\n    email: str\n    username: str\n    admin: bool\n    registered_on: datetime\n</code></pre>"},{"location":"api/schemas/#experiment-schemas","title":"Experiment Schemas","text":""},{"location":"api/schemas/#experimentcreate","title":"ExperimentCreate","text":"<pre><code>class ExperimentCreate(BaseModel):\n    name: str  # min_length=1, max_length=200\n</code></pre>"},{"location":"api/schemas/#experimentupdate","title":"ExperimentUpdate","text":"<pre><code>class ExperimentUpdate(BaseModel):\n    name: str | None = None\n    stopped_on: datetime | None = None\n</code></pre>"},{"location":"api/schemas/#experimentresponse","title":"ExperimentResponse","text":"<pre><code>class ExperimentResponse(BaseModel):\n    public_id: str\n    name: str\n    started_on: datetime | None\n    stopped_on: datetime | None\n    user_public_id: str\n</code></pre>"},{"location":"api/schemas/#event-schemas","title":"Event Schemas","text":""},{"location":"api/schemas/#eventcreate","title":"EventCreate","text":"<pre><code>class EventCreate(BaseModel):\n    name: str\n    type: EventType        # sensor | actuator | range | cmd_button | cmd_opened | cmd_closed\n    unit: str | None = None\n    description: str | None = None\n</code></pre>"},{"location":"api/schemas/#eventresponse","title":"EventResponse","text":"<pre><code>class EventResponse(BaseModel):\n    public_id: str\n    name: str\n    type: EventType\n    unit: str | None\n    description: str | None\n</code></pre>"},{"location":"api/schemas/#datapoint-schemas","title":"Datapoint Schemas","text":""},{"location":"api/schemas/#datapointcreate","title":"DatapointCreate","text":"<pre><code>class DatapointCreate(BaseModel):\n    value: float\n    event_public_id: str\n    experiment_public_id: str | None = None\n</code></pre>"},{"location":"api/schemas/#datapointresponse","title":"DatapointResponse","text":"<pre><code>class DatapointResponse(BaseModel):\n    public_id: str\n    value: float\n    timestamp: datetime\n    event_public_id: str\n    experiment_public_id: str | None\n</code></pre>"},{"location":"api/schemas/#log-schemas","title":"Log Schemas","text":""},{"location":"api/schemas/#logcreate","title":"LogCreate","text":"<pre><code>class LogCreate(BaseModel):\n    message: str\n    type: LoggingType    # error | warning | info\n    status: StatusType = StatusType.unread  # read | unread\n</code></pre>"},{"location":"api/schemas/#logresponse","title":"LogResponse","text":"<pre><code>class LogResponse(BaseModel):\n    public_id: str\n    message: str\n    type: LoggingType\n    status: StatusType\n    created_on: datetime\n</code></pre>"},{"location":"api/schemas/#enums","title":"Enums","text":""},{"location":"api/schemas/#eventtype","title":"EventType","text":"Value Description <code>sensor</code> Continuous measurement <code>actuator</code> Controllable output <code>range</code> Range-bounded value <code>cmd_button</code> Momentary command <code>cmd_opened</code> Open state command <code>cmd_closed</code> Close state command"},{"location":"api/schemas/#loggingtype","title":"LoggingType","text":"Value Description <code>error</code> Error-level log <code>warning</code> Warning-level log <code>info</code> Informational log"},{"location":"api/schemas/#statustype","title":"StatusType","text":"Value Description <code>read</code> Log entry has been read <code>unread</code> Log entry is unread"},{"location":"api/schemas/#next-steps","title":"Next Steps","text":"<ul> <li>REST API \u2014 how schemas are used in endpoints</li> <li>Backend Architecture \u2014 code structure</li> </ul>"},{"location":"api/websocket/","title":"WebSocket API","text":"<p>WebMACS exposes two WebSocket endpoints for real-time communication.</p>"},{"location":"api/websocket/#endpoints","title":"Endpoints","text":""},{"location":"api/websocket/#wscontrollertelemetry","title":"<code>/ws/controller/telemetry</code>","text":"<p>Direction: Controller \u2192 Backend</p> <p>Used by the IoT controller to push sensor readings in real time.</p> <p>Connection:</p> <pre><code>ws://localhost:8000/ws/controller/telemetry?token=&lt;JWT&gt;\n</code></pre> <p>Inbound Message (Controller \u2192 Backend):</p> <pre><code>{\n  \"event_public_id\": \"evt_temp01\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\"\n}\n</code></pre> <p>Behaviour:</p> <ol> <li>Backend validates JWT from query parameter</li> <li>Persists datapoint to database</li> <li>Broadcasts to all <code>/ws/datapoints/stream</code> subscribers</li> <li>Sends periodic heartbeat pings (configurable: <code>WS_HEARTBEAT_INTERVAL</code>)</li> </ol>"},{"location":"api/websocket/#wsdatapointsstream","title":"<code>/ws/datapoints/stream</code>","text":"<p>Direction: Backend \u2192 Frontend</p> <p>Used by the Vue frontend to receive live datapoint updates.</p> <p>Connection:</p> <pre><code>ws://localhost:8000/ws/datapoints/stream\n</code></pre> <p>Outbound Message (Backend \u2192 Frontend):</p> <pre><code>{\n  \"public_id\": \"dp_abc123\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\",\n  \"event_public_id\": \"evt_temp01\",\n  \"experiment_public_id\": \"exp_001\"\n}\n</code></pre> <p>Behaviour:</p> <ol> <li>Client connects \u2014 added to broadcast group</li> <li>Receives every new datapoint as JSON</li> <li>Connection kept alive via heartbeat pings</li> <li>On disconnect \u2014 client removed from broadcast group</li> </ol>"},{"location":"api/websocket/#message-flow","title":"Message Flow","text":"<pre><code>sequenceDiagram\n    participant C as Controller\n    participant B as Backend\n    participant DB as PostgreSQL\n    participant F1 as Frontend 1\n    participant F2 as Frontend 2\n\n    C-&gt;&gt;B: WS /ws/controller/telemetry\n    F1-&gt;&gt;B: WS /ws/datapoints/stream\n    F2-&gt;&gt;B: WS /ws/datapoints/stream\n\n    C-&gt;&gt;B: {\"event_public_id\": \"...\", \"value\": 23.4}\n    B-&gt;&gt;DB: INSERT INTO datapoints\n    B--&gt;&gt;F1: {\"public_id\": \"...\", \"value\": 23.4, ...}\n    B--&gt;&gt;F2: {\"public_id\": \"...\", \"value\": 23.4, ...}</code></pre>"},{"location":"api/websocket/#frontend-reconnection-strategy","title":"Frontend Reconnection Strategy","text":"<p>The <code>useRealtimeDatapoints</code> composable handles reconnection:</p> Attempt Action 1\u20133 Reconnect WebSocket with exponential backoff &gt; 3 Switch to HTTP polling (<code>GET /api/v1/datapoints</code>)"},{"location":"api/websocket/#nginx-proxy","title":"Nginx Proxy","text":"<p>For WebSocket support through Nginx, the config must include upgrade headers:</p> <pre><code>location /ws/ {\n    proxy_pass http://backend:8000;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"upgrade\";\n    proxy_set_header Host $host;\n    proxy_read_timeout 86400;\n}\n</code></pre>"},{"location":"api/websocket/#next-steps","title":"Next Steps","text":"<ul> <li>REST API \u2014 HTTP endpoint reference</li> <li>WebSocket Architecture \u2014 design deep-dive</li> </ul>"},{"location":"architecture/backend/","title":"Backend Architecture","text":"<p>The backend is a FastAPI application with async SQLAlchemy, structured as a Python package: <code>webmacs_backend</code>.</p>"},{"location":"architecture/backend/#package-structure","title":"Package Structure","text":"<pre><code>backend/src/webmacs_backend/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 main.py              # Application factory + lifespan\n\u251c\u2500\u2500 config.py            # pydantic-settings Settings\n\u251c\u2500\u2500 database.py          # Engine, session, init_db\n\u251c\u2500\u2500 models.py            # SQLAlchemy ORM models\n\u251c\u2500\u2500 schemas.py           # Pydantic v2 request/response schemas\n\u251c\u2500\u2500 enums.py             # StrEnum definitions (EventType, StatusType, LoggingType)\n\u251c\u2500\u2500 security.py          # JWT + bcrypt helpers\n\u251c\u2500\u2500 dependencies.py      # FastAPI Depends() factories\n\u251c\u2500\u2500 repository.py        # ORM-level query helpers\n\u251c\u2500\u2500 api/\n\u2502   \u2514\u2500\u2500 v1/\n\u2502       \u251c\u2500\u2500 auth.py          # POST /auth/login\n\u2502       \u251c\u2500\u2500 users.py         # CRUD /users\n\u2502       \u251c\u2500\u2500 experiments.py   # CRUD /experiments + CSV export\n\u2502       \u251c\u2500\u2500 events.py        # CRUD /events\n\u2502       \u251c\u2500\u2500 datapoints.py    # CRUD /datapoints\n\u2502       \u2514\u2500\u2500 logging.py       # CRUD /logs\n\u251c\u2500\u2500 repositories/\n\u2502   \u251c\u2500\u2500 protocols.py         # DatapointRepository + ExperimentRepository\n\u2502   \u251c\u2500\u2500 dependencies.py      # DI wiring (STORAGE_BACKEND \u2192 impl)\n\u2502   \u251c\u2500\u2500 sqlalchemy_repo.py   # PostgreSQL implementation\n\u2502   \u2514\u2500\u2500 timescale_repo.py    # TimescaleDB stub\n\u2514\u2500\u2500 ws/\n    \u251c\u2500\u2500 connection_manager.py  # Pub/sub hub\n    \u2514\u2500\u2500 endpoints.py           # /ws/controller/telemetry, /ws/datapoints/stream\n</code></pre>"},{"location":"architecture/backend/#application-lifecycle","title":"Application Lifecycle","text":"<pre><code>@asynccontextmanager\nasync def lifespan(app: FastAPI) -&gt; AsyncGenerator[None]:\n    await init_db()          # Create tables\n    await _seed_admin()      # Seed admin if no users exist\n    yield\n    await engine.dispose()   # Clean shutdown\n</code></pre> <p>The <code>lifespan</code> context manager runs once at startup and shutdown. It replaces the deprecated <code>on_event</code> hooks.</p>"},{"location":"architecture/backend/#configuration","title":"Configuration","text":"<p>All settings are loaded from environment variables via pydantic-settings:</p> <pre><code>class Settings(BaseSettings):\n    database_url: str\n    secret_key: str\n    storage_backend: str = \"postgresql\"\n    ws_heartbeat_interval: int = 30\n    # ...\n</code></pre>"},{"location":"architecture/backend/#api-routers","title":"API Routers","text":"<p>All six routers are mounted under <code>/api/v1/</code>:</p> Router Prefix Auth Key Endpoints <code>auth</code> <code>/auth</code> Public <code>POST /login</code> <code>users</code> <code>/users</code> Admin CRUD <code>experiments</code> <code>/experiments</code> JWT CRUD, <code>GET /{id}/export/csv</code> <code>events</code> <code>/events</code> JWT CRUD <code>datapoints</code> <code>/datapoints</code> JWT CRUD, bulk create <code>logging</code> <code>/logs</code> JWT CRUD, mark read"},{"location":"architecture/backend/#repository-protocol-layer","title":"Repository Protocol Layer","text":"<p>The backend uses PEP 544 Protocols to abstract the database:</p> <pre><code>class DatapointRepository(Protocol):\n    async def create(self, ...) -&gt; DatapointRecord: ...\n    async def get_by_experiment(self, ...) -&gt; Sequence[DatapointRecord]: ...\n</code></pre> <p>Switch between implementations via <code>STORAGE_BACKEND</code>:</p> <ul> <li><code>postgresql</code> \u2192 <code>SQLAlchemyDatapointRepo</code></li> <li><code>timescale</code> \u2192 <code>TimescaleDatapointRepo</code> (stub)</li> </ul>"},{"location":"architecture/backend/#security","title":"Security","text":"<ul> <li>bcrypt for password hashing (via <code>bcrypt</code> package directly)</li> <li>JWT tokens with <code>python-jose</code> (HS256)</li> <li><code>get_current_user</code> dependency validates token on every protected route</li> <li>Admin-only routes check <code>user.admin == True</code></li> </ul>"},{"location":"architecture/backend/#next-steps","title":"Next Steps","text":"<ul> <li>WebSocket Design \u2014 real-time data streaming</li> <li>Database Abstraction \u2014 Protocol details</li> <li>REST API Reference \u2014 endpoint documentation</li> </ul>"},{"location":"architecture/controller/","title":"Controller Architecture","text":"<p>The IoT Controller is a headless Python agent that reads sensor data and pushes it to the backend.</p>"},{"location":"architecture/controller/#package-structure","title":"Package Structure","text":"<pre><code>controller/src/webmacs_controller/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 __main__.py          # Entry point (python -m webmacs_controller)\n\u251c\u2500\u2500 app.py               # Main application loop\n\u251c\u2500\u2500 config.py            # pydantic-settings configuration\n\u251c\u2500\u2500 schemas.py           # Pydantic models for API payloads\n\u2514\u2500\u2500 services/\n    \u251c\u2500\u2500 api_client.py      # HTTPX client with retry + auto-reauth\n    \u251c\u2500\u2500 actuator_manager.py  # Actuator command handling\n    \u251c\u2500\u2500 demo_seeder.py     # Demo event seeding (dev mode)\n    \u251c\u2500\u2500 hardware.py        # HardwareInterface ABC + RevPi/Simulated impls\n    \u251c\u2500\u2500 rule_engine.py     # Valve cycling rule logic\n    \u251c\u2500\u2500 sensor_manager.py  # Sensor reading abstraction\n    \u2514\u2500\u2500 telemetry.py       # TelemetryTransport Protocol (HTTP / WebSocket)\n</code></pre>"},{"location":"architecture/controller/#telemetry-modes","title":"Telemetry Modes","text":"<p>The controller supports two transport modes, selected via <code>WEBMACS_TELEMETRY_MODE</code>:</p>"},{"location":"architecture/controller/#http-mode-default","title":"HTTP Mode (default)","text":"<pre><code>sequenceDiagram\n    Controller-&gt;&gt;+Backend: POST /api/v1/datapoints\n    Backend--&gt;&gt;-Controller: 201 Created</code></pre> <p>Each sensor reading \u2192 one HTTP POST request.</p>"},{"location":"architecture/controller/#websocket-mode","title":"WebSocket Mode","text":"<pre><code>sequenceDiagram\n    Controller-&gt;&gt;+Backend: WS /ws/controller/telemetry\n    Note over Controller,Backend: Persistent connection\n    loop Every poll interval\n        Controller-&gt;&gt;Backend: JSON message\n        Backend--&gt;&gt;Controller: ack\n    end</code></pre> <p>A single persistent WebSocket connection carries all telemetry.</p>"},{"location":"architecture/controller/#transport-protocol","title":"Transport Protocol","text":"<p>The telemetry layer uses a Protocol for pluggability:</p> <pre><code>class TelemetryTransport(Protocol):\n    async def connect(self) -&gt; None: ...\n    async def send(self, payload: dict) -&gt; None: ...\n    async def disconnect(self) -&gt; None: ...\n</code></pre> <p>Implementations:</p> <ul> <li><code>HttpTelemetry</code> \u2014 wraps <code>APIClient.post()</code></li> <li><code>WebSocketTelemetry</code> \u2014 async context manager over <code>websockets</code> library</li> </ul>"},{"location":"architecture/controller/#auto-reauthentication","title":"Auto-Reauthentication","text":"<p>The <code>APIClient</code> handles JWT lifecycle automatically:</p> <ol> <li>Login with configured credentials on startup</li> <li>Store JWT token</li> <li>On any 401 Unauthorized response \u2192 re-login and retry</li> <li>Exponential backoff on repeated failures</li> </ol>"},{"location":"architecture/controller/#sensor-manager","title":"Sensor Manager","text":"<p>In development mode (<code>WEBMACS_ENV=development</code>), the <code>SensorManager</code> generates dummy data \u2014 sinusoidal waves, random noise, etc. In production mode, it reads from the RevPi via <code>revpimodio2</code>.</p>"},{"location":"architecture/controller/#configuration","title":"Configuration","text":"<pre><code>class ControllerSettings(BaseSettings):\n    webmacs_env: str = \"development\"\n    webmacs_server_url: str = \"http://localhost\"\n    webmacs_server_port: int = 8000\n    webmacs_poll_interval: float = 0.5\n    webmacs_telemetry_mode: str = \"http\"  # \"http\" | \"websocket\"\n    webmacs_admin_email: str\n    webmacs_admin_password: str\n</code></pre>"},{"location":"architecture/controller/#next-steps","title":"Next Steps","text":"<ul> <li>WebSocket Design \u2014 full protocol specification</li> <li>Backend Architecture \u2014 how the backend processes data</li> </ul>"},{"location":"architecture/database/","title":"Database Abstraction","text":"<p>WebMACS uses PEP 544 Protocols to abstract the persistence layer. This allows swapping database backends without changing application code.</p>"},{"location":"architecture/database/#design","title":"Design","text":"<pre><code>classDiagram\n    class DatapointRepository {\n        &lt;&lt;Protocol&gt;&gt;\n        +create(public_id, value, ...) DatapointRecord\n        +get_by_experiment(experiment_id, ...) Sequence~DatapointRecord~\n        +get_latest(limit) Sequence~DatapointRecord~\n    }\n\n    class ExperimentRepository {\n        &lt;&lt;Protocol&gt;&gt;\n        +create(public_id, name, ...) ExperimentRecord\n        +get_all() Sequence~ExperimentRecord~\n        +update(public_id, ...) ExperimentRecord\n    }\n\n    class SQLAlchemyDatapointRepo {\n        +session: AsyncSession\n    }\n    class TimescaleDatapointRepo {\n        +session: AsyncSession\n    }\n\n    DatapointRepository &lt;|.. SQLAlchemyDatapointRepo\n    DatapointRepository &lt;|.. TimescaleDatapointRepo</code></pre>"},{"location":"architecture/database/#protocols","title":"Protocols","text":"<p>Two Protocols define the storage contracts:</p>"},{"location":"architecture/database/#datapointrepository","title":"DatapointRepository","text":"<pre><code>class DatapointRepository(Protocol):\n    async def create(self, public_id: str, value: float, timestamp: datetime,\n                     event_public_id: str, experiment_public_id: str | None) -&gt; DatapointRecord: ...\n    async def get_by_experiment(self, experiment_public_id: str,\n                                limit: int, offset: int) -&gt; Sequence[DatapointRecord]: ...\n    async def get_latest(self, limit: int) -&gt; Sequence[DatapointRecord]: ...\n</code></pre>"},{"location":"architecture/database/#experimentrepository","title":"ExperimentRepository","text":"<pre><code>class ExperimentRepository(Protocol):\n    async def create(self, public_id: str, name: str,\n                     started_on: datetime, user_public_id: str) -&gt; ExperimentRecord: ...\n    async def get_all(self) -&gt; Sequence[ExperimentRecord]: ...\n    async def update(self, public_id: str, **kwargs) -&gt; ExperimentRecord: ...\n</code></pre>"},{"location":"architecture/database/#data-transfer-objects","title":"Data Transfer Objects","text":"<p>Instead of returning raw ORM models, repositories use lightweight DTOs:</p> <pre><code>class DatapointRecord:\n    __slots__ = (\"public_id\", \"value\", \"timestamp\", \"event_public_id\", \"experiment_public_id\")\n</code></pre> <p>This decouples the API layer from the ORM and keeps the Protocol implementations substitutable.</p>"},{"location":"architecture/database/#dependency-injection","title":"Dependency Injection","text":"<p>The <code>STORAGE_BACKEND</code> environment variable selects the implementation:</p> <pre><code># repositories/dependencies.py\ndef get_datapoint_repo(session: AsyncSession = Depends(get_session)) -&gt; DatapointRepository:\n    match settings.storage_backend:\n        case \"postgresql\":\n            return SQLAlchemyDatapointRepo(session)\n        case \"timescale\":\n            return TimescaleDatapointRepo(session)\n        case _:\n            raise ValueError(f\"Unknown storage backend: {settings.storage_backend}\")\n</code></pre> <p>Routers declare the dependency via FastAPI's <code>Depends()</code>:</p> <pre><code>@router.get(\"/datapoints\")\nasync def list_datapoints(repo: DatapointRepository = Depends(get_datapoint_repo)):\n    return await repo.get_latest(limit=50)\n</code></pre>"},{"location":"architecture/database/#adding-a-new-backend","title":"Adding a New Backend","text":"<ol> <li>Create <code>repositories/my_backend_repo.py</code></li> <li>Implement <code>DatapointRepository</code> and <code>ExperimentRepository</code></li> <li>Add a case in <code>dependencies.py</code></li> <li>Set <code>STORAGE_BACKEND=my_backend</code></li> </ol> <p>No changes to routers, schemas, or tests needed.</p>"},{"location":"architecture/database/#timescaledb-support","title":"TimescaleDB Support","text":"<p>The <code>timescale_repo.py</code> is currently a stub \u2014 it inherits from the SQLAlchemy implementation. When TimescaleDB-specific features are needed (hypertables, continuous aggregates, compression), this module will diverge.</p>"},{"location":"architecture/database/#next-steps","title":"Next Steps","text":"<ul> <li>Backend Architecture \u2014 full backend structure</li> <li>Deployment: Environment Variables \u2014 configuring <code>STORAGE_BACKEND</code></li> </ul>"},{"location":"architecture/frontend/","title":"Frontend Architecture","text":"<p>The frontend is a Vue 3 single-page application built with Vite, TypeScript, and PrimeVue.</p>"},{"location":"architecture/frontend/#project-structure","title":"Project Structure","text":"<pre><code>frontend/src/\n\u251c\u2500\u2500 main.ts                  # App entry point (createApp, plugins)\n\u251c\u2500\u2500 App.vue                  # Root component (router-view, AppToast)\n\u251c\u2500\u2500 router/                  # Vue Router (7 views + 404)\n\u251c\u2500\u2500 stores/                  # Pinia stores\n\u2502   \u251c\u2500\u2500 auth.ts              # JWT auth, login/logout\n\u2502   \u251c\u2500\u2500 experiments.ts       # Experiment CRUD\n\u2502   \u251c\u2500\u2500 events.ts            # Events CRUD\n\u2502   \u2514\u2500\u2500 datapoints.ts        # Datapoints fetch\n\u251c\u2500\u2500 views/\n\u2502   \u251c\u2500\u2500 DashboardView.vue    # Real-time sensor data\n\u2502   \u251c\u2500\u2500 ExperimentsView.vue  # Experiment management + CSV export\n\u2502   \u251c\u2500\u2500 EventsView.vue       # Events listing\n\u2502   \u251c\u2500\u2500 DatapointsView.vue   # Raw datapoints table\n\u2502   \u251c\u2500\u2500 LogsView.vue         # System logs\n\u2502   \u251c\u2500\u2500 UsersView.vue        # User management (admin)\n\u2502   \u251c\u2500\u2500 LoginView.vue        # Authentication\n\u2502   \u2514\u2500\u2500 NotFoundView.vue     # 404 page\n\u251c\u2500\u2500 composables/\n\u2502   \u251c\u2500\u2500 useRealtimeDatapoints.ts   # WS-first + polling fallback\n\u2502   \u251c\u2500\u2500 useNotification.ts         # Toast notification system\n\u2502   \u251c\u2500\u2500 useFormatters.ts           # Date, number, relative time formatting\n\u2502   \u2514\u2500\u2500 usePolling.ts              # Generic polling composable\n\u251c\u2500\u2500 services/\n\u2502   \u251c\u2500\u2500 api.ts               # Axios wrapper with JWT interceptor\n\u2502   \u2514\u2500\u2500 websocket.ts         # Generic reconnecting WebSocket client\n\u251c\u2500\u2500 components/\n\u2502   \u251c\u2500\u2500 AppSidebar.vue        # Navigation sidebar\n\u2502   \u251c\u2500\u2500 AppToast.vue          # Custom toast notifications\n\u2502   \u2514\u2500\u2500 AppTopbar.vue         # Top navigation bar\n\u251c\u2500\u2500 types/                    # TypeScript interfaces\n\u2514\u2500\u2500 assets/                   # Styles, images\n</code></pre>"},{"location":"architecture/frontend/#state-management-pinia","title":"State Management (Pinia)","text":"<p>Each store encapsulates a domain:</p> <pre><code>// stores/experiments.ts\nexport const useExperimentsStore = defineStore('experiments', () =&gt; {\n  const experiments = ref&lt;Experiment[]&gt;([])\n  const loading = ref(false)\n\n  async function fetchAll() { /* ... */ }\n  async function create(name: string) { /* ... */ }\n  async function stop(id: string) { /* ... */ }\n\n  return { experiments, loading, fetchAll, create, stop }\n})\n</code></pre>"},{"location":"architecture/frontend/#real-time-data-composable","title":"Real-Time Data Composable","text":"<p>The <code>useRealtimeDatapoints</code> composable implements the WS-first, polling-fallback strategy:</p> <pre><code>stateDiagram-v2\n    [*] --&gt; WebSocket: Mount\n    WebSocket --&gt; WebSocket: onMessage\n    WebSocket --&gt; Retry: onClose\n    Retry --&gt; WebSocket: attempt \u2264 3\n    Retry --&gt; Polling: attempt &gt; 3\n    Polling --&gt; Polling: setInterval</code></pre> <pre><code>const { datapoints, connectionMode } = useRealtimeDatapoints({\n  wsUrl: '/ws/datapoints/stream',\n  pollUrl: '/api/v1/datapoints',\n  pollInterval: 2000,\n  maxWsRetries: 3,\n})\n</code></pre> <p>Returns:</p> Property Type Description <code>datapoints</code> <code>Ref&lt;Datapoint[]&gt;</code> Latest datapoints <code>connectionMode</code> <code>Ref&lt;'ws' \\| 'polling' \\| 'disconnected'&gt;</code> Current transport"},{"location":"architecture/frontend/#custom-toast-notifications","title":"Custom Toast Notifications","text":"<p><code>AppToast.vue</code> replaces PrimeVue's toast with a custom system:</p> <ul> <li>Gradient variants: <code>success</code>, <code>error</code>, <code>warning</code>, <code>info</code></li> <li>Slide-in/out animations via <code>&lt;TransitionGroup&gt;</code></li> <li>Rendered via <code>&lt;Teleport to=\"body\"&gt;</code></li> <li>Uses design tokens for consistent theming</li> </ul>"},{"location":"architecture/frontend/#build-dev","title":"Build &amp; Dev","text":"<pre><code>npm run dev          # Vite dev server \u2192 http://localhost:5173\nnpm run build        # Production build \u2192 dist/\nnpm run lint         # ESLint\nnpm run type-check   # vue-tsc\n</code></pre> <p>In production, Nginx serves the built SPA and proxies <code>/api/</code> and <code>/ws/</code> to the backend.</p>"},{"location":"architecture/frontend/#next-steps","title":"Next Steps","text":"<ul> <li>Controller Architecture \u2014 the IoT agent</li> <li>WebSocket Design \u2014 protocol details</li> </ul>"},{"location":"architecture/overview/","title":"System Overview","text":"<p>WebMACS is a four-component system connected via REST, WebSocket, and a shared PostgreSQL database.</p>"},{"location":"architecture/overview/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>graph TB\n    subgraph Docker Compose\n        DB[(PostgreSQL 17)]\n        Backend[\"FastAPI Backend&lt;br/&gt;:8000\"]\n        Frontend[\"Vue 3 SPA&lt;br/&gt;Nginx :80\"]\n        Controller[\"IoT Controller&lt;br/&gt;Python\"]\n    end\n\n    Controller --&gt;|\"HTTP POST /api/v1/datapoints&lt;br/&gt;or WS /ws/controller/telemetry\"| Backend\n    Backend --&gt;|\"SQLAlchemy 2 async\"| DB\n    Frontend --&gt;|\"REST + WS\"| Backend\n\n    User((User)) --&gt;|\"Browser\"| Frontend\n    Hardware[\"RevPi / Sensors\"] --&gt;|\"I/O\"| Controller</code></pre>"},{"location":"architecture/overview/#components","title":"Components","text":""},{"location":"architecture/overview/#backend-fastapi","title":"Backend (FastAPI)","text":"<p>The backend is the central hub. It:</p> <ul> <li>Exposes a versioned REST API (<code>/api/v1/</code>) with 6 routers</li> <li>Serves two WebSocket endpoints for real-time data</li> <li>Uses SQLAlchemy 2 async ORM with a repository protocol layer</li> <li>Handles JWT authentication with bcrypt password hashing</li> <li>Seeds an initial admin user on first boot</li> </ul> <p>Key files: <code>main.py</code>, <code>config.py</code>, <code>models.py</code>, <code>schemas.py</code>, <code>security.py</code></p> <p>Details \u2192 Backend Architecture</p>"},{"location":"architecture/overview/#frontend-vue-3","title":"Frontend (Vue 3)","text":"<p>A single-page application served by Nginx:</p> <ul> <li>Vue 3 with Composition API and <code>&lt;script setup&gt;</code></li> <li>TypeScript throughout</li> <li>Pinia for state management (auth, experiments, events, datapoints, logs)</li> <li>PrimeVue component library</li> <li>Custom <code>useRealtimeDatapoints</code> composable (WS + HTTP fallback)</li> <li>Custom <code>AppToast</code> notification system</li> </ul> <p>Key views: Dashboard, Experiments, Events, Datapoints, Logs, Users, Login</p> <p>Details \u2192 Frontend Architecture</p>"},{"location":"architecture/overview/#controller-iot-agent","title":"Controller (IoT Agent)","text":"<p>A headless Python process that:</p> <ul> <li>Reads sensor values from hardware (or generates dummy data in dev mode)</li> <li>Authenticates with the backend via JWT</li> <li>Pushes datapoints via HTTP or WebSocket (configurable)</li> <li>Implements auto-reauthentication on 401 responses</li> <li>Has retry logic with exponential backoff</li> </ul> <p>Telemetry modes: <code>http</code> (default) or <code>websocket</code></p> <p>Details \u2192 Controller Architecture</p>"},{"location":"architecture/overview/#database-postgresql","title":"Database (PostgreSQL)","text":"<ul> <li>PostgreSQL 17-alpine in Docker</li> <li>Async driver: <code>asyncpg</code></li> <li>Tables: <code>users</code>, <code>experiments</code>, <code>events</code>, <code>datapoints</code>, <code>logs</code></li> <li>Protocol-based repository abstraction for swapping backends</li> </ul> <p>Details \u2192 Database Abstraction</p>"},{"location":"architecture/overview/#data-flow","title":"Data Flow","text":"<pre><code>sequenceDiagram\n    participant S as Sensor Hardware\n    participant C as Controller\n    participant B as Backend\n    participant DB as PostgreSQL\n    participant F as Frontend\n\n    S-&gt;&gt;C: Read sensor value\n    C-&gt;&gt;B: POST /api/v1/datapoints (or WS)\n    B-&gt;&gt;DB: INSERT INTO datapoints\n    B--&gt;&gt;F: WebSocket broadcast\n    F-&gt;&gt;F: Update dashboard chart</code></pre>"},{"location":"architecture/overview/#technology-decisions","title":"Technology Decisions","text":"Decision Choice Rationale Python 3.14 Latest RC StrEnum, PEP 695 generics, performance FastAPI Async framework Native async, Pydantic v2, OpenAPI docs SQLAlchemy 2 Async ORM Mature, type-safe, async session support Vue 3 Frontend framework Composition API, TypeScript, reactive Pinia State management Official Vue store, devtools support Docker Compose Orchestration Simple, reproducible, single-command Protocol pattern DB abstraction PEP 544 structural subtyping, plug-and-play"},{"location":"architecture/overview/#next-steps","title":"Next Steps","text":"<ul> <li>Backend \u2014 FastAPI internals</li> <li>WebSocket Design \u2014 real-time protocol details</li> <li>Database Abstraction \u2014 Protocol-based storage layer</li> </ul>"},{"location":"architecture/websocket/","title":"WebSocket Design","text":"<p>WebMACS uses WebSockets for two real-time channels: controller telemetry and frontend data streaming.</p>"},{"location":"architecture/websocket/#endpoints","title":"Endpoints","text":"Endpoint Direction Purpose <code>/ws/controller/telemetry</code> Controller \u2192 Backend Push sensor readings <code>/ws/datapoints/stream</code> Backend \u2192 Frontend Broadcast new datapoints"},{"location":"architecture/websocket/#architecture","title":"Architecture","text":"<pre><code>graph LR\n    Controller --&gt;|\"WS /ws/controller/telemetry\"| WS_Hub[\"Connection Manager&lt;br/&gt;(Pub/Sub Hub)\"]\n    WS_Hub --&gt;|\"broadcast\"| F1[\"Frontend Client 1\"]\n    WS_Hub --&gt;|\"broadcast\"| F2[\"Frontend Client 2\"]\n    WS_Hub --&gt;|\"persist\"| DB[(PostgreSQL)]</code></pre>"},{"location":"architecture/websocket/#connection-manager","title":"Connection Manager","text":"<p>The <code>ConnectionManager</code> is a pub/sub hub that:</p> <ol> <li>Accepts incoming WebSocket connections</li> <li>Maintains a set of active connections per topic</li> <li>Broadcasts messages to all subscribers</li> <li>Handles disconnection cleanup</li> </ol> <pre><code>class ConnectionManager:\n    def __init__(self):\n        self._connections: dict[str, set[WebSocket]] = {}\n\n    async def connect(self, topic: str, ws: WebSocket): ...\n    async def disconnect(self, topic: str, ws: WebSocket): ...\n    async def broadcast(self, topic: str, data: dict): ...\n</code></pre>"},{"location":"architecture/websocket/#controller-backend-protocol","title":"Controller \u2192 Backend Protocol","text":""},{"location":"architecture/websocket/#message-format","title":"Message Format","text":"<pre><code>{\n  \"event_public_id\": \"evt_temp01\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\"\n}\n</code></pre>"},{"location":"architecture/websocket/#flow","title":"Flow","text":"<ol> <li>Controller opens WS to <code>/ws/controller/telemetry</code></li> <li>Backend authenticates via token query parameter</li> <li>Controller sends JSON messages at <code>poll_interval</code></li> <li>Backend persists to DB and broadcasts to <code>/ws/datapoints/stream</code> subscribers</li> <li>Backend sends heartbeat pings every <code>ws_heartbeat_interval</code> seconds</li> </ol>"},{"location":"architecture/websocket/#backend-frontend-protocol","title":"Backend \u2192 Frontend Protocol","text":""},{"location":"architecture/websocket/#message-format_1","title":"Message Format","text":"<pre><code>{\n  \"public_id\": \"dp_abc123\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\",\n  \"event_public_id\": \"evt_temp01\",\n  \"experiment_public_id\": \"exp_001\"\n}\n</code></pre>"},{"location":"architecture/websocket/#client-reconnection","title":"Client Reconnection","text":"<p>The frontend <code>websocket.ts</code> service implements:</p> <ul> <li>Automatic reconnection with exponential backoff</li> <li>Maximum 3 retry attempts</li> <li>Fallback to HTTP polling after exhausting retries</li> <li>Clean disconnect on component unmount</li> </ul>"},{"location":"architecture/websocket/#nginx-proxy-configuration","title":"Nginx Proxy Configuration","text":"<p>For WebSocket passthrough, the Nginx config includes:</p> <pre><code>location /ws/ {\n    proxy_pass http://backend:8000;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"upgrade\";\n    proxy_set_header Host $host;\n    proxy_read_timeout 86400;\n}\n</code></pre> <p>The <code>proxy_read_timeout</code> is set to 24 hours to prevent premature disconnection of long-lived WebSocket connections.</p>"},{"location":"architecture/websocket/#sequence-diagram","title":"Sequence Diagram","text":"<pre><code>sequenceDiagram\n    participant C as Controller\n    participant B as Backend WS Hub\n    participant DB as PostgreSQL\n    participant F as Frontend\n\n    C-&gt;&gt;B: WS Connect /ws/controller/telemetry\n    F-&gt;&gt;B: WS Connect /ws/datapoints/stream\n\n    loop Every 0.5s\n        C-&gt;&gt;B: {\"event_public_id\": \"...\", \"value\": 23.4}\n        B-&gt;&gt;DB: INSERT INTO datapoints\n        B-&gt;&gt;F: {\"public_id\": \"...\", \"value\": 23.4, ...}\n    end\n\n    B-&gt;&gt;C: ping (heartbeat)\n    C-&gt;&gt;B: pong</code></pre>"},{"location":"architecture/websocket/#next-steps","title":"Next Steps","text":"<ul> <li>Database Abstraction \u2014 how data is persisted</li> <li>API Reference: WebSocket \u2014 endpoint documentation</li> </ul>"},{"location":"deployment/docker/","title":"Docker Deployment","text":"<p>WebMACS runs as a four-container Docker Compose stack.</p>"},{"location":"deployment/docker/#architecture","title":"Architecture","text":"<pre><code>graph TB\n    subgraph Docker Network\n        DB[\"db&lt;br/&gt;postgres:17-alpine&lt;br/&gt;:5432\"]\n        Backend[\"backend&lt;br/&gt;FastAPI/Uvicorn&lt;br/&gt;:8000\"]\n        Frontend[\"frontend&lt;br/&gt;Nginx + Vue SPA&lt;br/&gt;:80\"]\n        Controller[\"controller&lt;br/&gt;Python Agent\"]\n    end\n\n    Frontend --&gt;|\"/api/* proxy\"| Backend\n    Frontend --&gt;|\"/ws/* proxy\"| Backend\n    Controller --&gt;|\"HTTP/WS\"| Backend\n    Backend --&gt;|\"asyncpg\"| DB</code></pre>"},{"location":"deployment/docker/#quick-start","title":"Quick Start","text":"<pre><code>cp .env.example .env\ndocker compose up --build -d\n</code></pre>"},{"location":"deployment/docker/#verify","title":"Verify","text":"<pre><code>docker compose ps\n# All 4 services should show \"healthy\" or \"running\"\n\ncurl http://localhost/health\n# {\"status\":\"healthy\"}\n</code></pre>"},{"location":"deployment/docker/#services","title":"Services","text":""},{"location":"deployment/docker/#db-postgresql","title":"<code>db</code> \u2014 PostgreSQL","text":"<pre><code>image: postgres:17-alpine\nports: [\"5432:5432\"]\nvolumes: [pgdata:/var/lib/postgresql/data]\nhealthcheck: pg_isready -U webmacs\n</code></pre>"},{"location":"deployment/docker/#backend-fastapi","title":"<code>backend</code> \u2014 FastAPI","text":"<pre><code>build: docker/backend.Dockerfile\nports: [\"8000:8000\"]\ndepends_on: db (healthy)\nhealthcheck: urllib.request.urlopen('http://localhost:8000/health')\n</code></pre>"},{"location":"deployment/docker/#frontend-nginx-vue","title":"<code>frontend</code> \u2014 Nginx + Vue","text":"<pre><code>build: docker/frontend.Dockerfile\nports: [\"80:80\"]\ndepends_on: [backend]\n</code></pre> <p>Nginx serves the built Vue SPA and proxies <code>/api/</code> and <code>/ws/</code> to the backend.</p>"},{"location":"deployment/docker/#controller-iot-agent","title":"<code>controller</code> \u2014 IoT Agent","text":"<pre><code>build: docker/controller.Dockerfile\ndepends_on: backend (healthy)\n</code></pre>"},{"location":"deployment/docker/#docker-files","title":"Docker Files","text":"File Description <code>docker/backend.Dockerfile</code> Python 3.14-rc-slim + UV + FastAPI <code>docker/frontend.Dockerfile</code> Node 22 build stage \u2192 Nginx serve stage <code>docker/controller.Dockerfile</code> Python 3.14-rc-slim + UV + controller <code>docker/nginx.conf</code> Nginx config with API + WebSocket proxy"},{"location":"deployment/docker/#common-commands","title":"Common Commands","text":"<pre><code># Start all services\ndocker compose up -d\n\n# Rebuild after code changes\ndocker compose up --build -d\n\n# View logs\ndocker compose logs -f backend\ndocker compose logs -f controller\n\n# Stop everything\ndocker compose down\n\n# Stop and remove data\ndocker compose down -v   # \u26a0\ufe0f deletes database\n\n# Restart single service\ndocker compose restart backend\n</code></pre>"},{"location":"deployment/docker/#volumes","title":"Volumes","text":"Volume Mounted At Purpose <code>pgdata</code> <code>/var/lib/postgresql/data</code> Persistent database storage"},{"location":"deployment/docker/#next-steps","title":"Next Steps","text":"<ul> <li>Production Deployment \u2014 hardening for production</li> <li>Environment Variables \u2014 full configuration reference</li> </ul>"},{"location":"deployment/env-vars/","title":"Environment Variables","text":"<p>Complete reference of all environment variables used by WebMACS.</p>"},{"location":"deployment/env-vars/#backend","title":"Backend","text":"Variable Required Default Description <code>DATABASE_URL</code> Yes <code>postgresql+asyncpg://...localhost...</code> SQLAlchemy async connection string <code>SECRET_KEY</code> Yes (empty) JWT signing secret \u2014 must set in production <code>ALGORITHM</code> No <code>HS256</code> JWT algorithm <code>ACCESS_TOKEN_EXPIRE_MINUTES</code> No <code>1440</code> Token lifetime (minutes) <code>BACKEND_HOST</code> No <code>0.0.0.0</code> Uvicorn bind host <code>BACKEND_PORT</code> No <code>8000</code> Uvicorn bind port <code>CORS_ORIGINS</code> No <code>[\"http://localhost:3000\",\"http://localhost:5173\"]</code> JSON array of allowed origins <code>DEBUG</code> No <code>false</code> Enable debug mode <code>STORAGE_BACKEND</code> No <code>postgresql</code> <code>postgresql</code> or <code>timescale</code> <code>SENTRY_DSN</code> No (empty) Sentry error tracking URL <code>WS_HEARTBEAT_INTERVAL</code> No <code>30</code> WebSocket heartbeat (seconds) <code>TIMEZONE</code> No <code>Europe/Berlin</code> Default timezone <code>INITIAL_ADMIN_EMAIL</code> No <code>admin@webmacs.io</code> Seed admin email <code>INITIAL_ADMIN_USERNAME</code> No <code>admin</code> Seed admin username <code>INITIAL_ADMIN_PASSWORD</code> No <code>admin123</code> Seed admin password"},{"location":"deployment/env-vars/#controller","title":"Controller","text":"Variable Required Default Description <code>WEBMACS_ENV</code> No <code>development</code> <code>development</code> or <code>production</code> <code>WEBMACS_SERVER_URL</code> Yes <code>http://localhost</code> Backend base URL <code>WEBMACS_SERVER_PORT</code> Yes <code>8000</code> Backend port <code>WEBMACS_ADMIN_EMAIL</code> Yes \u2014 Login credentials for controller <code>WEBMACS_ADMIN_PASSWORD</code> Yes \u2014 Login password <code>WEBMACS_POLL_INTERVAL</code> No <code>0.5</code> Sensor read interval (seconds) <code>WEBMACS_REQUEST_TIMEOUT</code> No <code>30.0</code> HTTP timeout (seconds) <code>WEBMACS_TELEMETRY_MODE</code> No <code>http</code> <code>http</code> or <code>websocket</code> <code>WEBMACS_RULE_EVENT_ID</code> No (empty) Event triggering rule evaluation <code>WEBMACS_REVPI_MAPPING</code> No <code>{}</code> JSON: RevPi I/O pin \u2192 event ID"},{"location":"deployment/env-vars/#docker-compose","title":"Docker Compose","text":"<p>These are used in <code>docker-compose.yml</code> and passed through to services:</p> Variable Default Used By <code>DB_PASSWORD</code> <code>webmacs_dev_password</code> db, backend <code>SECRET_KEY</code> <code>change-me-in-production</code> backend <code>ADMIN_EMAIL</code> <code>admin@webmacs.io</code> backend, controller <code>ADMIN_USERNAME</code> <code>admin</code> backend <code>ADMIN_PASSWORD</code> <code>admin123</code> backend, controller <code>TELEMETRY_MODE</code> <code>http</code> controller"},{"location":"deployment/env-vars/#generating-secrets","title":"Generating Secrets","text":"<pre><code># Secret key (64 hex chars)\nopenssl rand -hex 32\n\n# Database password\nopenssl rand -base64 24\n\n# Admin password\nopenssl rand -base64 16\n</code></pre>"},{"location":"deployment/env-vars/#example-env","title":"Example <code>.env</code>","text":"<pre><code># Database\nDATABASE_URL=postgresql+asyncpg://webmacs:MyStr0ngPwd!@db:5432/webmacs\nDB_PASSWORD=MyStr0ngPwd!\n\n# Security\nSECRET_KEY=a1b2c3d4e5f6...64chars\nACCESS_TOKEN_EXPIRE_MINUTES=60\n\n# Admin\nADMIN_EMAIL=admin@company.com\nADMIN_USERNAME=admin\nADMIN_PASSWORD=Ch4ng3M3!\n\n# Controller\nTELEMETRY_MODE=websocket\n</code></pre>"},{"location":"deployment/env-vars/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Setup \u2014 container configuration</li> <li>Production Guide \u2014 hardening checklist</li> </ul>"},{"location":"deployment/production/","title":"Production Deployment","text":"<p>This guide covers hardening WebMACS for production environments.</p>"},{"location":"deployment/production/#security-checklist","title":"Security Checklist","text":"<ul> <li>[ ] Generate a strong <code>SECRET_KEY</code> (<code>openssl rand -hex 32</code>)</li> <li>[ ] Change default admin password</li> <li>[ ] Set <code>DEBUG=false</code></li> <li>[ ] Use a strong <code>DB_PASSWORD</code></li> <li>[ ] Restrict <code>CORS_ORIGINS</code> to your domain</li> <li>[ ] Enable HTTPS (TLS termination at load balancer or Nginx)</li> <li>[ ] Configure Sentry for error tracking (<code>SENTRY_DSN</code>)</li> </ul>"},{"location":"deployment/production/#environment-file","title":"Environment File","text":"<p>Create a production <code>.env</code>:</p> <pre><code># Security\nSECRET_KEY=&lt;generated-64-char-hex&gt;\nALGORITHM=HS256\nACCESS_TOKEN_EXPIRE_MINUTES=60\n\n# Database\nDATABASE_URL=postgresql+asyncpg://webmacs:&lt;strong-password&gt;@db:5432/webmacs\nDB_PASSWORD=&lt;strong-password&gt;\n\n# Admin\nINITIAL_ADMIN_EMAIL=admin@yourcompany.com\nINITIAL_ADMIN_USERNAME=admin\nINITIAL_ADMIN_PASSWORD=&lt;strong-password&gt;\n\n# Backend\nCORS_ORIGINS=[\"https://webmacs.yourcompany.com\"]\nDEBUG=false\nWEBMACS_ENV=production\n\n# Controller\nWEBMACS_TELEMETRY_MODE=websocket\n</code></pre>"},{"location":"deployment/production/#https-tls","title":"HTTPS / TLS","text":""},{"location":"deployment/production/#option-1-reverse-proxy-recommended","title":"Option 1: Reverse Proxy (Recommended)","text":"<p>Place a TLS-terminating reverse proxy (Traefik, Caddy, cloud LB) in front of the Nginx container.</p>"},{"location":"deployment/production/#option-2-nginx-with-certbot","title":"Option 2: Nginx with Certbot","text":"<p>Add SSL configuration to <code>docker/nginx.conf</code>:</p> <pre><code>server {\n    listen 443 ssl;\n    ssl_certificate /etc/letsencrypt/live/webmacs.example.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/webmacs.example.com/privkey.pem;\n\n    # ... existing location blocks\n}\n</code></pre>"},{"location":"deployment/production/#database-backups","title":"Database Backups","text":""},{"location":"deployment/production/#automated-dump","title":"Automated Dump","text":"<pre><code>docker compose exec db pg_dump -U webmacs webmacs &gt; backup_$(date +%Y%m%d).sql\n</code></pre>"},{"location":"deployment/production/#restore","title":"Restore","text":"<pre><code>cat backup_20250115.sql | docker compose exec -T db psql -U webmacs webmacs\n</code></pre>"},{"location":"deployment/production/#scheduled-backups","title":"Scheduled Backups","text":"<p>Add a cron job:</p> <pre><code>0 2 * * * cd /path/to/webmacs &amp;&amp; docker compose exec -T db pg_dump -U webmacs webmacs | gzip &gt; /backups/webmacs_$(date +\\%Y\\%m\\%d).sql.gz\n</code></pre>"},{"location":"deployment/production/#monitoring","title":"Monitoring","text":""},{"location":"deployment/production/#health-endpoints","title":"Health Endpoints","text":"Endpoint Service Purpose <code>GET /health</code> Backend Application health <code>pg_isready</code> PostgreSQL Database connectivity"},{"location":"deployment/production/#sentry-integration","title":"Sentry Integration","text":"<p>Set <code>SENTRY_DSN</code> to enable error tracking:</p> <pre><code>SENTRY_DSN=https://abc123@sentry.io/12345\n</code></pre>"},{"location":"deployment/production/#logging","title":"Logging","text":"<p>The backend uses structlog for structured JSON logging. In production, pipe logs to your log aggregator (ELK, Loki, CloudWatch).</p>"},{"location":"deployment/production/#scaling-considerations","title":"Scaling Considerations","text":"Component Scaling Notes Backend Horizontal Run multiple replicas behind a load balancer Frontend CDN Serve static files from a CDN Controller Single One controller per physical installation Database Vertical / Read replicas Consider TimescaleDB for time-series"},{"location":"deployment/production/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Setup \u2014 container configuration</li> <li>Environment Variables \u2014 full reference</li> </ul>"},{"location":"development/code-style/","title":"Code Style","text":"<p>WebMACS enforces consistent code style across all components.</p>"},{"location":"development/code-style/#python-backend-controller","title":"Python (Backend &amp; Controller)","text":""},{"location":"development/code-style/#formatter-linter-ruff","title":"Formatter &amp; Linter: Ruff","text":"<p>Ruff handles both formatting and linting:</p> <pre><code># pyproject.toml\n[tool.ruff]\ntarget-version = \"py314\"\nline-length = 120\n\n[tool.ruff.lint]\nselect = [\n    \"E\", \"F\", \"W\",     # pycodestyle, pyflakes\n    \"I\",                # isort\n    \"N\",                # pep8-naming\n    \"UP\",               # pyupgrade\n    \"S\",                # bandit (security)\n    \"B\",                # bugbear\n    \"A\",                # builtins\n    \"C4\",               # comprehensions\n    \"DTZ\",              # datetime timezone\n    \"T20\",              # print statements\n    \"PT\",               # pytest style\n    \"SIM\",              # simplify\n    \"TID\",              # tidy imports\n    \"TCH\",              # type checking\n    \"ARG\",              # unused arguments\n    \"PL\",               # pylint\n    \"TRY\",              # tryceratops\n    \"PERF\",             # performance\n    \"RUF\",              # ruff-specific\n]\nignore = [\"S101\", \"TRY003\", \"PLR0913\"]\n</code></pre>"},{"location":"development/code-style/#type-checking-mypy","title":"Type Checking: mypy","text":"<pre><code>[tool.mypy]\npython_version = \"3.14\"\nstrict = true\ndisallow_untyped_defs = true\n</code></pre>"},{"location":"development/code-style/#commands","title":"Commands","text":"<pre><code>just lint       # ruff check + format check\njust format     # ruff format (auto-fix)\njust fix        # format + lint-fix\n</code></pre>"},{"location":"development/code-style/#typescript-frontend","title":"TypeScript (Frontend)","text":""},{"location":"development/code-style/#linter-eslint","title":"Linter: ESLint","text":"<p>The frontend uses ESLint with Vue and TypeScript rules:</p> <pre><code>npm run lint        # Check\nnpm run lint:fix    # Auto-fix\n</code></pre>"},{"location":"development/code-style/#type-checking-vue-tsc","title":"Type Checking: vue-tsc","text":"<pre><code>npm run type-check\n</code></pre>"},{"location":"development/code-style/#conventions","title":"Conventions","text":""},{"location":"development/code-style/#python","title":"Python","text":"<ul> <li>Imports: Sorted by <code>isort</code> (via Ruff). First-party packages: <code>webmacs_backend</code>, <code>webmacs_controller</code></li> <li>Docstrings: Google style</li> <li>Naming: <code>snake_case</code> for functions/variables, <code>PascalCase</code> for classes</li> <li>Type hints: Required on all public functions (mypy strict mode)</li> <li>Async: Use <code>async def</code> for all I/O-bound operations</li> </ul>"},{"location":"development/code-style/#typescript","title":"TypeScript","text":"<ul> <li>Naming: <code>camelCase</code> for variables/functions, <code>PascalCase</code> for components/types</li> <li>Composition API: <code>&lt;script setup lang=\"ts\"&gt;</code> for all components</li> <li>Types: Explicit interfaces in <code>types/</code> directory</li> <li>Imports: Absolute paths from <code>@/</code> alias</li> </ul>"},{"location":"development/code-style/#commits","title":"Commits","text":"<p>Follow Conventional Commits \u2014 see Contributing.</p>"},{"location":"development/code-style/#pre-commit-checks","title":"Pre-Commit Checks","text":"<p>Run before every commit:</p> <pre><code>just check      # lint + type-check + test\n</code></pre> <p>Or integrate with git hooks:</p> <pre><code># .pre-commit-config.yaml support planned\n</code></pre>"},{"location":"development/code-style/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing \u2014 full development workflow</li> <li>Testing \u2014 test structure and patterns</li> </ul>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Contributions to WebMACS are welcome. Here is how to get involved.</p>"},{"location":"development/contributing/#development-setup","title":"Development Setup","text":""},{"location":"development/contributing/#1-clone-the-repository","title":"1. Clone the repository","text":"<pre><code>git clone https://github.com/stefanposs/webmacs.git\ncd webmacs\n</code></pre>"},{"location":"development/contributing/#2-install-dependencies","title":"2. Install dependencies","text":"<pre><code># Backend\ncd backend &amp;&amp; uv sync --all-extras &amp;&amp; cd ..\n\n# Controller\ncd controller &amp;&amp; uv sync --all-extras &amp;&amp; cd ..\n\n# Frontend\ncd frontend &amp;&amp; npm install &amp;&amp; cd ..\n</code></pre>"},{"location":"development/contributing/#3-verify-installation","title":"3. Verify installation","text":"<pre><code>just test       # Run all tests\njust lint       # Check code style\n</code></pre>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"development/contributing/#available-commands","title":"Available Commands","text":"<pre><code># Setup\njust setup              # Install all dependencies\n\n# Code quality\njust lint               # Run ruff linter on backend + controller\njust format             # Auto-format code\njust fix                # Format + lint-fix\n\n# Testing\njust test               # Run all tests (backend + controller + frontend)\njust test-backend       # Backend tests only\njust test-controller    # Controller tests only\njust test-frontend      # Frontend tests only\n\n# Docker\njust dev                # Start full Docker stack\njust down               # Stop all containers\njust rebuild            # Rebuild and restart\n\n# Documentation\njust docs               # Serve docs locally (http://localhost:8001)\njust docs-build         # Build static docs\n\n# Quality\njust qa                 # Full QA: lint + format-check + test\njust check              # Quick check before commit\n</code></pre>"},{"location":"development/contributing/#branch-strategy","title":"Branch Strategy","text":"Branch Purpose <code>main</code> Production-ready code <code>develop</code> Integration branch <code>feature/*</code> New features <code>fix/*</code> Bug fixes <code>docs/*</code> Documentation updates"},{"location":"development/contributing/#commit-messages","title":"Commit Messages","text":"<p>Follow Conventional Commits:</p> Prefix Purpose <code>feat:</code> New feature <code>fix:</code> Bug fix <code>docs:</code> Documentation <code>test:</code> Tests <code>refactor:</code> Code refactoring <code>perf:</code> Performance improvements <code>ci:</code> CI/CD changes <code>chore:</code> Maintenance"},{"location":"development/contributing/#pull-request-process","title":"Pull Request Process","text":""},{"location":"development/contributing/#1-create-feature-branch","title":"1. Create feature branch","text":"<pre><code>git checkout -b feature/my-awesome-feature\n</code></pre>"},{"location":"development/contributing/#2-make-changes","title":"2. Make changes","text":"<ul> <li>Write tests for new functionality</li> <li>Ensure <code>just qa</code> passes</li> <li>Update documentation if needed</li> </ul>"},{"location":"development/contributing/#3-push-and-open-pr","title":"3. Push and open PR","text":"<pre><code>git push origin feature/my-awesome-feature\n</code></pre> <p>Open a PR against <code>develop</code> (or <code>main</code> for hotfixes).</p>"},{"location":"development/contributing/#4-code-review","title":"4. Code review","text":"<ul> <li>At least one approval required</li> <li>CI must pass</li> <li>No merge conflicts</li> </ul>"},{"location":"development/contributing/#cicd-pipeline","title":"CI/CD Pipeline","text":"<p>GitHub Actions runs on every push:</p> <ul> <li>Python: Ruff linting, mypy type checking, pytest with coverage</li> <li>Frontend: ESLint, vue-tsc type checking, Vite build, vitest</li> <li>Matrix: Backend + Controller tested separately</li> <li>Services: PostgreSQL 17 for integration tests</li> </ul>"},{"location":"development/contributing/#release-process","title":"Release Process","text":"<ol> <li>Merge to <code>main</code></li> <li>Tag version: <code>git tag v2.x.x</code></li> <li>Push tags: <code>git push --tags</code></li> <li>Docker images rebuilt automatically</li> </ol>"},{"location":"development/contributing/#questions","title":"Questions?","text":"<p>Open a GitHub Issue.</p>"},{"location":"development/testing/","title":"Testing","text":"<p>WebMACS has three test suites: backend (Python), controller (Python), and frontend (TypeScript).</p>"},{"location":"development/testing/#test-structure","title":"Test Structure","text":"<pre><code>\u251c\u2500\u2500 backend/tests/\n\u2502   \u251c\u2500\u2500 conftest.py           # Fixtures (async session, test client, auth)\n\u2502   \u251c\u2500\u2500 test_auth.py          # Login, JWT validation, logout\n\u2502   \u251c\u2500\u2500 test_datapoints.py    # Datapoints batch, latest, CRUD\n\u2502   \u2514\u2500\u2500 test_events.py        # Events CRUD + duplicates\n\u251c\u2500\u2500 controller/tests/\n\u2502   \u251c\u2500\u2500 conftest.py           # Fixtures (mock API client)\n\u2502   \u251c\u2500\u2500 test_api_client.py    # HTTP client + retry logic\n\u2502   \u251c\u2500\u2500 test_hardware.py      # Hardware abstraction tests\n\u2502   \u2514\u2500\u2500 test_sensor_manager.py # Sensor reading tests\n\u2514\u2500\u2500 frontend/src/\n    \u251c\u2500\u2500 composables/__tests__/  # useFormatters, useNotification\n    \u251c\u2500\u2500 stores/__tests__/       # auth, events, experiments, datapoints\n    \u251c\u2500\u2500 services/__tests__/     # api, websocket\n    \u2514\u2500\u2500 types/__tests__/        # TypeScript enum validation\n</code></pre>"},{"location":"development/testing/#running-tests","title":"Running Tests","text":""},{"location":"development/testing/#all-tests","title":"All Tests","text":"<pre><code>just test\n</code></pre>"},{"location":"development/testing/#by-component","title":"By Component","text":"<pre><code>just test-backend       # Backend only\njust test-controller    # Controller only\njust test-frontend      # Frontend only\n</code></pre>"},{"location":"development/testing/#with-coverage","title":"With Coverage","text":"<pre><code>cd backend &amp;&amp; uv run pytest tests/ -v --cov --cov-report=html\n</code></pre> <p>Open <code>htmlcov/index.html</code> to view the coverage report.</p>"},{"location":"development/testing/#backend-test-setup","title":"Backend Test Setup","text":"<p>Tests use an in-memory SQLite database by default (overridable via <code>DATABASE_URL</code> env var).</p>"},{"location":"development/testing/#key-fixtures-conftestpy","title":"Key Fixtures (<code>conftest.py</code>)","text":"Fixture Scope Description <code>engine</code> session Async SQLAlchemy engine <code>session</code> function Async session (auto-rolled-back) <code>client</code> function <code>httpx.AsyncClient</code> against the test app <code>auth_headers</code> function <code>{\"Authorization\": \"Bearer ...\"}</code> for authenticated requests <code>admin_user</code> function Pre-seeded admin user"},{"location":"development/testing/#example-test","title":"Example Test","text":"<pre><code>@pytest.mark.asyncio\nasync def test_create_experiment(client, auth_headers):\n    response = await client.post(\n        \"/api/v1/experiments\",\n        json={\"name\": \"Test Run\"},\n        headers=auth_headers,\n    )\n    assert response.status_code == 201\n    data = response.json()\n    assert data[\"name\"] == \"Test Run\"\n    assert data[\"started_on\"] is not None\n</code></pre>"},{"location":"development/testing/#controller-test-setup","title":"Controller Test Setup","text":"<p>Controller tests mock the HTTP client to avoid needing a running backend:</p> <pre><code>@pytest.fixture\ndef mock_api_client(mocker):\n    client = mocker.MagicMock(spec=APIClient)\n    client.post = mocker.AsyncMock(return_value={\"status\": \"ok\"})\n    return client\n</code></pre>"},{"location":"development/testing/#frontend-tests","title":"Frontend Tests","text":"<pre><code>cd frontend\nnpm run test -- --run     # Single run\nnpm run test -- --watch   # Watch mode\n</code></pre> <p>Uses Vitest with Vue Test Utils.</p>"},{"location":"development/testing/#ci-integration","title":"CI Integration","text":"<p>GitHub Actions runs the full test matrix:</p> Job Python OS Services <code>python</code> 3.14 ubuntu-latest PostgreSQL 17 <code>frontend</code> \u2014 ubuntu-latest \u2014 <p>Coverage reports are uploaded to Codecov.</p>"},{"location":"development/testing/#test-markers","title":"Test Markers","text":"<pre><code>@pytest.mark.unit          # Fast, no external deps\n@pytest.mark.integration   # Needs database\n@pytest.mark.e2e           # Full stack\n</code></pre> <p>Run specific markers:</p> <pre><code>uv run pytest -m unit\nuv run pytest -m integration\n</code></pre>"},{"location":"development/testing/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing \u2014 development workflow</li> <li>Code Style \u2014 formatting and linting rules</li> </ul>"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>WebMACS is configured entirely through environment variables. Copy <code>.env.example</code> to <code>.env</code> and customise as needed.</p>"},{"location":"getting-started/configuration/#backend-settings","title":"Backend Settings","text":"Variable Default Description <code>DATABASE_URL</code> <code>postgresql+asyncpg://webmacs:webmacs@localhost:5432/webmacs</code> Async SQLAlchemy connection string <code>SECRET_KEY</code> (empty \u2014 must set) JWT signing key. Generate with <code>openssl rand -hex 32</code> <code>ACCESS_TOKEN_EXPIRE_MINUTES</code> <code>1440</code> JWT token lifetime (default 24 h) <code>ALGORITHM</code> <code>HS256</code> JWT algorithm <code>BACKEND_HOST</code> <code>0.0.0.0</code> Uvicorn bind address <code>BACKEND_PORT</code> <code>8000</code> Uvicorn port <code>CORS_ORIGINS</code> <code>[\"http://localhost:3000\",\"http://localhost:5173\"]</code> Allowed CORS origins (JSON array) <code>DEBUG</code> <code>false</code> Enable debug mode <code>STORAGE_BACKEND</code> <code>postgresql</code> Database backend: <code>postgresql</code> or <code>timescale</code> <code>SENTRY_DSN</code> (empty) Optional Sentry error tracking <code>WS_HEARTBEAT_INTERVAL</code> <code>30</code> WebSocket heartbeat interval (seconds) <code>TIMEZONE</code> <code>Europe/Berlin</code> Default timezone for timestamps"},{"location":"getting-started/configuration/#initial-admin-user","title":"Initial Admin User","text":"Variable Default Description <code>INITIAL_ADMIN_EMAIL</code> <code>admin@webmacs.io</code> Email for the auto-seeded admin <code>INITIAL_ADMIN_USERNAME</code> <code>admin</code> Username <code>INITIAL_ADMIN_PASSWORD</code> <code>admin123</code> Password \u2014 change in production!"},{"location":"getting-started/configuration/#controller-settings","title":"Controller Settings","text":"Variable Default Description <code>WEBMACS_ENV</code> <code>development</code> Environment (<code>development</code> / <code>production</code>) <code>WEBMACS_SERVER_URL</code> <code>http://localhost</code> Backend base URL <code>WEBMACS_SERVER_PORT</code> <code>8000</code> Backend port <code>WEBMACS_ADMIN_EMAIL</code> <code>admin@example.com</code> Credentials for controller \u2194 backend auth <code>WEBMACS_ADMIN_PASSWORD</code> (set in .env) Password for auto-login <code>WEBMACS_POLL_INTERVAL</code> <code>0.5</code> Sensor polling interval (seconds) <code>WEBMACS_REQUEST_TIMEOUT</code> <code>30.0</code> HTTP request timeout <code>WEBMACS_TELEMETRY_MODE</code> <code>http</code> <code>http</code> or <code>websocket</code> <code>WEBMACS_RULE_EVENT_ID</code> (empty) Event public_id triggering rule evaluation <code>WEBMACS_REVPI_MAPPING</code> <code>{}</code> JSON mapping of RevPi I/O pins to event ids"},{"location":"getting-started/configuration/#docker-compose-variables","title":"Docker Compose Variables","text":"<p>These are used by <code>docker-compose.yml</code>:</p> Variable Default Description <code>DB_PASSWORD</code> <code>webmacs_dev_password</code> PostgreSQL password <code>ADMIN_EMAIL</code> <code>admin@webmacs.io</code> Passed to backend + controller <code>ADMIN_USERNAME</code> <code>admin</code> Admin username <code>ADMIN_PASSWORD</code> <code>admin123</code> Admin password <code>TELEMETRY_MODE</code> <code>http</code> Controller telemetry transport"},{"location":"getting-started/configuration/#generating-a-secret-key","title":"Generating a Secret Key","text":"<pre><code>openssl rand -hex 32\n</code></pre> <p>Copy the output into <code>SECRET_KEY</code> in your <code>.env</code> file.</p>"},{"location":"getting-started/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Deployment \u2014 production Docker setup</li> <li>Environment Variables Reference \u2014 full reference</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"Tool Version Purpose Docker 24+ Container runtime Docker Compose v2+ Multi-container orchestration Git 2.x Source control just 1.x Task runner (optional, recommended) <p>For local development without Docker you also need:</p> Tool Version Purpose Python 3.14+ Backend &amp; Controller Node.js 22+ Frontend build PostgreSQL 17+ Database"},{"location":"getting-started/installation/#clone-the-repository","title":"Clone the Repository","text":"<pre><code>git clone https://github.com/stefanposs/webmacs.git\ncd webmacs\n</code></pre>"},{"location":"getting-started/installation/#docker-recommended","title":"Docker (Recommended)","text":"<p>The fastest way to run WebMACS:</p> <pre><code># Copy environment defaults\ncp .env.example .env\n\n# Build &amp; start all four services\ndocker compose up --build -d\n</code></pre> <p>This spins up:</p> Service Port Description <code>db</code> 5432 PostgreSQL 17-alpine <code>backend</code> 8000 FastAPI (Uvicorn) <code>frontend</code> 80 Vue 3 SPA (Nginx) <code>controller</code> \u2014 IoT telemetry agent <p>Verify everything is healthy:</p> <pre><code>docker compose ps\n</code></pre>"},{"location":"getting-started/installation/#local-development-setup","title":"Local Development Setup","text":""},{"location":"getting-started/installation/#backend","title":"Backend","text":"<pre><code>cd backend\nuv sync --all-extras\nuv run uvicorn webmacs_backend.main:create_app --factory --reload --port 8000\n</code></pre>"},{"location":"getting-started/installation/#frontend","title":"Frontend","text":"<pre><code>cd frontend\nnpm install\nnpm run dev          # \u2192 http://localhost:5173\n</code></pre>"},{"location":"getting-started/installation/#controller","title":"Controller","text":"<pre><code>cd controller\nuv sync --all-extras\nuv run python -m webmacs_controller\n</code></pre>"},{"location":"getting-started/installation/#install-just-task-runner","title":"Install <code>just</code> (Task Runner)","text":"<pre><code># macOS\nbrew install just\n\n# Linux\ncurl --proto '=https' --tlsv1.2 -sSf https://just.systems/install.sh | bash -s -- --to /usr/local/bin\n\n# Windows (scoop)\nscoop install just\n</code></pre> <p>Then run <code>just</code> from the project root to see all available commands:</p> <pre><code>just          # lists all recipes\njust dev      # start full dev stack\njust test     # run all tests\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start \u2014 first login and experiment</li> <li>Configuration \u2014 environment variables reference</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>This guide walks you through your first WebMACS session \u2014 from login to running an experiment.</p>"},{"location":"getting-started/quick-start/#1-start-the-stack","title":"1. Start the Stack","text":"<pre><code>cd webmacs\ndocker compose up -d\n</code></pre> <p>Open http://localhost in your browser.</p>"},{"location":"getting-started/quick-start/#2-log-in","title":"2. Log In","text":"<p>The backend automatically seeds an initial admin user on first startup:</p> Field Default Email <code>admin@webmacs.io</code> Password <code>admin123</code> <p>Change the default password</p> <p>Set <code>INITIAL_ADMIN_PASSWORD</code> in your <code>.env</code> file before deploying to any shared environment.</p>"},{"location":"getting-started/quick-start/#3-explore-the-dashboard","title":"3. Explore the Dashboard","text":"<p>The Dashboard shows real-time sensor data:</p> <ul> <li>WebSocket mode \u2014 data streams in via <code>/ws/datapoints/stream</code> (green indicator)</li> <li>Polling fallback \u2014 if WebSocket fails after 3 attempts, the dashboard falls back to HTTP polling (amber indicator)</li> </ul>"},{"location":"getting-started/quick-start/#4-create-an-experiment","title":"4. Create an Experiment","text":"<ol> <li>Navigate to Experiments in the sidebar</li> <li>Click New Experiment</li> <li>Enter a name (e.g. <code>Test Run 01</code>)</li> <li>Click Start \u2014 all incoming datapoints are now associated with this experiment</li> </ol>"},{"location":"getting-started/quick-start/#5-view-events-sensors","title":"5. View Events &amp; Sensors","text":"<p>The Events page lists all configured sensor/actuator events. Each event has:</p> <ul> <li>A unique <code>public_id</code></li> <li>A <code>type</code> (sensor, actuator, range, cmd_button, cmd_opened, cmd_closed)</li> <li>A human-readable <code>name</code></li> </ul>"},{"location":"getting-started/quick-start/#6-stop-export","title":"6. Stop &amp; Export","text":"<ol> <li>Go back to Experiments</li> <li>Click Stop on the running experiment</li> <li>Click the CSV download button to export all datapoints</li> </ol>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration \u2014 customise settings via environment variables</li> <li>Dashboard Guide \u2014 deep dive into real-time monitoring</li> <li>Architecture Overview \u2014 understand how the pieces fit together</li> </ul>"},{"location":"guide/","title":"User Guide","text":"<p>Welcome to the WebMACS User Guide. This section covers all operator-facing features of the platform.</p>"},{"location":"guide/#guide-overview","title":"Guide Overview","text":"Page Description Dashboard Real-time sensor monitoring with WebSocket fallback Experiments Creating, running, and managing experiments Events &amp; Sensors Event types, sensor/actuator configuration CSV Export Downloading experiment data"},{"location":"guide/#recommended-reading-order","title":"Recommended Reading Order","text":"<ol> <li>Dashboard \u2014 understand the live view</li> <li>Events &amp; Sensors \u2014 configure what you monitor</li> <li>Experiments \u2014 group data into experiments</li> <li>CSV Export \u2014 get data out for analysis</li> </ol>"},{"location":"guide/#need-help","title":"Need Help?","text":"<ul> <li>GitHub Issues</li> <li>Architecture Overview \u2014 for deeper technical understanding</li> </ul>"},{"location":"guide/csv-export/","title":"CSV Export","text":"<p>WebMACS lets you export all datapoints from a completed experiment as a CSV file with a single click.</p>"},{"location":"guide/csv-export/#how-it-works","title":"How It Works","text":"<p>The backend uses FastAPI's <code>StreamingResponse</code> to generate the CSV on-the-fly. This means:</p> <ul> <li>No file is written to disk</li> <li>Memory usage stays constant regardless of dataset size</li> <li>Download starts immediately</li> </ul>"},{"location":"guide/csv-export/#using-the-ui","title":"Using the UI","text":"<ol> <li>Navigate to Experiments</li> <li>Find a stopped experiment</li> <li>Click the  CSV button</li> <li>The browser downloads a file like <code>experiment_Fluidised_Bed_Run_07.csv</code></li> </ol>"},{"location":"guide/csv-export/#using-the-api","title":"Using the API","text":"<pre><code>curl -O http://localhost:8000/api/v1/experiments/$EXP_ID/export/csv \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/csv-export/#response-headers","title":"Response Headers","text":"<pre><code>Content-Type: text/csv; charset=utf-8\nContent-Disposition: attachment; filename=\"experiment_My_Run.csv\"\nTransfer-Encoding: chunked\n</code></pre>"},{"location":"guide/csv-export/#csv-format","title":"CSV Format","text":"<pre><code>public_id,value,timestamp,event_public_id,event_name,event_type,event_unit\ndp_001,23.45,2025-01-15T14:32:10.000000,evt_temp01,Inlet Temperature,sensor,\u00b0C\ndp_002,1.23,2025-01-15T14:32:10.500000,evt_pres01,Chamber Pressure,sensor,bar\n</code></pre> Column Description <code>public_id</code> Unique datapoint ID <code>value</code> Measured value <code>timestamp</code> ISO 8601 timestamp <code>event_public_id</code> Parent event ID <code>event_name</code> Human-readable event name <code>event_type</code> Event type (sensor, actuator, \u2026) <code>event_unit</code> Measurement unit"},{"location":"guide/csv-export/#next-steps","title":"Next Steps","text":"<ul> <li>Experiments \u2014 managing experiment lifecycle</li> <li>REST API Reference \u2014 full endpoint documentation</li> </ul>"},{"location":"guide/dashboard/","title":"Dashboard","text":"<p>The Dashboard is the primary view for real-time sensor monitoring. It displays live datapoint values and updates automatically.</p> <p></p>"},{"location":"guide/dashboard/#real-time-data","title":"Real-Time Data","text":"<p>WebMACS uses a WebSocket-first, HTTP-fallback strategy:</p> <pre><code>flowchart TD\n    A[Dashboard mounts] --&gt; B{WebSocket available?}\n    B --&gt;|Yes| C[Stream via /ws/datapoints/stream]\n    B --&gt;|No| D[HTTP Polling every N seconds]\n    C --&gt;|Connection lost| E{Retry count &lt; 3?}\n    E --&gt;|Yes| C\n    E --&gt;|No| D</code></pre>"},{"location":"guide/dashboard/#connection-indicator","title":"Connection Indicator","text":"Icon Mode Meaning  Green WebSocket Live streaming active  Amber Polling Fallback \u2014 WebSocket unavailable  Red Disconnected No connection to backend"},{"location":"guide/dashboard/#websocket-transport","title":"WebSocket Transport","text":"<p>The frontend connects to:</p> <pre><code>ws://localhost:8000/ws/datapoints/stream\n</code></pre> <p>Messages arrive as JSON:</p> <pre><code>{\n  \"public_id\": \"dp_abc123\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\",\n  \"event_public_id\": \"evt_temp01\",\n  \"experiment_public_id\": \"exp_001\"\n}\n</code></pre> <p>When the WebSocket connection drops, the <code>useRealtimeDatapoints</code> composable automatically switches to HTTP polling after 3 failed reconnection attempts.</p>"},{"location":"guide/dashboard/#http-polling-fallback","title":"HTTP Polling Fallback","text":"<p>In polling mode the frontend calls:</p> <pre><code>GET /api/v1/datapoints?limit=50\n</code></pre> <p>at a configurable interval (default: 2 seconds).</p>"},{"location":"guide/dashboard/#configuration","title":"Configuration","text":"Setting Type Default Description Poll interval Frontend 2 s Time between HTTP polls in fallback mode WS heartbeat Backend 30 s Server-side heartbeat to keep WS alive Max retries Frontend 3 WS reconnection attempts before switching to polling"},{"location":"guide/dashboard/#next-steps","title":"Next Steps","text":"<ul> <li>Events &amp; Sensors \u2014 what data feeds the dashboard</li> <li>Architecture: WebSocket Design \u2014 full protocol details</li> </ul>"},{"location":"guide/events/","title":"Events &amp; Sensors","text":"<p>Events represent the physical sensors and actuators connected to the IoT controller. Every datapoint is linked to exactly one event.</p>"},{"location":"guide/events/#event-types","title":"Event Types","text":"<p>WebMACS defines six event types via a <code>StrEnum</code>:</p> Type Description Typical Use <code>sensor</code> Continuous measurement Temperature, pressure, flow rate <code>actuator</code> Controllable output Valves, heaters, motors <code>range</code> Range-bounded value Min/max temperature thresholds <code>cmd_button</code> Momentary command Start/stop buttons, triggers <code>cmd_opened</code> Open state command Valve open confirmation <code>cmd_closed</code> Close state command Valve close confirmation"},{"location":"guide/events/#event-properties","title":"Event Properties","text":"<p>Each event has:</p> Field Type Description <code>public_id</code> <code>string</code> Unique identifier (UUID) <code>name</code> <code>string</code> Human-readable label <code>type</code> <code>EventType</code> One of the six types above <code>unit</code> <code>string</code> Measurement unit (\u00b0C, bar, L/min) <code>description</code> <code>string</code> Optional notes"},{"location":"guide/events/#managing-events","title":"Managing Events","text":""},{"location":"guide/events/#via-the-ui","title":"Via the UI","text":"<p>Navigate to Events in the sidebar to view, create, edit, and delete events.</p>"},{"location":"guide/events/#via-the-api","title":"Via the API","text":"<pre><code># List all events\ncurl http://localhost:8000/api/v1/events \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# Create a new sensor event\ncurl -X POST http://localhost:8000/api/v1/events \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"Inlet Temperature\",\n    \"type\": \"sensor\",\n    \"unit\": \"\u00b0C\"\n  }'\n</code></pre>"},{"location":"guide/events/#controller-mapping","title":"Controller Mapping","text":"<p>The IoT controller maps physical I/O pins to event IDs. Configure via <code>WEBMACS_REVPI_MAPPING</code>:</p> <pre><code>{\n  \"Input_1\": \"evt_temp_inlet\",\n  \"Input_2\": \"evt_pressure_01\",\n  \"Output_1\": \"evt_valve_main\"\n}\n</code></pre>"},{"location":"guide/events/#next-steps","title":"Next Steps","text":"<ul> <li>Experiments \u2014 group datapoints by experiment</li> <li>API Reference \u2014 full events endpoint docs</li> </ul>"},{"location":"guide/experiments/","title":"Experiments","text":"<p>Experiments group datapoints in time. Every datapoint collected while an experiment is running is automatically linked to that experiment.</p>"},{"location":"guide/experiments/#lifecycle","title":"Lifecycle","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Created: Create\n    Created --&gt; Running: Start\n    Running --&gt; Stopped: Stop\n    Stopped --&gt; [*]</code></pre>"},{"location":"guide/experiments/#creating-an-experiment","title":"Creating an Experiment","text":"<ol> <li>Navigate to Experiments in the sidebar</li> <li>Click New Experiment</li> <li>Enter a descriptive name</li> <li>Click Create</li> </ol> <p>The experiment is created but not yet started.</p>"},{"location":"guide/experiments/#starting-stopping","title":"Starting &amp; Stopping","text":"Action API Endpoint Effect Start <code>POST /api/v1/experiments</code> Sets <code>started_on</code>, begins associating new datapoints Stop <code>PUT /api/v1/experiments/{id}</code> Sets <code>stopped_on</code>, stops association <p>Only one experiment can be running at a time.</p>"},{"location":"guide/experiments/#viewing-results","title":"Viewing Results","text":"<p>The Experiments page shows:</p> <ul> <li>Experiment name</li> <li>Start / stop timestamps</li> <li>Number of associated datapoints</li> <li>CSV download button (see CSV Export)</li> </ul>"},{"location":"guide/experiments/#api-examples","title":"API Examples","text":""},{"location":"guide/experiments/#create-start","title":"Create &amp; Start","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/experiments \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Fluidised Bed Run 07\"}'\n</code></pre>"},{"location":"guide/experiments/#stop","title":"Stop","text":"<pre><code>curl -X PUT http://localhost:8000/api/v1/experiments/$EXP_ID \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"stopped_on\": \"2025-01-15T16:00:00Z\"}'\n</code></pre>"},{"location":"guide/experiments/#next-steps","title":"Next Steps","text":"<ul> <li>CSV Export \u2014 download experiment data</li> <li>API Reference \u2014 full endpoint documentation</li> </ul>"}]}