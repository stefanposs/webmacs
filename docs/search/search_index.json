{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"WebMACS","text":"<p>Web-based Monitoring and Control System for IoT experiments.</p> <p>WebMACS provides real-time sensor monitoring, experiment management, and telemetry for industrial IoT setups \u2014 specifically designed for Wirbelschicht (fluidised-bed) experiments at the TU Kaiserslautern Chair of Mechanical Process Engineering.</p>"},{"location":"#features","title":"Features","text":""},{"location":"#real-time-dashboard","title":"Real-Time Dashboard","text":"<p>Live sensor readings with auto-updating charts, WebSocket-first with HTTP polling fallback.</p>"},{"location":"#experiment-management","title":"Experiment Management","text":"<p>Create, start, and stop experiments. All datapoints are automatically linked to the active experiment.</p>"},{"location":"#websocket-telemetry","title":"WebSocket Telemetry","text":"<p>Dual-mode controller telemetry (HTTP / WebSocket). Frontend streams via <code>/ws/datapoints/stream</code>.</p>"},{"location":"#csv-export","title":"CSV Export","text":"<p>One-click download of all experiment datapoints as a CSV file \u2014 streamed via <code>StreamingResponse</code>.</p>"},{"location":"#pluggable-storage","title":"Pluggable Storage","text":"<p>Protocol-based repository layer. Switch between PostgreSQL and TimescaleDB via a single env var.</p>"},{"location":"#docker-compose","title":"Docker Compose","text":"<p>Four-container stack (PostgreSQL, FastAPI, Vue/Nginx, Controller) \u2014 one command to start.</p>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># Clone the repository\ngit clone https://github.com/stefanposs/webmacs.git\ncd webmacs\n\n# Copy environment defaults\ncp .env.example .env\n\n# Spin up all services\ndocker compose up --build -d\n</code></pre> <p>Open http://localhost and log in with the seeded admin account (<code>admin@webmacs.io</code> / <code>admin123</code>).</p>"},{"location":"#architecture-at-a-glance","title":"Architecture at a Glance","text":"<pre><code>graph LR\n    Controller[\"IoT Controller&lt;br/&gt;(Python)\"] --&gt;|HTTP / WS| Backend[\"FastAPI Backend\"]\n    Backend --&gt;|async| DB[(PostgreSQL)]\n    Frontend[\"Vue 3 SPA&lt;br/&gt;(Nginx)\"] --&gt;|REST + WS| Backend</code></pre> Layer Tech Stack Backend FastAPI \u00b7 SQLAlchemy 2 async \u00b7 Pydantic v2 \u00b7 Python 3.14 Frontend Vue 3 \u00b7 TypeScript \u00b7 Vite \u00b7 PrimeVue \u00b7 Pinia Controller Python 3.14 \u00b7 HTTPX \u00b7 Async WebSocket Database PostgreSQL 17 (TimescaleDB optional) Infrastructure Docker Compose \u00b7 Nginx reverse-proxy <p>Learn more \u2192 Architecture Overview</p>"},{"location":"#documentation","title":"Documentation","text":"Section Audience Description Getting Started Everyone Install, configure, run User Guide Operators Dashboard, experiments, CSV export Architecture Developers System design, WebSocket, DB protocols API Reference Developers REST + WebSocket endpoint docs Development Contributors Code style, testing, CI/CD Deployment DevOps Docker, production, env vars"},{"location":"#contributing","title":"Contributing","text":"<p>Contributions are welcome! See the Contributing Guide for development setup and workflow.</p>"},{"location":"#license","title":"License","text":"<p>MIT \u2014 see LICENSE for details.</p>"},{"location":"api/rest/","title":"REST API Reference","text":"<p>All endpoints are mounted under <code>/api/v1/</code>. Authentication uses JWT Bearer tokens unless noted otherwise.</p>"},{"location":"api/rest/#authentication","title":"Authentication","text":""},{"location":"api/rest/#post-apiv1authlogin","title":"<code>POST /api/v1/auth/login</code>","text":"<p>Authenticate and receive a JWT token.</p> <p>Request:</p> <pre><code>{\n  \"email\": \"admin@webmacs.io\",\n  \"password\": \"admin123\"\n}\n</code></pre> <p>Response <code>200</code>:</p> <pre><code>{\n  \"status\": \"success\",\n  \"message\": \"Successfully logged in.\",\n  \"access_token\": \"eyJhbGciOiJIUzI1NiIs...\",\n  \"public_id\": \"usr_abc123\",\n  \"username\": \"admin\"\n}\n</code></pre> <p>Token usage</p> <p>Include the token in all subsequent requests: <code>Authorization: Bearer &lt;access_token&gt;</code></p>"},{"location":"api/rest/#users","title":"Users","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/users</code> Admin List all users <code>GET</code> <code>/api/v1/users/{id}</code> Admin Get user by public_id <code>POST</code> <code>/api/v1/users</code> Admin Create user <code>PUT</code> <code>/api/v1/users/{id}</code> Admin Update user <code>DELETE</code> <code>/api/v1/users/{id}</code> Admin Delete user"},{"location":"api/rest/#create-user","title":"Create User","text":"<pre><code>{\n  \"email\": \"operator@example.com\",\n  \"username\": \"operator1\",\n  \"password\": \"securepassword123\"\n}\n</code></pre>"},{"location":"api/rest/#experiments","title":"Experiments","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/experiments</code> JWT List all experiments <code>GET</code> <code>/api/v1/experiments/{id}</code> JWT Get single experiment <code>POST</code> <code>/api/v1/experiments</code> JWT Create &amp; start experiment <code>PUT</code> <code>/api/v1/experiments/{id}</code> JWT Update (e.g. stop) <code>DELETE</code> <code>/api/v1/experiments/{id}</code> JWT Delete experiment <code>GET</code> <code>/api/v1/experiments/{id}/export/csv</code> JWT Download CSV"},{"location":"api/rest/#create-experiment","title":"Create Experiment","text":"<pre><code>{\n  \"name\": \"Fluidised Bed Run 07\"\n}\n</code></pre>"},{"location":"api/rest/#csv-export","title":"CSV Export","text":"<pre><code>GET /api/v1/experiments/{id}/export/csv\n</code></pre> <p>Returns <code>text/csv</code> as a streaming response. See CSV Export Guide.</p>"},{"location":"api/rest/#events","title":"Events","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/events</code> JWT List all events <code>GET</code> <code>/api/v1/events/{id}</code> JWT Get single event <code>POST</code> <code>/api/v1/events</code> JWT Create event <code>PUT</code> <code>/api/v1/events/{id}</code> JWT Update event <code>DELETE</code> <code>/api/v1/events/{id}</code> JWT Delete event"},{"location":"api/rest/#create-event","title":"Create Event","text":"<pre><code>{\n  \"name\": \"Inlet Temperature\",\n  \"type\": \"sensor\",\n  \"unit\": \"\u00b0C\",\n  \"description\": \"Temperature at the fluidised-bed inlet\"\n}\n</code></pre> <p>Event Types: <code>sensor</code>, <code>actuator</code>, <code>range</code>, <code>cmd_button</code>, <code>cmd_opened</code>, <code>cmd_closed</code></p>"},{"location":"api/rest/#datapoints","title":"Datapoints","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/datapoints</code> JWT List datapoints (paginated) <code>POST</code> <code>/api/v1/datapoints</code> JWT Create single datapoint <code>POST</code> <code>/api/v1/datapoints/bulk</code> JWT Create multiple datapoints"},{"location":"api/rest/#create-datapoint","title":"Create Datapoint","text":"<pre><code>{\n  \"value\": 23.45,\n  \"event_public_id\": \"evt_temp01\",\n  \"experiment_public_id\": \"exp_001\"\n}\n</code></pre>"},{"location":"api/rest/#query-parameters","title":"Query Parameters","text":"Param Type Default Description <code>limit</code> <code>int</code> <code>50</code> Max results per page <code>offset</code> <code>int</code> <code>0</code> Pagination offset <code>event_id</code> <code>string</code> \u2014 Filter by event <code>experiment_id</code> <code>string</code> \u2014 Filter by experiment"},{"location":"api/rest/#logs","title":"Logs","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/logging</code> JWT List log entries <code>POST</code> <code>/api/v1/logging</code> JWT Create log entry <code>PUT</code> <code>/api/v1/logging/{id}</code> JWT Update (mark read)"},{"location":"api/rest/#create-log-entry","title":"Create Log Entry","text":"<pre><code>{\n  \"content\": \"Experiment started\",\n  \"logging_type\": \"info\"\n}\n</code></pre> <p>Log types: <code>error</code>, <code>warning</code>, <code>info</code> Statuses: <code>read</code>, <code>unread</code></p>"},{"location":"api/rest/#webhooks","title":"Webhooks","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/webhooks</code> Admin List webhook subscriptions <code>POST</code> <code>/api/v1/webhooks</code> Admin Create webhook <code>GET</code> <code>/api/v1/webhooks/{id}</code> Admin Get webhook details <code>PUT</code> <code>/api/v1/webhooks/{id}</code> Admin Update webhook <code>DELETE</code> <code>/api/v1/webhooks/{id}</code> Admin Delete webhook <code>GET</code> <code>/api/v1/webhooks/{id}/deliveries</code> Admin List delivery log"},{"location":"api/rest/#create-webhook","title":"Create Webhook","text":"<pre><code>{\n  \"url\": \"https://example.com/webhook\",\n  \"secret\": \"my-hmac-secret\",\n  \"events\": [\"sensor.threshold_exceeded\", \"experiment.started\"],\n  \"enabled\": true\n}\n</code></pre> <p>Webhook Event Types: <code>sensor.threshold_exceeded</code>, <code>sensor.reading</code>, <code>experiment.started</code>, <code>experiment.stopped</code>, <code>system.health_changed</code></p> <p>Delivery Statuses: <code>pending</code>, <code>success</code>, <code>failed</code>, <code>retrying</code></p> <p>HMAC Verification</p> <p>If a <code>secret</code> is provided, each delivery includes an <code>X-Webhook-Signature</code> header containing the HMAC-SHA256 signature of the payload body, which can be used to verify authenticity.</p>"},{"location":"api/rest/#rules","title":"Rules","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/rules</code> Admin List automation rules <code>POST</code> <code>/api/v1/rules</code> Admin Create rule <code>GET</code> <code>/api/v1/rules/{id}</code> Admin Get rule details <code>PUT</code> <code>/api/v1/rules/{id}</code> Admin Update rule <code>DELETE</code> <code>/api/v1/rules/{id}</code> Admin Delete rule"},{"location":"api/rest/#create-rule","title":"Create Rule","text":"<pre><code>{\n  \"name\": \"High Temperature Alert\",\n  \"event_public_id\": \"evt_temp01\",\n  \"operator\": \"gt\",\n  \"threshold\": 50.0,\n  \"action_type\": \"webhook\",\n  \"webhook_event_type\": \"sensor.threshold_exceeded\",\n  \"cooldown_seconds\": 300,\n  \"enabled\": true\n}\n</code></pre> <p>Operators: <code>gt</code> (&gt;), <code>lt</code> (&lt;), <code>gte</code> (&gt;=), <code>lte</code> (&lt;=), <code>eq</code> (==), <code>between</code>, <code>not_between</code></p> <p>Action Types: <code>webhook</code>, <code>log</code></p> <p>Between operator</p> <p>When using <code>between</code> or <code>not_between</code>, provide both <code>threshold</code> (low) and <code>threshold_high</code> (high) values.</p>"},{"location":"api/rest/#ota-updates","title":"OTA Updates","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/ota</code> Admin List firmware updates <code>POST</code> <code>/api/v1/ota</code> Admin Create firmware update <code>GET</code> <code>/api/v1/ota/{id}</code> Admin Get update details <code>DELETE</code> <code>/api/v1/ota/{id}</code> Admin Delete firmware update <code>POST</code> <code>/api/v1/ota/{id}/apply</code> Admin Apply firmware update <code>POST</code> <code>/api/v1/ota/{id}/rollback</code> Admin Rollback firmware update <code>GET</code> <code>/api/v1/ota/check</code> Admin Check for available updates"},{"location":"api/rest/#create-firmware-update","title":"Create Firmware Update","text":"<pre><code>{\n  \"version\": \"2.1.0\",\n  \"release_notes\": \"Performance improvements and bug fixes\",\n  \"firmware_url\": \"https://releases.example.com/firmware/v2.1.0.bin\"\n}\n</code></pre> <p>Update Statuses: <code>pending</code>, <code>downloading</code>, <code>verifying</code>, <code>applying</code>, <code>completed</code>, <code>failed</code>, <code>rolled_back</code></p>"},{"location":"api/rest/#health-check","title":"Health Check","text":""},{"location":"api/rest/#get-health","title":"<code>GET /health</code>","text":"<p>Returns <code>200 OK</code> \u2014 used by Docker healthcheck.</p> <pre><code>{\n  \"status\": \"healthy\"\n}\n</code></pre>"},{"location":"api/rest/#error-responses","title":"Error Responses","text":"<p>All errors follow a consistent format:</p> <pre><code>{\n  \"detail\": \"Not Found\"\n}\n</code></pre> Status Code Meaning <code>400</code> Bad request / validation error <code>401</code> Unauthorized \u2014 invalid or missing token <code>403</code> Forbidden \u2014 insufficient permissions <code>404</code> Resource not found <code>422</code> Validation error \u2014 Pydantic schema mismatch <code>500</code> Internal server error"},{"location":"api/rest/#openapi-documentation","title":"OpenAPI Documentation","text":"<p>FastAPI auto-generates interactive API docs:</p> <ul> <li>Swagger UI: <code>http://localhost:8000/docs</code></li> <li>ReDoc: <code>http://localhost:8000/redoc</code></li> </ul>"},{"location":"api/rest/#next-steps","title":"Next Steps","text":"<ul> <li>WebSocket API \u2014 real-time endpoints</li> <li>Schemas \u2014 Pydantic model reference</li> </ul>"},{"location":"api/schemas/","title":"Schemas","text":"<p>WebMACS uses Pydantic v2 for all request/response validation. Below is a reference of all schema models.</p>"},{"location":"api/schemas/#auth-schemas","title":"Auth Schemas","text":""},{"location":"api/schemas/#loginrequest","title":"LoginRequest","text":"<pre><code>class LoginRequest(BaseModel):\n    email: EmailStr\n    password: str  # min_length=1\n</code></pre>"},{"location":"api/schemas/#loginresponse","title":"LoginResponse","text":"<pre><code>class LoginResponse(BaseModel):\n    status: str = \"success\"\n    message: str = \"Successfully logged in.\"\n    access_token: str\n    public_id: str\n    username: str\n</code></pre>"},{"location":"api/schemas/#user-schemas","title":"User Schemas","text":""},{"location":"api/schemas/#usercreate","title":"UserCreate","text":"<pre><code>class UserCreate(BaseModel):\n    email: EmailStr\n    username: str  # min_length=2, max_length=50\n    password: str  # min_length=8\n</code></pre>"},{"location":"api/schemas/#userupdate","title":"UserUpdate","text":"<pre><code>class UserUpdate(BaseModel):\n    email: EmailStr | None = None\n    username: str | None = None  # min_length=2, max_length=50\n</code></pre>"},{"location":"api/schemas/#userresponse","title":"UserResponse","text":"<pre><code>class UserResponse(BaseModel):\n    public_id: str\n    email: str\n    username: str\n    admin: bool\n    registered_on: datetime\n</code></pre>"},{"location":"api/schemas/#experiment-schemas","title":"Experiment Schemas","text":""},{"location":"api/schemas/#experimentcreate","title":"ExperimentCreate","text":"<pre><code>class ExperimentCreate(BaseModel):\n    name: str  # min_length=1, max_length=200\n</code></pre>"},{"location":"api/schemas/#experimentupdate","title":"ExperimentUpdate","text":"<pre><code>class ExperimentUpdate(BaseModel):\n    name: str | None = None\n    stopped_on: datetime | None = None\n</code></pre>"},{"location":"api/schemas/#experimentresponse","title":"ExperimentResponse","text":"<pre><code>class ExperimentResponse(BaseModel):\n    public_id: str\n    name: str\n    started_on: datetime | None\n    stopped_on: datetime | None\n    user_public_id: str\n</code></pre>"},{"location":"api/schemas/#event-schemas","title":"Event Schemas","text":""},{"location":"api/schemas/#eventcreate","title":"EventCreate","text":"<pre><code>class EventCreate(BaseModel):\n    name: str\n    type: EventType        # sensor | actuator | range | cmd_button | cmd_opened | cmd_closed\n    unit: str | None = None\n    description: str | None = None\n</code></pre>"},{"location":"api/schemas/#eventresponse","title":"EventResponse","text":"<pre><code>class EventResponse(BaseModel):\n    public_id: str\n    name: str\n    type: EventType\n    unit: str | None\n    description: str | None\n</code></pre>"},{"location":"api/schemas/#datapoint-schemas","title":"Datapoint Schemas","text":""},{"location":"api/schemas/#datapointcreate","title":"DatapointCreate","text":"<pre><code>class DatapointCreate(BaseModel):\n    value: float\n    event_public_id: str\n    experiment_public_id: str | None = None\n</code></pre>"},{"location":"api/schemas/#datapointresponse","title":"DatapointResponse","text":"<pre><code>class DatapointResponse(BaseModel):\n    public_id: str\n    value: float\n    timestamp: datetime\n    event_public_id: str\n    experiment_public_id: str | None\n</code></pre>"},{"location":"api/schemas/#log-schemas","title":"Log Schemas","text":""},{"location":"api/schemas/#logcreate","title":"LogCreate","text":"<pre><code>class LogCreate(BaseModel):\n    message: str\n    type: LoggingType    # error | warning | info\n    status: StatusType = StatusType.unread  # read | unread\n</code></pre>"},{"location":"api/schemas/#logresponse","title":"LogResponse","text":"<pre><code>class LogResponse(BaseModel):\n    public_id: str\n    message: str\n    type: LoggingType\n    status: StatusType\n    created_on: datetime\n</code></pre>"},{"location":"api/schemas/#enums","title":"Enums","text":""},{"location":"api/schemas/#eventtype","title":"EventType","text":"Value Description <code>sensor</code> Continuous measurement <code>actuator</code> Controllable output <code>range</code> Range-bounded value <code>cmd_button</code> Momentary command <code>cmd_opened</code> Open state command <code>cmd_closed</code> Close state command"},{"location":"api/schemas/#loggingtype","title":"LoggingType","text":"Value Description <code>error</code> Error-level log <code>warning</code> Warning-level log <code>info</code> Informational log"},{"location":"api/schemas/#statustype","title":"StatusType","text":"Value Description <code>read</code> Log entry has been read <code>unread</code> Log entry is unread"},{"location":"api/schemas/#next-steps","title":"Next Steps","text":"<ul> <li>REST API \u2014 how schemas are used in endpoints</li> <li>Backend Architecture \u2014 code structure</li> </ul>"},{"location":"api/websocket/","title":"WebSocket API","text":"<p>WebMACS exposes two WebSocket endpoints for real-time communication.</p>"},{"location":"api/websocket/#endpoints","title":"Endpoints","text":""},{"location":"api/websocket/#wscontrollertelemetry","title":"<code>/ws/controller/telemetry</code>","text":"<p>Direction: Controller \u2192 Backend</p> <p>Used by the IoT controller to push sensor readings in real time.</p> <p>Connection:</p> <pre><code>ws://localhost:8000/ws/controller/telemetry?token=&lt;JWT&gt;\n</code></pre> <p>Inbound Message (Controller \u2192 Backend):</p> <pre><code>{\n  \"event_public_id\": \"evt_temp01\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\"\n}\n</code></pre> <p>Behaviour:</p> <ol> <li>Backend validates JWT from query parameter</li> <li>Persists datapoint to database</li> <li>Broadcasts to all <code>/ws/datapoints/stream</code> subscribers</li> <li>Sends periodic heartbeat pings (configurable: <code>WS_HEARTBEAT_INTERVAL</code>)</li> </ol>"},{"location":"api/websocket/#wsdatapointsstream","title":"<code>/ws/datapoints/stream</code>","text":"<p>Direction: Backend \u2192 Frontend</p> <p>Used by the Vue frontend to receive live datapoint updates.</p> <p>Connection:</p> <pre><code>ws://localhost:8000/ws/datapoints/stream\n</code></pre> <p>Outbound Message (Backend \u2192 Frontend):</p> <pre><code>{\n  \"public_id\": \"dp_abc123\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\",\n  \"event_public_id\": \"evt_temp01\",\n  \"experiment_public_id\": \"exp_001\"\n}\n</code></pre> <p>Behaviour:</p> <ol> <li>Client connects \u2014 added to broadcast group</li> <li>Receives every new datapoint as JSON</li> <li>Connection kept alive via heartbeat pings</li> <li>On disconnect \u2014 client removed from broadcast group</li> </ol>"},{"location":"api/websocket/#message-flow","title":"Message Flow","text":"<pre><code>sequenceDiagram\n    participant C as Controller\n    participant B as Backend\n    participant DB as PostgreSQL\n    participant F1 as Frontend 1\n    participant F2 as Frontend 2\n\n    C-&gt;&gt;B: WS /ws/controller/telemetry\n    F1-&gt;&gt;B: WS /ws/datapoints/stream\n    F2-&gt;&gt;B: WS /ws/datapoints/stream\n\n    C-&gt;&gt;B: {\"event_public_id\": \"...\", \"value\": 23.4}\n    B-&gt;&gt;DB: INSERT INTO datapoints\n    B--&gt;&gt;F1: {\"public_id\": \"...\", \"value\": 23.4, ...}\n    B--&gt;&gt;F2: {\"public_id\": \"...\", \"value\": 23.4, ...}</code></pre>"},{"location":"api/websocket/#frontend-reconnection-strategy","title":"Frontend Reconnection Strategy","text":"<p>The <code>useRealtimeDatapoints</code> composable handles reconnection:</p> Attempt Action 1\u20133 Reconnect WebSocket with exponential backoff &gt; 3 Switch to HTTP polling (<code>GET /api/v1/datapoints</code>)"},{"location":"api/websocket/#nginx-proxy","title":"Nginx Proxy","text":"<p>For WebSocket support through Nginx, the config must include upgrade headers:</p> <pre><code>location /ws/ {\n    proxy_pass http://backend:8000;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"upgrade\";\n    proxy_set_header Host $host;\n    proxy_read_timeout 86400;\n}\n</code></pre>"},{"location":"api/websocket/#next-steps","title":"Next Steps","text":"<ul> <li>REST API \u2014 HTTP endpoint reference</li> <li>WebSocket Architecture \u2014 design deep-dive</li> </ul>"},{"location":"architecture/backend/","title":"Backend Architecture","text":"<p>The backend is a FastAPI application with async SQLAlchemy, structured as a Python package: <code>webmacs_backend</code>.</p>"},{"location":"architecture/backend/#package-structure","title":"Package Structure","text":"<pre><code>backend/src/webmacs_backend/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 main.py              # Application factory + lifespan\n\u251c\u2500\u2500 config.py            # pydantic-settings Settings\n\u251c\u2500\u2500 database.py          # Engine, session, init_db\n\u251c\u2500\u2500 models.py            # SQLAlchemy ORM models\n\u251c\u2500\u2500 schemas.py           # Pydantic v2 request/response schemas\n\u251c\u2500\u2500 enums.py             # StrEnum definitions (EventType, StatusType, LoggingType)\n\u251c\u2500\u2500 security.py          # JWT + bcrypt helpers\n\u251c\u2500\u2500 dependencies.py      # FastAPI Depends() factories\n\u251c\u2500\u2500 repository.py        # ORM-level query helpers\n\u251c\u2500\u2500 api/\n\u2502   \u2514\u2500\u2500 v1/\n\u2502       \u251c\u2500\u2500 auth.py          # POST /auth/login\n\u2502       \u251c\u2500\u2500 users.py         # CRUD /users\n\u2502       \u251c\u2500\u2500 experiments.py   # CRUD /experiments + CSV export\n\u2502       \u251c\u2500\u2500 events.py        # CRUD /events\n\u2502       \u251c\u2500\u2500 datapoints.py    # CRUD /datapoints\n\u2502       \u2514\u2500\u2500 logging.py       # CRUD /logs\n\u251c\u2500\u2500 repositories/\n\u2502   \u251c\u2500\u2500 protocols.py         # DatapointRepository + ExperimentRepository\n\u2502   \u251c\u2500\u2500 dependencies.py      # DI wiring (STORAGE_BACKEND \u2192 impl)\n\u2502   \u251c\u2500\u2500 sqlalchemy_repo.py   # PostgreSQL implementation\n\u2502   \u2514\u2500\u2500 timescale_repo.py    # TimescaleDB stub\n\u2514\u2500\u2500 ws/\n    \u251c\u2500\u2500 connection_manager.py  # Pub/sub hub\n    \u2514\u2500\u2500 endpoints.py           # /ws/controller/telemetry, /ws/datapoints/stream\n</code></pre>"},{"location":"architecture/backend/#application-lifecycle","title":"Application Lifecycle","text":"<pre><code>@asynccontextmanager\nasync def lifespan(app: FastAPI) -&gt; AsyncGenerator[None]:\n    await init_db()          # Create tables\n    await _seed_admin()      # Seed admin if no users exist\n    yield\n    await engine.dispose()   # Clean shutdown\n</code></pre> <p>The <code>lifespan</code> context manager runs once at startup and shutdown. It replaces the deprecated <code>on_event</code> hooks.</p>"},{"location":"architecture/backend/#configuration","title":"Configuration","text":"<p>All settings are loaded from environment variables via pydantic-settings:</p> <pre><code>class Settings(BaseSettings):\n    database_url: str\n    secret_key: str\n    storage_backend: str = \"postgresql\"\n    ws_heartbeat_interval: int = 30\n    # ...\n</code></pre>"},{"location":"architecture/backend/#api-routers","title":"API Routers","text":"<p>All six routers are mounted under <code>/api/v1/</code>:</p> Router Prefix Auth Key Endpoints <code>auth</code> <code>/auth</code> Public <code>POST /login</code> <code>users</code> <code>/users</code> Admin CRUD <code>experiments</code> <code>/experiments</code> JWT CRUD, <code>GET /{id}/export/csv</code> <code>events</code> <code>/events</code> JWT CRUD <code>datapoints</code> <code>/datapoints</code> JWT CRUD, bulk create <code>logging</code> <code>/logs</code> JWT CRUD, mark read"},{"location":"architecture/backend/#repository-protocol-layer","title":"Repository Protocol Layer","text":"<p>The backend uses PEP 544 Protocols to abstract the database:</p> <pre><code>class DatapointRepository(Protocol):\n    async def create(self, ...) -&gt; DatapointRecord: ...\n    async def get_by_experiment(self, ...) -&gt; Sequence[DatapointRecord]: ...\n</code></pre> <p>Switch between implementations via <code>STORAGE_BACKEND</code>:</p> <ul> <li><code>postgresql</code> \u2192 <code>SQLAlchemyDatapointRepo</code></li> <li><code>timescale</code> \u2192 <code>TimescaleDatapointRepo</code> (stub)</li> </ul>"},{"location":"architecture/backend/#security","title":"Security","text":"<ul> <li>bcrypt for password hashing (via <code>bcrypt</code> package directly)</li> <li>JWT tokens with <code>python-jose</code> (HS256)</li> <li><code>get_current_user</code> dependency validates token on every protected route</li> <li>Admin-only routes check <code>user.admin == True</code></li> </ul>"},{"location":"architecture/backend/#next-steps","title":"Next Steps","text":"<ul> <li>WebSocket Design \u2014 real-time data streaming</li> <li>Database Abstraction \u2014 Protocol details</li> <li>REST API Reference \u2014 endpoint documentation</li> </ul>"},{"location":"architecture/controller/","title":"Controller Architecture","text":"<p>The IoT Controller is a headless Python agent that reads sensor data and pushes it to the backend.</p>"},{"location":"architecture/controller/#package-structure","title":"Package Structure","text":"<pre><code>controller/src/webmacs_controller/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 __main__.py          # Entry point (python -m webmacs_controller)\n\u251c\u2500\u2500 app.py               # Main application loop\n\u251c\u2500\u2500 config.py            # pydantic-settings configuration\n\u251c\u2500\u2500 schemas.py           # Pydantic models for API payloads\n\u2514\u2500\u2500 services/\n    \u251c\u2500\u2500 api_client.py      # HTTPX client with retry + auto-reauth\n    \u251c\u2500\u2500 actuator_manager.py  # Actuator command handling\n    \u251c\u2500\u2500 demo_seeder.py     # Demo event seeding (dev mode)\n    \u251c\u2500\u2500 hardware.py        # HardwareInterface ABC + RevPi/Simulated impls\n    \u251c\u2500\u2500 rule_engine.py     # Valve cycling rule logic\n    \u251c\u2500\u2500 sensor_manager.py  # Sensor reading abstraction\n    \u2514\u2500\u2500 telemetry.py       # TelemetryTransport Protocol (HTTP / WebSocket)\n</code></pre>"},{"location":"architecture/controller/#telemetry-modes","title":"Telemetry Modes","text":"<p>The controller supports two transport modes, selected via <code>WEBMACS_TELEMETRY_MODE</code>:</p>"},{"location":"architecture/controller/#http-mode-default","title":"HTTP Mode (default)","text":"<pre><code>sequenceDiagram\n    Controller-&gt;&gt;+Backend: POST /api/v1/datapoints\n    Backend--&gt;&gt;-Controller: 201 Created</code></pre> <p>Each sensor reading \u2192 one HTTP POST request.</p>"},{"location":"architecture/controller/#websocket-mode","title":"WebSocket Mode","text":"<pre><code>sequenceDiagram\n    Controller-&gt;&gt;+Backend: WS /ws/controller/telemetry\n    Note over Controller,Backend: Persistent connection\n    loop Every poll interval\n        Controller-&gt;&gt;Backend: JSON message\n        Backend--&gt;&gt;Controller: ack\n    end</code></pre> <p>A single persistent WebSocket connection carries all telemetry.</p>"},{"location":"architecture/controller/#transport-protocol","title":"Transport Protocol","text":"<p>The telemetry layer uses a Protocol for pluggability:</p> <pre><code>class TelemetryTransport(Protocol):\n    async def connect(self) -&gt; None: ...\n    async def send(self, payload: dict) -&gt; None: ...\n    async def disconnect(self) -&gt; None: ...\n</code></pre> <p>Implementations:</p> <ul> <li><code>HttpTelemetry</code> \u2014 wraps <code>APIClient.post()</code></li> <li><code>WebSocketTelemetry</code> \u2014 async context manager over <code>websockets</code> library</li> </ul>"},{"location":"architecture/controller/#auto-reauthentication","title":"Auto-Reauthentication","text":"<p>The <code>APIClient</code> handles JWT lifecycle automatically:</p> <ol> <li>Login with configured credentials on startup</li> <li>Store JWT token</li> <li>On any 401 Unauthorized response \u2192 re-login and retry</li> <li>Exponential backoff on repeated failures</li> </ol>"},{"location":"architecture/controller/#sensor-manager","title":"Sensor Manager","text":"<p>In development mode (<code>WEBMACS_ENV=development</code>), the <code>SensorManager</code> generates dummy data \u2014 sinusoidal waves, random noise, etc. In production mode, it reads from the RevPi via <code>revpimodio2</code>.</p>"},{"location":"architecture/controller/#configuration","title":"Configuration","text":"<pre><code>class ControllerSettings(BaseSettings):\n    webmacs_env: str = \"development\"\n    webmacs_server_url: str = \"http://localhost\"\n    webmacs_server_port: int = 8000\n    webmacs_poll_interval: float = 0.5\n    webmacs_telemetry_mode: str = \"http\"  # \"http\" | \"websocket\"\n    webmacs_admin_email: str\n    webmacs_admin_password: str\n</code></pre>"},{"location":"architecture/controller/#next-steps","title":"Next Steps","text":"<ul> <li>WebSocket Design \u2014 full protocol specification</li> <li>Backend Architecture \u2014 how the backend processes data</li> </ul>"},{"location":"architecture/database/","title":"Database Abstraction","text":"<p>WebMACS uses PEP 544 Protocols to abstract the persistence layer. This allows swapping database backends without changing application code.</p>"},{"location":"architecture/database/#design","title":"Design","text":"<pre><code>classDiagram\n    class DatapointRepository {\n        &lt;&lt;Protocol&gt;&gt;\n        +create(public_id, value, ...) DatapointRecord\n        +get_by_experiment(experiment_id, ...) Sequence~DatapointRecord~\n        +get_latest(limit) Sequence~DatapointRecord~\n    }\n\n    class ExperimentRepository {\n        &lt;&lt;Protocol&gt;&gt;\n        +create(public_id, name, ...) ExperimentRecord\n        +get_all() Sequence~ExperimentRecord~\n        +update(public_id, ...) ExperimentRecord\n    }\n\n    class SQLAlchemyDatapointRepo {\n        +session: AsyncSession\n    }\n    class TimescaleDatapointRepo {\n        +session: AsyncSession\n    }\n\n    DatapointRepository &lt;|.. SQLAlchemyDatapointRepo\n    DatapointRepository &lt;|.. TimescaleDatapointRepo</code></pre>"},{"location":"architecture/database/#protocols","title":"Protocols","text":"<p>Two Protocols define the storage contracts:</p>"},{"location":"architecture/database/#datapointrepository","title":"DatapointRepository","text":"<pre><code>class DatapointRepository(Protocol):\n    async def create(self, public_id: str, value: float, timestamp: datetime,\n                     event_public_id: str, experiment_public_id: str | None) -&gt; DatapointRecord: ...\n    async def get_by_experiment(self, experiment_public_id: str,\n                                limit: int, offset: int) -&gt; Sequence[DatapointRecord]: ...\n    async def get_latest(self, limit: int) -&gt; Sequence[DatapointRecord]: ...\n</code></pre>"},{"location":"architecture/database/#experimentrepository","title":"ExperimentRepository","text":"<pre><code>class ExperimentRepository(Protocol):\n    async def create(self, public_id: str, name: str,\n                     started_on: datetime, user_public_id: str) -&gt; ExperimentRecord: ...\n    async def get_all(self) -&gt; Sequence[ExperimentRecord]: ...\n    async def update(self, public_id: str, **kwargs) -&gt; ExperimentRecord: ...\n</code></pre>"},{"location":"architecture/database/#data-transfer-objects","title":"Data Transfer Objects","text":"<p>Instead of returning raw ORM models, repositories use lightweight DTOs:</p> <pre><code>class DatapointRecord:\n    __slots__ = (\"public_id\", \"value\", \"timestamp\", \"event_public_id\", \"experiment_public_id\")\n</code></pre> <p>This decouples the API layer from the ORM and keeps the Protocol implementations substitutable.</p>"},{"location":"architecture/database/#dependency-injection","title":"Dependency Injection","text":"<p>The <code>STORAGE_BACKEND</code> environment variable selects the implementation:</p> <pre><code># repositories/dependencies.py\ndef get_datapoint_repo(session: AsyncSession = Depends(get_session)) -&gt; DatapointRepository:\n    match settings.storage_backend:\n        case \"postgresql\":\n            return SQLAlchemyDatapointRepo(session)\n        case \"timescale\":\n            return TimescaleDatapointRepo(session)\n        case _:\n            raise ValueError(f\"Unknown storage backend: {settings.storage_backend}\")\n</code></pre> <p>Routers declare the dependency via FastAPI's <code>Depends()</code>:</p> <pre><code>@router.get(\"/datapoints\")\nasync def list_datapoints(repo: DatapointRepository = Depends(get_datapoint_repo)):\n    return await repo.get_latest(limit=50)\n</code></pre>"},{"location":"architecture/database/#adding-a-new-backend","title":"Adding a New Backend","text":"<ol> <li>Create <code>repositories/my_backend_repo.py</code></li> <li>Implement <code>DatapointRepository</code> and <code>ExperimentRepository</code></li> <li>Add a case in <code>dependencies.py</code></li> <li>Set <code>STORAGE_BACKEND=my_backend</code></li> </ol> <p>No changes to routers, schemas, or tests needed.</p>"},{"location":"architecture/database/#timescaledb-support","title":"TimescaleDB Support","text":"<p>The <code>timescale_repo.py</code> is currently a stub \u2014 it inherits from the SQLAlchemy implementation. When TimescaleDB-specific features are needed (hypertables, continuous aggregates, compression), this module will diverge.</p>"},{"location":"architecture/database/#next-steps","title":"Next Steps","text":"<ul> <li>Backend Architecture \u2014 full backend structure</li> <li>Deployment: Environment Variables \u2014 configuring <code>STORAGE_BACKEND</code></li> </ul>"},{"location":"architecture/frontend/","title":"Frontend Architecture","text":"<p>The frontend is a Vue 3 single-page application built with Vite, TypeScript, and PrimeVue.</p>"},{"location":"architecture/frontend/#project-structure","title":"Project Structure","text":"<pre><code>frontend/src/\n\u251c\u2500\u2500 main.ts                  # App entry point (createApp, plugins)\n\u251c\u2500\u2500 App.vue                  # Root component (router-view, AppToast)\n\u251c\u2500\u2500 router/                  # Vue Router (7 views + 404)\n\u251c\u2500\u2500 stores/                  # Pinia stores\n\u2502   \u251c\u2500\u2500 auth.ts              # JWT auth, login/logout\n\u2502   \u251c\u2500\u2500 experiments.ts       # Experiment CRUD\n\u2502   \u251c\u2500\u2500 events.ts            # Events CRUD\n\u2502   \u2514\u2500\u2500 datapoints.ts        # Datapoints fetch\n\u251c\u2500\u2500 views/\n\u2502   \u251c\u2500\u2500 DashboardView.vue    # Real-time sensor data\n\u2502   \u251c\u2500\u2500 ExperimentsView.vue  # Experiment management + CSV export\n\u2502   \u251c\u2500\u2500 EventsView.vue       # Events listing\n\u2502   \u251c\u2500\u2500 DatapointsView.vue   # Raw datapoints table\n\u2502   \u251c\u2500\u2500 LogsView.vue         # System logs\n\u2502   \u251c\u2500\u2500 UsersView.vue        # User management (admin)\n\u2502   \u251c\u2500\u2500 LoginView.vue        # Authentication\n\u2502   \u2514\u2500\u2500 NotFoundView.vue     # 404 page\n\u251c\u2500\u2500 composables/\n\u2502   \u251c\u2500\u2500 useRealtimeDatapoints.ts   # WS-first + polling fallback\n\u2502   \u251c\u2500\u2500 useNotification.ts         # Toast notification system\n\u2502   \u251c\u2500\u2500 useFormatters.ts           # Date, number, relative time formatting\n\u2502   \u2514\u2500\u2500 usePolling.ts              # Generic polling composable\n\u251c\u2500\u2500 services/\n\u2502   \u251c\u2500\u2500 api.ts               # Axios wrapper with JWT interceptor\n\u2502   \u2514\u2500\u2500 websocket.ts         # Generic reconnecting WebSocket client\n\u251c\u2500\u2500 components/\n\u2502   \u251c\u2500\u2500 AppSidebar.vue        # Navigation sidebar\n\u2502   \u251c\u2500\u2500 AppToast.vue          # Custom toast notifications\n\u2502   \u2514\u2500\u2500 AppTopbar.vue         # Top navigation bar\n\u251c\u2500\u2500 types/                    # TypeScript interfaces\n\u2514\u2500\u2500 assets/                   # Styles, images\n</code></pre>"},{"location":"architecture/frontend/#state-management-pinia","title":"State Management (Pinia)","text":"<p>Each store encapsulates a domain:</p> <pre><code>// stores/experiments.ts\nexport const useExperimentsStore = defineStore('experiments', () =&gt; {\n  const experiments = ref&lt;Experiment[]&gt;([])\n  const loading = ref(false)\n\n  async function fetchAll() { /* ... */ }\n  async function create(name: string) { /* ... */ }\n  async function stop(id: string) { /* ... */ }\n\n  return { experiments, loading, fetchAll, create, stop }\n})\n</code></pre>"},{"location":"architecture/frontend/#real-time-data-composable","title":"Real-Time Data Composable","text":"<p>The <code>useRealtimeDatapoints</code> composable implements the WS-first, polling-fallback strategy:</p> <pre><code>stateDiagram-v2\n    [*] --&gt; WebSocket: Mount\n    WebSocket --&gt; WebSocket: onMessage\n    WebSocket --&gt; Retry: onClose\n    Retry --&gt; WebSocket: attempt \u2264 3\n    Retry --&gt; Polling: attempt &gt; 3\n    Polling --&gt; Polling: setInterval</code></pre> <pre><code>const { datapoints, connectionMode } = useRealtimeDatapoints({\n  wsUrl: '/ws/datapoints/stream',\n  pollUrl: '/api/v1/datapoints',\n  pollInterval: 2000,\n  maxWsRetries: 3,\n})\n</code></pre> <p>Returns:</p> Property Type Description <code>datapoints</code> <code>Ref&lt;Datapoint[]&gt;</code> Latest datapoints <code>connectionMode</code> <code>Ref&lt;'ws' \\| 'polling' \\| 'disconnected'&gt;</code> Current transport"},{"location":"architecture/frontend/#custom-toast-notifications","title":"Custom Toast Notifications","text":"<p><code>AppToast.vue</code> replaces PrimeVue's toast with a custom system:</p> <ul> <li>Gradient variants: <code>success</code>, <code>error</code>, <code>warning</code>, <code>info</code></li> <li>Slide-in/out animations via <code>&lt;TransitionGroup&gt;</code></li> <li>Rendered via <code>&lt;Teleport to=\"body\"&gt;</code></li> <li>Uses design tokens for consistent theming</li> </ul>"},{"location":"architecture/frontend/#build-dev","title":"Build &amp; Dev","text":"<pre><code>npm run dev          # Vite dev server \u2192 http://localhost:5173\nnpm run build        # Production build \u2192 dist/\nnpm run lint         # ESLint\nnpm run type-check   # vue-tsc\n</code></pre> <p>In production, Nginx serves the built SPA and proxies <code>/api/</code> and <code>/ws/</code> to the backend.</p>"},{"location":"architecture/frontend/#next-steps","title":"Next Steps","text":"<ul> <li>Controller Architecture \u2014 the IoT agent</li> <li>WebSocket Design \u2014 protocol details</li> </ul>"},{"location":"architecture/overview/","title":"System Overview","text":"<p>WebMACS is a four-component system connected via REST, WebSocket, and a shared PostgreSQL database.</p>"},{"location":"architecture/overview/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>graph TB\n    subgraph Docker Compose\n        DB[(PostgreSQL 17)]\n        Backend[\"FastAPI Backend&lt;br/&gt;:8000\"]\n        Frontend[\"Vue 3 SPA&lt;br/&gt;Nginx :80\"]\n        Controller[\"IoT Controller&lt;br/&gt;Python\"]\n    end\n\n    Controller --&gt;|\"HTTP POST /api/v1/datapoints&lt;br/&gt;or WS /ws/controller/telemetry\"| Backend\n    Backend --&gt;|\"SQLAlchemy 2 async\"| DB\n    Frontend --&gt;|\"REST + WS\"| Backend\n\n    User((User)) --&gt;|\"Browser\"| Frontend\n    Hardware[\"RevPi / Sensors\"] --&gt;|\"I/O\"| Controller</code></pre>"},{"location":"architecture/overview/#components","title":"Components","text":""},{"location":"architecture/overview/#backend-fastapi","title":"Backend (FastAPI)","text":"<p>The backend is the central hub. It:</p> <ul> <li>Exposes a versioned REST API (<code>/api/v1/</code>) with 6 routers</li> <li>Serves two WebSocket endpoints for real-time data</li> <li>Uses SQLAlchemy 2 async ORM with a repository protocol layer</li> <li>Handles JWT authentication with bcrypt password hashing</li> <li>Seeds an initial admin user on first boot</li> </ul> <p>Key files: <code>main.py</code>, <code>config.py</code>, <code>models.py</code>, <code>schemas.py</code>, <code>security.py</code></p> <p>Details \u2192 Backend Architecture</p>"},{"location":"architecture/overview/#frontend-vue-3","title":"Frontend (Vue 3)","text":"<p>A single-page application served by Nginx:</p> <ul> <li>Vue 3 with Composition API and <code>&lt;script setup&gt;</code></li> <li>TypeScript throughout</li> <li>Pinia for state management (auth, experiments, events, datapoints, logs)</li> <li>PrimeVue component library</li> <li>Custom <code>useRealtimeDatapoints</code> composable (WS + HTTP fallback)</li> <li>Custom <code>AppToast</code> notification system</li> </ul> <p>Key views: Dashboard, Experiments, Events, Datapoints, Logs, Users, Login</p> <p>Details \u2192 Frontend Architecture</p>"},{"location":"architecture/overview/#controller-iot-agent","title":"Controller (IoT Agent)","text":"<p>A headless Python process that:</p> <ul> <li>Reads sensor values from hardware (or generates dummy data in dev mode)</li> <li>Authenticates with the backend via JWT</li> <li>Pushes datapoints via HTTP or WebSocket (configurable)</li> <li>Implements auto-reauthentication on 401 responses</li> <li>Has retry logic with exponential backoff</li> </ul> <p>Telemetry modes: <code>http</code> (default) or <code>websocket</code></p> <p>Details \u2192 Controller Architecture</p>"},{"location":"architecture/overview/#database-postgresql","title":"Database (PostgreSQL)","text":"<ul> <li>PostgreSQL 17-alpine in Docker</li> <li>Async driver: <code>asyncpg</code></li> <li>Tables: <code>users</code>, <code>experiments</code>, <code>events</code>, <code>datapoints</code>, <code>logs</code></li> <li>Protocol-based repository abstraction for swapping backends</li> </ul> <p>Details \u2192 Database Abstraction</p>"},{"location":"architecture/overview/#data-flow","title":"Data Flow","text":"<pre><code>sequenceDiagram\n    participant S as Sensor Hardware\n    participant C as Controller\n    participant B as Backend\n    participant DB as PostgreSQL\n    participant F as Frontend\n\n    S-&gt;&gt;C: Read sensor value\n    C-&gt;&gt;B: POST /api/v1/datapoints (or WS)\n    B-&gt;&gt;DB: INSERT INTO datapoints\n    B--&gt;&gt;F: WebSocket broadcast\n    F-&gt;&gt;F: Update dashboard chart</code></pre>"},{"location":"architecture/overview/#technology-decisions","title":"Technology Decisions","text":"Decision Choice Rationale Python 3.14 Latest RC StrEnum, PEP 695 generics, performance FastAPI Async framework Native async, Pydantic v2, OpenAPI docs SQLAlchemy 2 Async ORM Mature, type-safe, async session support Vue 3 Frontend framework Composition API, TypeScript, reactive Pinia State management Official Vue store, devtools support Docker Compose Orchestration Simple, reproducible, single-command Protocol pattern DB abstraction PEP 544 structural subtyping, plug-and-play"},{"location":"architecture/overview/#next-steps","title":"Next Steps","text":"<ul> <li>Backend \u2014 FastAPI internals</li> <li>WebSocket Design \u2014 real-time protocol details</li> <li>Database Abstraction \u2014 Protocol-based storage layer</li> </ul>"},{"location":"architecture/websocket/","title":"WebSocket Design","text":"<p>WebMACS uses WebSockets for two real-time channels: controller telemetry and frontend data streaming.</p>"},{"location":"architecture/websocket/#endpoints","title":"Endpoints","text":"Endpoint Direction Purpose <code>/ws/controller/telemetry</code> Controller \u2192 Backend Push sensor readings <code>/ws/datapoints/stream</code> Backend \u2192 Frontend Broadcast new datapoints"},{"location":"architecture/websocket/#architecture","title":"Architecture","text":"<pre><code>graph LR\n    Controller --&gt;|\"WS /ws/controller/telemetry\"| WS_Hub[\"Connection Manager&lt;br/&gt;(Pub/Sub Hub)\"]\n    WS_Hub --&gt;|\"broadcast\"| F1[\"Frontend Client 1\"]\n    WS_Hub --&gt;|\"broadcast\"| F2[\"Frontend Client 2\"]\n    WS_Hub --&gt;|\"persist\"| DB[(PostgreSQL)]</code></pre>"},{"location":"architecture/websocket/#connection-manager","title":"Connection Manager","text":"<p>The <code>ConnectionManager</code> is a pub/sub hub that:</p> <ol> <li>Accepts incoming WebSocket connections</li> <li>Maintains a set of active connections per topic</li> <li>Broadcasts messages to all subscribers</li> <li>Handles disconnection cleanup</li> </ol> <pre><code>class ConnectionManager:\n    def __init__(self):\n        self._connections: dict[str, set[WebSocket]] = {}\n\n    async def connect(self, topic: str, ws: WebSocket): ...\n    async def disconnect(self, topic: str, ws: WebSocket): ...\n    async def broadcast(self, topic: str, data: dict): ...\n</code></pre>"},{"location":"architecture/websocket/#controller-backend-protocol","title":"Controller \u2192 Backend Protocol","text":""},{"location":"architecture/websocket/#message-format","title":"Message Format","text":"<pre><code>{\n  \"event_public_id\": \"evt_temp01\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\"\n}\n</code></pre>"},{"location":"architecture/websocket/#flow","title":"Flow","text":"<ol> <li>Controller opens WS to <code>/ws/controller/telemetry</code></li> <li>Backend authenticates via token query parameter</li> <li>Controller sends JSON messages at <code>poll_interval</code></li> <li>Backend persists to DB and broadcasts to <code>/ws/datapoints/stream</code> subscribers</li> <li>Backend sends heartbeat pings every <code>ws_heartbeat_interval</code> seconds</li> </ol>"},{"location":"architecture/websocket/#backend-frontend-protocol","title":"Backend \u2192 Frontend Protocol","text":""},{"location":"architecture/websocket/#message-format_1","title":"Message Format","text":"<pre><code>{\n  \"public_id\": \"dp_abc123\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\",\n  \"event_public_id\": \"evt_temp01\",\n  \"experiment_public_id\": \"exp_001\"\n}\n</code></pre>"},{"location":"architecture/websocket/#client-reconnection","title":"Client Reconnection","text":"<p>The frontend <code>websocket.ts</code> service implements:</p> <ul> <li>Automatic reconnection with exponential backoff</li> <li>Maximum 3 retry attempts</li> <li>Fallback to HTTP polling after exhausting retries</li> <li>Clean disconnect on component unmount</li> </ul>"},{"location":"architecture/websocket/#nginx-proxy-configuration","title":"Nginx Proxy Configuration","text":"<p>For WebSocket passthrough, the Nginx config includes:</p> <pre><code>location /ws/ {\n    proxy_pass http://backend:8000;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"upgrade\";\n    proxy_set_header Host $host;\n    proxy_read_timeout 86400;\n}\n</code></pre> <p>The <code>proxy_read_timeout</code> is set to 24 hours to prevent premature disconnection of long-lived WebSocket connections.</p>"},{"location":"architecture/websocket/#sequence-diagram","title":"Sequence Diagram","text":"<pre><code>sequenceDiagram\n    participant C as Controller\n    participant B as Backend WS Hub\n    participant DB as PostgreSQL\n    participant F as Frontend\n\n    C-&gt;&gt;B: WS Connect /ws/controller/telemetry\n    F-&gt;&gt;B: WS Connect /ws/datapoints/stream\n\n    loop Every 0.5s\n        C-&gt;&gt;B: {\"event_public_id\": \"...\", \"value\": 23.4}\n        B-&gt;&gt;DB: INSERT INTO datapoints\n        B-&gt;&gt;F: {\"public_id\": \"...\", \"value\": 23.4, ...}\n    end\n\n    B-&gt;&gt;C: ping (heartbeat)\n    C-&gt;&gt;B: pong</code></pre>"},{"location":"architecture/websocket/#next-steps","title":"Next Steps","text":"<ul> <li>Database Abstraction \u2014 how data is persisted</li> <li>API Reference: WebSocket \u2014 endpoint documentation</li> </ul>"},{"location":"deployment/docker/","title":"Docker Deployment","text":"<p>WebMACS runs as a four-container Docker Compose stack.</p>"},{"location":"deployment/docker/#architecture","title":"Architecture","text":"<pre><code>graph TB\n    subgraph Docker Network\n        DB[\"db&lt;br/&gt;postgres:17-alpine&lt;br/&gt;:5432\"]\n        Backend[\"backend&lt;br/&gt;FastAPI/Uvicorn&lt;br/&gt;:8000\"]\n        Frontend[\"frontend&lt;br/&gt;Nginx + Vue SPA&lt;br/&gt;:80\"]\n        Controller[\"controller&lt;br/&gt;Python Agent\"]\n    end\n\n    Frontend --&gt;|\"/api/* proxy\"| Backend\n    Frontend --&gt;|\"/ws/* proxy\"| Backend\n    Controller --&gt;|\"HTTP/WS\"| Backend\n    Backend --&gt;|\"asyncpg\"| DB</code></pre>"},{"location":"deployment/docker/#quick-start","title":"Quick Start","text":"<pre><code>cp .env.example .env\ndocker compose up --build -d\n</code></pre>"},{"location":"deployment/docker/#verify","title":"Verify","text":"<pre><code>docker compose ps\n# All 4 services should show \"healthy\" or \"running\"\n\ncurl http://localhost/health\n# {\"status\":\"healthy\"}\n</code></pre>"},{"location":"deployment/docker/#services","title":"Services","text":""},{"location":"deployment/docker/#db-postgresql","title":"<code>db</code> \u2014 PostgreSQL","text":"<pre><code>image: postgres:17-alpine\nports: [\"5432:5432\"]\nvolumes: [pgdata:/var/lib/postgresql/data]\nhealthcheck: pg_isready -U webmacs\n</code></pre>"},{"location":"deployment/docker/#backend-fastapi","title":"<code>backend</code> \u2014 FastAPI","text":"<pre><code>build: docker/backend.Dockerfile\nports: [\"8000:8000\"]\ndepends_on: db (healthy)\nhealthcheck: urllib.request.urlopen('http://localhost:8000/health')\n</code></pre>"},{"location":"deployment/docker/#frontend-nginx-vue","title":"<code>frontend</code> \u2014 Nginx + Vue","text":"<pre><code>build: docker/frontend.Dockerfile\nports: [\"80:80\"]\ndepends_on: [backend]\n</code></pre> <p>Nginx serves the built Vue SPA and proxies <code>/api/</code> and <code>/ws/</code> to the backend.</p>"},{"location":"deployment/docker/#controller-iot-agent","title":"<code>controller</code> \u2014 IoT Agent","text":"<pre><code>build: docker/controller.Dockerfile\ndepends_on: backend (healthy)\n</code></pre>"},{"location":"deployment/docker/#docker-files","title":"Docker Files","text":"File Description <code>docker/backend.Dockerfile</code> Python 3.13-slim + UV + FastAPI <code>docker/frontend.Dockerfile</code> Node 22 build stage \u2192 Nginx serve stage <code>docker/controller.Dockerfile</code> Python 3.13-slim + UV + controller <code>docker/nginx.conf</code> Nginx config with API + WebSocket proxy"},{"location":"deployment/docker/#common-commands","title":"Common Commands","text":"<pre><code># Start all services\ndocker compose up -d\n\n# Rebuild after code changes\ndocker compose up --build -d\n\n# View logs\ndocker compose logs -f backend\ndocker compose logs -f controller\n\n# Stop everything\ndocker compose down\n\n# Stop and remove data\ndocker compose down -v   # \u26a0\ufe0f deletes database\n\n# Restart single service\ndocker compose restart backend\n</code></pre>"},{"location":"deployment/docker/#volumes","title":"Volumes","text":"Volume Mounted At Purpose <code>pgdata</code> <code>/var/lib/postgresql/data</code> Persistent database storage"},{"location":"deployment/docker/#ota-updates","title":"OTA Updates","text":"<p>WebMACS includes a built-in Over-The-Air (OTA) update system. Updates are distributed as <code>.tar.gz</code> bundles containing Docker images and metadata.</p>"},{"location":"deployment/docker/#how-ota-works","title":"How OTA Works","text":"<pre><code>sequenceDiagram\n    participant User\n    participant Frontend\n    participant Backend\n    participant Updater\n    participant Docker\n\n    User-&gt;&gt;Frontend: Upload .tar.gz bundle\n    Frontend-&gt;&gt;Backend: POST /api/v1/ota/upload\n    Backend-&gt;&gt;Backend: Verify hash &amp; version\n    Backend-&gt;&gt;Updater: Trigger update\n    Updater-&gt;&gt;Updater: Backup database\n    Updater-&gt;&gt;Docker: docker load images\n    Updater-&gt;&gt;Docker: docker compose up -d\n    Docker--&gt;&gt;User: Services restart with new version</code></pre>"},{"location":"deployment/docker/#building-an-update-bundle","title":"Building an Update Bundle","text":"<p>Use the <code>just bundle</code> command on your development machine:</p> <pre><code>just bundle\n</code></pre> <p>This creates <code>webmacs-update-&lt;version&gt;.tar.gz</code> containing:</p> <ul> <li><code>images.tar</code> \u2014 all Docker images</li> <li><code>docker-compose.prod.yml</code> \u2014 production compose file</li> <li><code>metadata.json</code> \u2014 version, build timestamp, SHA-256 hash</li> </ul>"},{"location":"deployment/docker/#applying-updates","title":"Applying Updates","text":"<p>There are three ways to apply an update:</p> Web UI (Recommended)USB / SCPCommand Line <ol> <li>Navigate to OTA Updates in the sidebar</li> <li>Click Upload Bundle</li> <li>Select the <code>.tar.gz</code> bundle file</li> <li>The system verifies integrity, backs up the database, loads new images, and restarts</li> <li>The page reloads when the update is complete</li> </ol> <p>Copy the bundle to the device's update directory:</p> <pre><code>scp webmacs-update-2.1.0.tar.gz pi@&lt;device-ip&gt;:/opt/webmacs/updates/\n</code></pre> <p>The built-in updater watches <code>/opt/webmacs/updates/</code> and automatically applies new bundles within 60 seconds.</p> <pre><code>cd /opt/webmacs\nsudo tar -xzf updates/webmacs-update-2.1.0.tar.gz -C /tmp/webmacs-update\nsudo docker load -i /tmp/webmacs-update/images.tar\nsudo sed -i \"s/^WEBMACS_VERSION=.*/WEBMACS_VERSION=2.1.0/\" .env\nsudo docker compose -f docker-compose.prod.yml --env-file .env up -d\n</code></pre>"},{"location":"deployment/docker/#rollback","title":"Rollback","text":"<p>If an update fails, the system automatically rolls back. Manual rollback:</p> <pre><code>cd /opt/webmacs\n# Restore database backup\ncat updates/backups/pre-update-*.sql | docker compose exec -T db psql -U webmacs webmacs\n\n# Load previous images\ndocker load -i updates/backups/images-prev.tar\ndocker compose -f docker-compose.prod.yml up -d\n</code></pre>"},{"location":"deployment/docker/#webhooks","title":"Webhooks","text":"<p>WebMACS can notify external systems when events occur via HTTP webhooks.</p>"},{"location":"deployment/docker/#supported-events","title":"Supported Events","text":"Event Trigger <code>sensor_reading</code> New datapoint is recorded <code>experiment_started</code> Experiment starts <code>experiment_stopped</code> Experiment stops <code>rule_triggered</code> An automation rule fires <code>system_alert</code> Health or threshold alert"},{"location":"deployment/docker/#configuring-webhooks","title":"Configuring Webhooks","text":"Web UIREST API <ol> <li>Navigate to Settings \u2192 Webhooks</li> <li>Click Add Webhook</li> <li>Enter the target URL (e.g., <code>https://hooks.example.com/services/...</code>)</li> <li>Select which events should trigger the webhook</li> <li>Optionally add a secret for HMAC signature verification</li> </ol> <pre><code>curl -X POST http://localhost/api/v1/webhooks \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"url\": \"https://your-server.com/webhook\",\n    \"events\": [\"sensor_reading\", \"experiment_started\"],\n    \"secret\": \"optional-hmac-secret\"\n  }'\n</code></pre>"},{"location":"deployment/docker/#webhook-payload-format","title":"Webhook Payload Format","text":"<pre><code>{\n  \"event\": \"sensor_reading\",\n  \"timestamp\": \"2025-01-15T14:30:00Z\",\n  \"data\": {\n    \"sensor\": \"evt_abc123\",\n    \"value\": 23.5\n  }\n}\n</code></pre>"},{"location":"deployment/docker/#integration-examples","title":"Integration Examples","text":"SlackNode-REDHome AssistantCustom Script <p>Use a Slack Incoming Webhook URL:</p> <pre><code>https://hooks.example.com/services/T00000000/B00000000/XXXXXXXX\n</code></pre> <p>Slack will display the JSON payload as a message in your channel.</p> <p>Create an HTTP In node listening on <code>/webmacs-hook</code> and point the webhook URL to your Node-RED instance:</p> <pre><code>http://&lt;nodered-ip&gt;:1880/webmacs-hook\n</code></pre> <p>Use a Home Assistant webhook automation:</p> <pre><code>http://&lt;ha-ip&gt;:8123/api/webhook/&lt;webhook-id&gt;\n</code></pre> <p>Receive webhooks with a simple Python server:</p> <pre><code>from flask import Flask, request\n\napp = Flask(__name__)\n\n@app.post(\"/webhook\")\ndef handle():\n    data = request.json\n    print(f\"Event: {data['event']}, Value: {data['data']}\")\n    return \"OK\", 200\n</code></pre>"},{"location":"deployment/docker/#security","title":"Security","text":"<p>Webhooks support HMAC-SHA256 signature verification. When a <code>secret</code> is configured, every request includes an <code>X-WebMACS-Signature</code> header:</p> <pre><code>X-WebMACS-Signature: sha256=&lt;hex-digest&gt;\n</code></pre> <p>Verify the signature in your receiving endpoint to ensure authenticity.</p>"},{"location":"deployment/docker/#simple-installation-for-customers","title":"Simple Installation for Customers","text":"<p>For end-user installations on Revolution Pi or similar devices, use the automated installer:</p> <pre><code># 1. Transfer the update bundle to the device\nscp webmacs-update-2.0.0.tar.gz pi@&lt;device-ip&gt;:/tmp/\n\n# 2. SSH into the device\nssh pi@&lt;device-ip&gt;\n\n# 3. Run the one-line installer\nsudo bash /tmp/install.sh /tmp/webmacs-update-2.0.0.tar.gz\n</code></pre> <p>The installer handles everything automatically:</p> Step What it does Docker Installs Docker + Compose if not present Directory Creates <code>/opt/webmacs</code> with update folders Credentials Generates random <code>SECRET_KEY</code>, <code>DB_PASSWORD</code>, and admin password Images Loads Docker images from the bundle Services Starts all 4 containers Boot Creates systemd service for auto-start <p>After installation, open <code>http://&lt;device-ip&gt;</code> in a browser and log in with the credentials shown during install.</p> <p>No Internet Required</p> <p>The installer works completely offline. All Docker images are pre-built and included in the update bundle.</p> <p>For detailed step-by-step instructions, see the Installation Guide.</p>"},{"location":"deployment/docker/#next-steps","title":"Next Steps","text":"<ul> <li>Installation Guide \u2014 detailed customer installation</li> <li>Production Deployment \u2014 hardening for production</li> <li>Environment Variables \u2014 full configuration reference</li> </ul>"},{"location":"deployment/env-vars/","title":"Environment Variables","text":"<p>Complete reference of all environment variables used by WebMACS.</p>"},{"location":"deployment/env-vars/#backend","title":"Backend","text":"Variable Required Default Description <code>DATABASE_URL</code> Yes <code>postgresql+asyncpg://...localhost...</code> SQLAlchemy async connection string <code>SECRET_KEY</code> Yes (empty) JWT signing secret \u2014 must set in production <code>ALGORITHM</code> No <code>HS256</code> JWT algorithm <code>ACCESS_TOKEN_EXPIRE_MINUTES</code> No <code>1440</code> Token lifetime (minutes) <code>BACKEND_HOST</code> No <code>0.0.0.0</code> Uvicorn bind host <code>BACKEND_PORT</code> No <code>8000</code> Uvicorn bind port <code>CORS_ORIGINS</code> No <code>[\"http://localhost:3000\",\"http://localhost:5173\"]</code> JSON array of allowed origins <code>DEBUG</code> No <code>false</code> Enable debug mode <code>STORAGE_BACKEND</code> No <code>postgresql</code> <code>postgresql</code> or <code>timescale</code> <code>SENTRY_DSN</code> No (empty) Sentry error tracking URL <code>WS_HEARTBEAT_INTERVAL</code> No <code>30</code> WebSocket heartbeat (seconds) <code>TIMEZONE</code> No <code>Europe/Berlin</code> Default timezone <code>INITIAL_ADMIN_EMAIL</code> No <code>admin@webmacs.io</code> Seed admin email <code>INITIAL_ADMIN_USERNAME</code> No <code>admin</code> Seed admin username <code>INITIAL_ADMIN_PASSWORD</code> No <code>admin123</code> Seed admin password"},{"location":"deployment/env-vars/#controller","title":"Controller","text":"Variable Required Default Description <code>WEBMACS_ENV</code> No <code>development</code> <code>development</code> or <code>production</code> <code>WEBMACS_SERVER_URL</code> Yes <code>http://localhost</code> Backend base URL <code>WEBMACS_SERVER_PORT</code> Yes <code>8000</code> Backend port <code>WEBMACS_ADMIN_EMAIL</code> Yes \u2014 Login credentials for controller <code>WEBMACS_ADMIN_PASSWORD</code> Yes \u2014 Login password <code>WEBMACS_POLL_INTERVAL</code> No <code>0.5</code> Sensor read interval (seconds) <code>WEBMACS_REQUEST_TIMEOUT</code> No <code>30.0</code> HTTP timeout (seconds) <code>WEBMACS_TELEMETRY_MODE</code> No <code>http</code> <code>http</code> or <code>websocket</code> <code>WEBMACS_RULE_EVENT_ID</code> No (empty) Event triggering rule evaluation <code>WEBMACS_REVPI_MAPPING</code> No <code>{}</code> JSON: RevPi I/O pin \u2192 event ID"},{"location":"deployment/env-vars/#docker-compose","title":"Docker Compose","text":"<p>These are used in <code>docker-compose.yml</code> and passed through to services:</p> Variable Default Used By <code>DB_PASSWORD</code> <code>webmacs_dev_password</code> db, backend <code>SECRET_KEY</code> <code>change-me-in-production</code> backend <code>ADMIN_EMAIL</code> <code>admin@webmacs.io</code> backend, controller <code>ADMIN_USERNAME</code> <code>admin</code> backend <code>ADMIN_PASSWORD</code> <code>admin123</code> backend, controller <code>TELEMETRY_MODE</code> <code>http</code> controller"},{"location":"deployment/env-vars/#generating-secrets","title":"Generating Secrets","text":"<pre><code># Secret key (64 hex chars)\nopenssl rand -hex 32\n\n# Database password\nopenssl rand -base64 24\n\n# Admin password\nopenssl rand -base64 16\n</code></pre>"},{"location":"deployment/env-vars/#example-env","title":"Example <code>.env</code>","text":"<pre><code># Database\nDATABASE_URL=postgresql+asyncpg://webmacs:MyStr0ngPwd!@db:5432/webmacs\nDB_PASSWORD=MyStr0ngPwd!\n\n# Security\nSECRET_KEY=a1b2c3d4e5f6...64chars\nACCESS_TOKEN_EXPIRE_MINUTES=60\n\n# Admin\nADMIN_EMAIL=admin@company.com\nADMIN_USERNAME=admin\nADMIN_PASSWORD=Ch4ng3M3!\n\n# Controller\nTELEMETRY_MODE=websocket\n</code></pre>"},{"location":"deployment/env-vars/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Setup \u2014 container configuration</li> <li>Production Guide \u2014 hardening checklist</li> </ul>"},{"location":"deployment/installation-guide/","title":"Installation Guide","text":"<p>Step-by-step instructions for installing WebMACS on a Revolution Pi or any Debian/Ubuntu-based system.</p>"},{"location":"deployment/installation-guide/#prerequisites","title":"Prerequisites","text":"Requirement Minimum Hardware Kunbus Revolution Pi, Raspberry Pi 4, or x86_64 server OS Debian 11+ / Ubuntu 22.04+ (64-bit recommended) RAM 2 GB Storage 8 GB free Network Ethernet (for sensor I/O and web access) <p>Docker and Docker Compose are installed automatically by the installation script if not already present.</p>"},{"location":"deployment/installation-guide/#installation","title":"Installation","text":""},{"location":"deployment/installation-guide/#option-a-automated-install-recommended","title":"Option A \u2014 Automated Install (Recommended)","text":"<p>You will receive a WebMACS update bundle (<code>.tar.gz</code> file) from your system integrator. Copy it to the device via USB stick or SCP.</p> <pre><code># Copy the bundle to the device (from your workstation)\nscp webmacs-update-2.0.0.tar.gz pi@&lt;device-ip&gt;:/tmp/\n\n# SSH into the device\nssh pi@&lt;device-ip&gt;\n\n# Run the installer\nsudo bash /tmp/install.sh /tmp/webmacs-update-2.0.0.tar.gz\n</code></pre> <p>The installer will:</p> <ol> <li>Install Docker and Docker Compose (if missing)</li> <li>Create the <code>/opt/webmacs</code> directory structure</li> <li>Generate a secure <code>.env</code> with random passwords</li> <li>Load the Docker images from the bundle</li> <li>Start all services</li> <li>Create a systemd service for automatic start on boot</li> </ol> <p>Save Your Credentials</p> <p>The admin password is displayed only once during installation. It is also stored in <code>/opt/webmacs/.env</code>.</p>"},{"location":"deployment/installation-guide/#option-b-manual-install","title":"Option B \u2014 Manual Install","text":"<p>If you prefer to set up components individually:</p> <pre><code># 1. Install Docker\ncurl -fsSL https://get.docker.com | sh\nsudo systemctl enable docker &amp;&amp; sudo systemctl start docker\n\n# 2. Create directories\nsudo mkdir -p /opt/webmacs/{updates,updates/applied,updates/backups,updates/failed}\n\n# 3. Copy the compose file and bundle\nsudo cp docker-compose.prod.yml /opt/webmacs/\nsudo cp webmacs-update-*.tar.gz /opt/webmacs/\n\n# 4. Extract and load images\ncd /opt/webmacs\nsudo tar -xzf webmacs-update-*.tar.gz\nsudo docker load -i images.tar\n\n# 5. Create .env (see Environment Variables page for all options)\nsudo cp .env.example /opt/webmacs/.env\nsudo nano /opt/webmacs/.env\n\n# 6. Start\ncd /opt/webmacs\nsudo docker compose -f docker-compose.prod.yml --env-file .env up -d\n</code></pre>"},{"location":"deployment/installation-guide/#first-login","title":"First Login","text":"<ol> <li>Open a browser and navigate to <code>http://&lt;device-ip&gt;</code></li> <li>Log in with the admin credentials shown during installation</li> <li>Change the admin password immediately under Settings \u2192 Profile</li> </ol> <p>Finding the Device IP</p> <p>Run <code>hostname -I</code> on the device to see its IP address. On a Revolution Pi connected via Ethernet, the IP is typically assigned by DHCP.</p>"},{"location":"deployment/installation-guide/#creating-additional-users","title":"Creating Additional Users","text":"<p>After your first login as admin:</p> <ol> <li>Navigate to Settings \u2192 Users</li> <li>Click Add User</li> <li>Fill in email, username, and password</li> <li>Assign the appropriate role (<code>admin</code> or <code>viewer</code>)</li> </ol>"},{"location":"deployment/installation-guide/#updating-webmacs","title":"Updating WebMACS","text":"<p>There are two ways to apply updates:</p>"},{"location":"deployment/installation-guide/#via-web-ui-recommended","title":"Via Web UI (Recommended)","text":"<ol> <li>Go to OTA Updates in the sidebar</li> <li>Click Upload Bundle</li> <li>Select the <code>.tar.gz</code> update bundle</li> <li>The system will verify the bundle integrity, back up the database, load new images, and restart automatically</li> <li>The page will reload once the update is complete</li> </ol>"},{"location":"deployment/installation-guide/#via-usb-scp","title":"Via USB / SCP","text":"<ol> <li>Copy the update bundle to the device:    <pre><code>scp webmacs-update-2.1.0.tar.gz pi@&lt;device-ip&gt;:/opt/webmacs/updates/\n</code></pre></li> <li>The built-in updater service will detect the bundle within 60 seconds</li> <li>It will automatically verify, apply, and restart the stack</li> </ol>"},{"location":"deployment/installation-guide/#via-command-line","title":"Via Command Line","text":"<pre><code>cd /opt/webmacs\nsudo tar -xzf updates/webmacs-update-2.1.0.tar.gz -C /tmp/webmacs-update\nsudo docker load -i /tmp/webmacs-update/images.tar\nsudo sed -i \"s/^WEBMACS_VERSION=.*/WEBMACS_VERSION=2.1.0/\" .env\nsudo docker compose -f docker-compose.prod.yml --env-file .env up -d\n</code></pre>"},{"location":"deployment/installation-guide/#backup-restore","title":"Backup &amp; Restore","text":""},{"location":"deployment/installation-guide/#create-a-database-backup","title":"Create a Database Backup","text":"<pre><code>cd /opt/webmacs\ndocker compose -f docker-compose.prod.yml exec -T db \\\n  pg_dump -U webmacs webmacs &gt; backup-$(date +%Y%m%d).sql\n</code></pre>"},{"location":"deployment/installation-guide/#restore-from-backup","title":"Restore from Backup","text":"<pre><code>cd /opt/webmacs\ndocker compose -f docker-compose.prod.yml exec -T db \\\n  psql -U webmacs webmacs &lt; backup-20250101.sql\n</code></pre> <p>Note</p> <p>The updater creates automatic backups before every update in <code>/opt/webmacs/updates/backups/</code>.</p>"},{"location":"deployment/installation-guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"deployment/installation-guide/#services-wont-start","title":"Services Won't Start","text":"<pre><code># Check service status\ncd /opt/webmacs\ndocker compose -f docker-compose.prod.yml ps\n\n# View logs\ndocker compose -f docker-compose.prod.yml logs -f backend\n\n# Restart everything\nsudo systemctl restart webmacs\n</code></pre>"},{"location":"deployment/installation-guide/#cannot-access-web-ui","title":"Cannot Access Web UI","text":"<ol> <li>Check that the backend is healthy:    <pre><code>curl -s http://localhost:8000/health\n</code></pre></li> <li>Check that nginx/frontend is running:    <pre><code>docker compose -f docker-compose.prod.yml ps frontend\n</code></pre></li> <li>Verify no firewall is blocking port 80:    <pre><code>sudo ufw allow 80/tcp   # if ufw is active\n</code></pre></li> </ol>"},{"location":"deployment/installation-guide/#out-of-disk-space","title":"Out of Disk Space","text":"<pre><code># Check disk usage\ndf -h\n\n# Remove old Docker images\ndocker image prune -a\n\n# Remove old update bundles\nrm /opt/webmacs/updates/applied/*.tar.gz\n</code></pre>"},{"location":"deployment/installation-guide/#forgot-admin-password","title":"Forgot Admin Password","text":"<pre><code>cd /opt/webmacs\ncat .env | grep ADMIN_PASSWORD\n</code></pre> <p>If the password was changed via the UI and is no longer in <code>.env</code>, reset it:</p> <pre><code>docker compose -f docker-compose.prod.yml exec backend \\\n  python -c \"\nfrom webmacs_backend.security import get_password_hash\nprint(get_password_hash('NewPassword123!'))\n\" | xargs -I{} docker compose -f docker-compose.prod.yml exec -T db \\\n  psql -U webmacs webmacs -c \"UPDATE users SET hashed_password='{}' WHERE username='admin';\"\n</code></pre>"},{"location":"deployment/installation-guide/#uninstalling","title":"Uninstalling","text":"<pre><code>cd /opt/webmacs\nsudo docker compose -f docker-compose.prod.yml down -v\nsudo systemctl disable webmacs\nsudo rm /etc/systemd/system/webmacs.service\nsudo systemctl daemon-reload\nsudo rm -rf /opt/webmacs\n</code></pre> <p>Danger</p> <p>This removes all data including the database. Create a backup first.</p>"},{"location":"deployment/installation-guide/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Revolution Pi / Host                            \u2502\n\u2502                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 Frontend \u2502  \u2502 Backend  \u2502  \u2502  Controller  \u2502  \u2502\n\u2502   \u2502 (nginx)  \u2502  \u2502 (FastAPI)\u2502  \u2502 (sensors)    \u2502  \u2502\n\u2502   \u2502 :80      \u2502  \u2502 :8000    \u2502  \u2502              \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502        \u2502              \u2502               \u2502          \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502          \u2502\n\u2502               \u2502                       \u2502          \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502          \u2502\n\u2502         \u2502 PostgreSQL\u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502         \u2502 :5432     \u2502                            \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                            \u2502\n\u2502                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502\n\u2502   \u2502 Updater  \u2502  (monitors /opt/webmacs/updates/) \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>All services run as Docker containers managed by Docker Compose. The systemd unit ensures they start automatically after a reboot.</p>"},{"location":"deployment/production/","title":"Production Deployment","text":"<p>This guide covers hardening WebMACS for production environments.</p>"},{"location":"deployment/production/#security-checklist","title":"Security Checklist","text":"<ul> <li>[ ] Generate a strong <code>SECRET_KEY</code> (<code>openssl rand -hex 32</code>)</li> <li>[ ] Change default admin password</li> <li>[ ] Set <code>DEBUG=false</code></li> <li>[ ] Use a strong <code>DB_PASSWORD</code></li> <li>[ ] Restrict <code>CORS_ORIGINS</code> to your domain</li> <li>[ ] Enable HTTPS (TLS termination at load balancer or Nginx)</li> <li>[ ] Configure Sentry for error tracking (<code>SENTRY_DSN</code>)</li> </ul>"},{"location":"deployment/production/#environment-file","title":"Environment File","text":"<p>Create a production <code>.env</code>:</p> <pre><code># Security\nSECRET_KEY=&lt;generated-64-char-hex&gt;\nALGORITHM=HS256\nACCESS_TOKEN_EXPIRE_MINUTES=60\n\n# Database\nDATABASE_URL=postgresql+asyncpg://webmacs:&lt;strong-password&gt;@db:5432/webmacs\nDB_PASSWORD=&lt;strong-password&gt;\n\n# Admin\nINITIAL_ADMIN_EMAIL=admin@yourcompany.com\nINITIAL_ADMIN_USERNAME=admin\nINITIAL_ADMIN_PASSWORD=&lt;strong-password&gt;\n\n# Backend\nCORS_ORIGINS=[\"https://webmacs.yourcompany.com\"]\nDEBUG=false\nWEBMACS_ENV=production\n\n# Controller\nWEBMACS_TELEMETRY_MODE=websocket\n</code></pre>"},{"location":"deployment/production/#https-tls","title":"HTTPS / TLS","text":""},{"location":"deployment/production/#option-1-reverse-proxy-recommended","title":"Option 1: Reverse Proxy (Recommended)","text":"<p>Place a TLS-terminating reverse proxy (Traefik, Caddy, cloud LB) in front of the Nginx container.</p>"},{"location":"deployment/production/#option-2-nginx-with-certbot","title":"Option 2: Nginx with Certbot","text":"<p>Add SSL configuration to <code>docker/nginx.conf</code>:</p> <pre><code>server {\n    listen 443 ssl;\n    ssl_certificate /etc/letsencrypt/live/webmacs.example.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/webmacs.example.com/privkey.pem;\n\n    # ... existing location blocks\n}\n</code></pre>"},{"location":"deployment/production/#database-backups","title":"Database Backups","text":""},{"location":"deployment/production/#automated-dump","title":"Automated Dump","text":"<pre><code>docker compose exec db pg_dump -U webmacs webmacs &gt; backup_$(date +%Y%m%d).sql\n</code></pre>"},{"location":"deployment/production/#restore","title":"Restore","text":"<pre><code>cat backup_20250115.sql | docker compose exec -T db psql -U webmacs webmacs\n</code></pre>"},{"location":"deployment/production/#scheduled-backups","title":"Scheduled Backups","text":"<p>Add a cron job:</p> <pre><code>0 2 * * * cd /path/to/webmacs &amp;&amp; docker compose exec -T db pg_dump -U webmacs webmacs | gzip &gt; /backups/webmacs_$(date +\\%Y\\%m\\%d).sql.gz\n</code></pre>"},{"location":"deployment/production/#monitoring","title":"Monitoring","text":""},{"location":"deployment/production/#health-endpoints","title":"Health Endpoints","text":"Endpoint Service Purpose <code>GET /health</code> Backend Application health <code>pg_isready</code> PostgreSQL Database connectivity"},{"location":"deployment/production/#sentry-integration","title":"Sentry Integration","text":"<p>Set <code>SENTRY_DSN</code> to enable error tracking:</p> <pre><code>SENTRY_DSN=https://abc123@sentry.io/12345\n</code></pre>"},{"location":"deployment/production/#logging","title":"Logging","text":"<p>The backend uses structlog for structured JSON logging. In production, pipe logs to your log aggregator (ELK, Loki, CloudWatch).</p>"},{"location":"deployment/production/#scaling-considerations","title":"Scaling Considerations","text":"Component Scaling Notes Backend Horizontal Run multiple replicas behind a load balancer Frontend CDN Serve static files from a CDN Controller Single One controller per physical installation Database Vertical / Read replicas Consider TimescaleDB for time-series"},{"location":"deployment/production/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Setup \u2014 container configuration</li> <li>Environment Variables \u2014 full reference</li> </ul>"},{"location":"development/code-style/","title":"Code Style","text":"<p>WebMACS enforces consistent code style across all components.</p>"},{"location":"development/code-style/#python-backend-controller","title":"Python (Backend &amp; Controller)","text":""},{"location":"development/code-style/#formatter-linter-ruff","title":"Formatter &amp; Linter: Ruff","text":"<p>Ruff handles both formatting and linting:</p> <pre><code># pyproject.toml\n[tool.ruff]\ntarget-version = \"py314\"\nline-length = 120\n\n[tool.ruff.lint]\nselect = [\n    \"E\", \"F\", \"W\",     # pycodestyle, pyflakes\n    \"I\",                # isort\n    \"N\",                # pep8-naming\n    \"UP\",               # pyupgrade\n    \"S\",                # bandit (security)\n    \"B\",                # bugbear\n    \"A\",                # builtins\n    \"C4\",               # comprehensions\n    \"DTZ\",              # datetime timezone\n    \"T20\",              # print statements\n    \"PT\",               # pytest style\n    \"SIM\",              # simplify\n    \"TID\",              # tidy imports\n    \"TCH\",              # type checking\n    \"ARG\",              # unused arguments\n    \"PL\",               # pylint\n    \"TRY\",              # tryceratops\n    \"PERF\",             # performance\n    \"RUF\",              # ruff-specific\n]\nignore = [\"S101\", \"TRY003\", \"PLR0913\"]\n</code></pre>"},{"location":"development/code-style/#type-checking-mypy","title":"Type Checking: mypy","text":"<pre><code>[tool.mypy]\npython_version = \"3.14\"\nstrict = true\ndisallow_untyped_defs = true\n</code></pre>"},{"location":"development/code-style/#commands","title":"Commands","text":"<pre><code>just lint       # ruff check + format check\njust format     # ruff format (auto-fix)\njust fix        # format + lint-fix\n</code></pre>"},{"location":"development/code-style/#typescript-frontend","title":"TypeScript (Frontend)","text":""},{"location":"development/code-style/#linter-eslint","title":"Linter: ESLint","text":"<p>The frontend uses ESLint with Vue and TypeScript rules:</p> <pre><code>npm run lint        # Check\nnpm run lint:fix    # Auto-fix\n</code></pre>"},{"location":"development/code-style/#type-checking-vue-tsc","title":"Type Checking: vue-tsc","text":"<pre><code>npm run type-check\n</code></pre>"},{"location":"development/code-style/#conventions","title":"Conventions","text":""},{"location":"development/code-style/#python","title":"Python","text":"<ul> <li>Imports: Sorted by <code>isort</code> (via Ruff). First-party packages: <code>webmacs_backend</code>, <code>webmacs_controller</code></li> <li>Docstrings: Google style</li> <li>Naming: <code>snake_case</code> for functions/variables, <code>PascalCase</code> for classes</li> <li>Type hints: Required on all public functions (mypy strict mode)</li> <li>Async: Use <code>async def</code> for all I/O-bound operations</li> </ul>"},{"location":"development/code-style/#typescript","title":"TypeScript","text":"<ul> <li>Naming: <code>camelCase</code> for variables/functions, <code>PascalCase</code> for components/types</li> <li>Composition API: <code>&lt;script setup lang=\"ts\"&gt;</code> for all components</li> <li>Types: Explicit interfaces in <code>types/</code> directory</li> <li>Imports: Absolute paths from <code>@/</code> alias</li> </ul>"},{"location":"development/code-style/#commits","title":"Commits","text":"<p>Follow Conventional Commits \u2014 see Contributing.</p>"},{"location":"development/code-style/#pre-commit-checks","title":"Pre-Commit Checks","text":"<p>Run before every commit:</p> <pre><code>just check      # lint + type-check + test\n</code></pre> <p>Or integrate with git hooks:</p> <pre><code># .pre-commit-config.yaml support planned\n</code></pre>"},{"location":"development/code-style/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing \u2014 full development workflow</li> <li>Testing \u2014 test structure and patterns</li> </ul>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Contributions to WebMACS are welcome. Here is how to get involved.</p>"},{"location":"development/contributing/#development-setup","title":"Development Setup","text":""},{"location":"development/contributing/#1-clone-the-repository","title":"1. Clone the repository","text":"<pre><code>git clone https://github.com/stefanposs/webmacs.git\ncd webmacs\n</code></pre>"},{"location":"development/contributing/#2-install-dependencies","title":"2. Install dependencies","text":"<pre><code># Backend\ncd backend &amp;&amp; uv sync --all-extras &amp;&amp; cd ..\n\n# Controller\ncd controller &amp;&amp; uv sync --all-extras &amp;&amp; cd ..\n\n# Frontend\ncd frontend &amp;&amp; npm install &amp;&amp; cd ..\n</code></pre>"},{"location":"development/contributing/#3-verify-installation","title":"3. Verify installation","text":"<pre><code>just test       # Run all tests\njust lint       # Check code style\n</code></pre>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"development/contributing/#available-commands","title":"Available Commands","text":"<pre><code># Setup\njust setup              # Install all dependencies\n\n# Code quality\njust lint               # Run ruff linter on backend + controller\njust format             # Auto-format code\njust fix                # Format + lint-fix\n\n# Testing\njust test               # Run all tests (backend + controller + frontend)\njust test-backend       # Backend tests only\njust test-controller    # Controller tests only\njust test-frontend      # Frontend tests only\n\n# Docker\njust dev                # Start full Docker stack\njust down               # Stop all containers\njust rebuild            # Rebuild and restart\n\n# Documentation\njust docs               # Serve docs locally (http://localhost:8001)\njust docs-build         # Build static docs\n\n# Quality\njust qa                 # Full QA: lint + format-check + test\njust check              # Quick check before commit\n</code></pre>"},{"location":"development/contributing/#branch-strategy","title":"Branch Strategy","text":"Branch Purpose <code>main</code> Production-ready code <code>develop</code> Integration branch <code>feature/*</code> New features <code>fix/*</code> Bug fixes <code>docs/*</code> Documentation updates"},{"location":"development/contributing/#commit-messages","title":"Commit Messages","text":"<p>Follow Conventional Commits:</p> Prefix Purpose <code>feat:</code> New feature <code>fix:</code> Bug fix <code>docs:</code> Documentation <code>test:</code> Tests <code>refactor:</code> Code refactoring <code>perf:</code> Performance improvements <code>ci:</code> CI/CD changes <code>chore:</code> Maintenance"},{"location":"development/contributing/#pull-request-process","title":"Pull Request Process","text":""},{"location":"development/contributing/#1-create-feature-branch","title":"1. Create feature branch","text":"<pre><code>git checkout -b feature/my-awesome-feature\n</code></pre>"},{"location":"development/contributing/#2-make-changes","title":"2. Make changes","text":"<ul> <li>Write tests for new functionality</li> <li>Ensure <code>just qa</code> passes</li> <li>Update documentation if needed</li> </ul>"},{"location":"development/contributing/#3-push-and-open-pr","title":"3. Push and open PR","text":"<pre><code>git push origin feature/my-awesome-feature\n</code></pre> <p>Open a PR against <code>develop</code> (or <code>main</code> for hotfixes).</p>"},{"location":"development/contributing/#4-code-review","title":"4. Code review","text":"<ul> <li>At least one approval required</li> <li>CI must pass</li> <li>No merge conflicts</li> </ul>"},{"location":"development/contributing/#cicd-pipeline","title":"CI/CD Pipeline","text":"<p>GitHub Actions runs on every push:</p> <ul> <li>Python: Ruff linting, mypy type checking, pytest with coverage</li> <li>Frontend: ESLint, vue-tsc type checking, Vite build, vitest</li> <li>Matrix: Backend + Controller tested separately</li> <li>Services: PostgreSQL 17 for integration tests</li> </ul>"},{"location":"development/contributing/#release-process","title":"Release Process","text":"<ol> <li>Merge to <code>main</code></li> <li>Tag version: <code>git tag v2.x.x</code></li> <li>Push tags: <code>git push --tags</code></li> <li>Docker images rebuilt automatically</li> </ol>"},{"location":"development/contributing/#questions","title":"Questions?","text":"<p>Open a GitHub Issue.</p>"},{"location":"development/testing/","title":"Testing","text":"<p>WebMACS has three test suites: backend (Python), controller (Python), and frontend (TypeScript).</p>"},{"location":"development/testing/#test-structure","title":"Test Structure","text":"<pre><code>\u251c\u2500\u2500 backend/tests/\n\u2502   \u251c\u2500\u2500 conftest.py           # Fixtures (async session, test client, auth)\n\u2502   \u251c\u2500\u2500 test_auth.py          # Login, JWT validation, logout\n\u2502   \u251c\u2500\u2500 test_datapoints.py    # Datapoints batch, latest, CRUD\n\u2502   \u2514\u2500\u2500 test_events.py        # Events CRUD + duplicates\n\u251c\u2500\u2500 controller/tests/\n\u2502   \u251c\u2500\u2500 conftest.py           # Fixtures (mock API client)\n\u2502   \u251c\u2500\u2500 test_api_client.py    # HTTP client + retry logic\n\u2502   \u251c\u2500\u2500 test_hardware.py      # Hardware abstraction tests\n\u2502   \u2514\u2500\u2500 test_sensor_manager.py # Sensor reading tests\n\u2514\u2500\u2500 frontend/src/\n    \u251c\u2500\u2500 composables/__tests__/  # useFormatters, useNotification\n    \u251c\u2500\u2500 stores/__tests__/       # auth, events, experiments, datapoints\n    \u251c\u2500\u2500 services/__tests__/     # api, websocket\n    \u2514\u2500\u2500 types/__tests__/        # TypeScript enum validation\n</code></pre>"},{"location":"development/testing/#running-tests","title":"Running Tests","text":""},{"location":"development/testing/#all-tests","title":"All Tests","text":"<pre><code>just test\n</code></pre>"},{"location":"development/testing/#by-component","title":"By Component","text":"<pre><code>just test-backend       # Backend only\njust test-controller    # Controller only\njust test-frontend      # Frontend only\n</code></pre>"},{"location":"development/testing/#with-coverage","title":"With Coverage","text":"<pre><code>cd backend &amp;&amp; uv run pytest tests/ -v --cov --cov-report=html\n</code></pre> <p>Open <code>htmlcov/index.html</code> to view the coverage report.</p>"},{"location":"development/testing/#backend-test-setup","title":"Backend Test Setup","text":"<p>Tests use an in-memory SQLite database by default (overridable via <code>DATABASE_URL</code> env var).</p>"},{"location":"development/testing/#key-fixtures-conftestpy","title":"Key Fixtures (<code>conftest.py</code>)","text":"Fixture Scope Description <code>engine</code> session Async SQLAlchemy engine <code>session</code> function Async session (auto-rolled-back) <code>client</code> function <code>httpx.AsyncClient</code> against the test app <code>auth_headers</code> function <code>{\"Authorization\": \"Bearer ...\"}</code> for authenticated requests <code>admin_user</code> function Pre-seeded admin user"},{"location":"development/testing/#example-test","title":"Example Test","text":"<pre><code>@pytest.mark.asyncio\nasync def test_create_experiment(client, auth_headers):\n    response = await client.post(\n        \"/api/v1/experiments\",\n        json={\"name\": \"Test Run\"},\n        headers=auth_headers,\n    )\n    assert response.status_code == 201\n    data = response.json()\n    assert data[\"name\"] == \"Test Run\"\n    assert data[\"started_on\"] is not None\n</code></pre>"},{"location":"development/testing/#controller-test-setup","title":"Controller Test Setup","text":"<p>Controller tests mock the HTTP client to avoid needing a running backend:</p> <pre><code>@pytest.fixture\ndef mock_api_client(mocker):\n    client = mocker.MagicMock(spec=APIClient)\n    client.post = mocker.AsyncMock(return_value={\"status\": \"ok\"})\n    return client\n</code></pre>"},{"location":"development/testing/#frontend-tests","title":"Frontend Tests","text":"<pre><code>cd frontend\nnpm run test -- --run     # Single run\nnpm run test -- --watch   # Watch mode\n</code></pre> <p>Uses Vitest with Vue Test Utils.</p>"},{"location":"development/testing/#ci-integration","title":"CI Integration","text":"<p>GitHub Actions runs the full test matrix:</p> Job Python OS Services <code>python</code> 3.14 ubuntu-latest PostgreSQL 17 <code>frontend</code> \u2014 ubuntu-latest \u2014 <p>Coverage reports are uploaded to Codecov.</p>"},{"location":"development/testing/#test-markers","title":"Test Markers","text":"<pre><code>@pytest.mark.unit          # Fast, no external deps\n@pytest.mark.integration   # Needs database\n@pytest.mark.e2e           # Full stack\n</code></pre> <p>Run specific markers:</p> <pre><code>uv run pytest -m unit\nuv run pytest -m integration\n</code></pre>"},{"location":"development/testing/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing \u2014 development workflow</li> <li>Code Style \u2014 formatting and linting rules</li> </ul>"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>WebMACS is configured entirely through environment variables. Copy <code>.env.example</code> to <code>.env</code> and customise as needed.</p>"},{"location":"getting-started/configuration/#backend-settings","title":"Backend Settings","text":"Variable Default Description <code>DATABASE_URL</code> <code>postgresql+asyncpg://webmacs:webmacs@localhost:5432/webmacs</code> Async SQLAlchemy connection string <code>SECRET_KEY</code> (empty \u2014 must set) JWT signing key. Generate with <code>openssl rand -hex 32</code> <code>ACCESS_TOKEN_EXPIRE_MINUTES</code> <code>1440</code> JWT token lifetime (default 24 h) <code>ALGORITHM</code> <code>HS256</code> JWT algorithm <code>BACKEND_HOST</code> <code>0.0.0.0</code> Uvicorn bind address <code>BACKEND_PORT</code> <code>8000</code> Uvicorn port <code>CORS_ORIGINS</code> <code>[\"http://localhost:3000\",\"http://localhost:5173\"]</code> Allowed CORS origins (JSON array) <code>DEBUG</code> <code>false</code> Enable debug mode <code>STORAGE_BACKEND</code> <code>postgresql</code> Database backend: <code>postgresql</code> or <code>timescale</code> <code>SENTRY_DSN</code> (empty) Optional Sentry error tracking <code>WS_HEARTBEAT_INTERVAL</code> <code>30</code> WebSocket heartbeat interval (seconds) <code>TIMEZONE</code> <code>Europe/Berlin</code> Default timezone for timestamps"},{"location":"getting-started/configuration/#initial-admin-user","title":"Initial Admin User","text":"Variable Default Description <code>INITIAL_ADMIN_EMAIL</code> <code>admin@webmacs.io</code> Email for the auto-seeded admin <code>INITIAL_ADMIN_USERNAME</code> <code>admin</code> Username <code>INITIAL_ADMIN_PASSWORD</code> <code>admin123</code> Password \u2014 change in production!"},{"location":"getting-started/configuration/#controller-settings","title":"Controller Settings","text":"Variable Default Description <code>WEBMACS_ENV</code> <code>development</code> Environment (<code>development</code> / <code>production</code>) <code>WEBMACS_SERVER_URL</code> <code>http://localhost</code> Backend base URL <code>WEBMACS_SERVER_PORT</code> <code>8000</code> Backend port <code>WEBMACS_ADMIN_EMAIL</code> <code>admin@example.com</code> Credentials for controller \u2194 backend auth <code>WEBMACS_ADMIN_PASSWORD</code> (set in .env) Password for auto-login <code>WEBMACS_POLL_INTERVAL</code> <code>0.5</code> Sensor polling interval (seconds) <code>WEBMACS_REQUEST_TIMEOUT</code> <code>30.0</code> HTTP request timeout <code>WEBMACS_TELEMETRY_MODE</code> <code>http</code> <code>http</code> or <code>websocket</code> <code>WEBMACS_RULE_EVENT_ID</code> (empty) Event public_id triggering rule evaluation <code>WEBMACS_REVPI_MAPPING</code> <code>{}</code> JSON mapping of RevPi I/O pins to event ids"},{"location":"getting-started/configuration/#docker-compose-variables","title":"Docker Compose Variables","text":"<p>These are used by <code>docker-compose.yml</code>:</p> Variable Default Description <code>DB_PASSWORD</code> <code>webmacs_dev_password</code> PostgreSQL password <code>ADMIN_EMAIL</code> <code>admin@webmacs.io</code> Passed to backend + controller <code>ADMIN_USERNAME</code> <code>admin</code> Admin username <code>ADMIN_PASSWORD</code> <code>admin123</code> Admin password <code>TELEMETRY_MODE</code> <code>http</code> Controller telemetry transport"},{"location":"getting-started/configuration/#generating-a-secret-key","title":"Generating a Secret Key","text":"<pre><code>openssl rand -hex 32\n</code></pre> <p>Copy the output into <code>SECRET_KEY</code> in your <code>.env</code> file.</p>"},{"location":"getting-started/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Deployment \u2014 production Docker setup</li> <li>Environment Variables Reference \u2014 full reference</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"Tool Version Purpose Docker 24+ Container runtime Docker Compose v2+ Multi-container orchestration Git 2.x Source control just 1.x Task runner (optional, recommended) <p>For local development without Docker you also need:</p> Tool Version Purpose Python 3.14+ Backend &amp; Controller Node.js 22+ Frontend build PostgreSQL 17+ Database"},{"location":"getting-started/installation/#clone-the-repository","title":"Clone the Repository","text":"<pre><code>git clone https://github.com/stefanposs/webmacs.git\ncd webmacs\n</code></pre>"},{"location":"getting-started/installation/#docker-recommended","title":"Docker (Recommended)","text":"<p>The fastest way to run WebMACS:</p> <pre><code># Copy environment defaults\ncp .env.example .env\n\n# Build &amp; start all four services\ndocker compose up --build -d\n</code></pre> <p>This spins up:</p> Service Port Description <code>db</code> 5432 PostgreSQL 17-alpine <code>backend</code> 8000 FastAPI (Uvicorn) <code>frontend</code> 80 Vue 3 SPA (Nginx) <code>controller</code> \u2014 IoT telemetry agent <p>Verify everything is healthy:</p> <pre><code>docker compose ps\n</code></pre>"},{"location":"getting-started/installation/#local-development-setup","title":"Local Development Setup","text":""},{"location":"getting-started/installation/#backend","title":"Backend","text":"<pre><code>cd backend\nuv sync --all-extras\nuv run uvicorn webmacs_backend.main:create_app --factory --reload --port 8000\n</code></pre>"},{"location":"getting-started/installation/#frontend","title":"Frontend","text":"<pre><code>cd frontend\nnpm install\nnpm run dev          # \u2192 http://localhost:5173\n</code></pre>"},{"location":"getting-started/installation/#controller","title":"Controller","text":"<pre><code>cd controller\nuv sync --all-extras\nuv run python -m webmacs_controller\n</code></pre>"},{"location":"getting-started/installation/#install-just-task-runner","title":"Install <code>just</code> (Task Runner)","text":"<pre><code># macOS\nbrew install just\n\n# Linux\ncurl --proto '=https' --tlsv1.2 -sSf https://just.systems/install.sh | bash -s -- --to /usr/local/bin\n\n# Windows (scoop)\nscoop install just\n</code></pre> <p>Then run <code>just</code> from the project root to see all available commands:</p> <pre><code>just          # lists all recipes\njust dev      # start full dev stack\njust test     # run all tests\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start \u2014 first login and experiment</li> <li>Configuration \u2014 environment variables reference</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>This guide walks you through your first WebMACS session \u2014 from login to running an experiment.</p>"},{"location":"getting-started/quick-start/#1-start-the-stack","title":"1. Start the Stack","text":"<pre><code>cd webmacs\ndocker compose up -d\n</code></pre> <p>Open http://localhost in your browser.</p>"},{"location":"getting-started/quick-start/#2-log-in","title":"2. Log In","text":"<p>The backend automatically seeds an initial admin user on first startup:</p> Field Default Email <code>admin@webmacs.io</code> Password <code>admin123</code> <p>Change the default password</p> <p>Set <code>INITIAL_ADMIN_PASSWORD</code> in your <code>.env</code> file before deploying to any shared environment.</p>"},{"location":"getting-started/quick-start/#3-explore-the-dashboard","title":"3. Explore the Dashboard","text":"<p>The Dashboard shows real-time sensor data:</p> <ul> <li>WebSocket mode \u2014 data streams in via <code>/ws/datapoints/stream</code> (green indicator)</li> <li>Polling fallback \u2014 if WebSocket fails after 3 attempts, the dashboard falls back to HTTP polling (amber indicator)</li> </ul>"},{"location":"getting-started/quick-start/#4-create-an-experiment","title":"4. Create an Experiment","text":"<ol> <li>Navigate to Experiments in the sidebar</li> <li>Click New Experiment</li> <li>Enter a name (e.g. <code>Test Run 01</code>)</li> <li>Click Start \u2014 all incoming datapoints are now associated with this experiment</li> </ol>"},{"location":"getting-started/quick-start/#5-view-events-sensors","title":"5. View Events &amp; Sensors","text":"<p>The Events page lists all configured sensor/actuator events. Each event has:</p> <ul> <li>A unique <code>public_id</code></li> <li>A <code>type</code> (sensor, actuator, range, cmd_button, cmd_opened, cmd_closed)</li> <li>A human-readable <code>name</code></li> </ul>"},{"location":"getting-started/quick-start/#6-stop-export","title":"6. Stop &amp; Export","text":"<ol> <li>Go back to Experiments</li> <li>Click Stop on the running experiment</li> <li>Click the CSV download button to export all datapoints</li> </ol>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration \u2014 customise settings via environment variables</li> <li>Dashboard Guide \u2014 deep dive into real-time monitoring</li> <li>Architecture Overview \u2014 understand how the pieces fit together</li> </ul>"},{"location":"guide/","title":"User Guide","text":"<p>Welcome to the WebMACS User Guide. This section explains every feature of the platform \u2014 from live sensor monitoring to automated alerting and data export.</p> <p>WebMACS (Web-based Monitoring and Control System) is designed for operators who need to monitor industrial sensors, control actuators, run timed experiments, and export data \u2014 all from a browser.</p>"},{"location":"guide/#what-can-i-do-with-webmacs","title":"What Can I Do with WebMACS?","text":"Feature What It Does Dashboard See all sensor values live, toggle actuators, adjust range controls, view a real-time chart Events &amp; Sensors Define sensors, actuators, and range controls that the controller reads from hardware Experiments Group datapoints into time-bounded experiments for later analysis Datapoints Browse the raw data stream collected from every sensor Automation Rules Trigger alerts or webhooks when sensor values exceed thresholds Webhooks Push notifications to external systems (Slack, Teams, custom APIs) CSV Export Download experiment data as a spreadsheet-ready CSV file OTA Updates Update the system firmware over the network Logs View system log entries (info, warnings, errors) Users Manage operator and admin accounts"},{"location":"guide/#quick-overview","title":"Quick Overview","text":"<pre><code>flowchart LR\n    HW[Hardware Sensors] --&gt; CTRL[IoT Controller]\n    CTRL --&gt;|WebSocket + HTTP| BE[Backend API]\n    BE --&gt;|WebSocket| FE[Browser Dashboard]\n    BE --&gt;|Webhooks| EXT[External Systems]\n    BE --&gt;|CSV| DL[Data Export]\n    FE --&gt;|Actuator commands| BE\n    BE --&gt;|Write| DB[(Database)]</code></pre>"},{"location":"guide/#recommended-reading-order","title":"Recommended Reading Order","text":"<ol> <li>Dashboard \u2014 understand the live view and controls</li> <li>Events &amp; Sensors \u2014 configure what you monitor</li> <li>Experiments \u2014 group data into experiments</li> <li>CSV Export \u2014 get data out for analysis</li> <li>Automation Rules \u2014 set up threshold-based alerts</li> <li>Webhooks \u2014 notify external systems</li> <li>OTA Updates \u2014 manage firmware deployments</li> </ol>"},{"location":"guide/#user-roles","title":"User Roles","text":"<p>WebMACS has two user roles:</p> Role Can Access Operator Dashboard, Events, Experiments, Datapoints, CSV Export, Logs Admin Everything above + Rules, Webhooks, OTA Updates, User Management <p>Admin-only pages are marked with a  icon in the sidebar.</p>"},{"location":"guide/#need-help","title":"Need Help?","text":"<ul> <li>Configuration Guide \u2014 environment variables and settings</li> <li>Architecture Overview \u2014 technical deep dive</li> <li>API Reference \u2014 REST endpoint documentation</li> <li>GitHub Issues \u2014 report bugs or request features</li> </ul>"},{"location":"guide/csv-export/","title":"CSV Export","text":"<p>WebMACS lets you download all datapoints from a completed experiment as a CSV file \u2014 ready to open in Excel, Google Sheets, or import into analysis tools like Python/pandas or MATLAB.</p>"},{"location":"guide/csv-export/#how-it-works","title":"How It Works","text":"<p>The CSV is generated on-the-fly using streaming. This means:</p> <ul> <li> No temporary file is created on the server</li> <li> Memory usage stays constant regardless of dataset size</li> <li> Download starts immediately, even for millions of rows</li> <li> Data is ordered by timestamp (oldest first)</li> </ul>"},{"location":"guide/csv-export/#using-the-ui","title":"Using the UI","text":"<ol> <li>Navigate to Experiments in the sidebar</li> <li>Find a stopped experiment</li> <li>Click the  CSV button</li> <li>The browser downloads a file named like <code>experiment_Fluidised_Bed_Run_07_a1b2c3d4.csv</code></li> </ol> <p>Running experiments</p> <p>You can only export data from stopped experiments. Stop the experiment first if it's still running.</p>"},{"location":"guide/csv-export/#using-the-api","title":"Using the API","text":"<pre><code>curl -o results.csv \\\n  http://localhost:8000/api/v1/experiments/$EXP_ID/export/csv \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/csv-export/#response-headers","title":"Response Headers","text":"<pre><code>Content-Type: text/csv; charset=utf-8\nContent-Disposition: attachment; filename=\"experiment_My_Run_a1b2c3d4.csv\"\nTransfer-Encoding: chunked\n</code></pre>"},{"location":"guide/csv-export/#csv-format","title":"CSV Format","text":"<pre><code>timestamp,event_name,event_public_id,value,unit,datapoint_public_id\n2025-01-15T14:32:10.000000,Inlet Temperature,evt_temp01,23.45,\u00b0C,dp_001\n2025-01-15T14:32:10.000000,Chamber Pressure,evt_pres01,1.23,bar,dp_002\n2025-01-15T14:32:10.500000,Inlet Temperature,evt_temp01,23.51,\u00b0C,dp_003\n</code></pre>"},{"location":"guide/csv-export/#columns","title":"Columns","text":"Column Description <code>timestamp</code> ISO 8601 timestamp (UTC) <code>event_name</code> Human-readable sensor/actuator name <code>event_public_id</code> Event unique identifier <code>value</code> Measured value (float) <code>unit</code> Measurement unit (\u00b0C, bar, L/min, \u2026) <code>datapoint_public_id</code> Unique datapoint identifier"},{"location":"guide/csv-export/#working-with-the-data","title":"Working with the Data","text":"Excel / Google SheetsPython / pandasMATLAB <p>Simply open the downloaded <code>.csv</code> file. Columns are comma-separated with UTF-8 encoding. Most spreadsheet applications detect the format automatically.</p> <pre><code>import pandas as pd\n\ndf = pd.read_csv(\"experiment_Run_07_a1b2c3d4.csv\", parse_dates=[\"timestamp\"])\n\n# Filter by sensor\ntemp = df[df[\"event_name\"] == \"Inlet Temperature\"]\n\n# Plot\ntemp.plot(x=\"timestamp\", y=\"value\", title=\"Inlet Temperature\")\n</code></pre> <pre><code>data = readtable('experiment_Run_07_a1b2c3d4.csv');\ntemp = data(strcmp(data.event_name, 'Inlet Temperature'), :);\nplot(temp.timestamp, temp.value);\n</code></pre>"},{"location":"guide/csv-export/#tips","title":"Tips","text":"<p>Recommendations</p> <ul> <li>Export frequently \u2014 CSV files are the easiest way to back up experiment data</li> <li>Filter in your analysis tool \u2014 the CSV contains all events mixed together; filter by <code>event_name</code> or <code>event_public_id</code> to isolate individual sensors</li> <li>Timestamps are UTC \u2014 convert to your local timezone in your analysis tool if needed</li> <li>Large datasets \u2014 the streaming approach handles millions of rows, but very large files may take a moment to download</li> </ul>"},{"location":"guide/csv-export/#next-steps","title":"Next Steps","text":"<ul> <li>Experiments \u2014 manage experiment lifecycle</li> <li>Events &amp; Sensors \u2014 understand what data is collected</li> <li>Dashboard \u2014 monitor live data while an experiment runs</li> </ul>"},{"location":"guide/dashboard/","title":"Dashboard","text":"<p>The Dashboard is your primary control centre. It shows live sensor readings, lets you toggle actuators, adjust range controls, and displays a real-time chart \u2014 all updating in real time.</p>"},{"location":"guide/dashboard/#at-a-glance","title":"At a Glance","text":"<p>When you open the Dashboard you see four sections:</p> Section What It Shows Stats bar Total sensor count, actuator count, range control count, and connection status Sensor cards One card per sensor with current value, unit, and min/max range indicator Actuator controls ON / OFF toggle for each actuator Range controls Adjustable slider for each range-type event Live chart Scrolling line chart with the last 60 readings per sensor"},{"location":"guide/dashboard/#connection-status","title":"Connection Status","text":"<p>The stats bar shows how data is being received:</p> Indicator Mode Meaning Live (green) WebSocket Data streams in real time \u2014 best experience Poll (amber) HTTP Polling WebSocket unavailable, polling every 1.5 s Connecting \u2014 Establishing connection <p>Connection tips</p> <ul> <li>Live mode is the default and recommended. Data appears instantly.</li> <li>If you see Poll mode, check that the backend WebSocket endpoint is reachable. The system switches to polling automatically after 3 failed WebSocket reconnection attempts.</li> </ul>"},{"location":"guide/dashboard/#how-automatic-fallback-works","title":"How Automatic Fallback Works","text":"<pre><code>flowchart TD\n    A[Dashboard opens] --&gt; B{WebSocket connects?}\n    B --&gt;|Yes| C[Live mode \u2014 stream data]\n    B --&gt;|No| D{Retry count &lt; 3?}\n    D --&gt;|Yes| B\n    D --&gt;|No| E[Switch to HTTP polling]\n    C --&gt;|Connection drops| D\n    E --&gt; F[Poll GET /api/v1/datapoints/latest every 1.5 s]</code></pre>"},{"location":"guide/dashboard/#sensor-cards","title":"Sensor Cards","text":"<p>Each sensor event gets its own card displaying:</p> <ul> <li>Name \u2014 the sensor label (e.g. \"Inlet Temperature\")</li> <li>Current value \u2014 large, easy-to-read number</li> <li>Unit \u2014 measurement unit (\u00b0C, bar, L/min, \u2026)</li> <li>Range bar \u2014 visual min/max indicator showing where the current value falls</li> </ul> <p>Values update automatically whenever new data arrives via the real-time connection.</p>"},{"location":"guide/dashboard/#actuator-controls","title":"Actuator Controls","text":"<p>Each actuator event is shown as an ON / OFF toggle button. Toggling sends a datapoint with value <code>1</code> (ON) or <code>0</code> (OFF) to the backend, which the IoT controller picks up to switch hardware outputs.</p> <p>Actuators affect physical hardware</p> <p>Toggling an actuator immediately sends a command to the controller. Make sure the connected equipment is in a safe state before switching.</p>"},{"location":"guide/dashboard/#range-controls","title":"Range Controls","text":"<p>Range events appear as sliders bounded by the event's <code>min_value</code> and <code>max_value</code>. Dragging the slider sends the selected value as a new datapoint.</p> <p>Use range controls for setpoints like target temperatures, flow rates, or motor speeds.</p>"},{"location":"guide/dashboard/#live-chart","title":"Live Chart","text":"<p>The bottom section shows a scrolling line chart powered by Chart.js:</p> <ul> <li>One line per sensor \u2014 up to 8 colours are cycled automatically</li> <li>Last 60 data points per sensor</li> <li>Smooth curves \u2014 filled area under each line for easy visual separation</li> <li>Auto-scrolling \u2014 oldest data drops off the left edge as new data arrives</li> </ul> <p>The chart updates every time a new datapoint batch is received.</p> <p>Chart visibility</p> <p>The live chart section only appears when at least one sensor event exists.</p>"},{"location":"guide/dashboard/#typical-workflow","title":"Typical Workflow","text":"<ol> <li>Create events \u2014 go to Events &amp; Sensors and define your sensors, actuators, and range controls</li> <li>Start the controller \u2014 the IoT controller reads hardware and pushes datapoints to the backend</li> <li>Open the Dashboard \u2014 sensor cards fill with live values, the chart starts plotting</li> <li>Interact \u2014 toggle actuators, adjust range sliders, monitor trends</li> <li>(Optional) Start an experiment \u2014 go to Experiments to begin grouping datapoints</li> </ol>"},{"location":"guide/dashboard/#configuration-reference","title":"Configuration Reference","text":"Setting Where Default Description Poll interval Frontend composable 1.5 s Time between HTTP polls in fallback mode WS heartbeat Backend config 30 s Server-side ping to keep WebSocket alive Max WS retries Frontend composable 3 Reconnection attempts before switching to polling"},{"location":"guide/dashboard/#next-steps","title":"Next Steps","text":"<ul> <li>Events &amp; Sensors \u2014 define what data feeds the dashboard</li> <li>Experiments \u2014 start grouping data into experiments</li> <li>Automation Rules \u2014 get alerted when values cross thresholds</li> </ul>"},{"location":"guide/datapoints/","title":"Datapoints","text":"<p>Datapoints are the raw data stream of WebMACS. Every sensor reading, actuator command, and range adjustment is stored as a datapoint \u2014 a timestamped value linked to an event and optionally to an experiment.</p>"},{"location":"guide/datapoints/#what-is-a-datapoint","title":"What Is a Datapoint?","text":"Field Description Value The measured or commanded value (float) Timestamp When the reading was recorded (UTC) Event Which sensor/actuator produced this value Experiment The running experiment at the time (if any) Public ID Unique identifier"},{"location":"guide/datapoints/#how-datapoints-are-created","title":"How Datapoints Are Created","text":"<p>Datapoints are created automatically by the system \u2014 you rarely create them manually.</p> <pre><code>flowchart LR\n    CTRL[IoT Controller] --&gt;|POST /datapoints/batch| BE[Backend]\n    UI[Dashboard toggle/slider] --&gt;|POST /datapoints| BE\n    BE --&gt; DB[(Database)]\n    BE --&gt; WS[WebSocket broadcast]\n    BE --&gt; RULE[Rule evaluation]\n    BE --&gt; WH[Webhook dispatch]</code></pre> Source How Description Controller <code>POST /api/v1/datapoints/batch</code> Pushes sensor readings every ~0.5 s Dashboard <code>POST /api/v1/datapoints</code> Actuator toggles and range slider changes API client <code>POST /api/v1/datapoints</code> External systems can push data too"},{"location":"guide/datapoints/#what-happens-on-each-datapoint","title":"What Happens on Each Datapoint","text":"<p>When a new datapoint arrives, the backend:</p> <ol> <li>Persists it to the database</li> <li>Links to active experiment \u2014 if an experiment is running, the datapoint is associated automatically</li> <li>Evaluates rules \u2014 all enabled automation rules for the event are checked</li> <li>Fires webhooks \u2014 <code>sensor.reading</code> webhooks are dispatched</li> <li>Broadcasts \u2014 the value is pushed to all connected browser dashboards via WebSocket</li> </ol>"},{"location":"guide/datapoints/#browsing-datapoints","title":"Browsing Datapoints","text":""},{"location":"guide/datapoints/#via-the-ui","title":"Via the UI","text":"<p>Navigate to Datapoints in the sidebar to see a paginated table of all recorded values:</p> Column Description Public ID Unique identifier Event Sensor/actuator name Value Measured value Created Timestamp <p>The table shows a total count badge and is paginated.</p>"},{"location":"guide/datapoints/#via-the-api","title":"Via the API","text":"<pre><code># List datapoints (paginated, newest first)\ncurl http://localhost:8000/api/v1/datapoints?page=1&amp;page_size=50 \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# Get the latest reading per event (used by the Dashboard)\ncurl http://localhost:8000/api/v1/datapoints/latest \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# Get a single datapoint\ncurl http://localhost:8000/api/v1/datapoints/$DP_ID \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/datapoints/#creating-datapoints-via-api","title":"Creating Datapoints via API","text":""},{"location":"guide/datapoints/#single-datapoint","title":"Single Datapoint","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/datapoints \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"value\": 23.45,\n    \"event_public_id\": \"evt_temp_inlet\"\n  }'\n</code></pre>"},{"location":"guide/datapoints/#batch-multiple-datapoints","title":"Batch (Multiple Datapoints)","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/datapoints/batch \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"datapoints\": [\n      {\"value\": 23.45, \"event_public_id\": \"evt_temp_inlet\"},\n      {\"value\": 1.05, \"event_public_id\": \"evt_pressure_01\"},\n      {\"value\": 4.2, \"event_public_id\": \"evt_flow_rate\"}\n    ]\n  }'\n</code></pre> <p>Use batch for performance</p> <p>The batch endpoint is significantly more efficient than individual POSTs when sending multiple readings at once. The IoT controller uses this by default.</p>"},{"location":"guide/datapoints/#deleting-datapoints","title":"Deleting Datapoints","text":"<pre><code>curl -X DELETE http://localhost:8000/api/v1/datapoints/$DP_ID \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Deletion is permanent</p> <p>Deleted datapoints cannot be recovered. Consider CSV export before deleting experiment data.</p>"},{"location":"guide/datapoints/#data-volume","title":"Data Volume","text":"<p>In a typical setup with 7 sensors reading every 0.5 seconds:</p> Period Datapoints 1 minute ~840 1 hour ~50,400 24 hours ~1.2 million 1 week ~8.5 million <p>WebMACS handles this volume efficiently with streaming CSV export and paginated API responses.</p>"},{"location":"guide/datapoints/#next-steps","title":"Next Steps","text":"<ul> <li>Dashboard \u2014 see datapoints visualised in real time</li> <li>Experiments \u2014 group datapoints into time-bounded experiments</li> <li>CSV Export \u2014 download experiment data for analysis</li> <li>API Reference \u2014 full datapoints endpoint documentation</li> </ul>"},{"location":"guide/events/","title":"Events &amp; Sensors","text":"<p>Events represent the physical sensors and actuators connected to the IoT controller. Every datapoint recorded by WebMACS belongs to exactly one event.</p> <p>Think of events as channel definitions \u2014 they describe what is being measured (or controlled), while datapoints hold the actual values.</p>"},{"location":"guide/events/#event-types","title":"Event Types","text":"<p>WebMACS supports six event types:</p> Type Icon Description Dashboard Widget <code>sensor</code> Continuous measurement (temperature, pressure, flow) Value card with range bar <code>actuator</code> Binary on/off control (valves, heaters, motors) ON / OFF toggle <code>range</code> Adjustable value within min/max bounds Slider control <code>cmd_button</code> Momentary command button \u2014 <code>cmd_opened</code> Open-state command \u2014 <code>cmd_closed</code> Close-state command \u2014 <p>Choosing the right type</p> <ul> <li>Use sensor for anything you want to monitor passively (readings from the hardware).</li> <li>Use actuator for anything the operator needs to switch on or off.</li> <li>Use range for setpoints where the operator picks a value within a defined range.</li> </ul>"},{"location":"guide/events/#event-properties","title":"Event Properties","text":"Field Required Description Name Yes Human-readable label (must be unique) Type Yes One of the six types above Unit No Measurement unit (\u00b0C, bar, L/min, %, rpm) Min Value No Lower bound (used for range bar / slider) Max Value No Upper bound (used for range bar / slider) <p>Min / Max values</p> <p>For range events, <code>min_value</code> and <code>max_value</code> define the slider boundaries. For sensor events they define the range bar visual on the Dashboard. If not set, the range bar is not displayed.</p>"},{"location":"guide/events/#managing-events-via-the-ui","title":"Managing Events via the UI","text":""},{"location":"guide/events/#creating-an-event","title":"Creating an Event","text":"<ol> <li>Navigate to Events in the sidebar</li> <li>Click New Event</li> <li>Fill in the fields:<ul> <li>Name \u2014 e.g. \"Inlet Temperature\"</li> <li>Type \u2014 select from dropdown</li> <li>Unit \u2014 e.g. \"\u00b0C\"</li> <li>Min / Max Value \u2014 optional range bounds</li> </ul> </li> <li>Click Create</li> </ol>"},{"location":"guide/events/#editing-an-event","title":"Editing an Event","text":"<p>Click the  edit button on any event row. Change the fields you need and save.</p>"},{"location":"guide/events/#deleting-an-event","title":"Deleting an Event","text":"<p>Click the  delete button and confirm. Deleting an event does not delete its historical datapoints.</p>"},{"location":"guide/events/#managing-events-via-the-api","title":"Managing Events via the API","text":""},{"location":"guide/events/#list-events","title":"List Events","text":"<pre><code>curl http://localhost:8000/api/v1/events \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Response is paginated. Use <code>?page=1&amp;page_size=50</code> query parameters.</p>"},{"location":"guide/events/#create-an-event","title":"Create an Event","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/events \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"Inlet Temperature\",\n    \"type\": \"sensor\",\n    \"unit\": \"\u00b0C\",\n    \"min_value\": 0,\n    \"max_value\": 300\n  }'\n</code></pre> <p>Duplicate names</p> <p>Event names must be unique. Attempting to create an event with an existing name returns 409 Conflict.</p>"},{"location":"guide/events/#update-an-event","title":"Update an Event","text":"<pre><code>curl -X PUT http://localhost:8000/api/v1/events/$EVENT_ID \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"unit\": \"K\"}'\n</code></pre>"},{"location":"guide/events/#delete-an-event","title":"Delete an Event","text":"<pre><code>curl -X DELETE http://localhost:8000/api/v1/events/$EVENT_ID \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/events/#controller-mapping","title":"Controller Mapping","text":"<p>The IoT controller maps physical I/O pins to event Public IDs. This is configured via the <code>WEBMACS_REVPI_MAPPING</code> environment variable:</p> <pre><code>{\n  \"Input_1\": \"evt_temp_inlet\",\n  \"Input_2\": \"evt_pressure_chamber\",\n  \"Output_1\": \"evt_valve_main\"\n}\n</code></pre> <p>The controller reads hardware values for each mapped input and sends them as datapoints to the backend. For output events (actuators), the controller watches for new datapoints and writes the value to the physical output.</p> <p>No mapping, no data</p> <p>Only events that appear in the controller mapping will produce live data. You can create events in the UI first, then configure the mapping on the controller.</p>"},{"location":"guide/events/#best-practices","title":"Best Practices","text":"<ul> <li>Name descriptively: \"Inlet Temperature Reactor A\" is better than \"Temp1\"</li> <li>Set units: They appear on the Dashboard and in CSV exports</li> <li>Set min/max: Enables range bars on the Dashboard and <code>between</code>/<code>not_between</code> operators in Rules</li> <li>Use the right type: The Dashboard renders different widgets per type</li> </ul>"},{"location":"guide/events/#next-steps","title":"Next Steps","text":"<ul> <li>Dashboard \u2014 see events in action</li> <li>Experiments \u2014 group datapoints by experiment</li> <li>Automation Rules \u2014 alert when sensor values cross thresholds</li> <li>API Reference \u2014 full events endpoint documentation</li> </ul>"},{"location":"guide/experiments/","title":"Experiments","text":"<p>Experiments let you group datapoints into time-bounded runs. While an experiment is active, every datapoint recorded by the system is automatically linked to it. When you stop the experiment, you can download all associated data as a CSV file.</p>"},{"location":"guide/experiments/#lifecycle","title":"Lifecycle","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Created: POST /experiments\n    Created --&gt; Running: Experiment starts immediately\n    Running --&gt; Stopped: PUT /experiments/{id}/stop\n    Stopped --&gt; [*]: Download CSV / Delete</code></pre> <p>One experiment at a time</p> <p>Only one experiment can be running at any time. Starting a new experiment requires stopping the current one first.</p>"},{"location":"guide/experiments/#what-happens-during-an-experiment","title":"What Happens During an Experiment?","text":"<ol> <li>Create \u2014 you give the experiment a name. It starts running immediately (<code>started_on</code> is set automatically).</li> <li>Data collection \u2014 every datapoint pushed by the controller is automatically tagged with the experiment's ID. You don't need to do anything.</li> <li>Stop \u2014 you stop the experiment. <code>stopped_on</code> is recorded. No more datapoints are linked.</li> <li>Export \u2014 download all linked datapoints as a CSV file.</li> </ol>"},{"location":"guide/experiments/#using-the-ui","title":"Using the UI","text":""},{"location":"guide/experiments/#creating-an-experiment","title":"Creating an Experiment","text":"<ol> <li>Navigate to Experiments in the sidebar</li> <li>Click New Experiment</li> <li>Enter a descriptive name (e.g. \"Fluidised Bed Run 07 \u2014 200\u00b0C\")</li> <li>Click Create</li> </ol> <p>The experiment starts running immediately. You will see it in the table with a green Running badge.</p>"},{"location":"guide/experiments/#stopping-an-experiment","title":"Stopping an Experiment","text":"<p>Click the  Stop button on a running experiment. The badge changes to Stopped and the stop timestamp is recorded.</p>"},{"location":"guide/experiments/#downloading-data","title":"Downloading Data","text":"<p>Click the  CSV button on a stopped experiment to download all datapoints. See CSV Export for format details.</p>"},{"location":"guide/experiments/#deleting-an-experiment","title":"Deleting an Experiment","text":"<p>Click the  Delete button and confirm. This permanently removes the experiment and all its linked datapoints.</p> <p>Deletion is permanent</p> <p>Deleting an experiment also deletes every datapoint associated with it. Export to CSV first if you need the data.</p>"},{"location":"guide/experiments/#experiment-table-columns","title":"Experiment Table Columns","text":"Column Description Name Experiment label Status  Running (green) or  Stopped (grey) Started Timestamp when the experiment was created Stopped Timestamp when the experiment was stopped (empty if still running) Actions CSV download, Stop, Delete"},{"location":"guide/experiments/#using-the-api","title":"Using the API","text":""},{"location":"guide/experiments/#create-an-experiment","title":"Create an Experiment","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/experiments \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Fluidised Bed Run 07\"}'\n</code></pre> <p>Returns the experiment with <code>started_on</code> already set.</p>"},{"location":"guide/experiments/#list-experiments","title":"List Experiments","text":"<pre><code>curl http://localhost:8000/api/v1/experiments \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Supports <code>?page=1&amp;page_size=50</code> pagination.</p>"},{"location":"guide/experiments/#stop-an-experiment","title":"Stop an Experiment","text":"<pre><code>curl -X PUT http://localhost:8000/api/v1/experiments/$EXP_ID/stop \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/experiments/#download-csv","title":"Download CSV","text":"<pre><code>curl -o results.csv \\\n  http://localhost:8000/api/v1/experiments/$EXP_ID/export/csv \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/experiments/#delete-an-experiment","title":"Delete an Experiment","text":"<pre><code>curl -X DELETE http://localhost:8000/api/v1/experiments/$EXP_ID \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/experiments/#best-practices","title":"Best Practices","text":"<p>Recommendations</p> <ul> <li>Name experiments descriptively \u2014 include parameters, date, or batch number (e.g. \"Run 12 \u2014 Inlet 180\u00b0C, Flow 5 L/min\")</li> <li>Export CSV before deleting \u2014 deletion is irreversible and removes all linked datapoints</li> <li>Stop experiments promptly \u2014 a running experiment captures all data, including calibration or idle readings you may not want</li> </ul>"},{"location":"guide/experiments/#next-steps","title":"Next Steps","text":"<ul> <li>CSV Export \u2014 download and analyse experiment data</li> <li>Events &amp; Sensors \u2014 configure the sensors that feed experiments</li> <li>Dashboard \u2014 monitor the live data while an experiment runs</li> </ul>"},{"location":"guide/logs/","title":"Logs","text":"<p>The Logs page shows system log entries \u2014 informational messages, warnings, and errors generated by WebMACS during operation.</p> <p>Automatic entries</p> <p>Most log entries are created automatically by the system (e.g. when an automation rule triggers). You can also create log entries via the API.</p>"},{"location":"guide/logs/#viewing-logs","title":"Viewing Logs","text":"<p>Navigate to Logs in the sidebar. The table shows:</p> Column Description Timestamp When the log entry was created (relative time, e.g. \"2 minutes ago\") Type  Info (blue),  Warning (amber),  Error (red) Status <code>unread</code> or <code>read</code> Message Log content (up to 500 characters) <p>The table is paginated (50 entries per page) and ordered newest first.</p>"},{"location":"guide/logs/#log-types","title":"Log Types","text":"Type When It Appears Info Rule triggers, system events, general status updates Warning Degraded conditions, approaching thresholds, retries Error Failed webhook deliveries, hardware communication issues, unexpected errors"},{"location":"guide/logs/#log-sources","title":"Log Sources","text":"<p>Logs are generated by various system components:</p> Source Example Message Rule evaluation \"Rule 'High Temp Alert' triggered: Inlet Temperature = 215.3\u00b0C (&gt; 200)\" Webhook delivery \"Webhook delivery to https://hooks.example.com/... failed: timeout\" System health \"Database connection restored\" OTA updates \"Firmware update v2.1.0 applied successfully\""},{"location":"guide/logs/#managing-logs-via-api","title":"Managing Logs via API","text":""},{"location":"guide/logs/#list-logs","title":"List Logs","text":"<pre><code>curl http://localhost:8000/api/v1/logging?page=1&amp;page_size=50 \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/logs/#create-a-log-entry","title":"Create a Log Entry","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/logging \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"content\": \"Manual calibration completed for Sensor A\",\n    \"logging_type\": \"info\"\n  }'\n</code></pre> <p>Valid <code>logging_type</code> values: <code>info</code>, <code>warning</code>, <code>error</code></p>"},{"location":"guide/logs/#mark-a-log-as-read","title":"Mark a Log as Read","text":"<pre><code>curl -X PUT http://localhost:8000/api/v1/logging/$LOG_ID \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"status_type\": \"read\"}'\n</code></pre>"},{"location":"guide/logs/#best-practices","title":"Best Practices","text":"<p>Recommendations</p> <ul> <li>Review logs regularly \u2014 especially after setting up new automation rules</li> <li>Check error logs after webhook failures \u2014 they may indicate endpoint misconfiguration</li> <li>Use log entries for compliance \u2014 combine with rule-based <code>log</code> actions for automatic audit trails</li> </ul>"},{"location":"guide/logs/#next-steps","title":"Next Steps","text":"<ul> <li>Automation Rules \u2014 rules generate log entries when they fire</li> <li>Webhooks \u2014 failed deliveries appear as error logs</li> <li>Dashboard \u2014 monitor real-time data</li> </ul>"},{"location":"guide/ota/","title":"OTA Updates","text":"<p>Complete guide to WebMACS Over-The-Air updates \u2014 from building a release to customer deployment.</p>"},{"location":"guide/ota/#how-ota-works","title":"How OTA Works","text":"<pre><code>sequenceDiagram\n    participant Dev as Developer\n    participant GH as GitHub\n    participant CI as GitHub Actions\n    participant Device as RevPi / Device\n    participant Updater as Updater Daemon\n\n    Dev-&gt;&gt;GH: git tag v2.1.0 &amp;&amp; git push --tags\n    GH-&gt;&gt;CI: Trigger release workflow\n    CI-&gt;&gt;CI: Run tests (lint, mypy, pytest)\n    CI-&gt;&gt;CI: Build multi-arch Docker images\n    CI-&gt;&gt;CI: Create update bundle (.tar.gz)\n    CI-&gt;&gt;GH: Upload to GitHub Release\n    Note over GH: webmacs-update-2.1.0.tar.gz\n    Dev-&gt;&gt;Device: Download &amp; upload via UI\n    Device-&gt;&gt;Updater: Bundle saved to /updates/\n    Updater-&gt;&gt;Updater: Verify SHA-256 checksum\n    Updater-&gt;&gt;Updater: Backup database\n    Updater-&gt;&gt;Updater: docker load images\n    Updater-&gt;&gt;Updater: docker compose up -d\n    Updater-&gt;&gt;Updater: Health check \u2713</code></pre>"},{"location":"guide/ota/#whats-in-a-bundle","title":"What's in a Bundle?","text":"File Purpose <code>manifest.json</code> Version, SHA-256 checksum, changelog, image list <code>images.tar</code> All Docker images (<code>backend</code>, <code>frontend</code>, <code>controller</code>) <code>docker-compose.prod.yml</code> Production compose file <code>install.sh</code> First-time installation script"},{"location":"guide/ota/#for-developers-releasing-a-new-version","title":"For Developers: Releasing a New Version","text":""},{"location":"guide/ota/#option-a-via-github-recommended","title":"Option A \u2014 Via GitHub (Recommended)","text":"<p>Push a git tag and GitHub Actions builds the bundle automatically:</p> <pre><code># 1. Make your code changes\ngit add .\ngit commit -m \"feat: new sensor calibration\"\n\n# 2. Tag the release\ngit tag v2.1.0\ngit push origin main --tags\n</code></pre> <p>What happens automatically:</p> <ol> <li>CI runs all tests (ruff, mypy, pytest, eslint, vitest)</li> <li>Docker images are built for AMD64 + ARM64 (cross-platform)</li> <li>Images are packaged into <code>webmacs-update-2.1.0.tar.gz</code></li> <li>A GitHub Release is created with the bundle attached</li> </ol> <p>Download the bundle from the Releases page and deliver it to the customer.</p>"},{"location":"guide/ota/#option-b-local-build","title":"Option B \u2014 Local Build","text":"<p>Build manually on your machine (for testing or airgapped environments):</p> <pre><code>just bundle 2.1.0\n# Output: dist/webmacs-update-2.1.0.tar.gz\n</code></pre> <p>Architecture</p> <p><code>just bundle</code> builds for your host architecture only. If you build on x86_64 and deploy to an ARM RevPi, it won't work. Use the GitHub Actions workflow for multi-arch builds.</p>"},{"location":"guide/ota/#for-customers-installation","title":"For Customers: Installation","text":""},{"location":"guide/ota/#first-time-install","title":"First-Time Install","text":"<p>You receive a <code>.tar.gz</code> bundle from your system integrator or download it from GitHub Releases.</p>"},{"location":"guide/ota/#step-1-transfer-to-device","title":"Step 1 \u2014 Transfer to Device","text":"Via SCP (network)Via USB stick <pre><code>scp webmacs-update-2.0.0.tar.gz pi@&lt;device-ip&gt;:/tmp/\n</code></pre> <pre><code>sudo mount /dev/sda1 /mnt\ncp /mnt/webmacs-update-2.0.0.tar.gz /tmp/\nsudo umount /mnt\n</code></pre>"},{"location":"guide/ota/#step-2-run-installer","title":"Step 2 \u2014 Run Installer","text":"<pre><code>ssh pi@&lt;device-ip&gt;\n\n# Extract install script from bundle\ntar -xzf /tmp/webmacs-update-2.0.0.tar.gz install.sh\n\n# Run installer\nsudo bash install.sh /tmp/webmacs-update-2.0.0.tar.gz\n</code></pre> <p>The installer handles everything:</p> Step Action Docker Installs Docker + Compose (if missing) Directories Creates <code>/opt/webmacs</code> with update folders Credentials Generates random <code>SECRET_KEY</code>, <code>DB_PASSWORD</code>, admin password Images Loads Docker images from the bundle Services Starts all 4 containers Boot Creates systemd service for auto-start <p>Save Your Credentials</p> <p>The admin password is shown only once during installation. It is also stored in <code>/opt/webmacs/.env</code>.</p>"},{"location":"guide/ota/#step-3-open-browser","title":"Step 3 \u2014 Open Browser","text":"<p>Navigate to <code>http://&lt;device-ip&gt;</code> and log in.</p> <p>Finding the Device IP</p> <p>Run <code>hostname -I</code> on the device.</p>"},{"location":"guide/ota/#applying-updates","title":"Applying Updates","text":"<p>Three options to update an existing installation:</p> Web UI (Easiest)SCP / USB (Automatic)Command Line (Manual) <ol> <li>Download the <code>.tar.gz</code> bundle</li> <li>Open WebMACS \u2192 OTA Updates</li> <li>Click Upload Bundle and select the file</li> <li>The system verifies, backs up, loads images, and restarts (~3-8 min)</li> </ol> <p>Copy the bundle to the update directory: <pre><code>scp webmacs-update-2.1.0.tar.gz pi@&lt;ip&gt;:/opt/webmacs/updates/\n</code></pre> The updater daemon detects and applies it within 30 seconds.</p> <pre><code>cd /opt/webmacs\nsudo tar -xzf /path/to/webmacs-update-2.1.0.tar.gz -C /tmp/update\nsudo docker load -i /tmp/update/images.tar\nsudo sed -i \"s/^WEBMACS_VERSION=.*/WEBMACS_VERSION=2.1.0/\" .env\nsudo docker compose -f docker-compose.prod.yml --env-file .env up -d\n</code></pre>"},{"location":"guide/ota/#managing-updates-in-the-ui","title":"Managing Updates in the UI","text":"<p>Navigate to OTA Updates in the sidebar.</p>"},{"location":"guide/ota/#system-version-github-check","title":"System Version &amp; GitHub Check","text":"<p>The card at the top shows the running version and whether an update is available. Click Check for Updates to query both the local database and GitHub Releases.</p> <p>The GitHub Releases card below shows:</p> State What You See Release exists, newer than installed \"newer\" badge + Download Bundle button Release exists, same as installed \"installed\" badge + link to release page No releases published yet \"No releases published yet\" message GitHub unreachable (offline device) Warning with the error message <p>Automatic version check</p> <p>The OTA page checks for updates automatically when opened. On devices without internet access, the GitHub check times out gracefully and the local database is still checked.</p> <p>Container-only updates</p> <p>The OTA update system works with Docker containers only. It uses <code>docker load</code> + <code>docker compose up</code> to apply updates. Native (non-Docker) installations are not supported by the self-updater.</p>"},{"location":"guide/ota/#uploading-a-bundle","title":"Uploading a Bundle","text":"<ol> <li>Click Upload Bundle</li> <li>Select the <code>.tar.gz</code> file</li> <li>A progress bar shows the upload status</li> <li>Once uploaded, the updater daemon applies it automatically</li> </ol>"},{"location":"guide/ota/#creating-an-update-record","title":"Creating an Update Record","text":"<p>Click New Update to manually register a version:</p> Field Required Description Version Yes Semantic version (e.g. <code>2.1.0</code>) Release Notes No Description of changes"},{"location":"guide/ota/#update-statuses","title":"Update Statuses","text":"Status Description <code>pending</code> Registered, not yet applied <code>downloading</code> Firmware being downloaded <code>verifying</code> Integrity check in progress <code>applying</code> Images being loaded, services restarting <code>completed</code> Successfully applied <code>failed</code> Update failed \u2014 check logs <code>rolled_back</code> Reverted to previous version"},{"location":"guide/ota/#rolling-back","title":"Rolling Back","text":"<p>Click Rollback on a <code>completed</code> update to revert:</p> <pre><code>completed \u2192 rolled_back\n</code></pre>"},{"location":"guide/ota/#why-not-balena","title":"Why Not Balena?","text":"WebMACS OTA Balena Cost Free (GitHub Actions) Paid (after 10 devices) Offline \u2705 Full offline support \u274c Requires cloud Dependencies Docker only Balena OS + account Control Full \u2014 your code, your infra Vendor lock-in Ideal for Single devices, small fleets Large fleets (100+) <p>WebMACS OTA is designed for single-device or small-fleet deployments. If you later manage 50+ devices, you can add Balena on top \u2014 the application code doesn't change.</p>"},{"location":"guide/ota/#safety-recovery","title":"Safety &amp; Recovery","text":""},{"location":"guide/ota/#integrity-verification","title":"Integrity Verification","text":"<p>Every bundle includes a SHA-256 checksum in <code>manifest.json</code>. The updater verifies this before loading images.</p>"},{"location":"guide/ota/#automatic-database-backup","title":"Automatic Database Backup","text":"<p>Before every update, <code>pg_dump</code> saves a timestamped backup to <code>/opt/webmacs/updates/backups/</code>.</p>"},{"location":"guide/ota/#health-check","title":"Health Check","text":"<p>After restarting, the updater checks <code>GET /health</code> (10 retries \u00d7 5s). Failures are marked and logged.</p>"},{"location":"guide/ota/#failed-update-recovery","title":"Failed Update Recovery","text":"<p>On failure:</p> <ol> <li>Compose file restored from <code>.bak</code></li> <li>Bundle moved to <code>updates/failed/</code> (no retry loop)</li> <li>Previous version keeps running</li> </ol> <p>Manual recovery:</p> <pre><code>cd /opt/webmacs\n\n# Restore database backup\ncat updates/backups/webmacs_backup_*.sql | \\\n  docker compose -f docker-compose.prod.yml exec -T db psql -U webmacs webmacs\n\n# Restart\nsudo systemctl restart webmacs\n</code></pre>"},{"location":"guide/ota/#file-structure","title":"File Structure","text":"<pre><code>/opt/webmacs/\n\u251c\u2500\u2500 .env                          # Credentials &amp; version (auto-managed)\n\u251c\u2500\u2500 docker-compose.prod.yml       # Production compose file\n\u2514\u2500\u2500 updates/\n    \u251c\u2500\u2500 webmacs-update-2.1.0.tar.gz   # \u2190 drop bundles here\n    \u251c\u2500\u2500 applied/                       # Successfully applied\n    \u251c\u2500\u2500 backups/                       # Database backups (pre-update)\n    \u2514\u2500\u2500 failed/                        # Failed bundles (won't retry)\n</code></pre>"},{"location":"guide/ota/#faq","title":"FAQ","text":"<p>How long does an update take? : On a RevPi (~ARM Cortex-A53): 3\u20138 minutes. Most time is <code>docker load</code>.</p> <p>Can I update without internet? : Yes. Copy the <code>.tar.gz</code> via USB or local network. Everything is self-contained.</p> <p>What if power is lost during an update? : After reboot, systemd restarts the previous containers. The failed bundle moves to <code>updates/failed/</code>.</p> <p>Can I skip versions? : Yes. Bundles are self-contained. Go from v2.0.0 to v2.5.0 directly.</p> <p>How do I check the current version? : Web UI \u2192 OTA Updates, or <code>cat /opt/webmacs/.env | grep WEBMACS_VERSION</code>, or <code>curl http://localhost/api/v1/ota/check</code>.</p>"},{"location":"guide/ota/#next-steps","title":"Next Steps","text":"<ul> <li>Installation Guide \u2014 detailed first-time setup</li> <li>Docker Deployment \u2014 container architecture</li> <li>API Reference \u2014 programmatic OTA endpoints</li> </ul>"},{"location":"guide/rules/","title":"Automation Rules","text":"<p>Rules let you define threshold-based automations: when a sensor value meets a condition, WebMACS can log an alert or trigger a webhook delivery \u2014 without any code on your part.</p> <p>Admin only</p> <p>Rule management requires an admin account.</p>"},{"location":"guide/rules/#how-rules-work","title":"How Rules Work","text":"<pre><code>flowchart LR\n    DP[New Datapoint] --&gt; EVAL{Rule matches?}\n    EVAL --&gt;|No| SKIP[Skip]\n    EVAL --&gt;|Yes| CD{Cooldown expired?}\n    CD --&gt;|No| SKIP\n    CD --&gt;|Yes| ACT[Fire action]\n    ACT --&gt; LOG[Log entry]\n    ACT --&gt; WH[Webhook delivery]</code></pre> <p>Every time a datapoint is created, WebMACS evaluates all enabled rules that target the same event:</p> <ol> <li>Condition check \u2014 compare the datapoint value against the rule's operator and threshold</li> <li>Cooldown check \u2014 skip if the rule fired recently (within <code>cooldown_seconds</code>)</li> <li>Action \u2014 log the alert and/or trigger a webhook delivery</li> </ol>"},{"location":"guide/rules/#creating-a-rule","title":"Creating a Rule","text":""},{"location":"guide/rules/#via-the-ui","title":"Via the UI","text":"<ol> <li>Navigate to Rules in the sidebar (admin only)</li> <li>Click New Rule</li> <li>Configure:</li> </ol> Field Required Description Name Yes Descriptive label (e.g. \"High Temp Alert \u2014 Reactor A\") Event Yes Which sensor event to monitor (dropdown) Operator Yes Comparison operator (see table below) Threshold Yes The value to compare against Threshold High Only for <code>between</code> / <code>not between</code> Upper bound of the range Action Type Yes <code>log</code> or <code>webhook</code> Webhook Event Type Only for <code>webhook</code> actions Which webhook event type to dispatch Cooldown (seconds) Yes Minimum seconds between consecutive triggers Active Yes Enable or disable the rule <ol> <li>Click Create</li> </ol>"},{"location":"guide/rules/#via-the-api","title":"Via the API","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/rules \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"High Temp Alert\",\n    \"event_public_id\": \"evt_temp_inlet\",\n    \"operator\": \"gt\",\n    \"threshold\": 200,\n    \"action_type\": \"webhook\",\n    \"webhook_event_type\": \"sensor.threshold_exceeded\",\n    \"cooldown_seconds\": 300,\n    \"enabled\": true\n  }'\n</code></pre>"},{"location":"guide/rules/#operators","title":"Operators","text":"Operator Symbol Condition Example <code>gt</code> &gt; Value is greater than threshold Temperature &gt; 200 <code>lt</code> &lt; Value is less than threshold Pressure &lt; 0.5 <code>gte</code> \u2265 Greater than or equal Flow \u2265 10 <code>lte</code> \u2264 Less than or equal Level \u2264 5 <code>eq</code> = Equal (\u03b5 = 1e-9) Status = 1 <code>between</code> min \u2264 x \u2264 max Value is within range 20 \u2264 Temp \u2264 80 <code>not_between</code> x &lt; min or x &gt; max Value is outside range Temp &lt; 20 or &gt; 80 <p>Between vs Not Between</p> <p>Use <code>between</code> to trigger when values are within a normal range \u2014 useful for confirming steady-state. Use <code>not_between</code> to trigger when values go outside the safe range \u2014 this is the most common alerting pattern.</p>"},{"location":"guide/rules/#action-types","title":"Action Types","text":""},{"location":"guide/rules/#log","title":"Log","text":"<p>Creates a structured log entry when the condition is met. Visible on the Logs page. Useful for audit trails and post-experiment review.</p>"},{"location":"guide/rules/#webhook","title":"Webhook","text":"<p>Dispatches a <code>sensor.threshold_exceeded</code> (or other) webhook event to all matching webhook subscriptions. Use this to send alerts to Slack, Teams, or custom APIs.</p> <p>Combined setup</p> <p>Create two rules for the same event:</p> <ol> <li><code>Inlet Temp &gt; 200 \u2192 log</code> (always log for audit)</li> <li><code>Inlet Temp &gt; 250 \u2192 webhook</code> (alert team only when critical)</li> </ol>"},{"location":"guide/rules/#cooldown-period","title":"Cooldown Period","text":"<p>The cooldown prevents rules from firing repeatedly when a sensor value stays above a threshold.</p> Cooldown Behaviour 60 s (default) At most one trigger per minute 300 s At most once every 5 minutes 0 s Fire on every matching datapoint (use with caution) <p>Alert fatigue</p> <p>Setting cooldown to 0 with a <code>webhook</code> action can generate hundreds of deliveries per minute. Use a reasonable cooldown (60\u2013300 s) for alerting.</p> <pre><code>gantt\n    title Cooldown example (300 s)\n    dateFormat X\n    axisFormat %s\n    section Rule fires\n    Trigger 1           :done, 0, 1\n    Cooldown (skip)     :active, 1, 300\n    Trigger 2           :done, 300, 301\n    Cooldown (skip)     :active, 301, 600</code></pre>"},{"location":"guide/rules/#rule-table-columns","title":"Rule Table Columns","text":"Column Description Name Rule label Event Monitored sensor name Operator Comparison symbol ( &gt;, &lt;, \u2265, \u2264, =, between, not between) Threshold Threshold value (or range for between/not_between) Action <code>webhook</code> or <code>log</code> badge Active Enabled/disabled Cooldown Seconds between triggers Last Triggered Timestamp of last activation Created Creation date"},{"location":"guide/rules/#example-scenarios","title":"Example Scenarios","text":"Temperature alertPressure out of rangeAudit logging <p>Event: Inlet Temperature Operator: <code>gt</code> (&gt;) Threshold: 200 Action: <code>webhook</code> \u2192 <code>sensor.threshold_exceeded</code> Cooldown: 300 s</p> <p>Sends a Slack notification when inlet temperature exceeds 200\u00b0C, at most once every 5 minutes.</p> <p>Event: Chamber Pressure Operator: <code>not_between</code> Threshold: 0.8 / Threshold High: 1.2 Action: <code>webhook</code> \u2192 <code>sensor.threshold_exceeded</code> Cooldown: 60 s</p> <p>Alerts when pressure goes below 0.8 bar or above 1.2 bar.</p> <p>Event: Valve Status Operator: <code>eq</code> (=) Threshold: 1 Action: <code>log</code> Cooldown: 0 s</p> <p>Logs every time the valve opens (value = 1). Good for compliance trails.</p>"},{"location":"guide/rules/#best-practices","title":"Best Practices","text":"<p>Recommendations</p> <ul> <li>Name rules descriptively \u2014 include the sensor name and threshold in the rule name</li> <li>Set reasonable cooldowns \u2014 60-300 s for webhook alerts, 0 s only for log-only actions</li> <li>Combine <code>log</code> and <code>webhook</code> rules \u2014 log everything, webhook only critical thresholds</li> <li>Use <code>not_between</code> for safe-range monitoring \u2014 it triggers when values leave the normal window</li> <li>Review the Last Triggered column \u2014 rules that never fire may have incorrect thresholds</li> </ul>"},{"location":"guide/rules/#next-steps","title":"Next Steps","text":"<ul> <li>Webhooks \u2014 configure where webhook alerts are delivered</li> <li>Events &amp; Sensors \u2014 set up the sensors that rules monitor</li> <li>Logs \u2014 view rule-triggered log entries</li> </ul>"},{"location":"guide/users/","title":"User Management","text":"<p>WebMACS supports multiple user accounts with two roles: Operator and Admin. Admins can create, manage, and delete user accounts.</p> <p>Admin only</p> <p>The Users page is only visible to admin accounts.</p>"},{"location":"guide/users/#user-roles","title":"User Roles","text":"Role Access Operator Dashboard, Events, Experiments, Datapoints, CSV Export, Logs Admin Everything above + Rules, Webhooks, OTA Updates, User Management <p>The sidebar automatically hides admin-only pages for operator accounts.</p>"},{"location":"guide/users/#default-admin-account","title":"Default Admin Account","text":"<p>On first startup, WebMACS creates an initial admin account from environment variables:</p> Variable Default <code>INITIAL_ADMIN_EMAIL</code> <code>admin@webmacs.io</code> <code>INITIAL_ADMIN_USERNAME</code> <code>admin</code> <code>INITIAL_ADMIN_PASSWORD</code> <code>admin123</code> <p>Change the default password immediately</p> <p>The default credentials are publicly documented. Change them as soon as the system is deployed, especially in production environments.</p>"},{"location":"guide/users/#managing-users-via-the-ui","title":"Managing Users via the UI","text":""},{"location":"guide/users/#viewing-users","title":"Viewing Users","text":"<p>Navigate to Users in the sidebar. The table shows:</p> Column Description Username Login name Email Email address Role  Admin or  User badge Registered Account creation date Actions Delete button"},{"location":"guide/users/#creating-a-user","title":"Creating a User","text":"<ol> <li>Click Add User</li> <li>Fill in:<ul> <li>Username \u2014 2\u201350 characters</li> <li>Email \u2014 must be unique</li> <li>Password \u2014 minimum 8 characters</li> </ul> </li> <li>Click Create</li> </ol> <p>New users are created as Operators by default.</p>"},{"location":"guide/users/#deleting-a-user","title":"Deleting a User","text":"<p>Click the  delete button on a user row and confirm.</p> <p>Cannot delete yourself</p> <p>You cannot delete the account you're currently logged in with.</p>"},{"location":"guide/users/#managing-users-via-api","title":"Managing Users via API","text":""},{"location":"guide/users/#list-all-users-admin-only","title":"List All Users (Admin Only)","text":"<pre><code>curl http://localhost:8000/api/v1/users \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/users/#create-a-user-admin-only","title":"Create a User (Admin Only)","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/users \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"username\": \"operator1\",\n    \"email\": \"operator1@example.com\",\n    \"password\": \"securepassword123\"\n  }'\n</code></pre>"},{"location":"guide/users/#update-a-user-self-or-admin","title":"Update a User (Self or Admin)","text":"<pre><code>curl -X PUT http://localhost:8000/api/v1/users/$USER_ID \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"password\": \"new-secure-password\"}'\n</code></pre>"},{"location":"guide/users/#delete-a-user-admin-only","title":"Delete a User (Admin Only)","text":"<pre><code>curl -X DELETE http://localhost:8000/api/v1/users/$USER_ID \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/users/#authentication","title":"Authentication","text":""},{"location":"guide/users/#login","title":"Login","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"admin@webmacs.io\",\n    \"password\": \"admin123\"\n  }'\n</code></pre> <p>Returns:</p> <pre><code>{\n  \"access_token\": \"eyJhbGci...\",\n  \"public_id\": \"usr_abc123\",\n  \"username\": \"admin\"\n}\n</code></pre>"},{"location":"guide/users/#using-the-token","title":"Using the Token","text":"<p>Include the token in all subsequent requests:</p> <pre><code>-H \"Authorization: Bearer eyJhbGci...\"\n</code></pre> <p>Tokens expire after 24 hours by default (configurable via <code>ACCESS_TOKEN_EXPIRE_MINUTES</code>).</p>"},{"location":"guide/users/#logout","title":"Logout","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/auth/logout \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Logout blacklists the token \u2014 it cannot be reused even before expiry. Expired blacklisted tokens are cleaned up automatically.</p>"},{"location":"guide/users/#security-best-practices","title":"Security Best Practices","text":"<p>Recommendations</p> <ul> <li>Change the default admin password immediately after first login</li> <li>Use strong passwords \u2014 minimum 8 characters, mix of letters, numbers, and symbols</li> <li>Set a strong <code>SECRET_KEY</code> \u2014 in production, must be at least 32 characters</li> <li>Create operator accounts for regular users \u2014 don't share admin credentials</li> <li>Use HTTPS in production \u2014 tokens are sent in HTTP headers and must be protected in transit</li> </ul>"},{"location":"guide/users/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration \u2014 environment variables for auth settings</li> <li>Dashboard \u2014 get started monitoring data</li> <li>API Reference \u2014 full user and auth endpoint documentation</li> </ul>"},{"location":"guide/webhooks/","title":"Webhooks","text":"<p>Webhooks let WebMACS push real-time notifications to external systems whenever specific events occur. Use them to integrate with Slack, Microsoft Teams, custom dashboards, or any HTTP endpoint.</p> <p>Admin only</p> <p>Webhook management requires an admin account.</p>"},{"location":"guide/webhooks/#how-it-works","title":"How It Works","text":"<pre><code>sequenceDiagram\n    participant S as Sensor\n    participant B as WebMACS Backend\n    participant W as Your Webhook Endpoint\n\n    S-&gt;&gt;B: New datapoint\n    B-&gt;&gt;B: Check rules &amp; webhooks\n    B-&gt;&gt;W: POST payload (JSON)\n    W--&gt;&gt;B: 200 OK\n    B-&gt;&gt;B: Log delivery \u2713</code></pre> <ol> <li>A trigger occurs (new sensor reading, threshold exceeded, experiment started/stopped, \u2026)</li> <li>WebMACS finds all enabled webhook subscriptions matching that event type</li> <li>A JSON payload is sent via HTTP POST to each matching URL</li> <li>The delivery result is logged (success, failure, status code)</li> </ol>"},{"location":"guide/webhooks/#webhook-event-types","title":"Webhook Event Types","text":"Event Type When It Fires <code>sensor.reading</code> Every time a new sensor datapoint is recorded <code>sensor.threshold_exceeded</code> An automation rule triggers a threshold violation <code>experiment.started</code> An experiment is created and begins running <code>experiment.stopped</code> An experiment is stopped <code>system.health_changed</code> System health status changes (degraded / recovered) <p>Choose wisely</p> <p>Subscribing to <code>sensor.reading</code> generates a webhook delivery for every datapoint \u2014 potentially hundreds per minute. For most integrations, <code>sensor.threshold_exceeded</code> is more useful.</p>"},{"location":"guide/webhooks/#creating-a-webhook","title":"Creating a Webhook","text":""},{"location":"guide/webhooks/#via-the-ui","title":"Via the UI","text":"<ol> <li>Navigate to Webhooks in the sidebar (admin only)</li> <li>Click New Webhook</li> <li>Fill in the fields:</li> </ol> Field Required Description URL Yes The endpoint to receive POST requests (use HTTPS in production) Secret No Shared secret for HMAC-SHA256 signature verification Event Types Yes Select one or more event types to subscribe to Active Yes Toggle to enable or disable deliveries <ol> <li>Click Create</li> </ol>"},{"location":"guide/webhooks/#via-the-api","title":"Via the API","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/webhooks \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"url\": \"https://hooks.example.com/services/T.../B.../xxx\",\n    \"secret\": \"my-shared-secret\",\n    \"events\": [\"sensor.threshold_exceeded\", \"experiment.stopped\"],\n    \"enabled\": true\n  }'\n</code></pre> <p>Duplicate URLs</p> <p>Each URL can only be registered once. Attempting to create a duplicate returns 409 Conflict.</p>"},{"location":"guide/webhooks/#payload-format","title":"Payload Format","text":"<p>Every delivery sends a JSON body:</p> <pre><code>{\n  \"type\": \"sensor.threshold_exceeded\",\n  \"time\": \"2025-01-15T10:30:00Z\",\n  \"sensor\": \"Inlet Temperature\",\n  \"value\": 215.3,\n  \"device\": \"webmacs-prod-01\"\n}\n</code></pre> <p>The <code>data</code> fields vary by event type. Experiment events include <code>experiment_name</code> and <code>experiment_id</code>.</p>"},{"location":"guide/webhooks/#hmac-signature-verification","title":"HMAC Signature Verification","text":"<p>If you set a secret, every delivery includes two headers for security:</p> Header Value <code>X-Webhook-Signature</code> <code>sha256=&lt;hex-digest&gt;</code> <code>X-Webhook-Timestamp</code> Unix timestamp of the delivery <p>The HMAC is computed over <code>{timestamp}.{payload_body}</code> using SHA-256.</p>"},{"location":"guide/webhooks/#verification-example-python","title":"Verification Example (Python)","text":"<pre><code>import hmac, hashlib\n\ndef verify(secret: str, timestamp: str, body: bytes, signature: str) -&gt; bool:\n    message = f\"{timestamp}.\".encode() + body\n    expected = hmac.new(secret.encode(), message, hashlib.sha256).hexdigest()\n    return hmac.compare_digest(f\"sha256={expected}\", signature)\n</code></pre> <p>Replay protection</p> <p>Reject deliveries where <code>X-Webhook-Timestamp</code> is more than 5 minutes old.</p>"},{"location":"guide/webhooks/#delivery-log","title":"Delivery Log","text":"<p>Each webhook has a delivery log accessible from the UI or API. Every delivery attempt is recorded with:</p> Field Description Status <code>pending</code> \u2192 <code>delivered</code> \u2192 or <code>failed</code> \u2192 <code>dead_letter</code> HTTP Status Response code from your endpoint (200, 500, timeout, \u2026) Attempts Number of delivery attempts (max 3) Error Error message if failed Timestamp When the delivery was attempted / completed"},{"location":"guide/webhooks/#retry-behaviour","title":"Retry Behaviour","text":"Attempt Delay Total Wait 1st retry 2 seconds 2 s 2nd retry 4 seconds 6 s 3rd retry 8 seconds 14 s <p>After 3 failed retries, the delivery is marked as dead_letter. It will not be retried automatically.</p>"},{"location":"guide/webhooks/#viewing-deliveries-via-api","title":"Viewing Deliveries via API","text":"<pre><code>curl http://localhost:8000/api/v1/webhooks/$WEBHOOK_ID/deliveries \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Filter by status: <code>?status=failed</code></p>"},{"location":"guide/webhooks/#integration-examples","title":"Integration Examples","text":"SlackMicrosoft TeamsCustom API <p>Use a Slack Incoming Webhook URL:</p> <pre><code>https://hooks.example.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX\n</code></pre> <p>Slack expects a <code>text</code> field, so you may need a proxy/transform layer.</p> <p>Use a Teams Incoming Webhook connector URL.</p> <p>Point the webhook at any HTTPS endpoint that accepts POST with JSON body and returns 2xx.</p>"},{"location":"guide/webhooks/#best-practices","title":"Best Practices","text":"<p>Recommendations</p> <ul> <li>Always use HTTPS in production environments</li> <li>Set a webhook secret and verify HMAC signatures to prevent spoofing</li> <li>Monitor the delivery log \u2014 failed deliveries indicate connectivity or endpoint issues</li> <li>Disable unused webhooks to reduce unnecessary network traffic</li> <li>Use <code>sensor.threshold_exceeded</code> instead of <code>sensor.reading</code> for alerting \u2014 it fires only when rules trigger, not on every reading</li> <li>Set appropriate timeouts on your receiving endpoint \u2014 WebMACS waits up to 10 seconds per delivery</li> </ul>"},{"location":"guide/webhooks/#next-steps","title":"Next Steps","text":"<ul> <li>Automation Rules \u2014 define thresholds that trigger <code>sensor.threshold_exceeded</code> webhooks</li> <li>Events &amp; Sensors \u2014 configure what is monitored</li> <li>API Reference \u2014 full webhook endpoint documentation</li> </ul>"}]}