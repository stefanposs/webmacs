{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"WebMACS","text":""},{"location":"#monitor-automate-control-from-any-browser","title":"Monitor. Automate. Control. \u2014 From Any Browser.","text":"<p>WebMACS is an open-source control system that turns your Raspberry Pi or Revolution Pi into a real-time monitoring and automation hub for lab experiments and industrial processes.</p> <p>No cloud. No subscriptions. No vendor lock-in. Your data stays on your hardware.</p> <p></p>"},{"location":"#who-is-webmacs-for","title":"Who Is WebMACS For?","text":""},{"location":"#process-engineers-researchers","title":"Process Engineers &amp; Researchers","text":"<p>Monitor fluidised-bed reactors, temperature profiles, pressure readings, and flow rates \u2014 all from your browser. Export experiment data to CSV for analysis in Excel, Python, or MATLAB.</p>"},{"location":"#lab-technicians-operators","title":"Lab Technicians &amp; Operators","text":"<p>Toggle valves, adjust setpoints, and track sensor trends on a live dashboard. Get alerted via Slack or email when values go out of range.</p>"},{"location":"#developers-integrators","title":"Developers &amp; Integrators","text":"<p>Extend the system with a clean REST + WebSocket API. Add new sensor types, build custom dashboards, or integrate with external systems via webhooks.</p>"},{"location":"#what-can-you-do-with-webmacs","title":"What Can You Do With WebMACS?","text":"Capability What It Means For You Real-Time Dashboard See every sensor value live, toggle actuators, build custom widget layouts \u2014 updated via WebSocket in under 100 ms Experiment Management Group all readings into named experiments. Start, stop, and export with one click Custom Dashboards Build your own dashboards with line charts, gauges, stat cards, and actuator toggles on a 12-column grid Threshold Alerts Define rules like \"if temperature &gt; 200 \u00b0C \u2192 notify Slack\". No code required Webhook Integrations Push events to Slack, Teams, Node-RED, Home Assistant, or any HTTP endpoint CSV Export Download millions of datapoints as a CSV \u2014 streamed, instant, ready for pandas or Excel Over-The-Air Updates Deploy new versions via USB, file upload, or network \u2014 works fully offline Plugin System Connect any sensor or protocol \u2014 write a Python plugin, upload the <code>.whl</code> file, and see live data on your dashboard in under 20 minutes. No vendor, no recompilation. One-Command Install Single script installs Docker, generates credentials, starts all services, and enables auto-boot"},{"location":"#your-process-your-dashboard","title":"Your Process. Your Dashboard.","text":"<p>Traditional SCADA systems lock you into predefined screens. WebMACS lets every operator build their own dashboard \u2014 no programming required.</p> <p>Pick from line charts, gauges, stat cards, and actuator toggles. Place them on a 12-column grid with size presets from compact to full-width. Each widget connects to a live sensor event and refreshes automatically \u2014 with proper axis labels, units, and time scales out of the box. Create as many dashboards as you need: one for the reactor, one for the chiller loop, one for the client demo.</p> <p>10 minutes, not 10 days.</p> <p>Build Your First Dashboard \u2192</p>"},{"location":"#your-sensors-your-protocol-your-plugin","title":"Your Sensors. Your Protocol. Your Plugin.","text":"<p>Need to read a Modbus sensor? A serial weather station? An MQTT topic? With WebMACS, you don't wait for a vendor update \u2014 you write a Python class and upload it as a <code>.whl</code> file.</p> <p>The plugin SDK gives you:</p> <ul> <li>Five methods to implement \u2014 <code>get_channels</code>, <code>_do_connect</code>,   <code>_do_disconnect</code>, <code>_do_read</code>, <code>_do_write</code></li> <li>Built-in demo mode \u2014 simulate realistic data without hardware</li> <li>13 free conformance tests \u2014 inherit from <code>PluginConformanceSuite</code></li> <li>Automatic channel \u2192 event mapping \u2014 link a channel to an event and it   flows into dashboards, alerts, CSV export, everything</li> <li>A complete example \u2014 <code>examples/custom-plugin/</code> contains a ready-to-build   Weather Station plugin with tests and documentation</li> </ul> <p>20 minutes from idea to live data on your dashboard.</p> <p>Plugin Development Guide \u2192</p>"},{"location":"#connect-webmacs-to-everything","title":"Connect WebMACS to Everything","text":"<p>WebMACS isn't a closed box \u2014 it's a Lego building block that fits into your existing infrastructure.</p> <ul> <li>30+ REST endpoints \u2014 read and write every resource programmatically</li> <li>Plugin SDK \u2014 build custom device drivers in Python and upload them as <code>.whl</code> packages \u2014 Modbus, MQTT, serial, or any protocol</li> <li>WebSocket streaming \u2014 sub-second live data for custom UIs</li> <li>HMAC-signed webhooks \u2014 push events to Slack, Node-RED, Home Assistant,   or any HTTP endpoint</li> <li>CSV export \u2014 pipe data into pandas, Excel, or MATLAB</li> </ul> <p>Think of it as a Swiss army knife for lab and plant data: one tool, unlimited integrations.</p> <p>See Integration Examples \u2192</p>"},{"location":"#get-started-in-5-minutes","title":"Get Started in 5 Minutes","text":"Production (RevPi / Raspberry Pi)Development (Local) <pre><code># Transfer the bundle to your device and run:\nsudo bash scripts/install.sh webmacs-update-2.0.0.tar.gz\n</code></pre> <p>Open <code>http://&lt;device-ip&gt;</code> and log in with the credentials shown during install. See the Installation Guide for step-by-step details.</p> <pre><code>git clone https://github.com/stefanposs/webmacs.git\ncd webmacs\ndocker compose up --build -d\n</code></pre> <p>Open <code>http://localhost</code> and log in. See Quick Start for default credentials.</p> <p>Quick Start Guide \u2192 View on GitHub \u2192</p>"},{"location":"#architecture-at-a-glance","title":"Architecture at a Glance","text":"<pre><code>graph LR\n    Hardware[\"Sensors &amp; Actuators\"] --&gt;|I/O| Controller[\"IoT Controller&lt;br/&gt;(Python)\"]\n    Controller --&gt;|HTTP / WebSocket| Backend[\"FastAPI Backend\"]\n    Backend --&gt;|async| DB[(PostgreSQL)]\n    Frontend[\"Vue 3 Dashboard&lt;br/&gt;(Browser)\"] --&gt;|REST + WS| Backend\n    Backend --&gt;|Webhooks| External[\"Slack / Teams / APIs\"]</code></pre> Layer Technology Backend FastAPI \u00b7 SQLAlchemy 2 async \u00b7 Pydantic v2 \u00b7 Python 3.13 Frontend Vue 3 \u00b7 TypeScript \u00b7 Vite \u00b7 PrimeVue \u00b7 Pinia Controller Python 3.13 \u00b7 HTTPX \u00b7 RevPi I/O Database PostgreSQL 17 Deployment Docker Compose \u00b7 Nginx \u00b7 systemd <p>Architecture Deep Dive \u2192</p>"},{"location":"#documentation-map","title":"Documentation Map","text":"Section For What You'll Find Getting Started Everyone Install, configure, first login User Guide Operators &amp; Engineers Dashboard, experiments, rules, plugins, CSV export, OTA Architecture Developers System design, WebSocket protocol, database layer API Reference Developers REST + WebSocket endpoint docs, Pydantic schemas Development Contributors Code style, testing, CI/CD, how to contribute Deployment DevOps Docker, production hardening, environment variables"},{"location":"#built-with","title":"Built With","text":"<p> Python 3.13 \u2014 Backend &amp; Controller</p> <p> Vue 3 \u2014 Reactive SPA with TypeScript</p> <p> PostgreSQL 17 \u2014 Reliable, proven storage</p> <p> Docker Compose \u2014 One command, all services</p>"},{"location":"#contributing","title":"Contributing","text":"<p>Contributions are welcome! See the Contributing Guide for development setup and workflow.</p>"},{"location":"#license","title":"License","text":"<p>MIT \u2014 see LICENSE for details.</p>"},{"location":"why-webmacs/","title":"Why WebMACS?","text":""},{"location":"why-webmacs/#the-problem","title":"The Problem","text":"<p>Traditional lab monitoring setups rely on:</p> <ul> <li>Proprietary SCADA software \u2014 expensive licenses, vendor lock-in, Windows-only</li> <li>LabVIEW \u2014 powerful but complex, requires specialized skills, expensive per-seat licensing</li> <li>Spreadsheets + manual logging \u2014 error-prone, no real-time visibility, no alerts</li> <li>Custom scripts \u2014 no UI, no experiment management, breaks when the author leaves</li> </ul> <p>None of these give you a browser-based, real-time dashboard with alerts and CSV export that runs on a \u20ac200 Raspberry Pi.</p>"},{"location":"why-webmacs/#what-makes-webmacs-different","title":"What Makes WebMACS Different","text":"Capability WebMACS Proprietary SCADA LabVIEW Manual Logging Cost Free (open-source, MIT) \u20ac5,000\u201350,000+ \u20ac3,000+ per seat Free Real-time dashboard  Browser-based  Desktop app  Desktop Custom dashboards  Drag &amp; drop widget builder  Proprietary  Custom code Plugin system  Upload <code>.whl</code>, instant  Vendor-only  Custom code Threshold alerts  Slack, Teams, webhooks  Proprietary  Custom code CSV export  One-click, streaming Manual Runs on Raspberry Pi N/A No cloud required  Fully offline Varies Open REST + WebSocket API Varies Setup time ~5 minutes Days / weeks Hours / days N/A Vendor lock-in None High Medium None Multi-user access  Admin + operator roles Varies"},{"location":"why-webmacs/#deep-dive-custom-dashboards-no-code-full-control","title":"Deep Dive: Custom Dashboards \u2014 No Code, Full Control","text":"<p>With proprietary SCADA, changing a dashboard layout means calling the vendor or writing custom scripts. With LabVIEW, it means editing a VI and recompiling.</p> <p>With WebMACS, any operator can:</p> <ol> <li>Click \"New Dashboard\" and name it (e.g., \"Reactor Zone A\")</li> <li>Add widgets with a type picker and size presets (Small \u2192 Full Width)</li> <li>Choose from 4 widget types:</li> <li> Line Chart \u2014 real-time trend for any sensor</li> <li> Gauge \u2014 at-a-glance value with colour-coded range</li> <li> Stat Card \u2014 big number with label and unit</li> <li> Actuator Toggle \u2014 ON/OFF control for valves, relays, motors</li> <li>Link each widget to a live sensor event \u2014 data refreshes automatically</li> <li>Create as many dashboards as needed \u2014 one per zone, process, or team</li> <li>Share a dashboard with all users by marking it as global</li> </ol> <p>No recompilation. No vendor call. No license upgrade.</p> <p>Dashboard Guide \u2192</p>"},{"location":"why-webmacs/#deep-dive-plugin-system-your-hardware-your-rules","title":"Deep Dive: Plugin System \u2014 Your Hardware, Your Rules","text":"<p>With traditional SCADA systems, adding a new sensor type means waiting for the vendor to ship a driver update \u2014 or reverse-engineering a proprietary protocol. With LabVIEW, it means writing a new VI, rebuilding, and redeploying.</p> <p>With WebMACS, you write a Python class, build a wheel, and upload it through the browser. Done.</p>"},{"location":"why-webmacs/#how-it-works","title":"How It Works","text":"<pre><code>flowchart LR\n    Dev[\"Write plugin.py&lt;br/&gt;(Python)\"] --&gt; Build[\"python -m build&lt;br/&gt;\u2192 .whl file\"]\n    Build --&gt; Upload[\"Upload via UI&lt;br/&gt;or REST API\"]\n    Upload --&gt; Discover[\"Auto-discovered&lt;br/&gt;on restart\"]\n    Discover --&gt; Data[\"Channels \u2192 Events&lt;br/&gt;\u2192 Dashboards\"]</code></pre>"},{"location":"why-webmacs/#what-makes-it-unique","title":"What Makes It Unique","text":"<ol> <li>No recompilation \u2014 plugins are regular Python packages loaded at runtime</li> <li>Built-in demo mode \u2014 every plugin can simulate realistic sensor data out of the box, no hardware needed for development</li> <li>Conformance testing \u2014 inherit from <code>PluginConformanceSuite</code> and get 13 tests for free (lifecycle, channels, health, etc.)</li> <li>Channel mapping \u2014 link any plugin channel to a WebMACS event with one click; data flows into dashboards, rules, webhooks, and CSV exports automatically</li> <li>Sync and async \u2014 use <code>DevicePlugin</code> for async protocols (MQTT, OPC-UA) or <code>SyncDevicePlugin</code> for blocking libraries (serial, Modbus) \u2014 the SDK handles threading for you</li> <li>Safety by design \u2014 define <code>safe_value</code> per output channel; on disconnect or error, actuators are driven to safe state automatically</li> <li>Example included \u2014 a complete Weather Station example plugin ships in <code>examples/custom-plugin/</code> with build instructions</li> </ol>"},{"location":"why-webmacs/#example-add-a-custom-sensor-in-4-steps","title":"Example: Add a Custom Sensor in 4 Steps","text":"Step What You Do Time 1 Copy the example plugin and edit <code>get_channels()</code> 5 min 2 Implement <code>_do_connect()</code> and <code>_do_read()</code> for your protocol 15 min 3 Run <code>python -m build</code> to create a <code>.whl</code> file 10 sec 4 Upload via Plugins \u2192 Upload and create an instance 1 min <p>Total: ~20 minutes from idea to live data on your dashboard.</p> <p>Compare that to weeks of vendor coordination or days of LabVIEW rewiring.</p>"},{"location":"why-webmacs/#bundled-plugins","title":"Bundled Plugins","text":"<p>WebMACS ships with three plugins \u2014 no installation required:</p> Plugin Channels Purpose Simulated Device 9 (temperatures, pressures, flow, valve, heater) Testing &amp; demos without hardware System Monitor 4 (CPU, memory, disk, temperature) Host health monitoring Revolution Pi Dynamic (via piCtory) Direct RevPi I/O access <p>The Bottom Line</p> <p>Other systems force you to choose from the vendor's catalogue. WebMACS lets you connect anything that speaks a protocol \u2014 Modbus, MQTT, HTTP, serial, OPC-UA \u2014 with a Python class and a <code>.whl</code> upload.</p> <p>Plugin Development Guide \u2192 Plugin User Guide \u2192</p>"},{"location":"why-webmacs/#deep-dive-open-integration-the-swiss-army-knife","title":"Deep Dive: Open Integration \u2014 The Swiss Army Knife","text":"<p>Most monitoring systems are walled gardens. WebMACS is designed as a composable building block that connects to anything.</p>"},{"location":"why-webmacs/#three-integration-layers","title":"Three Integration Layers","text":"<pre><code>graph TB\n    subgraph WebMACS\n        REST[\"REST API&lt;br/&gt;30+ endpoints\"]\n        WS[\"WebSocket&lt;br/&gt;Live streaming\"]\n        WH[\"Webhooks&lt;br/&gt;Event-driven push\"]\n    end\n\n    REST --&gt;|\"GET/POST/PUT/DELETE\"| Client[\"Custom Apps&lt;br/&gt;Scripts \u00b7 Mobile\"]\n    WS --&gt;|\"Sub-second\"| CustomUI[\"Custom Dashboards&lt;br/&gt;Grafana \u00b7 HMI panels\"]\n    WH --&gt;|\"HMAC-signed POST\"| Slack[\"Slack / Teams\"]\n    WH --&gt;|\"Automation\"| NR[\"Node-RED\"]\n    WH --&gt;|\"Smart Home\"| HA[\"Home Assistant\"]\n    WH --&gt;|\"Data Pipeline\"| Cloud[\"AWS / Azure / S3\"]</code></pre> Layer Best For Example REST API CRUD, scripted pipelines, mobile apps <code>GET /experiments/{id}/export/csv</code> \u2192 feed a reporting tool WebSocket Live dashboards, low-latency custom UIs Stream values to Grafana or a wall-mounted HMI panel Webhooks Alerts, cross-system automation <code>sensor.threshold_exceeded</code> \u2192 Slack alert + Node-RED safety shutdown <p>The Bottom Line</p> <p>WebMACS doesn't replace your other tools \u2014 it powers them. Use the REST API to build, WebSocket to stream, and webhooks to react. Your lab's monitoring system becomes the data backbone of your entire workflow.</p> <p>Integration Guide \u2192</p>"},{"location":"why-webmacs/#ideal-use-cases","title":"Ideal Use Cases","text":""},{"location":"why-webmacs/#university-research-labs","title":"University Research Labs","text":"<p>Monitor fluidised-bed reactors, autoclaves, fermenters \u2014 with full experiment tracking and CSV export for thesis data.</p>"},{"location":"why-webmacs/#pilot-plants","title":"Pilot Plants","text":"<p>Track temperature, pressure, and flow across multiple zones. Set threshold alerts to catch anomalies early.</p>"},{"location":"why-webmacs/#quality-assurance","title":"Quality Assurance","text":"<p>Log every sensor reading with timestamps for compliance audits. Export complete data trails on demand.</p>"},{"location":"why-webmacs/#teaching-labs","title":"Teaching Labs","text":"<p>Students interact via browser \u2014 no software installation needed. Each team gets their own dashboard view.</p>"},{"location":"why-webmacs/#what-you-get-out-of-the-box","title":"What You Get Out of the Box","text":"<ol> <li>Live dashboard \u2014 sensor cards, actuator toggles, trend charts with configurable time ranges</li> <li>Custom dashboards \u2014 build your own widget layouts with line charts (incl. unit-labelled axes), gauges, stat cards, and actuator controls</li> <li>Plugin system \u2014 upload custom device drivers as Python wheels; connect any sensor or protocol in minutes</li> <li>Experiment tracking \u2014 named runs with automatic data linking and one-click CSV export</li> <li>Alerting \u2014 threshold rules with Slack/Teams/webhook notifications and cooldown periods</li> <li>Data export \u2014 streaming CSV downloads for Excel, Python, or MATLAB analysis</li> <li>User management \u2014 admin and operator roles with JWT authentication</li> <li>OTA updates \u2014 deploy new versions over USB, browser upload, or network</li> <li>Full API \u2014 extend or integrate with anything via REST and WebSocket</li> <li>Webhook integrations \u2014 HMAC-signed event delivery with retry logic</li> </ol>"},{"location":"why-webmacs/#open-source-extensible","title":"Open Source &amp; Extensible","text":"<p>WebMACS is licensed under MIT. You can:</p> <ul> <li>Build custom dashboards with widgets tailored to your process</li> <li>Write and upload new device plugins for any sensor, actuator, or protocol</li> <li>Integrate with Slack, Node-RED, Home Assistant, or any HTTP endpoint</li> <li>Deploy on a Raspberry Pi and self-host with zero ongoing costs</li> </ul> <p>Getting Started</p> <p>Ready to try it? Follow the Quick Start Guide to have WebMACS running in under 5 minutes.</p> <p>Get Started \u2192 View Architecture \u2192</p>"},{"location":"api/rest/","title":"REST API Reference","text":"<p>All endpoints are mounted under <code>/api/v1/</code>. Authentication uses JWT Bearer tokens unless noted otherwise.</p>"},{"location":"api/rest/#authentication","title":"Authentication","text":"Method Endpoint Auth Description <code>POST</code> <code>/api/v1/auth/login</code> Public Authenticate and receive JWT <code>POST</code> <code>/api/v1/auth/logout</code> JWT Revoke current token <code>GET</code> <code>/api/v1/auth/me</code> JWT Get current user info"},{"location":"api/rest/#post-apiv1authlogin","title":"<code>POST /api/v1/auth/login</code>","text":"<p>Authenticate and receive a JWT token.</p> <p>Request:</p> <pre><code>{\n  \"email\": \"admin@webmacs.io\",\n  \"password\": \"admin123\"\n}\n</code></pre> <p>Response <code>200</code>:</p> <pre><code>{\n  \"status\": \"success\",\n  \"message\": \"Successfully logged in.\",\n  \"access_token\": \"eyJhbGciOiJIUzI1NiIs...\",\n  \"public_id\": \"usr_abc123\",\n  \"username\": \"admin\"\n}\n</code></pre> <p>Token usage</p> <p>Include the token in all subsequent requests: <code>Authorization: Bearer &lt;access_token&gt;</code></p>"},{"location":"api/rest/#post-apiv1authlogout","title":"<code>POST /api/v1/auth/logout</code>","text":"<p>Blacklists the current JWT so it cannot be reused.</p> <p>Response <code>200</code>:</p> <pre><code>{ \"status\": \"success\", \"message\": \"Successfully logged out.\" }\n</code></pre>"},{"location":"api/rest/#get-apiv1authme","title":"<code>GET /api/v1/auth/me</code>","text":"<p>Returns the authenticated user's profile.</p> <p>Response <code>200</code>:</p> <pre><code>{\n  \"public_id\": \"usr_abc123\",\n  \"email\": \"admin@webmacs.io\",\n  \"username\": \"admin\",\n  \"admin\": true,\n  \"created_on\": \"2025-01-01T00:00:00\"\n}\n</code></pre>"},{"location":"api/rest/#users","title":"Users","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/users</code> Admin List all users <code>GET</code> <code>/api/v1/users/{id}</code> Admin Get user by public_id <code>POST</code> <code>/api/v1/users</code> Admin Create user <code>PUT</code> <code>/api/v1/users/{id}</code> Admin Update user <code>DELETE</code> <code>/api/v1/users/{id}</code> Admin Delete user"},{"location":"api/rest/#create-user","title":"Create User","text":"<pre><code>{\n  \"email\": \"operator@example.com\",\n  \"username\": \"operator1\",\n  \"password\": \"securepassword123\"\n}\n</code></pre>"},{"location":"api/rest/#experiments","title":"Experiments","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/experiments</code> JWT List all experiments <code>GET</code> <code>/api/v1/experiments/{id}</code> JWT Get single experiment <code>POST</code> <code>/api/v1/experiments</code> JWT Create &amp; start experiment <code>PUT</code> <code>/api/v1/experiments/{id}</code> JWT Update experiment <code>PUT</code> <code>/api/v1/experiments/{id}/stop</code> JWT Stop experiment <code>DELETE</code> <code>/api/v1/experiments/{id}</code> JWT Delete experiment <code>GET</code> <code>/api/v1/experiments/{id}/export/csv</code> JWT Download CSV"},{"location":"api/rest/#create-experiment","title":"Create Experiment","text":"<pre><code>{\n  \"name\": \"Fluidised Bed Run 07\"\n}\n</code></pre>"},{"location":"api/rest/#csv-export","title":"CSV Export","text":"<pre><code>GET /api/v1/experiments/{id}/export/csv\n</code></pre> <p>Returns <code>text/csv</code> as a streaming response. See CSV Export Guide.</p>"},{"location":"api/rest/#events","title":"Events","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/events</code> JWT List all events <code>GET</code> <code>/api/v1/events/{id}</code> JWT Get single event <code>POST</code> <code>/api/v1/events</code> JWT Create event <code>PUT</code> <code>/api/v1/events/{id}</code> JWT Update event <code>DELETE</code> <code>/api/v1/events/{id}</code> JWT Delete event"},{"location":"api/rest/#create-event","title":"Create Event","text":"<pre><code>{\n  \"name\": \"Inlet Temperature\",\n  \"type\": \"sensor\",\n  \"unit\": \"\u00b0C\",\n  \"min_value\": 0.0,\n  \"max_value\": 200.0\n}\n</code></pre> <p>Event Types: <code>sensor</code>, <code>actuator</code>, <code>range</code>, <code>cmd_button</code>, <code>cmd_opened</code>, <code>cmd_closed</code></p>"},{"location":"api/rest/#dashboards","title":"Dashboards","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/dashboards</code> JWT List dashboards (own + global) <code>POST</code> <code>/api/v1/dashboards</code> JWT Create dashboard <code>GET</code> <code>/api/v1/dashboards/{id}</code> JWT Get dashboard with widgets <code>PUT</code> <code>/api/v1/dashboards/{id}</code> JWT Update dashboard <code>DELETE</code> <code>/api/v1/dashboards/{id}</code> JWT Delete dashboard <code>POST</code> <code>/api/v1/dashboards/{id}/widgets</code> JWT Add widget to dashboard <code>PUT</code> <code>/api/v1/dashboards/{id}/widgets/{wid}</code> JWT Update widget <code>DELETE</code> <code>/api/v1/dashboards/{id}/widgets/{wid}</code> JWT Delete widget"},{"location":"api/rest/#create-dashboard","title":"Create Dashboard","text":"<pre><code>{\n  \"name\": \"Production Overview\",\n  \"is_global\": false\n}\n</code></pre>"},{"location":"api/rest/#add-widget","title":"Add Widget","text":"<pre><code>{\n  \"widget_type\": \"line_chart\",\n  \"title\": \"Inlet Temperature\",\n  \"event_public_id\": \"evt_temp01\",\n  \"x\": 0,\n  \"y\": 0,\n  \"w\": 6,\n  \"h\": 3\n}\n</code></pre> <p>Widget Types: <code>line_chart</code>, <code>gauge</code>, <code>stat_card</code>, <code>actuator_toggle</code></p> <p>Visibility</p> <p>Users see their own dashboards plus any dashboard marked <code>is_global: true</code>. Only the dashboard owner can modify or delete it.</p>"},{"location":"api/rest/#datapoints","title":"Datapoints","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/datapoints</code> JWT List datapoints (paginated) <code>POST</code> <code>/api/v1/datapoints</code> JWT Create single datapoint <code>POST</code> <code>/api/v1/datapoints/batch</code> JWT Create multiple datapoints <code>POST</code> <code>/api/v1/datapoints/series</code> JWT Get time-series data (for charts) <code>GET</code> <code>/api/v1/datapoints/latest</code> JWT Get latest datapoint per event <code>GET</code> <code>/api/v1/datapoints/{id}</code> JWT Get single datapoint <code>DELETE</code> <code>/api/v1/datapoints/{id}</code> JWT Delete datapoint"},{"location":"api/rest/#create-datapoint","title":"Create Datapoint","text":"<pre><code>{\n  \"value\": 23.45,\n  \"event_public_id\": \"evt_temp01\"\n}\n</code></pre>"},{"location":"api/rest/#query-parameters","title":"Query Parameters","text":"Param Type Default Description <code>page</code> <code>int</code> <code>1</code> Page number (\u2265 1) <code>page_size</code> <code>int</code> <code>25</code> Results per page (1\u2013100)"},{"location":"api/rest/#time-series-query","title":"Time-Series Query","text":"<p><code>POST /api/v1/datapoints/series</code> \u2014 returns datapoints grouped by event, with server-side downsampling for dashboard performance.</p> <pre><code>{\n  \"event_public_ids\": [\"evt_temp01\", \"evt_pressure\"],\n  \"minutes\": 60,\n  \"max_points\": 500\n}\n</code></pre> Param Type Default Range Description <code>event_public_ids</code> <code>list[str]</code> \u2014 1\u201320 Events to query <code>minutes</code> <code>int</code> <code>60</code> 1\u201314400 Time window (up to 10 days) <code>max_points</code> <code>int</code> <code>500</code> 10\u20132000 Max points per event (downsampled) <p>Response: <code>{ \"evt_temp01\": [...], \"evt_pressure\": [...] }</code></p> <p>Performance</p> <p>Use <code>max_points</code> to limit data transferred to the frontend \u2014 the server uniformly samples large datasets while always preserving the latest value.</p>"},{"location":"api/rest/#logs","title":"Logs","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/logging</code> JWT List log entries <code>POST</code> <code>/api/v1/logging</code> JWT Create log entry <code>PUT</code> <code>/api/v1/logging/{id}</code> JWT Update (mark read)"},{"location":"api/rest/#create-log-entry","title":"Create Log Entry","text":"<pre><code>{\n  \"content\": \"Experiment started\",\n  \"logging_type\": \"info\"\n}\n</code></pre> <p>Log types: <code>error</code>, <code>warning</code>, <code>info</code> Statuses: <code>read</code>, <code>unread</code></p>"},{"location":"api/rest/#webhooks","title":"Webhooks","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/webhooks</code> Admin List webhook subscriptions <code>POST</code> <code>/api/v1/webhooks</code> Admin Create webhook <code>GET</code> <code>/api/v1/webhooks/{id}</code> Admin Get webhook details <code>PUT</code> <code>/api/v1/webhooks/{id}</code> Admin Update webhook <code>DELETE</code> <code>/api/v1/webhooks/{id}</code> Admin Delete webhook <code>GET</code> <code>/api/v1/webhooks/{id}/deliveries</code> Admin List delivery log"},{"location":"api/rest/#create-webhook","title":"Create Webhook","text":"<pre><code>{\n  \"url\": \"https://example.com/webhook\",\n  \"secret\": \"my-hmac-secret\",\n  \"events\": [\"sensor.threshold_exceeded\", \"experiment.started\"],\n  \"enabled\": true\n}\n</code></pre> <p>Webhook Event Types: <code>sensor.threshold_exceeded</code>, <code>sensor.reading</code>, <code>experiment.started</code>, <code>experiment.stopped</code>, <code>system.health_changed</code></p> <p>Delivery Statuses: <code>pending</code>, <code>delivered</code>, <code>failed</code>, <code>dead_letter</code></p> <p>HMAC Verification</p> <p>If a <code>secret</code> is provided, each delivery includes an <code>X-Webhook-Signature</code> header containing the HMAC-SHA256 signature of the payload body, which can be used to verify authenticity.</p>"},{"location":"api/rest/#rules","title":"Rules","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/rules</code> Admin List automation rules <code>POST</code> <code>/api/v1/rules</code> Admin Create rule <code>GET</code> <code>/api/v1/rules/{id}</code> Admin Get rule details <code>PUT</code> <code>/api/v1/rules/{id}</code> Admin Update rule <code>DELETE</code> <code>/api/v1/rules/{id}</code> Admin Delete rule"},{"location":"api/rest/#create-rule","title":"Create Rule","text":"<pre><code>{\n  \"name\": \"High Temperature Alert\",\n  \"event_public_id\": \"evt_temp01\",\n  \"operator\": \"gt\",\n  \"threshold\": 50.0,\n  \"action_type\": \"webhook\",\n  \"webhook_event_type\": \"sensor.threshold_exceeded\",\n  \"cooldown_seconds\": 300,\n  \"enabled\": true\n}\n</code></pre> <p>Operators: <code>gt</code> (&gt;), <code>lt</code> (&lt;), <code>gte</code> (&gt;=), <code>lte</code> (&lt;=), <code>eq</code> (==), <code>between</code>, <code>not_between</code></p> <p>Action Types: <code>webhook</code>, <code>log</code></p> <p>Between operator</p> <p>When using <code>between</code> or <code>not_between</code>, provide both <code>threshold</code> (low) and <code>threshold_high</code> (high) values.</p>"},{"location":"api/rest/#ota-updates","title":"OTA Updates","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/ota</code> Admin List firmware updates <code>POST</code> <code>/api/v1/ota</code> Admin Create firmware update <code>GET</code> <code>/api/v1/ota/{id}</code> Admin Get update details <code>DELETE</code> <code>/api/v1/ota/{id}</code> Admin Delete firmware update <code>POST</code> <code>/api/v1/ota/{id}/apply</code> Admin Apply firmware update <code>POST</code> <code>/api/v1/ota/{id}/rollback</code> Admin Rollback firmware update <code>GET</code> <code>/api/v1/ota/check</code> Admin Check for available updates"},{"location":"api/rest/#create-firmware-update","title":"Create Firmware Update","text":"<pre><code>{\n  \"version\": \"2.1.0\",\n  \"changelog\": \"Performance improvements and bug fixes\"\n}\n</code></pre> <p>Update Statuses: <code>pending</code>, <code>downloading</code>, <code>verifying</code>, <code>applying</code>, <code>completed</code>, <code>failed</code>, <code>rolled_back</code></p>"},{"location":"api/rest/#health-check","title":"Health Check","text":""},{"location":"api/rest/#get-health","title":"<code>GET /health</code>","text":"<p>Returns system health \u2014 no authentication required. Used by Docker healthcheck.</p> <pre><code>{\n  \"status\": \"ok\",\n  \"version\": \"0.1.0\",\n  \"database\": \"ok\",\n  \"last_datapoint\": \"2025-01-15T14:30:00.123456\",\n  \"uptime_seconds\": 3621.5\n}\n</code></pre> Field Type Description <code>status</code> string <code>\"ok\"</code> or <code>\"degraded\"</code> <code>version</code> string Application version <code>database</code> string <code>\"ok\"</code> or <code>\"error\"</code> <code>last_datapoint</code> string | null ISO timestamp of last datapoint, or <code>null</code> <code>uptime_seconds</code> number Seconds since application start"},{"location":"api/rest/#plugins","title":"Plugins","text":""},{"location":"api/rest/#plugin-discovery-instances","title":"Plugin Discovery &amp; Instances","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/plugins/available</code> JWT List all discovered plugin classes <code>GET</code> <code>/api/v1/plugins</code> JWT List plugin instances (paginated) <code>POST</code> <code>/api/v1/plugins</code> JWT Create a new plugin instance <code>GET</code> <code>/api/v1/plugins/{public_id}</code> JWT Get a single plugin instance <code>PUT</code> <code>/api/v1/plugins/{public_id}</code> JWT Update a plugin instance <code>DELETE</code> <code>/api/v1/plugins/{public_id}</code> JWT Delete a plugin instance"},{"location":"api/rest/#get-apiv1pluginsavailable","title":"<code>GET /api/v1/plugins/available</code>","text":"<p>Returns all plugin classes discovered via Python entry points.</p> <p>Response <code>200</code>:</p> <pre><code>[\n  {\n    \"id\": \"system\",\n    \"name\": \"System Monitor\",\n    \"version\": \"0.1.0\",\n    \"vendor\": \"WebMACS\",\n    \"description\": \"CPU, memory, disk and temperature monitoring.\",\n    \"url\": \"https://github.com/stefanposs/webmacs\"\n  }\n]\n</code></pre>"},{"location":"api/rest/#post-apiv1plugins","title":"<code>POST /api/v1/plugins</code>","text":"<p>Create a new plugin instance. Channels are auto-discovered from the plugin class.</p> <p>Request:</p> <pre><code>{\n  \"plugin_id\": \"system\",\n  \"instance_name\": \"Lab Server Metrics\",\n  \"demo_mode\": true,\n  \"enabled\": true,\n  \"config_json\": null\n}\n</code></pre> <p>Response <code>201</code>:</p> <pre><code>{\n  \"status\": \"success\",\n  \"message\": \"Plugin instance created.\"\n}\n</code></pre>"},{"location":"api/rest/#get-apiv1pluginspublic_id","title":"<code>GET /api/v1/plugins/{public_id}</code>","text":"<p>Returns the instance including all channel mappings.</p> <p>Response <code>200</code>:</p> <pre><code>{\n  \"public_id\": \"abc-123\",\n  \"plugin_id\": \"system\",\n  \"instance_name\": \"Lab Server Metrics\",\n  \"demo_mode\": true,\n  \"enabled\": true,\n  \"status\": \"inactive\",\n  \"config_json\": null,\n  \"error_message\": null,\n  \"created_on\": \"2026-02-14T10:00:00Z\",\n  \"updated_on\": \"2026-02-14T10:00:00Z\",\n  \"user_public_id\": \"usr-123\",\n  \"channel_mappings\": [\n    {\n      \"public_id\": \"ch-001\",\n      \"channel_id\": \"cpu_percent\",\n      \"channel_name\": \"CPU Usage\",\n      \"direction\": \"input\",\n      \"unit\": \"%\",\n      \"event_public_id\": null,\n      \"created_on\": \"2026-02-14T10:00:00Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/rest/#put-apiv1pluginspublic_id","title":"<code>PUT /api/v1/plugins/{public_id}</code>","text":"<p>Request:</p> <pre><code>{\n  \"instance_name\": \"Updated Name\",\n  \"enabled\": false\n}\n</code></pre>"},{"location":"api/rest/#channel-mappings","title":"Channel Mappings","text":"Method Endpoint Auth Description <code>GET</code> <code>/api/v1/plugins/{public_id}/channels</code> JWT List channel mappings <code>POST</code> <code>/api/v1/plugins/{public_id}/channels</code> JWT Create a channel mapping <code>PUT</code> <code>/api/v1/plugins/{public_id}/channels/{mapping_id}</code> JWT Update a channel mapping <code>DELETE</code> <code>/api/v1/plugins/{public_id}/channels/{mapping_id}</code> JWT Delete a channel mapping"},{"location":"api/rest/#post-apiv1pluginspublic_idchannels","title":"<code>POST /api/v1/plugins/{public_id}/channels</code>","text":"<p>Request:</p> <pre><code>{\n  \"channel_id\": \"custom_sensor\",\n  \"channel_name\": \"Custom Sensor\",\n  \"direction\": \"input\",\n  \"unit\": \"mV\"\n}\n</code></pre>"},{"location":"api/rest/#put-apiv1pluginspublic_idchannelsmapping_id","title":"<code>PUT /api/v1/plugins/{public_id}/channels/{mapping_id}</code>","text":"<p>Link a channel to a WebMACS event:</p> <p>Request:</p> <pre><code>{\n  \"event_public_id\": \"evt-abc-123\"\n}\n</code></pre>"},{"location":"api/rest/#plugin-packages","title":"Plugin Packages","text":"<p> Admin-only endpoints.</p> Method Endpoint Auth Description <code>GET</code> <code>/api/v1/plugins/packages</code> JWT List installed plugin packages <code>POST</code> <code>/api/v1/plugins/packages/upload</code> Admin Upload a <code>.whl</code> plugin package <code>DELETE</code> <code>/api/v1/plugins/packages/{public_id}</code> Admin Uninstall an uploaded package"},{"location":"api/rest/#post-apiv1pluginspackagesupload","title":"<code>POST /api/v1/plugins/packages/upload</code>","text":"<p>Upload a Python wheel file. The file is validated, installed via pip, and the new plugins are discovered.</p> <p>Request: <code>multipart/form-data</code> with field <code>file</code> (<code>.whl</code> file)</p> <p>Response <code>201</code>:</p> <pre><code>{\n  \"status\": \"success\",\n  \"message\": \"Plugin package 'webmacs-plugin-my-sensor' v1.0.0 installed (12,345 bytes). Restart the controller to activate.\"\n}\n</code></pre> <p>Error Responses:</p> Code Cause <code>400</code> File is not a <code>.whl</code> <code>409</code> Package already exists or file already uploaded <code>413</code> File exceeds 50 MB limit <code>422</code> Invalid wheel structure (missing metadata or entry point) <code>500</code> pip install failed"},{"location":"api/rest/#get-apiv1pluginspackages","title":"<code>GET /api/v1/plugins/packages</code>","text":"<p>Response <code>200</code>:</p> <pre><code>[\n  {\n    \"public_id\": \"pkg-123\",\n    \"package_name\": \"webmacs-plugin-my-sensor\",\n    \"version\": \"1.0.0\",\n    \"source\": \"uploaded\",\n    \"plugin_ids\": [\"my-sensor\"],\n    \"file_size_bytes\": 12345,\n    \"installed_on\": \"2026-02-14T12:00:00Z\",\n    \"removable\": true\n  }\n]\n</code></pre>"},{"location":"api/rest/#error-responses","title":"Error Responses","text":"<p>All errors follow a consistent format:</p> <pre><code>{\n  \"detail\": \"Not Found\"\n}\n</code></pre> Status Code Meaning <code>400</code> Bad request / validation error <code>401</code> Unauthorized \u2014 invalid or missing token <code>403</code> Forbidden \u2014 insufficient permissions <code>404</code> Resource not found <code>422</code> Validation error \u2014 Pydantic schema mismatch <code>500</code> Internal server error"},{"location":"api/rest/#openapi-documentation","title":"OpenAPI Documentation","text":"<p>FastAPI auto-generates interactive API docs:</p> <ul> <li>Swagger UI: <code>http://localhost:8000/docs</code></li> <li>ReDoc: <code>http://localhost:8000/redoc</code></li> </ul>"},{"location":"api/rest/#next-steps","title":"Next Steps","text":"<ul> <li>WebSocket API \u2014 real-time endpoints</li> <li>Schemas \u2014 Pydantic model reference</li> </ul>"},{"location":"api/schemas/","title":"Schemas","text":"<p>WebMACS uses Pydantic v2 for all request/response validation. This page documents every schema model used across the API.</p> <p>Interactive Docs</p> <p>FastAPI auto-generates interactive schemas at <code>/docs</code> (Swagger UI) and <code>/redoc</code>.</p>"},{"location":"api/schemas/#auth","title":"Auth","text":""},{"location":"api/schemas/#loginrequest","title":"LoginRequest","text":"Field Type Required Description <code>email</code> <code>EmailStr</code> Yes User email address <code>password</code> <code>str</code> Yes User password (min 1 char)"},{"location":"api/schemas/#loginresponse","title":"LoginResponse","text":"Field Type Description <code>status</code> <code>str</code> Always <code>\"success\"</code> <code>message</code> <code>str</code> <code>\"Successfully logged in.\"</code> <code>access_token</code> <code>str</code> JWT token for subsequent requests <code>public_id</code> <code>str</code> User's public identifier <code>username</code> <code>str</code> Display name"},{"location":"api/schemas/#users","title":"Users","text":""},{"location":"api/schemas/#usercreate","title":"UserCreate","text":"Field Type Required Constraints <code>email</code> <code>EmailStr</code> Yes Valid email <code>username</code> <code>str</code> Yes 2\u201350 characters <code>password</code> <code>str</code> Yes Min 8 characters"},{"location":"api/schemas/#userupdate","title":"UserUpdate","text":"Field Type Required Constraints <code>email</code> <code>EmailStr</code> No Valid email <code>username</code> <code>str</code> No 2\u201350 characters <code>password</code> <code>str</code> No Min 8 characters"},{"location":"api/schemas/#userresponse","title":"UserResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Unique identifier <code>email</code> <code>str</code> Email address <code>username</code> <code>str</code> Display name <code>admin</code> <code>bool</code> Admin privileges <code>registered_on</code> <code>datetime</code> Registration timestamp"},{"location":"api/schemas/#events","title":"Events","text":""},{"location":"api/schemas/#eventcreate","title":"EventCreate","text":"Field Type Required Description <code>name</code> <code>str</code> Yes Event name (1\u2013255 chars) <code>min_value</code> <code>float</code> Yes Minimum expected value <code>max_value</code> <code>float</code> Yes Maximum expected value <code>unit</code> <code>str</code> Yes Unit of measurement (1\u2013255 chars) <code>type</code> <code>EventType</code> Yes One of: <code>sensor</code>, <code>actuator</code>, <code>range</code>, <code>cmd_button</code>, <code>cmd_opened</code>, <code>cmd_closed</code>"},{"location":"api/schemas/#eventupdate","title":"EventUpdate","text":"Field Type Required Description <code>name</code> <code>str</code> No Updated name <code>min_value</code> <code>float</code> No Updated minimum <code>max_value</code> <code>float</code> No Updated maximum <code>unit</code> <code>str</code> No Updated unit <code>type</code> <code>EventType</code> No Updated type"},{"location":"api/schemas/#eventresponse","title":"EventResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Unique identifier <code>name</code> <code>str</code> Event name <code>min_value</code> <code>float</code> Minimum expected value <code>max_value</code> <code>float</code> Maximum expected value <code>unit</code> <code>str</code> Unit of measurement <code>type</code> <code>EventType</code> Event type <code>user_public_id</code> <code>str</code> Owner's public ID"},{"location":"api/schemas/#experiments","title":"Experiments","text":""},{"location":"api/schemas/#experimentcreate","title":"ExperimentCreate","text":"Field Type Required Constraints <code>name</code> <code>str</code> Yes 1\u2013255 characters"},{"location":"api/schemas/#experimentupdate","title":"ExperimentUpdate","text":"Field Type Required Constraints <code>name</code> <code>str</code> No Max 255 characters"},{"location":"api/schemas/#experimentresponse","title":"ExperimentResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Unique identifier <code>name</code> <code>str</code> Experiment name <code>started_on</code> <code>datetime \\| null</code> Start timestamp <code>stopped_on</code> <code>datetime \\| null</code> Stop timestamp (null if running) <code>user_public_id</code> <code>str</code> Owner's public ID"},{"location":"api/schemas/#datapoints","title":"Datapoints","text":""},{"location":"api/schemas/#datapointcreate","title":"DatapointCreate","text":"Field Type Required Description <code>value</code> <code>float</code> Yes Measured value <code>event_public_id</code> <code>str</code> Yes Associated event ID <p>Experiment linking</p> <p>Datapoints are automatically linked to the currently running experiment. There is no <code>experiment_public_id</code> field on create.</p>"},{"location":"api/schemas/#datapointbatchcreate","title":"DatapointBatchCreate","text":"Field Type Required Description <code>datapoints</code> <code>list[DatapointCreate]</code> Yes Array of datapoints to insert"},{"location":"api/schemas/#datapointresponse","title":"DatapointResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Unique identifier <code>value</code> <code>float</code> Measured value <code>timestamp</code> <code>datetime</code> When the value was recorded <code>event_public_id</code> <code>str</code> Associated event ID <code>experiment_public_id</code> <code>str \\| null</code> Linked experiment (if any)"},{"location":"api/schemas/#datapointseriesrequest","title":"DatapointSeriesRequest","text":"<p>Used by <code>POST /api/v1/datapoints/series</code> for dashboard charts.</p> Field Type Default Constraints Description <code>event_public_ids</code> <code>list[str]</code> \u2014 1\u201320 items Events to query <code>minutes</code> <code>int</code> <code>60</code> 1\u201314400 Time window (max ~10 days) <code>max_points</code> <code>int</code> <code>500</code> 10\u20132000 Server-side downsampling limit"},{"location":"api/schemas/#logs","title":"Logs","text":""},{"location":"api/schemas/#logentrycreate","title":"LogEntryCreate","text":"Field Type Required Default Description <code>content</code> <code>str</code> Yes \u2014 Log message (1\u2013500 chars) <code>logging_type</code> <code>LoggingType</code> No <code>info</code> Severity level"},{"location":"api/schemas/#logentryupdate","title":"LogEntryUpdate","text":"Field Type Required Description <code>status_type</code> <code>StatusType</code> No Mark as <code>read</code> or <code>unread</code> <code>content</code> <code>str</code> No Update content"},{"location":"api/schemas/#logentryresponse","title":"LogEntryResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Unique identifier <code>content</code> <code>str</code> Log message <code>logging_type</code> <code>LoggingType</code> Severity: <code>error</code>, <code>warning</code>, <code>info</code> <code>status_type</code> <code>StatusType</code> Read status: <code>read</code>, <code>unread</code> <code>created_on</code> <code>datetime</code> Creation timestamp <code>user_public_id</code> <code>str</code> Author's public ID"},{"location":"api/schemas/#rules","title":"Rules","text":""},{"location":"api/schemas/#rulecreate","title":"RuleCreate","text":"Field Type Required Default Description <code>name</code> <code>str</code> Yes \u2014 Rule name (1\u2013255 chars) <code>event_public_id</code> <code>str</code> Yes \u2014 Event to monitor <code>operator</code> <code>RuleOperator</code> Yes \u2014 Comparison operator <code>threshold</code> <code>float</code> Yes \u2014 Threshold value <code>threshold_high</code> <code>float</code> No \u2014 Upper bound (required for <code>between</code> / <code>not_between</code>) <code>action_type</code> <code>RuleActionType</code> Yes \u2014 <code>webhook</code> or <code>log</code> <code>webhook_event_type</code> <code>WebhookEventType</code> No \u2014 Webhook event to fire <code>enabled</code> <code>bool</code> No <code>true</code> Active state <code>cooldown_seconds</code> <code>int</code> No <code>60</code> Minimum seconds between triggers <p>Operator validation</p> <p>When using <code>between</code> or <code>not_between</code>, <code>threshold_high</code> is required and must be \u2265 <code>threshold</code>.</p>"},{"location":"api/schemas/#ruleresponse","title":"RuleResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Unique identifier <code>name</code> <code>str</code> Rule name <code>event_public_id</code> <code>str</code> Monitored event <code>operator</code> <code>RuleOperator</code> Comparison operator <code>threshold</code> <code>float</code> Threshold value <code>threshold_high</code> <code>float \\| null</code> Upper bound <code>action_type</code> <code>RuleActionType</code> Action type <code>webhook_event_type</code> <code>str \\| null</code> Webhook event type <code>enabled</code> <code>bool</code> Active state <code>cooldown_seconds</code> <code>int</code> Cooldown period <code>last_triggered_at</code> <code>datetime \\| null</code> Last trigger time <code>created_on</code> <code>datetime</code> Creation timestamp <code>user_public_id</code> <code>str</code> Owner's public ID"},{"location":"api/schemas/#webhooks","title":"Webhooks","text":""},{"location":"api/schemas/#webhookcreate","title":"WebhookCreate","text":"Field Type Required Default Description <code>url</code> <code>str</code> Yes \u2014 Endpoint URL (must start with <code>http://</code> or <code>https://</code>) <code>secret</code> <code>str</code> No \u2014 HMAC-SHA256 signing secret (max 255 chars) <code>events</code> <code>list[WebhookEventType]</code> Yes \u2014 Events to subscribe to <code>enabled</code> <code>bool</code> No <code>true</code> Active state"},{"location":"api/schemas/#webhookresponse","title":"WebhookResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Unique identifier <code>url</code> <code>str</code> Endpoint URL <code>events</code> <code>list[str]</code> Subscribed event types <code>enabled</code> <code>bool</code> Active state <code>created_on</code> <code>datetime</code> Creation timestamp <code>user_public_id</code> <code>str</code> Owner's public ID"},{"location":"api/schemas/#webhookdeliveryresponse","title":"WebhookDeliveryResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Delivery ID <code>event_type</code> <code>str</code> Event that triggered the delivery <code>status</code> <code>WebhookDeliveryStatus</code> <code>pending</code>, <code>delivered</code>, <code>failed</code>, <code>dead_letter</code> <code>attempts</code> <code>int</code> Number of delivery attempts <code>last_error</code> <code>str \\| null</code> Last error message <code>response_code</code> <code>int \\| null</code> HTTP response code <code>created_on</code> <code>datetime</code> Created at <code>delivered_on</code> <code>datetime \\| null</code> Successfully delivered at"},{"location":"api/schemas/#ota-updates","title":"OTA Updates","text":""},{"location":"api/schemas/#firmwareupdatecreate","title":"FirmwareUpdateCreate","text":"Field Type Required Constraints Description <code>version</code> <code>str</code> Yes Semantic versioning (<code>X.Y.Z</code>) Firmware version <code>changelog</code> <code>str</code> No \u2014 Release notes"},{"location":"api/schemas/#firmwareupdateresponse","title":"FirmwareUpdateResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Unique identifier <code>version</code> <code>str</code> Firmware version <code>changelog</code> <code>str \\| null</code> Release notes <code>file_hash_sha256</code> <code>str \\| null</code> SHA-256 hash of firmware file <code>file_size_bytes</code> <code>int \\| null</code> File size in bytes <code>has_firmware_file</code> <code>bool</code> Whether a firmware binary has been uploaded <code>status</code> <code>UpdateStatus</code> <code>pending</code>, <code>downloading</code>, <code>verifying</code>, <code>applying</code>, <code>completed</code>, <code>failed</code>, <code>rolled_back</code> <code>error_message</code> <code>str \\| null</code> Error details (if failed) <code>created_on</code> <code>datetime</code> Created at <code>started_on</code> <code>datetime \\| null</code> Apply started at <code>completed_on</code> <code>datetime \\| null</code> Apply completed at <code>user_public_id</code> <code>str</code> Owner's public ID"},{"location":"api/schemas/#updatecheckresponse","title":"UpdateCheckResponse","text":"Field Type Description <code>current_version</code> <code>str</code> Currently running version <code>latest_version</code> <code>str \\| null</code> Latest local version <code>update_available</code> <code>bool</code> Whether an update is available <code>github_latest_version</code> <code>str \\| null</code> Latest GitHub release <code>github_download_url</code> <code>str \\| null</code> GitHub download URL <code>github_release_url</code> <code>str \\| null</code> GitHub release page <code>github_error</code> <code>str \\| null</code> Error fetching from GitHub"},{"location":"api/schemas/#dashboards","title":"Dashboards","text":""},{"location":"api/schemas/#dashboardcreate","title":"DashboardCreate","text":"Field Type Required Default Description <code>name</code> <code>str</code> Yes \u2014 Dashboard name (1\u2013255 chars) <code>is_global</code> <code>bool</code> No <code>false</code> Visible to all users"},{"location":"api/schemas/#dashboardresponse","title":"DashboardResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Unique identifier <code>name</code> <code>str</code> Dashboard name <code>is_global</code> <code>bool</code> Globally visible <code>created_on</code> <code>datetime</code> Created at <code>user_public_id</code> <code>str</code> Owner's public ID <code>widgets</code> <code>list[DashboardWidgetResponse]</code> Attached widgets"},{"location":"api/schemas/#dashboardwidgetcreate","title":"DashboardWidgetCreate","text":"Field Type Required Default Description <code>widget_type</code> <code>WidgetType</code> Yes \u2014 <code>line_chart</code>, <code>gauge</code>, <code>stat_card</code>, <code>actuator_toggle</code> <code>title</code> <code>str</code> Yes \u2014 Widget title (1\u2013255 chars) <code>event_public_id</code> <code>str</code> No \u2014 Data source event <code>x</code> <code>int</code> No <code>0</code> Grid column position <code>y</code> <code>int</code> No <code>0</code> Grid row position <code>w</code> <code>int</code> No <code>4</code> Width in grid columns (1\u201312) <code>h</code> <code>int</code> No <code>3</code> Height in grid rows (1\u201312) <code>config_json</code> <code>str</code> No \u2014 Custom widget configuration (JSON string)"},{"location":"api/schemas/#dashboardwidgetresponse","title":"DashboardWidgetResponse","text":"Field Type Description <code>public_id</code> <code>str</code> Unique identifier <code>widget_type</code> <code>WidgetType</code> Widget type <code>title</code> <code>str</code> Widget title <code>event_public_id</code> <code>str \\| null</code> Data source <code>x</code> <code>int</code> Grid column <code>y</code> <code>int</code> Grid row <code>w</code> <code>int</code> Width <code>h</code> <code>int</code> Height <code>config_json</code> <code>str \\| null</code> Custom configuration"},{"location":"api/schemas/#health","title":"Health","text":""},{"location":"api/schemas/#healthresponse","title":"HealthResponse","text":"Field Type Description <code>status</code> <code>str</code> <code>\"healthy\"</code> <code>version</code> <code>str</code> Application version <code>database</code> <code>str</code> Database status <code>last_datapoint</code> <code>datetime \\| null</code> Most recent datapoint timestamp <code>uptime_seconds</code> <code>float \\| null</code> Server uptime"},{"location":"api/schemas/#generic-schemas","title":"Generic Schemas","text":""},{"location":"api/schemas/#statusresponse","title":"StatusResponse","text":"Field Type Description <code>status</code> <code>str</code> <code>\"success\"</code> or <code>\"error\"</code> <code>message</code> <code>str</code> Human-readable message"},{"location":"api/schemas/#paginatedresponse","title":"PaginatedResponse","text":"Field Type Description <code>page</code> <code>int</code> Current page number <code>page_size</code> <code>int</code> Items per page <code>total</code> <code>int</code> Total item count <code>data</code> <code>list[T]</code> Array of items"},{"location":"api/schemas/#enums","title":"Enums","text":""},{"location":"api/schemas/#eventtype","title":"EventType","text":"Value Description <code>sensor</code> Continuous measurement input <code>actuator</code> Controllable output <code>range</code> Range-bounded value <code>cmd_button</code> Momentary command <code>cmd_opened</code> Open state command <code>cmd_closed</code> Close state command"},{"location":"api/schemas/#loggingtype","title":"LoggingType","text":"Value Description <code>error</code> Error-level log <code>warning</code> Warning-level log <code>info</code> Informational log"},{"location":"api/schemas/#statustype","title":"StatusType","text":"Value Description <code>read</code> Log entry has been read <code>unread</code> Log entry is unread"},{"location":"api/schemas/#ruleoperator","title":"RuleOperator","text":"Value Description <code>gt</code> Greater than (&gt;) <code>lt</code> Less than (&lt;) <code>gte</code> Greater than or equal (\u2265) <code>lte</code> Less than or equal (\u2264) <code>eq</code> Equal (==) <code>between</code> Within range (inclusive) <code>not_between</code> Outside range"},{"location":"api/schemas/#ruleactiontype","title":"RuleActionType","text":"Value Description <code>webhook</code> Fire a webhook event <code>log</code> Create a log entry"},{"location":"api/schemas/#widgettype","title":"WidgetType","text":"Value Description <code>line_chart</code> Time-series line chart <code>gauge</code> Radial gauge indicator <code>stat_card</code> Single-value display card <code>actuator_toggle</code> On/off toggle switch"},{"location":"api/schemas/#webhookeventtype","title":"WebhookEventType","text":"Value Description <code>sensor.threshold_exceeded</code> Sensor crossed a threshold <code>sensor.reading</code> New sensor reading <code>experiment.started</code> Experiment started <code>experiment.stopped</code> Experiment stopped <code>system.health_changed</code> System health changed"},{"location":"api/schemas/#webhookdeliverystatus","title":"WebhookDeliveryStatus","text":"Value Description <code>pending</code> Pending delivery <code>delivered</code> Successfully delivered <code>failed</code> Delivery failed <code>dead_letter</code> Permanently failed"},{"location":"api/schemas/#updatestatus","title":"UpdateStatus","text":"Value Description <code>pending</code> Awaiting action <code>downloading</code> Downloading firmware <code>verifying</code> Verifying integrity <code>applying</code> Applying update <code>completed</code> Successfully applied <code>failed</code> Update failed <code>rolled_back</code> Rolled back to previous version"},{"location":"api/schemas/#plugins","title":"Plugins","text":""},{"location":"api/schemas/#pluginmetaresponse","title":"PluginMetaResponse","text":"<p>Describes an available plugin type discovered on the controller.</p> Field Type Description <code>id</code> <code>string</code> Unique plugin identifier (e.g. <code>system_monitor</code>) <code>name</code> <code>string</code> Human-readable display name <code>version</code> <code>string</code> Semantic version (<code>1.0.0</code>) <code>vendor</code> <code>string</code> Author or organisation <code>description</code> <code>string</code> Short summary of the plugin <code>url</code> <code>string \\| null</code> Project / documentation URL"},{"location":"api/schemas/#plugininstancecreate","title":"PluginInstanceCreate","text":"Field Type Required Default Description <code>plugin_id</code> <code>string</code> \u2705 \u2014 Must match an available plugin <code>id</code> (1\u2013100 chars) <code>instance_name</code> <code>string</code> \u2705 \u2014 Descriptive label (1\u2013255 chars) <code>demo_mode</code> <code>boolean</code> \u2014 <code>false</code> Run with simulated data <code>enabled</code> <code>boolean</code> \u2014 <code>true</code> Start the instance immediately <code>config_json</code> <code>object \\| null</code> \u2014 <code>null</code> Plugin-specific configuration"},{"location":"api/schemas/#plugininstanceupdate","title":"PluginInstanceUpdate","text":"<p>All fields are optional \u2014 only supplied fields are changed.</p> Field Type Description <code>instance_name</code> <code>string</code> New display name (1\u2013255 chars) <code>demo_mode</code> <code>boolean</code> Toggle simulated data <code>enabled</code> <code>boolean</code> Enable / disable the instance <code>config_json</code> <code>object \\| null</code> Replace configuration"},{"location":"api/schemas/#plugininstanceresponse","title":"PluginInstanceResponse","text":"Field Type Description <code>public_id</code> <code>string (uuid)</code> Unique identifier <code>plugin_id</code> <code>string</code> Plugin type this instance runs <code>instance_name</code> <code>string</code> Display name <code>demo_mode</code> <code>boolean</code> Whether simulated data is used <code>enabled</code> <code>boolean</code> Whether the instance is active <code>status</code> <code>PluginStatus</code> Current runtime status <code>config_json</code> <code>object \\| null</code> Plugin-specific config <code>error_message</code> <code>string \\| null</code> Last error, if any <code>created_on</code> <code>string (datetime)</code> Creation timestamp (UTC) <code>updated_on</code> <code>string (datetime)</code> Last modification (UTC) <code>user_public_id</code> <code>string (uuid)</code> Owner who created the instance <code>channel_mappings</code> <code>ChannelMappingResponse[]</code> Mapped channels"},{"location":"api/schemas/#channelmappingcreate","title":"ChannelMappingCreate","text":"Field Type Required Default Description <code>channel_id</code> <code>string</code> \u2705 \u2014 Channel identifier from the plugin (1\u2013100 chars) <code>channel_name</code> <code>string</code> \u2705 \u2014 Display name (1\u2013255 chars) <code>direction</code> <code>ChannelDirection</code> \u2705 \u2014 Data-flow direction <code>unit</code> <code>string</code> \u2705 \u2014 Engineering unit (1\u201350 chars, e.g. <code>\u00b0C</code>) <code>event_public_id</code> <code>string (uuid) \\| null</code> \u2014 <code>null</code> Link to an existing event"},{"location":"api/schemas/#channelmappingupdate","title":"ChannelMappingUpdate","text":"Field Type Description <code>event_public_id</code> <code>string (uuid) \\| null</code> Link or unlink an event"},{"location":"api/schemas/#channelmappingresponse","title":"ChannelMappingResponse","text":"Field Type Description <code>public_id</code> <code>string (uuid)</code> Unique identifier <code>channel_id</code> <code>string</code> Plugin-side channel key <code>channel_name</code> <code>string</code> Display name <code>direction</code> <code>ChannelDirection</code> <code>input</code>, <code>output</code>, or <code>bidirectional</code> <code>unit</code> <code>string</code> Engineering unit <code>event_public_id</code> <code>string (uuid) \\| null</code> Linked event, if any <code>created_on</code> <code>string (datetime)</code> Creation timestamp (UTC)"},{"location":"api/schemas/#pluginpackageresponse","title":"PluginPackageResponse","text":"Field Type Description <code>public_id</code> <code>string (uuid)</code> Unique identifier <code>package_name</code> <code>string</code> Python package name <code>version</code> <code>string</code> Package version <code>source</code> <code>PluginSource</code> How the package was installed <code>plugin_ids</code> <code>string[]</code> Plugin IDs provided by this package <code>file_size_bytes</code> <code>integer \\| null</code> Size of the uploaded wheel <code>installed_on</code> <code>string (datetime)</code> Installation timestamp (UTC) <code>removable</code> <code>boolean</code> <code>true</code> for uploaded packages"},{"location":"api/schemas/#plugin-enums","title":"Plugin Enums","text":""},{"location":"api/schemas/#pluginstatus","title":"PluginStatus","text":"Value Description <code>inactive</code> Instance exists but is not running <code>connected</code> Running and operating normally <code>error</code> A runtime error occurred <code>demo</code> Running with simulated data"},{"location":"api/schemas/#channeldirection","title":"ChannelDirection","text":"Value Description <code>input</code> Data flows into WebMACS (sensor) <code>output</code> Data flows out of WebMACS (actuator) <code>bidirectional</code> Both directions"},{"location":"api/schemas/#pluginsource","title":"PluginSource","text":"Value Description <code>bundled</code> Shipped with WebMACS <code>uploaded</code> Installed via package upload"},{"location":"api/schemas/#next-steps","title":"Next Steps","text":"<ul> <li>REST API \u2014 how schemas are used in endpoints</li> <li>WebSocket API \u2014 real-time protocol reference</li> <li>Backend Architecture \u2014 code structure</li> </ul>"},{"location":"api/websocket/","title":"WebSocket API","text":"<p>WebMACS uses WebSockets for real-time sensor data streaming between the IoT controller, backend, and browser dashboards.</p>"},{"location":"api/websocket/#endpoints","title":"Endpoints","text":"Endpoint Direction Purpose <code>/ws/controller/telemetry</code> Controller \u2192 Backend Push sensor readings in batches <code>/ws/datapoints/stream</code> Backend \u2192 Browser Live dashboard updates <p>Both endpoints are mounted under the <code>/ws/</code> prefix.</p>"},{"location":"api/websocket/#authentication","title":"Authentication","text":"<p>All WebSocket endpoints require a valid JWT token passed as a query parameter:</p> <pre><code>ws://your-host/ws/controller/telemetry?token=&lt;jwt&gt;\nwss://your-host/ws/datapoints/stream?token=&lt;jwt&gt;\n</code></pre> <p>Token required</p> <p>Connections without a valid token are immediately closed with code 1008 (Policy Violation) and one of:</p> <ul> <li><code>\"Authentication required\"</code> \u2014 no token provided</li> <li><code>\"Invalid or expired token\"</code> \u2014 JWT decoding failed</li> <li><code>\"Token has been revoked\"</code> \u2014 token was blacklisted (user logged out)</li> <li><code>\"User not found\"</code> \u2014 user deleted after token issued</li> </ul>"},{"location":"api/websocket/#controller-telemetry-wscontrollertelemetry","title":"Controller Telemetry \u2014 <code>/ws/controller/telemetry</code>","text":"<p>This endpoint receives batches of sensor readings from the IoT controller and persists them.</p>"},{"location":"api/websocket/#inbound-message-format","title":"Inbound Message Format","text":"<pre><code>{\n  \"datapoints\": [\n    { \"value\": 23.5, \"event_public_id\": \"abc-123\" },\n    { \"value\": 1013.2, \"event_public_id\": \"def-456\" },\n    { \"value\": 7.14, \"event_public_id\": \"ghi-789\" }\n  ]\n}\n</code></pre> Field Type Required Description <code>datapoints</code> array Yes Batch of readings <code>datapoints[].value</code> number Yes Sensor reading value <code>datapoints[].event_public_id</code> string (UUID) Yes Matches an Event's <code>public_id</code>"},{"location":"api/websocket/#processing-pipeline","title":"Processing Pipeline","text":"<p>For each valid batch, the backend:</p> <ol> <li>Validates each datapoint (must have <code>value</code> and <code>event_public_id</code>)</li> <li>Persists to PostgreSQL (bulk <code>INSERT</code> with <code>experiment_public_id</code> from active experiment)</li> <li>Evaluates rules \u2014 checks all threshold rules against each datapoint value</li> <li>Dispatches webhooks \u2014 fires <code>sensor_reading</code> webhook events</li> <li>Broadcasts to all connected frontends (see below)</li> </ol>"},{"location":"api/websocket/#error-response","title":"Error Response","text":"<p>If no valid datapoints are found in a batch:</p> <pre><code>{ \"type\": \"error\", \"message\": \"No valid datapoints in batch\" }\n</code></pre>"},{"location":"api/websocket/#datapoint-stream-wsdatapointsstream","title":"Datapoint Stream \u2014 <code>/ws/datapoints/stream</code>","text":"<p>This is a read-only subscription endpoint for browser dashboards. Clients connect and receive real-time broadcasts.</p>"},{"location":"api/websocket/#connection-flow","title":"Connection Flow","text":"<pre><code>Browser                         Backend\n  \u2502                                \u2502\n  \u2502\u2500\u2500\u2500\u2500 WebSocket connect \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502     ?token=&lt;jwt&gt;               \u2502\n  \u2502                                \u2502\n  \u2502\u25c4\u2500\u2500\u2500 { type: \"connected\" } \u2500\u2500\u2500\u2500\u2502  (1) confirmation\n  \u2502                                \u2502\n  \u2502     { type: \"ping\" }  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  (2) keep-alive (optional)\n  \u2502\u25c4\u2500\u2500\u2500 { type: \"pong\" }  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n  \u2502                                \u2502\n  \u2502\u25c4\u2500\u2500\u2500 datapoints_batch \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  (3) live data\n  \u2502\u25c4\u2500\u2500\u2500 datapoints_batch \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n  \u2502     ...                        \u2502\n</code></pre>"},{"location":"api/websocket/#1-connection-confirmation","title":"1. Connection Confirmation","text":"<p>Immediately after authentication, the server sends:</p> <pre><code>{\n  \"type\": \"connected\",\n  \"message\": \"Subscribed to live datapoint stream.\"\n}\n</code></pre>"},{"location":"api/websocket/#2-keep-alive-pingpong","title":"2. Keep-Alive (Ping/Pong)","text":"<p>Clients can send periodic pings to prevent connection timeouts:</p> <pre><code>{ \"type\": \"ping\" }\n</code></pre> <p>Server responds:</p> <pre><code>{ \"type\": \"pong\" }\n</code></pre> <p>Frontend default</p> <p>The built-in Vue frontend sends a ping every 25 seconds.</p>"},{"location":"api/websocket/#3-broadcast-messages","title":"3. Broadcast Messages","text":"<p>When the controller pushes new sensor data, all connected frontends receive:</p> <pre><code>{\n  \"type\": \"datapoints_batch\",\n  \"datapoints\": [\n    {\n      \"value\": 23.5,\n      \"event_public_id\": \"abc-123\",\n      \"timestamp\": \"2025-01-15T14:30:00.123456\",\n      \"experiment_public_id\": \"exp-001\"\n    },\n    {\n      \"value\": 1013.2,\n      \"event_public_id\": \"def-456\",\n      \"timestamp\": \"2025-01-15T14:30:00.123456\",\n      \"experiment_public_id\": \"exp-001\"\n    }\n  ]\n}\n</code></pre> Field Type Description <code>type</code> string Always <code>\"datapoints_batch\"</code> <code>datapoints</code> array Array of persisted datapoints <code>datapoints[].value</code> number Sensor reading <code>datapoints[].event_public_id</code> string Event UUID <code>datapoints[].timestamp</code> string ISO 8601 timestamp <code>datapoints[].experiment_public_id</code> string | null Active experiment UUID, or <code>null</code> if none"},{"location":"api/websocket/#connection-manager","title":"Connection Manager","text":"<p>The backend uses a pub/sub connection manager with named groups:</p> Group Members Purpose <code>\"controller\"</code> IoT controller(s) Data ingestion <code>\"frontend\"</code> Browser clients Data consumption <p>The <code>broadcast(\"frontend\", payload)</code> call sends to all connected browsers simultaneously.</p>"},{"location":"api/websocket/#frontend-fallback-strategy","title":"Frontend Fallback Strategy","text":"<p>The Vue frontend implements WebSocket-first with automatic HTTP polling fallback:</p> <ol> <li>Attempts WebSocket connection to <code>/ws/datapoints/stream</code></li> <li>After 3 consecutive failures, falls back to <code>GET /api/v1/datapoints/latest</code> every 1500ms</li> <li>When WebSocket reconnects, polling is automatically stopped</li> </ol> <pre><code>type ConnectionMode = 'websocket' | 'polling' | 'connecting'\n</code></pre>"},{"location":"api/websocket/#nginx-proxy-configuration","title":"Nginx Proxy Configuration","text":"<p>For production, Nginx must proxy WebSocket connections:</p> <pre><code>location /ws/ {\n    proxy_pass http://backend:8000;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"upgrade\";\n    proxy_set_header Host $host;\n    proxy_read_timeout 86400;  # 24h \u2014 prevent premature close\n}\n</code></pre>"},{"location":"api/websocket/#next-steps","title":"Next Steps","text":"<ul> <li>Backend Architecture \u2014 application structure</li> <li>REST API \u2014 HTTP endpoint reference</li> <li>Schema Reference \u2014 request/response models</li> </ul>"},{"location":"architecture/backend/","title":"Backend Architecture","text":"<p>The backend is a FastAPI application with async SQLAlchemy, structured as a Python package: <code>webmacs_backend</code>.</p>"},{"location":"architecture/backend/#package-structure","title":"Package Structure","text":"<pre><code>backend/src/webmacs_backend/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 main.py              # Application factory + lifespan\n\u251c\u2500\u2500 config.py            # pydantic-settings Settings\n\u251c\u2500\u2500 database.py          # Engine, session, init_db\n\u251c\u2500\u2500 models.py            # SQLAlchemy ORM models (15 tables)\n\u251c\u2500\u2500 schemas.py           # Pydantic v2 request/response schemas\n\u251c\u2500\u2500 enums.py             # StrEnum definitions (EventType, StatusType, etc.)\n\u251c\u2500\u2500 security.py          # JWT + bcrypt helpers\n\u251c\u2500\u2500 dependencies.py      # FastAPI Depends() factories\n\u251c\u2500\u2500 repository.py        # Generic async CRUD helpers (paginate, get_or_404)\n\u251c\u2500\u2500 api/\n\u2502   \u2514\u2500\u2500 v1/\n\u2502       \u251c\u2500\u2500 auth.py          # POST /auth/login, /logout, GET /me\n\u2502       \u251c\u2500\u2500 users.py         # CRUD /users\n\u2502       \u251c\u2500\u2500 experiments.py   # CRUD /experiments + CSV export\n\u2502       \u251c\u2500\u2500 events.py        # CRUD /events\n\u2502       \u251c\u2500\u2500 datapoints.py    # CRUD /datapoints + /series + /latest\n\u2502       \u251c\u2500\u2500 logging.py       # CRUD /logs\n\u2502       \u251c\u2500\u2500 rules.py         # CRUD /rules (automation engine)\n\u2502       \u251c\u2500\u2500 webhooks.py      # CRUD /webhooks + deliveries\n\u2502       \u251c\u2500\u2500 ota.py           # CRUD /ota + apply/rollback/check/upload\n\u2502       \u251c\u2500\u2500 dashboards.py    # CRUD /dashboards + widgets\n\u2502       \u251c\u2500\u2500 plugins.py       # Plugin discovery, instances, channels, packages\n\u2502       \u2514\u2500\u2500 health.py        # GET /health\n\u251c\u2500\u2500 services/\n\u2502   \u251c\u2500\u2500 ingestion.py           # Shared datapoint ingestion pipeline\n\u2502   \u251c\u2500\u2500 webhook_dispatcher.py  # HMAC-signed webhook delivery\n\u2502   \u251c\u2500\u2500 rule_evaluator.py      # Threshold-based rule engine\n\u2502   \u251c\u2500\u2500 ota_service.py         # Firmware update management\n\u2502   \u251c\u2500\u2500 updater.py             # System update application\n\u2502   \u251c\u2500\u2500 log_service.py         # Logging service\n\u2502   \u2514\u2500\u2500 wheel_validator.py     # Plugin wheel upload validation\n\u251c\u2500\u2500 middleware/\n\u2502   \u251c\u2500\u2500 rate_limit.py          # Request rate limiting\n\u2502   \u2514\u2500\u2500 request_id.py          # X-Request-ID header injection\n\u2514\u2500\u2500 ws/\n    \u251c\u2500\u2500 connection_manager.py  # Pub/sub hub for WS groups\n    \u2514\u2500\u2500 endpoints.py           # /ws/controller/telemetry, /ws/datapoints/stream\n</code></pre>"},{"location":"architecture/backend/#application-lifecycle","title":"Application Lifecycle","text":"<pre><code>@asynccontextmanager\nasync def lifespan(app: FastAPI) -&gt; AsyncGenerator[None]:\n    await init_db()          # Create tables\n    await _seed_admin()      # Seed admin if no users exist\n    yield\n    await engine.dispose()   # Clean shutdown\n</code></pre> <p>The <code>lifespan</code> context manager runs once at startup and shutdown. It replaces the deprecated <code>on_event</code> hooks.</p>"},{"location":"architecture/backend/#configuration","title":"Configuration","text":"<p>All settings are loaded from environment variables via pydantic-settings:</p> <pre><code>class Settings(BaseSettings):\n    database_url: str\n    secret_key: str\n    env: str = \"development\"\n    rate_limit_per_minute: int = 300\n    ws_heartbeat_interval: int = 30\n    github_repo: str = \"stefanposs/webmacs\"\n    # ...\n</code></pre> <p>See Environment Variables for the complete list.</p>"},{"location":"architecture/backend/#api-routers","title":"API Routers","text":"<p>All eleven routers are mounted under <code>/api/v1/</code>:</p> Router Prefix Auth Key Endpoints <code>auth</code> <code>/auth</code> Public / JWT <code>POST /login</code>, <code>POST /logout</code>, <code>GET /me</code> <code>users</code> <code>/users</code> Admin CRUD <code>experiments</code> <code>/experiments</code> JWT CRUD, <code>PUT /{id}/stop</code>, <code>GET /{id}/export/csv</code> <code>events</code> <code>/events</code> JWT CRUD <code>datapoints</code> <code>/datapoints</code> JWT CRUD, <code>POST /batch</code>, <code>POST /series</code>, <code>GET /latest</code> <code>logging</code> <code>/logs</code> JWT CRUD, mark read <code>rules</code> <code>/rules</code> Admin CRUD (threshold-based automation) <code>webhooks</code> <code>/webhooks</code> Admin CRUD + <code>GET /{id}/deliveries</code> <code>ota</code> <code>/ota</code> Admin CRUD, <code>POST /{id}/apply</code>, <code>POST /{id}/rollback</code>, <code>GET /check</code>, <code>POST /upload</code> <code>dashboards</code> <code>/dashboards</code> JWT CRUD + widget CRUD (nested) <code>plugins</code> <code>/plugins</code> JWT / Admin Discovery, instance CRUD, channel mappings, package upload"},{"location":"architecture/backend/#generic-repository-layer","title":"Generic Repository Layer","text":"<p>The backend uses a generic repository module (<code>repository.py</code>) to eliminate CRUD boilerplate:</p> <pre><code>async def paginate[M, S](db, model, schema, page, page_size, base_query=None) -&gt; PaginatedResponse[S]:\n    \"\"\"Generic paginated query with automatic count.\"\"\"\n\nasync def get_or_404(db, model, public_id, entity_name) -&gt; M:\n    \"\"\"Fetch by public_id or raise 404.\"\"\"\n\nasync def delete_by_public_id(db, model, public_id, entity_name) -&gt; StatusResponse:\n    \"\"\"Delete by public_id or raise 404.\"\"\"\n</code></pre> <p>All routers share these helpers, keeping endpoint code focused on business logic.</p>"},{"location":"architecture/backend/#datapoint-ingestion-pipeline","title":"Datapoint Ingestion Pipeline","text":"<p>All incoming datapoints \u2014 whether via REST (<code>POST /datapoints</code>) or WebSocket (<code>/ws/controller/telemetry</code>) \u2014 pass through a single shared pipeline in <code>services/ingestion.py</code>:</p> <pre><code>flowchart LR\n    REST[\"REST API&lt;br/&gt;POST /datapoints\"] --&gt; Ingest[\"ingest_datapoints()\"]\n    WS[\"WebSocket&lt;br/&gt;/ws/controller/telemetry\"] --&gt; Ingest\n    Ingest --&gt; Filter[\"Filter by&lt;br/&gt;active plugin events\"]\n    Filter --&gt; DB[\"Persist to DB\"]\n    DB --&gt; Webhooks[\"Fire webhooks\"]\n    DB --&gt; Rules[\"Evaluate rules\"]\n    DB --&gt; Broadcast[\"WS broadcast&lt;br/&gt;to dashboards\"]</code></pre> <p>This eliminates code duplication and guarantees consistent behaviour across both ingestion paths. Key components:</p> Function Purpose <code>active_plugin_event_ids(db)</code> Returns event IDs that belong to an enabled, connected plugin <code>active_experiment_id(db)</code> Returns the currently running experiment ID (if any) <code>ingest_datapoints(db, items)</code> Validates, persists, and triggers side-effects for a batch of datapoints <p>The pipeline also guards against phantom data \u2014 datapoints submitted for events whose plugin is disabled or disconnected are silently filtered out.</p>"},{"location":"architecture/backend/#security","title":"Security","text":"<ul> <li>bcrypt for password hashing (via <code>bcrypt</code> package directly)</li> <li>JWT tokens with <code>python-jose</code> (HS256, 24h expiry)</li> <li><code>get_current_user</code> dependency validates token on every protected route</li> <li>Admin-only routes check <code>user.admin == True</code></li> <li>Token blacklisting on logout via <code>blacklist_tokens</code> table</li> <li>Rate limiting middleware (configurable per-minute limit)</li> </ul>"},{"location":"architecture/backend/#next-steps","title":"Next Steps","text":"<ul> <li>WebSocket Design \u2014 real-time data streaming</li> <li>Database Layer \u2014 ORM models and repository helpers</li> <li>REST API Reference \u2014 endpoint documentation</li> <li>User Guide: Rules \u2014 automation engine for engineers</li> </ul>"},{"location":"architecture/controller/","title":"Controller Architecture","text":"<p>The IoT Controller is a headless Python agent that reads sensor data and pushes it to the backend.</p>"},{"location":"architecture/controller/#package-structure","title":"Package Structure","text":"<pre><code>controller/src/webmacs_controller/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 __main__.py          # Entry point (python -m webmacs_controller)\n\u251c\u2500\u2500 app.py               # Main application loop\n\u251c\u2500\u2500 config.py            # pydantic-settings configuration\n\u251c\u2500\u2500 schemas.py           # Pydantic models for API payloads\n\u2514\u2500\u2500 services/\n    \u251c\u2500\u2500 api_client.py      # HTTPX client with retry + auto-reauth\n    \u251c\u2500\u2500 actuator_manager.py  # Actuator command handling\n    \u251c\u2500\u2500 demo_seeder.py     # Demo event seeding (dev mode)\n    \u251c\u2500\u2500 hardware.py        # HardwareInterface ABC + RevPi/Simulated impls    \u251c\u2500\u2500 plugin_bridge.py   # Load, start, and manage plugin instances    \u251c\u2500\u2500 rule_engine.py     # Valve cycling rule logic\n    \u251c\u2500\u2500 sensor_manager.py  # Sensor reading abstraction\n    \u2514\u2500\u2500 telemetry.py       # TelemetryTransport Protocol (HTTP / WebSocket)\n</code></pre>"},{"location":"architecture/controller/#telemetry-modes","title":"Telemetry Modes","text":"<p>The controller supports two transport modes, selected via <code>WEBMACS_TELEMETRY_MODE</code>:</p>"},{"location":"architecture/controller/#http-mode-default","title":"HTTP Mode (default)","text":"<pre><code>sequenceDiagram\n    Controller-&gt;&gt;+Backend: POST /api/v1/datapoints\n    Backend--&gt;&gt;-Controller: 201 Created</code></pre> <p>Each sensor reading \u2192 one HTTP POST request.</p>"},{"location":"architecture/controller/#websocket-mode","title":"WebSocket Mode","text":"<pre><code>sequenceDiagram\n    Controller-&gt;&gt;+Backend: WS /ws/controller/telemetry\n    Note over Controller,Backend: Persistent connection\n    loop Every poll interval\n        Controller-&gt;&gt;Backend: JSON message\n        Backend--&gt;&gt;Controller: ack\n    end</code></pre> <p>A single persistent WebSocket connection carries all telemetry.</p>"},{"location":"architecture/controller/#transport-protocol","title":"Transport Protocol","text":"<p>The telemetry layer uses a Protocol for pluggability:</p> <pre><code>class TelemetryTransport(Protocol):\n    async def connect(self) -&gt; None: ...\n    async def send(self, payload: dict) -&gt; None: ...\n    async def disconnect(self) -&gt; None: ...\n</code></pre> <p>Implementations:</p> <ul> <li><code>HttpTelemetry</code> \u2014 wraps <code>APIClient.post()</code></li> <li><code>WebSocketTelemetry</code> \u2014 async context manager over <code>websockets</code> library</li> </ul>"},{"location":"architecture/controller/#auto-reauthentication","title":"Auto-Reauthentication","text":"<p>The <code>APIClient</code> handles JWT lifecycle automatically:</p> <ol> <li>Login with configured credentials on startup</li> <li>Store JWT token</li> <li>On any 401 Unauthorized response \u2192 re-login and retry</li> <li>Exponential backoff on repeated failures</li> </ol>"},{"location":"architecture/controller/#sensor-manager","title":"Sensor Manager","text":"<p>In development mode (<code>WEBMACS_ENV=development</code>), the <code>SensorManager</code> generates dummy data \u2014 sinusoidal waves, random noise, etc. In production mode, it reads from the RevPi via <code>revpimodio2</code>.</p>"},{"location":"architecture/controller/#configuration","title":"Configuration","text":"<pre><code>class ControllerSettings(BaseSettings):\n    webmacs_env: str = \"development\"\n    webmacs_server_url: str = \"http://localhost\"\n    webmacs_server_port: int = 8000\n    webmacs_poll_interval: float = 0.5\n    webmacs_telemetry_mode: str = \"http\"  # \"http\" | \"websocket\"\n    webmacs_admin_email: str\n    webmacs_admin_password: str\n</code></pre>"},{"location":"architecture/controller/#plugin-bridge","title":"Plugin Bridge","text":"<p>The PluginBridge (<code>plugin_bridge.py</code>) loads and manages plugin instances on the controller:</p> <ol> <li>Discovery \u2014 scans installed packages for the <code>webmacs.plugins</code> entry-point group via <code>importlib.metadata</code></li> <li>Instantiation \u2014 creates plugin instances from the backend configuration (plugin ID, config JSON, demo mode)</li> <li>Lifecycle \u2014 starts, stops, and monitors plugins; reports status back to the backend</li> <li>Channel I/O \u2014 reads input channels and writes output channels each polling cycle, forwarding values through the telemetry pipeline</li> </ol> <p>Plugins are Python packages that implement the <code>DevicePlugin</code> (async) or <code>SyncDevicePlugin</code> (blocking) abstract base class from the <code>webmacs-plugins-core</code> SDK.</p> <pre><code>flowchart LR\n    Registry[\"Plugin Registry\"] --&gt;|discover| EP[\"Entry Points\"]\n    EP --&gt; P1[\"Plugin A\"]\n    EP --&gt; P2[\"Plugin B\"]\n    Bridge[\"Plugin Bridge\"] --&gt;|start / stop| P1\n    Bridge --&gt;|start / stop| P2\n    P1 --&gt;|channel data| TM[\"Telemetry\"]\n    P2 --&gt;|channel data| TM</code></pre> <p>See the Plugin Development Guide for writing custom plugins.</p>"},{"location":"architecture/controller/#next-steps","title":"Next Steps","text":"<ul> <li>WebSocket Design \u2014 full protocol specification</li> <li>Backend Architecture \u2014 how the backend processes data</li> </ul>"},{"location":"architecture/database/","title":"Database Layer","text":"<p>WebMACS uses PostgreSQL 17 with SQLAlchemy 2.0 async ORM and the asyncpg driver for high-throughput time-series storage.</p>"},{"location":"architecture/database/#connection-setup","title":"Connection Setup","text":"<pre><code># database.py\nengine = create_async_engine(settings.database_url, echo=False)\nasync_session = async_sessionmaker(engine, expire_on_commit=False)\n\nasync def init_db() -&gt; None:\n    async with engine.begin() as conn:\n        await conn.run_sync(Base.metadata.create_all)\n</code></pre> <p>Sessions are injected via <code>Depends(get_db)</code> in every route.</p>"},{"location":"architecture/database/#tables-15","title":"Tables (15)","text":"Table Purpose Key Columns <code>users</code> Admin and operator accounts <code>username</code>, <code>hashed_password</code>, <code>admin</code> <code>events</code> Sensor/channel definitions <code>name</code>, <code>unit</code>, <code>min_value</code>, <code>max_value</code>, <code>event_type</code> <code>experiments</code> Time-bounded data campaigns <code>name</code>, <code>started_on</code>, <code>stopped_on</code> <code>datapoints</code> Time-series sensor readings <code>value</code>, <code>event_public_id</code>, <code>experiment_public_id</code>, <code>timestamp</code> <code>log_entries</code> System and user logs <code>content</code>, <code>logging_type</code>, <code>status_type</code> <code>blacklist_tokens</code> Revoked JWTs (logout) <code>token</code>, <code>blacklisted_on</code> <code>rules</code> Automation threshold triggers <code>event_public_id</code>, <code>operator</code>, <code>threshold</code>, <code>action_type</code> <code>webhooks</code> HTTP callback subscriptions <code>url</code>, <code>secret</code>, <code>events</code> (JSON list), <code>enabled</code> <code>webhook_deliveries</code> Delivery audit trail <code>webhook_id</code>, <code>status</code>, <code>response_code</code>, <code>payload</code> <code>firmware_updates</code> OTA firmware records <code>version</code>, <code>release_notes</code>, <code>file_path</code>, <code>status</code> <code>dashboards</code> Custom dashboard layouts <code>name</code>, <code>is_global</code>, <code>user_public_id</code> <code>dashboard_widgets</code> Widget positioning &amp; config <code>dashboard_id</code>, <code>widget_type</code>, <code>config_json</code>, <code>x</code>, <code>y</code>, <code>w</code>, <code>h</code> <code>plugin_packages</code> Uploaded plugin <code>.whl</code> files <code>package_name</code>, <code>version</code>, <code>source</code>, <code>file_hash_sha256</code> <code>plugin_instances</code> Running plugin configurations <code>plugin_id</code>, <code>instance_name</code>, <code>demo_mode</code>, <code>config_json</code> <code>channel_mappings</code> Plugin channel \u2192 event links <code>instance_id</code>, <code>channel_id</code>, <code>event_public_id</code> <p>All tables use <code>public_id</code> (UUID) as the external-facing identifier and an integer <code>id</code> as the internal primary key.</p>"},{"location":"architecture/database/#model-conventions","title":"Model Conventions","text":"<p>All models inherit from a shared <code>DeclarativeBase</code>. Each model defines its own columns \u2014 there is no shared mixin. Common patterns across most models:</p> <ul> <li><code>id</code> \u2014 auto-incrementing integer primary key</li> <li><code>public_id</code> \u2014 UUID string exposed to the API (external identifier)</li> <li><code>created_on</code> \u2014 server-side timestamp via <code>server_default=func.now()</code></li> </ul> <pre><code>class Base(DeclarativeBase):\n    pass\n\nclass Event(Base):\n    __tablename__ = \"events\"\n\n    id: Mapped[int] = mapped_column(Integer, primary_key=True, autoincrement=True)\n    public_id: Mapped[str] = mapped_column(String(100), unique=True, default=lambda: str(uuid.uuid4()))\n    name: Mapped[str] = mapped_column(String(200), unique=True, nullable=False)\n    # ...\n</code></pre>"},{"location":"architecture/database/#key-indexes","title":"Key Indexes","text":"<pre><code># Composite index for time-series queries (datapoints filtered by event + time)\n__table_args__ = (\n    Index(\"ix_datapoints_event_ts\", \"event_public_id\", \"timestamp\"),\n)\n</code></pre> <p>This composite index dramatically accelerates the most common query pattern: \"give me datapoints for event X between time A and time B.\"</p>"},{"location":"architecture/database/#generic-repository","title":"Generic Repository","text":"<p>Instead of per-model repositories, WebMACS uses a single <code>repository.py</code> with generic async helpers:</p>"},{"location":"architecture/database/#paginatem-s","title":"<code>paginate[M, S]</code>","text":"<pre><code>async def paginate(\n    db: AsyncSession,\n    model: type[M],\n    schema: type[S],\n    page: int,\n    page_size: int,\n    base_query: Select | None = None,\n) -&gt; PaginatedResponse[S]:\n</code></pre> <p>Returns a <code>PaginatedResponse</code> with <code>items</code>, <code>total</code>, <code>page</code>, <code>page_size</code>, and <code>pages</code>. Used by every list endpoint.</p>"},{"location":"architecture/database/#get_or_404","title":"<code>get_or_404</code>","text":"<pre><code>async def get_or_404(\n    db: AsyncSession,\n    model: type[M],\n    public_id: str,\n    entity_name: str = \"Entity\",\n) -&gt; M:\n</code></pre> <p>Loads by <code>public_id</code> or raises <code>HTTPException(404)</code>.</p>"},{"location":"architecture/database/#delete_by_public_id","title":"<code>delete_by_public_id</code>","text":"<pre><code>async def delete_by_public_id(\n    db: AsyncSession,\n    model: type[M],\n    public_id: str,\n    entity_name: str = \"Entity\",\n) -&gt; StatusResponse:\n</code></pre> <p>Deletes by <code>public_id</code> or raises <code>HTTPException(404)</code>. Returns a <code>StatusResponse</code> confirmation.</p>"},{"location":"architecture/database/#conflicterror","title":"<code>ConflictError</code>","text":"<p>Raised when a uniqueness constraint is violated (e.g., duplicate username).</p>"},{"location":"architecture/database/#migrations","title":"Migrations","text":"<p>WebMACS uses Alembic for schema migrations:</p> <pre><code># Generate a migration after changing models\ncd backend\nalembic revision --autogenerate -m \"add dashboard tables\"\n\n# Apply migrations\nalembic upgrade head\n</code></pre> <p>The migration environment is configured in alembic/env.py for async support.</p>"},{"location":"architecture/database/#relationships","title":"Relationships","text":"<pre><code>users \u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500 log_entries (user_public_id)\n           \u251c\u2500\u2500 experiments (implicit, via auth)\n           \u251c\u2500\u2500 dashboards (user_public_id)\n           \u251c\u2500\u2500 rules (user_public_id)\n           \u251c\u2500\u2500 firmware_updates (user_public_id, SET NULL)\n           \u2514\u2500\u2500 plugin_packages (user_public_id, SET NULL)\n\nevents \u2500\u2500\u2500\u2500\u252c\u2500\u2500 datapoints (event_public_id)\n           \u251c\u2500\u2500 rules (event_public_id, CASCADE)\n           \u2514\u2500\u2500 dashboard_widgets (event_public_id, SET NULL)\n\nexperiments \u2500\u2500 datapoints (experiment_public_id, SET NULL)\n\nwebhooks \u2500\u2500 webhook_deliveries (webhook_id, CASCADE)\n\ndashboards \u2500\u2500 dashboard_widgets (dashboard_id, CASCADE)\n\nplugin_instances \u2500\u2500 channel_mappings (instance_id, CASCADE)\n</code></pre> <p>All foreign keys have explicit <code>ondelete</code> directives (<code>CASCADE</code> or <code>SET NULL</code>) to prevent orphaned records.</p>"},{"location":"architecture/database/#next-steps","title":"Next Steps","text":"<ul> <li>Backend Architecture \u2014 where the repository is consumed</li> <li>Schema Reference \u2014 Pydantic models for all tables</li> <li>REST API \u2014 endpoint documentation</li> </ul>"},{"location":"architecture/frontend/","title":"Frontend Architecture","text":"<p>The frontend is a Vue 3 Single Page Application built with TypeScript, PrimeVue 4, and Vite 6.</p>"},{"location":"architecture/frontend/#project-structure","title":"Project Structure","text":"<pre><code>frontend/src/\n\u251c\u2500\u2500 main.ts                 # App bootstrap, plugin registration\n\u251c\u2500\u2500 App.vue                 # Root component (sidebar + router view)\n\u251c\u2500\u2500 router/\n\u2502   \u2514\u2500\u2500 index.ts            # Vue Router routes (12 views + 404)\n\u251c\u2500\u2500 views/\n\u2502   \u251c\u2500\u2500 LoginView.vue       # Public \u2014 JWT authentication\n\u2502   \u251c\u2500\u2500 DashboardView.vue   # Default overview dashboard\n\u2502   \u251c\u2500\u2500 DashboardsView.vue  # Dashboard list (CRUD)\n\u2502   \u251c\u2500\u2500 DashboardCustomView.vue  # User-built widget dashboard\n\u2502   \u251c\u2500\u2500 ExperimentsView.vue # Experiment lifecycle management\n\u2502   \u251c\u2500\u2500 EventsView.vue      # Sensor/channel definitions\n\u2502   \u251c\u2500\u2500 DatapointsView.vue  # Time-series data explorer\n\u2502   \u251c\u2500\u2500 LogsView.vue        # System log viewer\n\u2502   \u251c\u2500\u2500 UsersView.vue       # User management (admin)\n\u2502   \u251c\u2500\u2500 RulesView.vue       # Automation rule builder (admin)\n\u2502   \u251c\u2500\u2500 WebhooksView.vue    # Webhook management (admin)\n\u2502   \u251c\u2500\u2500 OtaView.vue         # Firmware OTA updates (admin)\n\u2502   \u2514\u2500\u2500 NotFoundView.vue    # 404 page\n\u251c\u2500\u2500 components/\n\u2502   \u251c\u2500\u2500 AppSidebar.vue      # Navigation sidebar\n\u2502   \u251c\u2500\u2500 AppTopbar.vue       # Top bar with user menu\n\u2502   \u251c\u2500\u2500 AppToast.vue        # Global toast container\n\u2502   \u2514\u2500\u2500 widgets/\n\u2502       \u251c\u2500\u2500 WidgetWrapper.vue       # Widget chrome (title, edit, delete)\n\u2502       \u251c\u2500\u2500 LineChartWidget.vue     # Time-series line chart\n\u2502       \u251c\u2500\u2500 GaugeWidget.vue         # Radial gauge display\n\u2502       \u251c\u2500\u2500 StatCardWidget.vue      # KPI stat card\n\u2502       \u2514\u2500\u2500 ActuatorToggleWidget.vue # On/off toggle control\n\u251c\u2500\u2500 stores/                 # Pinia state stores (8)\n\u2502   \u251c\u2500\u2500 auth.ts             # JWT token, user info, login/logout\n\u2502   \u251c\u2500\u2500 experiments.ts      # Experiment CRUD + active tracking\n\u2502   \u251c\u2500\u2500 events.ts           # Event/channel CRUD\n\u2502   \u251c\u2500\u2500 datapoints.ts       # Datapoint queries + time-series\n\u2502   \u251c\u2500\u2500 dashboards.ts       # Dashboard + widget CRUD\n\u2502   \u251c\u2500\u2500 rules.ts            # Rule CRUD\n\u2502   \u251c\u2500\u2500 webhooks.ts         # Webhook CRUD + delivery history\n\u2502   \u2514\u2500\u2500 ota.ts              # OTA update management\n\u251c\u2500\u2500 composables/\n\u2502   \u251c\u2500\u2500 useRealtimeDatapoints.ts  # WS-first with HTTP polling fallback\n\u2502   \u251c\u2500\u2500 usePolling.ts             # Generic polling composable\n\u2502   \u251c\u2500\u2500 useNotification.ts       # Toast notification helper\n\u2502   \u2514\u2500\u2500 useFormatters.ts         # Date/number formatting\n\u251c\u2500\u2500 services/\n\u2502   \u251c\u2500\u2500 api.ts              # Axios instance with JWT interceptor\n\u2502   \u2514\u2500\u2500 websocket.ts        # Reconnecting WebSocket client\n\u251c\u2500\u2500 types/\n\u2502   \u2514\u2500\u2500 index.ts            # TypeScript interfaces + enums\n\u2514\u2500\u2500 assets/\n    \u2514\u2500\u2500 main.css            # Global styles\n</code></pre>"},{"location":"architecture/frontend/#state-management-pinia","title":"State Management \u2014 Pinia","text":"<p>Eight stores manage application state, each corresponding to a backend resource:</p> Store Key State Key Actions <code>auth</code> <code>user</code>, <code>token</code>, <code>isAuthenticated</code> <code>login()</code>, <code>logout()</code>, <code>fetchMe()</code> <code>experiments</code> <code>experiments</code>, <code>activeExperiment</code> <code>fetchAll()</code>, <code>create()</code>, <code>stop()</code>, <code>exportCsv()</code> <code>events</code> <code>events</code> <code>fetchAll()</code>, <code>create()</code>, <code>update()</code>, <code>delete()</code> <code>datapoints</code> <code>datapoints</code>, <code>series</code> <code>fetchAll()</code>, <code>fetchSeries()</code>, <code>fetchLatest()</code> <code>dashboards</code> <code>dashboards</code>, <code>currentDashboard</code> <code>fetchAll()</code>, <code>createWidget()</code>, <code>updateWidget()</code> <code>rules</code> <code>rules</code> <code>fetchAll()</code>, <code>create()</code>, <code>update()</code>, <code>toggleActive()</code> <code>webhooks</code> <code>webhooks</code>, <code>deliveries</code> <code>fetchAll()</code>, <code>create()</code>, <code>fetchDeliveries()</code> <code>ota</code> <code>updates</code>, <code>checking</code> <code>fetchAll()</code>, <code>checkForUpdate()</code>, <code>applyUpdate()</code>"},{"location":"architecture/frontend/#real-time-data-userealtimedatapoints","title":"Real-Time Data \u2014 <code>useRealtimeDatapoints</code>","text":"<p>The core composable implements a WebSocket-first strategy with automatic HTTP polling fallback:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    Connected     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  connecting  \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502  websocket   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502 3 failures                      \u2502 disconnect\n       \u25bc                                 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502\n\u2502   polling    \u2502 \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   WS reconnects \u2192 back to 'websocket'\n</code></pre> <ul> <li>Default poll interval: 1500ms (configurable)</li> <li>WS max failures before fallback: 3 attempts</li> <li>WS reconnect: Exponential back-off (1s \u2192 30s max)</li> <li>WS keep-alive: Ping every 25s</li> </ul> <pre><code>type ConnectionMode = 'websocket' | 'polling' | 'connecting'\n\nconst { latestDatapoints, connectionMode, isConnected } = useRealtimeDatapoints()\n</code></pre>"},{"location":"architecture/frontend/#websocket-client","title":"WebSocket Client","text":"<p>The <code>WebSocketClient</code> class in <code>services/websocket.ts</code> is a generic reconnecting wrapper:</p> <ul> <li>Auto-reconnect with exponential back-off (1s initial, 30s max)</li> <li>Ping/pong keep-alive (25s interval)</li> <li>Protocol auto-detection (<code>ws:</code> / <code>wss:</code> based on page protocol)</li> <li>Clean dispose for component unmount</li> </ul>"},{"location":"architecture/frontend/#dashboard-widgets","title":"Dashboard Widgets","text":"<p>The custom dashboard system uses a 12-column CSS grid with size presets:</p> Widget Type Enum Purpose <code>LineChartWidget</code> <code>line_chart</code> Time-series chart (Chart.js) <code>GaugeWidget</code> <code>gauge</code> Radial gauge for single values <code>StatCardWidget</code> <code>stat_card</code> KPI card with current value <code>ActuatorToggleWidget</code> <code>actuator_toggle</code> On/off toggle control <p>Each widget has a JSON <code>config</code> object and grid position (<code>x</code>, <code>y</code>, <code>w</code>, <code>h</code>).</p>"},{"location":"architecture/frontend/#api-service","title":"API Service","text":"<p>All HTTP requests go through a single Axios instance (<code>services/api.ts</code>):</p> <ul> <li>Base URL: <code>/api/v1/</code> (proxied by Vite dev server or Nginx)</li> <li>JWT interceptor: Attaches <code>Authorization: Bearer &lt;token&gt;</code> to every request</li> <li>401 handling: Auto-logout on expired tokens</li> <li>Error transform: Normalizes API errors for toast notifications</li> </ul>"},{"location":"architecture/frontend/#routing","title":"Routing","text":"<p>Vue Router with navigation guards:</p> <ul> <li>Public routes: <code>/login</code></li> <li>Protected routes: Everything else (redirects to <code>/login</code> if no token)</li> <li>Admin routes: Users, Rules, Webhooks, OTA (hidden from non-admins)</li> <li>404 catch-all: <code>NotFoundView</code></li> </ul>"},{"location":"architecture/frontend/#ui-framework-primevue-4","title":"UI Framework \u2014 PrimeVue 4","text":"<ul> <li>Theme: Aura Dark (customized via CSS variables)</li> <li>Key components: DataTable, Dialog, Chart, InputNumber, Dropdown, Toast, Sidebar</li> <li>Accessibility: ARIA labels on all icon-only buttons</li> </ul>"},{"location":"architecture/frontend/#next-steps","title":"Next Steps","text":"<ul> <li>WebSocket Protocol \u2014 message formats and authentication</li> <li>Dashboard Guide \u2014 creating custom dashboards</li> <li>REST API \u2014 backend endpoints</li> </ul>"},{"location":"architecture/overview/","title":"System Architecture","text":"<p>WebMACS is a four-component system for real-time sensor monitoring, data acquisition, and process automation.</p>"},{"location":"architecture/overview/#high-level-diagram","title":"High-Level Diagram","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Nginx Reverse Proxy                     \u2502\n\u2502                  (TLS termination, WebSocket upgrade)            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                     \u2502                  \u2502                        \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502   \u2502  Frontend    \u2502   \u2502  \u2502  Backend   \u2502  \u2502  \u2502  PostgreSQL 17   \u2502 \u2502\n\u2502   \u2502  Vue 3 SPA   \u2502\u25c4\u2500\u253c\u2500\u25ba\u2502  FastAPI   \u2502\u25c4\u2500\u253c\u2500\u25ba\u2502  15 tables       \u2502 \u2502\n\u2502   \u2502  PrimeVue 4  \u2502   \u2502  \u2502  11 routes \u2502  \u2502  \u2502  async (asyncpg) \u2502 \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                     \u2502        \u2502 WS      \u2502                        \u2502\n\u2502                     \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502                        \u2502\n\u2502                     \u2502  \u2502 Controller \u2502  \u2502                        \u2502\n\u2502                     \u2502  \u2502 RevPi HW   \u2502  \u2502                        \u2502\n\u2502                     \u2502  \u2502 + Plugins  \u2502  \u2502                        \u2502\n\u2502                     \u2502  \u2502 Python 3.13\u2502  \u2502                        \u2502\n\u2502                     \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                               \u2502\n                     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                     \u2502  External / HW   \u2502\n                     \u2502  \u2022 Plugin I/O    \u2502\n                     \u2502  \u2022 Webhooks      \u2502\n                     \u2502  \u2022 GitHub OTA    \u2502\n                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/overview/#four-components","title":"Four Components","text":""},{"location":"architecture/overview/#1-frontend-vue-3-single-page-application","title":"1. Frontend \u2014 Vue 3 Single Page Application","text":"Aspect Detail Framework Vue 3 (Composition API) + TypeScript 5.7 UI Library PrimeVue 4 (Aura Dark theme) State Pinia \u2014 8 stores Views 12 views + 404 page Real-time Native WebSocket with automatic reconnection Build Vite 6, served as static files via Nginx <p>See Frontend Architecture.</p>"},{"location":"architecture/overview/#2-backend-fastapi-rest-websocket-server","title":"2. Backend \u2014 FastAPI REST + WebSocket Server","text":"Aspect Detail Framework FastAPI + Uvicorn (async) Language Python 3.13 ORM SQLAlchemy 2.0 (async) Schemas Pydantic v2 Auth JWT (HS256, 24h) + bcrypt API Routers 11 (auth, users, experiments, events, datapoints, logging, rules, webhooks, ota, dashboards, plugins) Services Webhook dispatcher, Rule evaluator, OTA manager, Plugin manager <p>See Backend Architecture.</p>"},{"location":"architecture/overview/#3-controller-revpi-hardware-bridge","title":"3. Controller \u2014 RevPi Hardware Bridge","text":"Aspect Detail Role Reads sensors, pushes data to backend via WebSocket Language Python 3.13 (async) Protocol WebSocket client \u2192 backend <code>/ws/controller/telemetry</code> Hardware RevPi Connect / DIO / AIO via <code>revpimodio2</code> Plugins Extensible via Plugin SDK \u2014 custom device drivers, system monitoring, simulated devices <p>See Controller Architecture.</p>"},{"location":"architecture/overview/#4-postgresql-database","title":"4. PostgreSQL Database","text":"Aspect Detail Version PostgreSQL 17 Driver <code>asyncpg</code> (fully async) Tables 15 (users, events, experiments, datapoints, log_entries, blacklist_tokens, rules, webhooks, webhook_deliveries, firmware_updates, dashboards, dashboard_widgets, plugin_instances, channel_mappings, plugin_packages) Key composite index on <code>(event_public_id, created_on)</code> for time-series queries <p>See Database Layer.</p>"},{"location":"architecture/overview/#data-flow","title":"Data Flow","text":"<pre><code>Sensor \u2192 Controller \u2192 WS (batch JSON) \u2192 Backend \u2192 DB (INSERT)\n                          \u2502                    \u2502\n                  Plugin Bridge                \u251c\u2500\u2500\u25ba WS broadcast \u2192 Frontend (live chart)\n                  (custom I/O)                 \u251c\u2500\u2500\u25ba Rule evaluator \u2192 trigger actions\n                                               \u2514\u2500\u2500\u25ba Webhook dispatcher \u2192 external APIs\n</code></pre>"},{"location":"architecture/overview/#step-by-step","title":"Step-by-step","text":"<ol> <li>Controller reads sensor values from RevPi hardware at a configured poll interval.</li> <li>Controller sends a batch of datapoints over WebSocket to the backend:    <pre><code>{\"datapoints\": [{\"value\": 23.5, \"event_public_id\": \"abc-123\"}, ...]}\n</code></pre></li> <li>Backend validates, persists to PostgreSQL, and triggers three side-effects:<ul> <li>Broadcast to all connected dashboards via WebSocket.</li> <li>Rule evaluation against threshold-based rules (e.g., \"if temperature &gt; 80\u00b0C, send alert\").</li> <li>Webhook dispatch if subscribed events match.</li> </ul> </li> <li>Frontend receives the broadcast and updates live charts in real-time with no page reload.</li> <li>Plugin bridge (optional): The controller loads third-party device plugins that read additional I/O sources (system metrics, custom hardware, simulated data) and feed their channels into the same telemetry pipeline.</li> </ol>"},{"location":"architecture/overview/#technology-decisions","title":"Technology Decisions","text":"Decision Choice Rationale Python 3.13 Backend + Controller Native async, type-hinting, modern stdlib FastAPI Web framework Best-in-class async Python, auto-generated OpenAPI SQLAlchemy 2.0 ORM Async-first, 2.0 style uses <code>select()</code> instead of legacy query asyncpg DB driver Fastest PostgreSQL driver for Python async Vue 3 + TS Frontend Composition API for clean composable logic PrimeVue 4 UI Rich component library with accessible dark theme WebSocket Real-time Low latency bidirectional, native browser support Docker Compose Deployment One-command production deployment Alembic Migrations De-facto standard for SQLAlchemy schema migrations"},{"location":"architecture/overview/#deployment-model","title":"Deployment Model","text":"<p>WebMACS ships as a Docker Compose stack:</p> <pre><code>services:\n  backend:    # FastAPI + Uvicorn\n  frontend:   # Nginx serving built Vue SPA\n  db:         # PostgreSQL 17\n  # controller runs on RevPi hardware (optional)\n</code></pre> <p>See Docker Deployment for full setup.</p>"},{"location":"architecture/websocket/","title":"WebSocket Design","text":"<p>WebMACS uses WebSockets for two real-time channels: controller telemetry and frontend data streaming.</p>"},{"location":"architecture/websocket/#endpoints","title":"Endpoints","text":"Endpoint Direction Purpose <code>/ws/controller/telemetry</code> Controller \u2192 Backend Push sensor readings <code>/ws/datapoints/stream</code> Backend \u2192 Frontend Broadcast new datapoints"},{"location":"architecture/websocket/#architecture","title":"Architecture","text":"<pre><code>graph LR\n    Controller --&gt;|\"WS /ws/controller/telemetry\"| WS_Hub[\"Connection Manager&lt;br/&gt;(Pub/Sub Hub)\"]\n    WS_Hub --&gt;|\"broadcast\"| F1[\"Frontend Client 1\"]\n    WS_Hub --&gt;|\"broadcast\"| F2[\"Frontend Client 2\"]\n    WS_Hub --&gt;|\"persist\"| DB[(PostgreSQL)]</code></pre>"},{"location":"architecture/websocket/#connection-manager","title":"Connection Manager","text":"<p>The <code>ConnectionManager</code> is a pub/sub hub that:</p> <ol> <li>Accepts incoming WebSocket connections</li> <li>Maintains a set of active connections per topic</li> <li>Broadcasts messages to all subscribers</li> <li>Handles disconnection cleanup</li> </ol> <pre><code>class ConnectionManager:\n    def __init__(self):\n        self._connections: dict[str, set[WebSocket]] = {}\n\n    async def connect(self, topic: str, ws: WebSocket): ...\n    async def disconnect(self, topic: str, ws: WebSocket): ...\n    async def broadcast(self, topic: str, data: dict): ...\n</code></pre>"},{"location":"architecture/websocket/#controller-backend-protocol","title":"Controller \u2192 Backend Protocol","text":""},{"location":"architecture/websocket/#message-format","title":"Message Format","text":"<pre><code>{\n  \"event_public_id\": \"evt_temp01\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\"\n}\n</code></pre>"},{"location":"architecture/websocket/#flow","title":"Flow","text":"<ol> <li>Controller opens WS to <code>/ws/controller/telemetry</code></li> <li>Backend authenticates via token query parameter</li> <li>Controller sends JSON messages at <code>poll_interval</code></li> <li>Backend persists to DB and broadcasts to <code>/ws/datapoints/stream</code> subscribers</li> <li>Backend sends heartbeat pings every <code>ws_heartbeat_interval</code> seconds</li> </ol>"},{"location":"architecture/websocket/#backend-frontend-protocol","title":"Backend \u2192 Frontend Protocol","text":""},{"location":"architecture/websocket/#message-format_1","title":"Message Format","text":"<pre><code>{\n  \"public_id\": \"dp_abc123\",\n  \"value\": 23.45,\n  \"timestamp\": \"2025-01-15T14:32:10.000Z\",\n  \"event_public_id\": \"evt_temp01\",\n  \"experiment_public_id\": \"exp_001\"\n}\n</code></pre>"},{"location":"architecture/websocket/#client-reconnection","title":"Client Reconnection","text":"<p>The frontend <code>websocket.ts</code> service implements:</p> <ul> <li>Automatic reconnection with exponential backoff</li> <li>Maximum 3 retry attempts</li> <li>Fallback to HTTP polling after exhausting retries</li> <li>Clean disconnect on component unmount</li> </ul>"},{"location":"architecture/websocket/#nginx-proxy-configuration","title":"Nginx Proxy Configuration","text":"<p>For WebSocket passthrough, the Nginx config includes:</p> <pre><code>location /ws/ {\n    proxy_pass http://backend:8000;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"upgrade\";\n    proxy_set_header Host $host;\n    proxy_read_timeout 86400;\n}\n</code></pre> <p>The <code>proxy_read_timeout</code> is set to 24 hours to prevent premature disconnection of long-lived WebSocket connections.</p>"},{"location":"architecture/websocket/#sequence-diagram","title":"Sequence Diagram","text":"<pre><code>sequenceDiagram\n    participant C as Controller\n    participant B as Backend WS Hub\n    participant DB as PostgreSQL\n    participant F as Frontend\n\n    C-&gt;&gt;B: WS Connect /ws/controller/telemetry\n    F-&gt;&gt;B: WS Connect /ws/datapoints/stream\n\n    loop Every 0.5s\n        C-&gt;&gt;B: {\"event_public_id\": \"...\", \"value\": 23.4}\n        B-&gt;&gt;DB: INSERT INTO datapoints\n        B-&gt;&gt;F: {\"public_id\": \"...\", \"value\": 23.4, ...}\n    end\n\n    B-&gt;&gt;C: ping (heartbeat)\n    C-&gt;&gt;B: pong</code></pre>"},{"location":"architecture/websocket/#next-steps","title":"Next Steps","text":"<ul> <li>Database Abstraction \u2014 how data is persisted</li> <li>API Reference: WebSocket \u2014 endpoint documentation</li> </ul>"},{"location":"deployment/docker/","title":"Docker Deployment","text":"<p>Development vs. Production</p> <p>The <code>docker-compose.yml</code> in the project root is designed for local development. For production deployment on a RevPi or server, use <code>scripts/install.sh</code> which sets up <code>docker-compose.prod.yml</code> with proper credentials, systemd auto-start, and the OTA updater. See the Installation Guide for details.</p> <p>WebMACS runs as a four-container Docker Compose stack.</p>"},{"location":"deployment/docker/#architecture","title":"Architecture","text":"<pre><code>graph TB\n    subgraph Docker Network\n        DB[\"db&lt;br/&gt;postgres:17-alpine&lt;br/&gt;:5432\"]\n        Backend[\"backend&lt;br/&gt;FastAPI/Uvicorn&lt;br/&gt;:8000\"]\n        Frontend[\"frontend&lt;br/&gt;Nginx + Vue SPA&lt;br/&gt;:80\"]\n        Controller[\"controller&lt;br/&gt;Python Agent\"]\n    end\n\n    Frontend --&gt;|\"/api/* proxy\"| Backend\n    Frontend --&gt;|\"/ws/* proxy\"| Backend\n    Controller --&gt;|\"HTTP/WS\"| Backend\n    Backend --&gt;|\"asyncpg\"| DB</code></pre>"},{"location":"deployment/docker/#quick-start","title":"Quick Start","text":"<pre><code>cp .env.example .env\ndocker compose up --build -d\n</code></pre>"},{"location":"deployment/docker/#verify","title":"Verify","text":"<pre><code>docker compose ps\n# All 4 services should show \"healthy\" or \"running\"\n\ncurl http://localhost/health\n# {\"status\":\"ok\",\"version\":\"0.1.0\",\"database\":\"ok\",...}\n</code></pre>"},{"location":"deployment/docker/#services","title":"Services","text":""},{"location":"deployment/docker/#db-postgresql","title":"<code>db</code> \u2014 PostgreSQL","text":"<pre><code>image: postgres:17-alpine\nports: [\"5432:5432\"]\nvolumes: [pgdata:/var/lib/postgresql/data]\nhealthcheck: pg_isready -U webmacs\n</code></pre>"},{"location":"deployment/docker/#backend-fastapi","title":"<code>backend</code> \u2014 FastAPI","text":"<pre><code>build: docker/backend.Dockerfile\nports: [\"8000:8000\"]\ndepends_on: db (healthy)\nhealthcheck: urllib.request.urlopen('http://localhost:8000/health')\n</code></pre>"},{"location":"deployment/docker/#frontend-nginx-vue","title":"<code>frontend</code> \u2014 Nginx + Vue","text":"<pre><code>build: docker/frontend.Dockerfile\nports: [\"80:80\"]\ndepends_on: [backend]\n</code></pre> <p>Nginx serves the built Vue SPA and proxies <code>/api/</code> and <code>/ws/</code> to the backend.</p>"},{"location":"deployment/docker/#controller-iot-agent","title":"<code>controller</code> \u2014 IoT Agent","text":"<pre><code>build: docker/controller.Dockerfile\ndepends_on: backend (healthy)\n</code></pre>"},{"location":"deployment/docker/#docker-files","title":"Docker Files","text":"File Description <code>docker/backend.Dockerfile</code> Python 3.13-slim + UV + FastAPI <code>docker/frontend.Dockerfile</code> Node 22 build stage \u2192 Nginx serve stage <code>docker/controller.Dockerfile</code> Python 3.13-slim + UV + controller <code>docker/nginx.conf</code> Nginx config with API + WebSocket proxy"},{"location":"deployment/docker/#common-commands","title":"Common Commands","text":"<pre><code># Start all services\ndocker compose up -d\n\n# Rebuild after code changes\ndocker compose up --build -d\n\n# View logs\ndocker compose logs -f backend\ndocker compose logs -f controller\n\n# Stop everything\ndocker compose down\n\n# Stop and remove data\ndocker compose down -v   # \u26a0\ufe0f deletes database\n\n# Restart single service\ndocker compose restart backend\n</code></pre>"},{"location":"deployment/docker/#volumes","title":"Volumes","text":"Volume Mounted At Purpose <code>pgdata</code> <code>/var/lib/postgresql/data</code> Persistent database storage"},{"location":"deployment/docker/#ota-updates","title":"OTA Updates","text":"<p>WebMACS includes a built-in Over-The-Air update system. Updates are distributed as <code>.tar.gz</code> bundles containing Docker images and metadata.</p> <pre><code># Build a bundle on your dev machine\njust bundle\n</code></pre> <p>Apply via the OTA Updates page in the web UI, or by copying to <code>/opt/webmacs/updates/</code> on the device.</p> <p>Full OTA documentation</p> <p>See the OTA Updates Guide for build steps, upload, USB/SCP delivery, rollback, and Balena comparison.</p>"},{"location":"deployment/docker/#webhooks","title":"Webhooks","text":"<p>WebMACS notifies external systems (Slack, Node-RED, Home Assistant, custom endpoints) via HMAC-signed HTTP webhooks.</p> <p>Configure via Settings \u2192 Webhooks in the web UI or the REST API.</p> <p>Full webhook documentation</p> <p>See the Webhooks Guide for event types, payload format, HMAC verification, and integration examples.</p>"},{"location":"deployment/docker/#simple-installation-for-customers","title":"Simple Installation for Customers","text":"<p>For end-user installations on Revolution Pi or similar devices, use the automated installer:</p> <pre><code># 1. Transfer the update bundle to the device\nscp webmacs-update-2.0.0.tar.gz pi@&lt;device-ip&gt;:/tmp/\n\n# 2. SSH into the device\nssh pi@&lt;device-ip&gt;\n\n# 3. Run the one-line installer\nsudo bash /tmp/install.sh /tmp/webmacs-update-2.0.0.tar.gz\n</code></pre> <p>The installer handles everything automatically:</p> Step What it does Docker Installs Docker + Compose if not present Directory Creates <code>/opt/webmacs</code> with update folders Credentials Generates random <code>SECRET_KEY</code>, <code>DB_PASSWORD</code>, and admin password Images Loads Docker images from the bundle Services Starts all 4 containers Boot Creates systemd service for auto-start <p>After installation, open <code>http://&lt;device-ip&gt;</code> in a browser and log in with the credentials shown during install.</p> <p>No Internet Required</p> <p>The installer works completely offline. All Docker images are pre-built and included in the update bundle.</p> <p>For detailed step-by-step instructions, see the Installation Guide.</p>"},{"location":"deployment/docker/#balena-when-does-it-make-sense","title":"Balena \u2014 When Does It Make Sense?","text":"<p>WebMACS includes its own OTA update system (see OTA Updates) which is ideal for single devices or small fleets.</p> <p>Balena can be interesting if you:</p> <ul> <li>Manage 50+ devices across multiple locations</li> <li>Need fleet-wide rollouts with staged canary deployments</li> <li>Want delta updates (only changed layers) to save bandwidth</li> <li>Need a cloud dashboard for remote device management</li> </ul> WebMACS OTA Balena Cost Free (GitHub Actions) Paid (after 10 devices) Offline \u2705 Full offline support \u274c Requires cloud connection Dependencies Docker only Balena OS + account Control Full \u2014 your code, your infra Vendor lock-in Ideal for 1\u201350 devices 50+ device fleets <p>Since WebMACS runs in Docker containers, migrating to Balena later requires no code changes \u2014 only the deployment layer changes.</p>"},{"location":"deployment/docker/#next-steps","title":"Next Steps","text":"<ul> <li>Installation Guide \u2014 detailed customer installation</li> <li>Production Deployment \u2014 hardening for production</li> <li>Environment Variables \u2014 full configuration reference</li> </ul>"},{"location":"deployment/env-vars/","title":"Environment Variables","text":"<p>Complete reference of all environment variables used by WebMACS.</p>"},{"location":"deployment/env-vars/#backend","title":"Backend","text":"Variable Required Default Description <code>DATABASE_URL</code> Yes <code>postgresql+asyncpg://...localhost...</code> SQLAlchemy async connection string <code>SECRET_KEY</code> Yes (empty) JWT signing secret \u2014 must set in production <code>ALGORITHM</code> No <code>HS256</code> JWT algorithm <code>ACCESS_TOKEN_EXPIRE_MINUTES</code> No <code>1440</code> Token lifetime (minutes) <code>BACKEND_HOST</code> No <code>0.0.0.0</code> Uvicorn bind host <code>BACKEND_PORT</code> No <code>8000</code> Uvicorn bind port <code>CORS_ORIGINS</code> No <code>[\"http://localhost:3000\",\"http://localhost:5173\"]</code> JSON array of allowed origins <code>DEBUG</code> No <code>false</code> Enable debug mode <code>STORAGE_BACKEND</code> No <code>postgresql</code> <code>postgresql</code> or <code>timescale</code> <code>SENTRY_DSN</code> No (empty) Sentry error tracking URL <code>WS_HEARTBEAT_INTERVAL</code> No <code>30</code> WebSocket heartbeat (seconds) <code>TIMEZONE</code> No <code>Europe/Berlin</code> Default timezone <code>INITIAL_ADMIN_EMAIL</code> No <code>admin@webmacs.io</code> Seed admin email <code>INITIAL_ADMIN_USERNAME</code> No <code>admin</code> Seed admin username <code>INITIAL_ADMIN_PASSWORD</code> No <code>admin123</code> Seed admin password"},{"location":"deployment/env-vars/#controller","title":"Controller","text":"Variable Required Default Description <code>WEBMACS_ENV</code> No <code>development</code> <code>development</code> or <code>production</code> <code>WEBMACS_SERVER_URL</code> Yes <code>http://localhost</code> Backend base URL <code>WEBMACS_SERVER_PORT</code> Yes <code>8000</code> Backend port <code>WEBMACS_ADMIN_EMAIL</code> Yes \u2014 Login credentials for controller <code>WEBMACS_ADMIN_PASSWORD</code> Yes \u2014 Login password <code>WEBMACS_POLL_INTERVAL</code> No <code>0.5</code> Sensor read interval (seconds) <code>WEBMACS_REQUEST_TIMEOUT</code> No <code>30.0</code> HTTP timeout (seconds) <code>WEBMACS_TELEMETRY_MODE</code> No <code>http</code> <code>http</code> or <code>websocket</code> <code>WEBMACS_RULE_EVENT_ID</code> No (empty) Event triggering rule evaluation <code>WEBMACS_REVPI_MAPPING</code> No <code>{}</code> JSON: RevPi I/O pin \u2192 event ID"},{"location":"deployment/env-vars/#docker-compose","title":"Docker Compose","text":"<p>These are used in <code>docker-compose.yml</code> and passed through to services:</p> Variable Default Used By <code>DB_PASSWORD</code> <code>webmacs_dev_password</code> db, backend <code>SECRET_KEY</code> <code>change-me-in-production</code> backend <code>ADMIN_EMAIL</code> <code>admin@webmacs.io</code> backend, controller <code>ADMIN_USERNAME</code> <code>admin</code> backend <code>ADMIN_PASSWORD</code> <code>admin123</code> backend, controller <code>TELEMETRY_MODE</code> <code>http</code> controller"},{"location":"deployment/env-vars/#generating-secrets","title":"Generating Secrets","text":"<pre><code># Secret key (64 hex chars)\nopenssl rand -hex 32\n\n# Database password\nopenssl rand -base64 24\n\n# Admin password\nopenssl rand -base64 16\n</code></pre>"},{"location":"deployment/env-vars/#example-env","title":"Example <code>.env</code>","text":"<pre><code># Database\nDATABASE_URL=postgresql+asyncpg://webmacs:MyStr0ngPwd!@db:5432/webmacs\nDB_PASSWORD=MyStr0ngPwd!\n\n# Security\nSECRET_KEY=a1b2c3d4e5f6...64chars\nACCESS_TOKEN_EXPIRE_MINUTES=60\n\n# Admin\nADMIN_EMAIL=admin@company.com\nADMIN_USERNAME=admin\nADMIN_PASSWORD=Ch4ng3M3!\n\n# Controller\nTELEMETRY_MODE=websocket\n</code></pre>"},{"location":"deployment/env-vars/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Setup \u2014 container configuration</li> <li>Production Guide \u2014 hardening checklist</li> </ul>"},{"location":"deployment/installation-guide/","title":"Installation Guide","text":"<p>Step-by-step instructions for installing WebMACS on a Revolution Pi or any Debian/Ubuntu-based system.</p>"},{"location":"deployment/installation-guide/#prerequisites","title":"Prerequisites","text":"Requirement Minimum Hardware Kunbus Revolution Pi, Raspberry Pi 4, or x86_64 server OS Debian 11+ / Ubuntu 22.04+ (64-bit recommended) RAM 2 GB Storage 8 GB free Network Ethernet (for sensor I/O and web access) <p>Docker and Docker Compose are installed automatically by the installation script if not already present.</p>"},{"location":"deployment/installation-guide/#installation","title":"Installation","text":""},{"location":"deployment/installation-guide/#option-a-automated-install-with-scriptsinstallsh-recommended","title":"Option A \u2014 Automated Install with <code>scripts/install.sh</code> (Recommended)","text":"<p>The easiest way to install WebMACS is the install script in the <code>scripts/</code> directory. It handles everything automatically \u2014 Docker, credentials, services, and auto-start.</p> <p>You will receive a WebMACS update bundle (<code>.tar.gz</code> file) from your system integrator or download it from GitHub Releases.</p> <pre><code># Copy the bundle to the device (from your workstation)\nscp webmacs-update-2.0.0.tar.gz pi@&lt;device-ip&gt;:/tmp/\n\n# SSH into the device\nssh pi@&lt;device-ip&gt;\n\n# Run the installer\nsudo bash scripts/install.sh /tmp/webmacs-update-2.0.0.tar.gz\n</code></pre> <p>The installer will:</p> <ol> <li>Install Docker and Docker Compose (if missing)</li> <li>Create the <code>/opt/webmacs</code> directory structure</li> <li>Generate a secure <code>.env</code> with random passwords</li> <li>Load the Docker images from the bundle</li> <li>Start all services</li> <li>Create a systemd service for automatic start on boot</li> </ol> <p>Save Your Credentials</p> <p>The admin password is displayed only once during installation. It is also stored in <code>/opt/webmacs/.env</code>.</p>"},{"location":"deployment/installation-guide/#option-b-manual-install","title":"Option B \u2014 Manual Install","text":"<p>If you prefer to set up components individually:</p> <pre><code># 1. Install Docker\ncurl -fsSL https://get.docker.com | sh\nsudo systemctl enable docker &amp;&amp; sudo systemctl start docker\n\n# 2. Create directories\nsudo mkdir -p /opt/webmacs/{updates,updates/applied,updates/backups,updates/failed}\n\n# 3. Copy the compose file and bundle\nsudo cp docker-compose.prod.yml /opt/webmacs/\nsudo cp webmacs-update-*.tar.gz /opt/webmacs/\n\n# 4. Extract and load images\ncd /opt/webmacs\nsudo tar -xzf webmacs-update-*.tar.gz\nsudo docker load -i images.tar\n\n# 5. Create .env (see Environment Variables page for all options)\nsudo cp .env.example /opt/webmacs/.env\nsudo nano /opt/webmacs/.env\n\n# 6. Start\ncd /opt/webmacs\nsudo docker compose -f docker-compose.prod.yml --env-file .env up -d\n</code></pre>"},{"location":"deployment/installation-guide/#first-login","title":"First Login","text":"<ol> <li>Open a browser and navigate to <code>http://&lt;device-ip&gt;</code></li> <li>Log in with the admin credentials shown during installation</li> <li>Change the admin password immediately under Settings \u2192 Profile</li> </ol> <p>Finding the Device IP</p> <p>Run <code>hostname -I</code> on the device to see its IP address. On a Revolution Pi connected via Ethernet, the IP is typically assigned by DHCP.</p>"},{"location":"deployment/installation-guide/#creating-additional-users","title":"Creating Additional Users","text":"<p>After your first login as admin:</p> <ol> <li>Navigate to Settings \u2192 Users</li> <li>Click Add User</li> <li>Fill in email, username, and password</li> <li>Assign the appropriate role (<code>admin</code> or <code>viewer</code>)</li> </ol>"},{"location":"deployment/installation-guide/#updating-webmacs","title":"Updating WebMACS","text":"<p>There are two ways to apply updates:</p>"},{"location":"deployment/installation-guide/#via-web-ui-recommended","title":"Via Web UI (Recommended)","text":"<ol> <li>Go to OTA Updates in the sidebar</li> <li>Click Upload Bundle</li> <li>Select the <code>.tar.gz</code> update bundle</li> <li>The system will verify the bundle integrity, back up the database, load new images, and restart automatically</li> <li>The page will reload once the update is complete</li> </ol>"},{"location":"deployment/installation-guide/#via-usb-scp","title":"Via USB / SCP","text":"<ol> <li>Copy the update bundle to the device:    <pre><code>scp webmacs-update-2.1.0.tar.gz pi@&lt;device-ip&gt;:/opt/webmacs/updates/\n</code></pre></li> <li>The built-in updater service will detect the bundle within 60 seconds</li> <li>It will automatically verify, apply, and restart the stack</li> </ol>"},{"location":"deployment/installation-guide/#via-command-line","title":"Via Command Line","text":"<pre><code>cd /opt/webmacs\nsudo tar -xzf updates/webmacs-update-2.1.0.tar.gz -C /tmp/webmacs-update\nsudo docker load -i /tmp/webmacs-update/images.tar\nsudo sed -i \"s/^WEBMACS_VERSION=.*/WEBMACS_VERSION=2.1.0/\" .env\nsudo docker compose -f docker-compose.prod.yml --env-file .env up -d\n</code></pre>"},{"location":"deployment/installation-guide/#backup-restore","title":"Backup &amp; Restore","text":""},{"location":"deployment/installation-guide/#create-a-database-backup","title":"Create a Database Backup","text":"<pre><code>cd /opt/webmacs\ndocker compose -f docker-compose.prod.yml exec -T db \\\n  pg_dump -U webmacs webmacs &gt; backup-$(date +%Y%m%d).sql\n</code></pre>"},{"location":"deployment/installation-guide/#restore-from-backup","title":"Restore from Backup","text":"<pre><code>cd /opt/webmacs\ndocker compose -f docker-compose.prod.yml exec -T db \\\n  psql -U webmacs webmacs &lt; backup-20250101.sql\n</code></pre> <p>Note</p> <p>The updater creates automatic backups before every update in <code>/opt/webmacs/updates/backups/</code>.</p>"},{"location":"deployment/installation-guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"deployment/installation-guide/#services-wont-start","title":"Services Won't Start","text":"<pre><code># Check service status\ncd /opt/webmacs\ndocker compose -f docker-compose.prod.yml ps\n\n# View logs\ndocker compose -f docker-compose.prod.yml logs -f backend\n\n# Restart everything\nsudo systemctl restart webmacs\n</code></pre>"},{"location":"deployment/installation-guide/#cannot-access-web-ui","title":"Cannot Access Web UI","text":"<ol> <li>Check that the backend is healthy:    <pre><code>curl -s http://localhost:8000/health\n</code></pre></li> <li>Check that nginx/frontend is running:    <pre><code>docker compose -f docker-compose.prod.yml ps frontend\n</code></pre></li> <li>Verify no firewall is blocking port 80:    <pre><code>sudo ufw allow 80/tcp   # if ufw is active\n</code></pre></li> </ol>"},{"location":"deployment/installation-guide/#out-of-disk-space","title":"Out of Disk Space","text":"<pre><code># Check disk usage\ndf -h\n\n# Remove old Docker images\ndocker image prune -a\n\n# Remove old update bundles\nrm /opt/webmacs/updates/applied/*.tar.gz\n</code></pre>"},{"location":"deployment/installation-guide/#forgot-admin-password","title":"Forgot Admin Password","text":"<pre><code>cd /opt/webmacs\ncat .env | grep ADMIN_PASSWORD\n</code></pre> <p>If the password was changed via the UI and is no longer in <code>.env</code>, reset it:</p> <pre><code>docker compose -f docker-compose.prod.yml exec backend \\\n  python -c \"\nfrom webmacs_backend.security import get_password_hash\nprint(get_password_hash('NewPassword123!'))\n\" | xargs -I{} docker compose -f docker-compose.prod.yml exec -T db \\\n  psql -U webmacs webmacs -c \"UPDATE users SET hashed_password='{}' WHERE username='admin';\"\n</code></pre>"},{"location":"deployment/installation-guide/#uninstalling","title":"Uninstalling","text":"<pre><code>cd /opt/webmacs\nsudo docker compose -f docker-compose.prod.yml down -v\nsudo systemctl disable webmacs\nsudo rm /etc/systemd/system/webmacs.service\nsudo systemctl daemon-reload\nsudo rm -rf /opt/webmacs\n</code></pre> <p>Danger</p> <p>This removes all data including the database. Create a backup first.</p>"},{"location":"deployment/installation-guide/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Revolution Pi / Host                            \u2502\n\u2502                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502   \u2502 Frontend \u2502  \u2502 Backend  \u2502  \u2502  Controller  \u2502  \u2502\n\u2502   \u2502 (nginx)  \u2502  \u2502 (FastAPI)\u2502  \u2502 (sensors)    \u2502  \u2502\n\u2502   \u2502 :80      \u2502  \u2502 :8000    \u2502  \u2502              \u2502  \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502        \u2502              \u2502               \u2502          \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502          \u2502\n\u2502               \u2502                       \u2502          \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502          \u2502\n\u2502         \u2502 PostgreSQL\u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502         \u2502 :5432     \u2502                            \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                            \u2502\n\u2502                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u2502\n\u2502   \u2502 Updater  \u2502  (monitors /opt/webmacs/updates/) \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>All services run as Docker containers managed by Docker Compose. The systemd unit ensures they start automatically after a reboot.</p>"},{"location":"deployment/production/","title":"Production Deployment","text":"<p>This guide covers hardening WebMACS for production environments.</p>"},{"location":"deployment/production/#security-checklist","title":"Security Checklist","text":"<ul> <li>[ ] Generate a strong <code>SECRET_KEY</code> (<code>openssl rand -hex 32</code>)</li> <li>[ ] Change default admin password</li> <li>[ ] Set <code>DEBUG=false</code></li> <li>[ ] Use a strong <code>DB_PASSWORD</code></li> <li>[ ] Restrict <code>CORS_ORIGINS</code> to your domain</li> <li>[ ] Enable HTTPS (TLS termination at load balancer or Nginx)</li> <li>[ ] Configure Sentry for error tracking (<code>SENTRY_DSN</code>)</li> </ul>"},{"location":"deployment/production/#environment-file","title":"Environment File","text":"<p>Create a production <code>.env</code>:</p> <pre><code># Security\nSECRET_KEY=&lt;generated-64-char-hex&gt;\nALGORITHM=HS256\nACCESS_TOKEN_EXPIRE_MINUTES=60\n\n# Database\nDATABASE_URL=postgresql+asyncpg://webmacs:&lt;strong-password&gt;@db:5432/webmacs\nDB_PASSWORD=&lt;strong-password&gt;\n\n# Admin\nINITIAL_ADMIN_EMAIL=admin@yourcompany.com\nINITIAL_ADMIN_USERNAME=admin\nINITIAL_ADMIN_PASSWORD=&lt;strong-password&gt;\n\n# Backend\nCORS_ORIGINS=[\"https://webmacs.yourcompany.com\"]\nDEBUG=false\nWEBMACS_ENV=production\n\n# Controller\nWEBMACS_TELEMETRY_MODE=websocket\n</code></pre>"},{"location":"deployment/production/#https-tls","title":"HTTPS / TLS","text":""},{"location":"deployment/production/#option-1-reverse-proxy-recommended","title":"Option 1: Reverse Proxy (Recommended)","text":"<p>Place a TLS-terminating reverse proxy (Traefik, Caddy, cloud LB) in front of the Nginx container.</p>"},{"location":"deployment/production/#option-2-nginx-with-certbot","title":"Option 2: Nginx with Certbot","text":"<p>Add SSL configuration to <code>docker/nginx.conf</code>:</p> <pre><code>server {\n    listen 443 ssl;\n    ssl_certificate /etc/letsencrypt/live/webmacs.example.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/webmacs.example.com/privkey.pem;\n\n    # ... existing location blocks\n}\n</code></pre>"},{"location":"deployment/production/#database-backups","title":"Database Backups","text":""},{"location":"deployment/production/#automated-dump","title":"Automated Dump","text":"<pre><code>docker compose exec db pg_dump -U webmacs webmacs &gt; backup_$(date +%Y%m%d).sql\n</code></pre>"},{"location":"deployment/production/#restore","title":"Restore","text":"<pre><code>cat backup_20250115.sql | docker compose exec -T db psql -U webmacs webmacs\n</code></pre>"},{"location":"deployment/production/#scheduled-backups","title":"Scheduled Backups","text":"<p>Add a cron job:</p> <pre><code>0 2 * * * cd /path/to/webmacs &amp;&amp; docker compose exec -T db pg_dump -U webmacs webmacs | gzip &gt; /backups/webmacs_$(date +\\%Y\\%m\\%d).sql.gz\n</code></pre>"},{"location":"deployment/production/#monitoring","title":"Monitoring","text":""},{"location":"deployment/production/#health-endpoints","title":"Health Endpoints","text":"Endpoint Service Purpose <code>GET /health</code> Backend Application health <code>pg_isready</code> PostgreSQL Database connectivity"},{"location":"deployment/production/#sentry-integration","title":"Sentry Integration","text":"<p>Set <code>SENTRY_DSN</code> to enable error tracking:</p> <pre><code>SENTRY_DSN=https://abc123@sentry.io/12345\n</code></pre>"},{"location":"deployment/production/#logging","title":"Logging","text":"<p>The backend uses structlog for structured JSON logging. In production, pipe logs to your log aggregator (ELK, Loki, CloudWatch).</p>"},{"location":"deployment/production/#scaling-considerations","title":"Scaling Considerations","text":"Component Scaling Notes Backend Horizontal Run multiple replicas behind a load balancer Frontend CDN Serve static files from a CDN Controller Single One controller per physical installation Database Vertical / Read replicas Consider TimescaleDB for time-series"},{"location":"deployment/production/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Setup \u2014 container configuration</li> <li>Environment Variables \u2014 full reference</li> </ul>"},{"location":"deployment/troubleshooting/","title":"Troubleshooting","text":"<p>Common issues and their solutions when running WebMACS in production.</p>"},{"location":"deployment/troubleshooting/#connection-issues","title":"Connection Issues","text":""},{"location":"deployment/troubleshooting/#websocket-disconnects","title":"WebSocket Disconnects","text":"<p>Symptom: Frontend shows \"Connection lost\" repeatedly, real-time data stops.</p> <p>Causes &amp; Fixes:</p> Cause Fix nginx proxy timeout Set <code>proxy_read_timeout 86400s;</code> in nginx config Network instability WebMACS auto-reconnects with exponential backoff \u2014 check network Token expired Re-login to refresh JWT (24h TTL) Rate limiting WS paths (<code>/ws/*</code>) are exempt by default \u2014 verify middleware config <p>Diagnostic:</p> <pre><code># Check WebSocket connectivity\nwscat -c ws://localhost:8000/ws/controller/telemetry?token=&lt;jwt&gt;\n\n# Check backend logs\ndocker compose logs backend --tail=100 | grep -i \"websocket\\|disconnect\"\n</code></pre>"},{"location":"deployment/troubleshooting/#controller-cannot-reach-backend","title":"Controller Cannot Reach Backend","text":"<p>Symptom: Controller logs <code>connection refused</code> or <code>timeout</code> errors, no sensor data arrives.</p> <p>Causes &amp; Fixes:</p> Cause Fix Wrong <code>BACKEND_URL</code> Verify <code>BACKEND_URL</code> in controller <code>.env</code> (default: <code>http://backend:8000</code>) Backend not running <code>docker compose ps</code> \u2014 check backend health Docker network issue Ensure both services are on the same Docker network Auth failure Check controller logs for <code>401</code> \u2014 re-register controller user <p>Diagnostic:</p> <pre><code># From controller container, test connectivity\ndocker compose exec controller curl -s http://backend:8000/health\n\n# Check controller logs\ndocker compose logs controller --tail=100\n</code></pre>"},{"location":"deployment/troubleshooting/#database-issues","title":"Database Issues","text":""},{"location":"deployment/troubleshooting/#connection-pool-exhaustion","title":"Connection Pool Exhaustion","text":"<p>Symptom: <code>TimeoutError</code> or <code>QueuePool limit of X overflow Y reached</code> in backend logs.</p> <p>Causes &amp; Fixes:</p> Cause Fix Too many concurrent requests Increase <code>pool_size</code> in database config Slow queries holding connections Check for missing indexes, optimize queries Connection leak Ensure all sessions are properly closed (use <code>async with</code>) <p>Diagnostic:</p> <pre><code># Check active connections\njust db-shell\nSELECT count(*) FROM pg_stat_activity WHERE datname = 'webmacs';\n\n# Check for long-running queries\nSELECT pid, now() - pg_stat_activity.query_start AS duration, query\nFROM pg_stat_activity\nWHERE state != 'idle'\nORDER BY duration DESC\nLIMIT 10;\n</code></pre>"},{"location":"deployment/troubleshooting/#migration-failures","title":"Migration Failures","text":"<p>Symptom: <code>alembic upgrade head</code> fails on startup.</p> <pre><code># Check current revision\ndocker compose exec backend alembic current\n\n# View pending migrations\ndocker compose exec backend alembic history --verbose\n\n# Force stamp to a known good state (last resort)\ndocker compose exec backend alembic stamp head\n</code></pre> <p>See Database Migrations for detailed guide.</p>"},{"location":"deployment/troubleshooting/#plugin-issues","title":"Plugin Issues","text":""},{"location":"deployment/troubleshooting/#plugin-fails-to-load","title":"Plugin Fails to Load","text":"<p>Symptom: Plugin shows as installed but no channels appear, controller logs show errors.</p> <p>Common Causes:</p> <pre><code># Check controller logs for plugin errors\ndocker compose logs controller --tail=100 | grep -i \"plugin\\|error\\|traceback\"\n</code></pre> Cause Fix Missing entry point Plugin <code>.whl</code> must declare <code>webmacs.plugins</code> entry point Dependency conflict Install with <code>--no-deps</code> and add dependencies separately Wrong Python version Plugin must be compatible with Python 3.13 Architecture mismatch ARM plugin on x86 host (or vice versa)"},{"location":"deployment/troubleshooting/#plugin-channels-not-syncing","title":"Plugin Channels Not Syncing","text":"<p>Symptom: Plugin is loaded, channels exist, but no events are created in the backend.</p> <pre><code># Trigger manual sync\ndocker compose restart controller\n\n# Check channel_mappings table\njust db-shell\nSELECT * FROM channel_mappings;\n</code></pre>"},{"location":"deployment/troubleshooting/#ota-update-issues","title":"OTA Update Issues","text":""},{"location":"deployment/troubleshooting/#upload-fails-413-entity-too-large","title":"Upload Fails (413 Entity Too Large)","text":"<p>Symptom: Bundle upload hangs or returns <code>413</code>.</p> <p>Fix: Increase nginx upload limit:</p> <pre><code># nginx.conf\nclient_max_body_size 500M;\n</code></pre> <p>Then restart nginx:</p> <pre><code>docker compose restart nginx\n</code></pre>"},{"location":"deployment/troubleshooting/#update-stuck-in-applying","title":"Update Stuck in \"applying\"","text":"<p>Symptom: Status stays at <code>applying</code> for more than 15 minutes.</p> <pre><code># Check what's happening\ndocker compose logs --tail=200\n\n# Force restart if safe\nsudo systemctl restart webmacs\n\n# The bundle moves to updates/failed/ on error\nls /opt/webmacs/updates/failed/\n</code></pre>"},{"location":"deployment/troubleshooting/#health-check-fails-after-update","title":"Health Check Fails After Update","text":"<p>Symptom: All containers running but <code>/health</code> returns errors.</p> <pre><code># Check each service\ndocker compose ps\ndocker compose logs backend --tail=50\ndocker compose logs controller --tail=50\n\n# Restore database from pre-update backup\ncat /opt/webmacs/updates/backups/webmacs_backup_*.sql | \\\n  docker compose exec -T db psql -U webmacs webmacs\n\n# Restart\nsudo systemctl restart webmacs\n</code></pre>"},{"location":"deployment/troubleshooting/#performance-issues","title":"Performance Issues","text":""},{"location":"deployment/troubleshooting/#slow-datapoint-queries","title":"Slow Datapoint Queries","text":"<p>Symptom: Dashboard loads slowly, CSV export times out.</p> <p>Causes:</p> Cause Fix Missing index Verify <code>ix_datapoints_event_ts</code> exists: <code>\\di</code> in psql Too many datapoints Use time-bounded queries, consider archival No experiment filter Always filter by experiment for bounded result sets <p>Diagnostic:</p> <pre><code>just db-shell\n\n-- Check table sizes\nSELECT relname, pg_size_pretty(pg_total_relation_size(oid))\nFROM pg_class\nWHERE relname LIKE '%datapoint%';\n\n-- Check index usage\nSELECT indexrelname, idx_scan, idx_tup_read\nFROM pg_stat_user_indexes\nWHERE relname = 'datapoints';\n</code></pre>"},{"location":"deployment/troubleshooting/#high-memory-usage","title":"High Memory Usage","text":"<p>Symptom: Backend container uses excessive RAM.</p> <p>Causes:</p> Cause Fix Rate limiter state Normal for high-traffic deployments; entries pruned every 60s Large query results Add pagination (<code>?skip=0&amp;limit=100</code>) to API calls Plugin memory leak Check plugin code, restart controller periodically"},{"location":"deployment/troubleshooting/#docker-issues","title":"Docker Issues","text":""},{"location":"deployment/troubleshooting/#container-wont-start","title":"Container Won't Start","text":"<pre><code># Check container state and exit code\ndocker compose ps -a\n\n# View last logs before crash\ndocker compose logs backend --tail=50\n\n# Common: database not ready yet\n# The backend waits for PostgreSQL \u2014 check db container\ndocker compose logs db --tail=20\n</code></pre>"},{"location":"deployment/troubleshooting/#disk-space-full","title":"Disk Space Full","text":"<pre><code># Check Docker disk usage\ndocker system df\n\n# Remove unused images and volumes\ndocker system prune -a --volumes\n\n# Check database backup directory\ndu -sh /opt/webmacs/updates/backups/\n</code></pre>"},{"location":"deployment/troubleshooting/#logging","title":"Logging","text":""},{"location":"deployment/troubleshooting/#enable-debug-logging","title":"Enable Debug Logging","text":"<p>Set <code>DEBUG=true</code> in your <code>.env</code> file:</p> <pre><code># .env\nDEBUG=true\n</code></pre> <p>Then restart:</p> <pre><code>docker compose restart backend\n</code></pre>"},{"location":"deployment/troubleshooting/#view-structured-logs","title":"View Structured Logs","text":"<p>WebMACS uses <code>structlog</code> for structured logging. Filter by event type:</p> <pre><code># All authentication events\ndocker compose logs backend | grep \"auth\\|login\\|token\"\n\n# All WebSocket events\ndocker compose logs backend | grep \"websocket\\|ws_\"\n\n# All plugin events\ndocker compose logs controller | grep \"plugin\\|sync\\|channel\"\n</code></pre>"},{"location":"deployment/troubleshooting/#getting-help","title":"Getting Help","text":"<p>If your issue isn't covered here:</p> <ol> <li>Check the Logs in the WebMACS UI</li> <li>Search GitHub Issues</li> <li>Open a new issue with:<ul> <li>WebMACS version (<code>curl http://localhost/api/v1/health</code>)</li> <li>Docker logs (last 100 lines)</li> <li>Steps to reproduce</li> </ul> </li> </ol>"},{"location":"deployment/troubleshooting/#next-steps","title":"Next Steps","text":"<ul> <li>Production Deployment \u2014 hardening, HTTPS, backups</li> <li>Security \u2014 authentication, rate limiting</li> <li>OTA Updates \u2014 update process and recovery</li> </ul>"},{"location":"development/code-style/","title":"Code Style","text":"<p>WebMACS enforces consistent code style across all components.</p>"},{"location":"development/code-style/#python-backend-controller","title":"Python (Backend &amp; Controller)","text":""},{"location":"development/code-style/#formatter-linter-ruff","title":"Formatter &amp; Linter: Ruff","text":"<p>Ruff handles both formatting and linting:</p> <pre><code># pyproject.toml\n[tool.ruff]\ntarget-version = \"py313\"\nline-length = 120\n\n[tool.ruff.lint]\nselect = [\n    \"E\", \"F\", \"W\",     # pycodestyle, pyflakes\n    \"I\",                # isort\n    \"N\",                # pep8-naming\n    \"UP\",               # pyupgrade\n    \"S\",                # bandit (security)\n    \"B\",                # bugbear\n    \"A\",                # builtins\n    \"C4\",               # comprehensions\n    \"DTZ\",              # datetime timezone\n    \"T20\",              # print statements\n    \"PT\",               # pytest style\n    \"SIM\",              # simplify\n    \"TID\",              # tidy imports\n    \"TCH\",              # type checking\n    \"ARG\",              # unused arguments\n    \"PL\",               # pylint\n    \"TRY\",              # tryceratops\n    \"PERF\",             # performance\n    \"RUF\",              # ruff-specific\n]\nignore = [\"S101\", \"TRY003\", \"PLR0913\"]\n</code></pre>"},{"location":"development/code-style/#type-checking-mypy","title":"Type Checking: mypy","text":"<pre><code>[tool.mypy]\npython_version = \"3.13\"\nstrict = true\ndisallow_untyped_defs = true\n</code></pre>"},{"location":"development/code-style/#commands","title":"Commands","text":"<pre><code>just lint       # ruff check + format check\njust format     # ruff format (auto-fix)\njust fix        # format + lint-fix\n</code></pre>"},{"location":"development/code-style/#typescript-frontend","title":"TypeScript (Frontend)","text":""},{"location":"development/code-style/#linter-eslint","title":"Linter: ESLint","text":"<p>The frontend uses ESLint with Vue and TypeScript rules:</p> <pre><code>npm run lint        # Check\nnpm run lint:fix    # Auto-fix\n</code></pre>"},{"location":"development/code-style/#type-checking-vue-tsc","title":"Type Checking: vue-tsc","text":"<pre><code>npm run type-check\n</code></pre>"},{"location":"development/code-style/#conventions","title":"Conventions","text":""},{"location":"development/code-style/#python","title":"Python","text":"<ul> <li>Imports: Sorted by <code>isort</code> (via Ruff). First-party packages: <code>webmacs_backend</code>, <code>webmacs_controller</code></li> <li>Docstrings: Google style</li> <li>Naming: <code>snake_case</code> for functions/variables, <code>PascalCase</code> for classes</li> <li>Type hints: Required on all public functions (mypy strict mode)</li> <li>Async: Use <code>async def</code> for all I/O-bound operations</li> </ul>"},{"location":"development/code-style/#typescript","title":"TypeScript","text":"<ul> <li>Naming: <code>camelCase</code> for variables/functions, <code>PascalCase</code> for components/types</li> <li>Composition API: <code>&lt;script setup lang=\"ts\"&gt;</code> for all components</li> <li>Types: Explicit interfaces in <code>types/</code> directory</li> <li>Imports: Absolute paths from <code>@/</code> alias</li> </ul>"},{"location":"development/code-style/#commits","title":"Commits","text":"<p>Follow Conventional Commits \u2014 see Contributing.</p>"},{"location":"development/code-style/#pre-commit-checks","title":"Pre-Commit Checks","text":"<p>Run before every commit:</p> <pre><code>just check      # lint + type-check + test\n</code></pre> <p>Or integrate with git hooks:</p> <pre><code># .pre-commit-config.yaml support planned\n</code></pre>"},{"location":"development/code-style/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing \u2014 full development workflow</li> <li>Testing \u2014 test structure and patterns</li> </ul>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Contributions to WebMACS are welcome. Here is how to get involved.</p>"},{"location":"development/contributing/#development-setup","title":"Development Setup","text":""},{"location":"development/contributing/#1-clone-the-repository","title":"1. Clone the repository","text":"<pre><code>git clone https://github.com/stefanposs/webmacs.git\ncd webmacs\n</code></pre>"},{"location":"development/contributing/#2-install-dependencies","title":"2. Install dependencies","text":"<pre><code># Backend\ncd backend &amp;&amp; uv sync --all-extras &amp;&amp; cd ..\n\n# Controller\ncd controller &amp;&amp; uv sync --all-extras &amp;&amp; cd ..\n\n# Frontend\ncd frontend &amp;&amp; npm install &amp;&amp; cd ..\n</code></pre>"},{"location":"development/contributing/#3-verify-installation","title":"3. Verify installation","text":"<pre><code>just test       # Run all tests\njust lint       # Check code style\n</code></pre>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"development/contributing/#available-commands","title":"Available Commands","text":"<p>All commands use just (a modern <code>make</code> alternative).</p> <pre><code># Setup\njust setup              # Install all dependencies (backend + controller + plugins + frontend)\njust setup-backend      # Install backend dependencies only\njust setup-controller   # Install controller dependencies only\njust setup-frontend     # Install frontend dependencies only\n\n# Code quality\njust lint               # Run all linters (backend + controller + plugins + frontend)\njust lint-backend       # Lint backend + controller + plugins with ruff\njust lint-frontend      # Lint frontend with ESLint\njust lint-fix           # Auto-fix Python lint issues\njust format             # Auto-format Python code\njust fix                # Format + lint-fix\n\n# Type checking\njust typecheck          # Type check Python (backend + controller) with mypy\njust typecheck-frontend # Type check frontend with vue-tsc\n\n# Testing\njust test               # Run all tests (backend + controller + plugins + frontend)\njust test-backend       # Backend tests only\njust test-backend-cov   # Backend tests with coverage report\njust test-controller    # Controller tests only\njust test-frontend      # Frontend tests only\njust test-frontend-cov  # Frontend tests with coverage report\njust test-plugins       # Run all plugin tests\njust test-plugin &lt;name&gt; # Run tests for a specific plugin\njust test-example-plugin # Run example plugin tests (validates SDK contract)\n\n# CI / QA\njust qa                 # Full QA pipeline: lint + typecheck + all tests\njust check              # Quick check before commit\njust ci                 # Simulate full CI pipeline locally (mirrors GitHub Actions)\njust ci-cov             # Full CI with coverage reports\njust ci-quick           # Quick CI (lint + test, skip typecheck)\n\n# Docker\njust dev                # Start full Docker stack (detached)\njust down               # Stop all containers\njust down-clean         # Stop and remove all data (volumes)\njust rebuild            # Rebuild and restart all containers\njust restart &lt;service&gt;  # Restart a single service\njust status             # Check service health\njust logs &lt;service&gt;     # View logs (follow mode)\n\n# Database\njust db-shell           # Open psql shell\njust db-backup          # Create database backup\n\n# Documentation\njust docs               # Serve docs locally (http://localhost:8001)\njust docs-build         # Build static docs\n\n# Release\njust bundle &lt;version&gt;   # Build OTA update bundle for customer deployment\n\n# Utilities\njust info               # Show project info\njust loc                # Count lines of code\njust clean              # Clean build artifacts\n</code></pre>"},{"location":"development/contributing/#branch-strategy","title":"Branch Strategy","text":"Branch Purpose <code>main</code> Production-ready code <code>develop</code> Integration branch <code>feature/*</code> New features <code>fix/*</code> Bug fixes <code>docs/*</code> Documentation updates"},{"location":"development/contributing/#commit-messages","title":"Commit Messages","text":"<p>Follow Conventional Commits:</p> Prefix Purpose <code>feat:</code> New feature <code>fix:</code> Bug fix <code>docs:</code> Documentation <code>test:</code> Tests <code>refactor:</code> Code refactoring <code>perf:</code> Performance improvements <code>ci:</code> CI/CD changes <code>chore:</code> Maintenance"},{"location":"development/contributing/#pull-request-process","title":"Pull Request Process","text":""},{"location":"development/contributing/#1-create-feature-branch","title":"1. Create feature branch","text":"<pre><code>git checkout -b feature/my-awesome-feature\n</code></pre>"},{"location":"development/contributing/#2-make-changes","title":"2. Make changes","text":"<ul> <li>Write tests for new functionality</li> <li>Ensure <code>just qa</code> passes</li> <li>Update documentation if needed</li> </ul>"},{"location":"development/contributing/#3-push-and-open-pr","title":"3. Push and open PR","text":"<pre><code>git push origin feature/my-awesome-feature\n</code></pre> <p>Open a PR against <code>develop</code> (or <code>main</code> for hotfixes).</p>"},{"location":"development/contributing/#4-code-review","title":"4. Code review","text":"<ul> <li>At least one approval required</li> <li>CI must pass</li> <li>No merge conflicts</li> </ul>"},{"location":"development/contributing/#cicd-pipeline","title":"CI/CD Pipeline","text":"<p>GitHub Actions runs on every push:</p> <ul> <li>Python: Ruff linting, mypy type checking, pytest with coverage</li> <li>Frontend: ESLint, vue-tsc type checking, Vite build, vitest</li> <li>Matrix: Backend + Controller tested separately</li> <li>Services: PostgreSQL 17 for integration tests</li> </ul>"},{"location":"development/contributing/#release-process","title":"Release Process","text":"<ol> <li>Merge to <code>main</code></li> <li>Tag version: <code>git tag v2.x.x</code></li> <li>Push tags: <code>git push --tags</code></li> <li>Docker images rebuilt automatically</li> </ol>"},{"location":"development/contributing/#questions","title":"Questions?","text":"<p>Open a GitHub Issue.</p>"},{"location":"development/database-migrations/","title":"Database Migrations","text":"<p>WebMACS uses Alembic for database schema migrations with full async support.</p>"},{"location":"development/database-migrations/#overview","title":"Overview","text":"Component Details Migration tool Alembic ORM SQLAlchemy 2 (async) Driver <code>asyncpg</code> (runtime) / <code>psycopg2</code> (migrations) Config <code>backend/alembic.ini</code> + <code>backend/alembic/env.py</code> Migrations <code>backend/alembic/versions/</code> <p>Driver Swap</p> <p>Alembic runs migrations synchronously. The <code>env.py</code> automatically swaps <code>+asyncpg</code> \u2192 <code>+psycopg2</code> in the database URL. Make sure both drivers are installed (<code>asyncpg</code> for the app, <code>psycopg2-binary</code> for migrations).</p>"},{"location":"development/database-migrations/#current-migrations","title":"Current Migrations","text":"Migration Description <code>001_plugins.py</code> Plugin instances, channel mappings tables <code>002_plugin_packages.py</code> Plugin packages table (OTA uploads) <code>003_fk_ondelete.py</code> Add <code>ON DELETE CASCADE/SET NULL</code> to all foreign keys"},{"location":"development/database-migrations/#running-migrations","title":"Running Migrations","text":""},{"location":"development/database-migrations/#apply-all-pending-migrations","title":"Apply All Pending Migrations","text":"<pre><code>cd backend\nalembic upgrade head\n</code></pre>"},{"location":"development/database-migrations/#check-current-revision","title":"Check Current Revision","text":"<pre><code>alembic current\n</code></pre>"},{"location":"development/database-migrations/#view-migration-history","title":"View Migration History","text":"<pre><code>alembic history --verbose\n</code></pre>"},{"location":"development/database-migrations/#downgrade-rollback-last-migration","title":"Downgrade (Rollback Last Migration)","text":"<pre><code>alembic downgrade -1\n</code></pre>"},{"location":"development/database-migrations/#creating-a-new-migration","title":"Creating a New Migration","text":""},{"location":"development/database-migrations/#step-1-modify-the-model","title":"Step 1 \u2014 Modify the Model","text":"<p>Edit <code>backend/src/webmacs_backend/models.py</code>:</p> <pre><code>class MyNewTable(Base):\n    __tablename__ = \"my_new_table\"\n\n    id: Mapped[int] = mapped_column(Integer, primary_key=True, autoincrement=True)\n    public_id: Mapped[str] = mapped_column(\n        String(100), unique=True, default=lambda: str(uuid.uuid4())\n    )\n    name: Mapped[str] = mapped_column(String(200), nullable=False)\n    created_on: Mapped[datetime] = mapped_column(\n        DateTime(timezone=True), server_default=func.now()\n    )\n</code></pre>"},{"location":"development/database-migrations/#step-2-auto-generate-the-migration","title":"Step 2 \u2014 Auto-generate the Migration","text":"<pre><code>cd backend\nalembic revision --autogenerate -m \"add_my_new_table\"\n</code></pre> <p>This creates a file in <code>alembic/versions/</code> with <code>upgrade()</code> and <code>downgrade()</code> functions.</p>"},{"location":"development/database-migrations/#step-3-review-the-generated-migration","title":"Step 3 \u2014 Review the Generated Migration","text":"<p>Always review the generated file. Alembic autogenerate is not perfect \u2014 check for:</p> <ul> <li>[ ] Correct column types and constraints</li> <li>[ ] Missing indexes</li> <li>[ ] Proper <code>ondelete</code> on foreign keys</li> <li>[ ] Data migrations (Alembic can't auto-detect these)</li> </ul> <p>Example migration:</p> <pre><code>\"\"\"add_my_new_table\n\nRevision ID: abc123\nRevises: 003_fk_ondelete\n\"\"\"\n\nfrom alembic import op\nimport sqlalchemy as sa\n\nrevision = \"004_my_new_table\"\ndown_revision = \"003_fk_ondelete\"\n\n\ndef upgrade() -&gt; None:\n    op.create_table(\n        \"my_new_table\",\n        sa.Column(\"id\", sa.Integer(), autoincrement=True, nullable=False),\n        sa.Column(\"public_id\", sa.String(100), nullable=False),\n        sa.Column(\"name\", sa.String(200), nullable=False),\n        sa.Column(\"created_on\", sa.DateTime(timezone=True), server_default=sa.func.now()),\n        sa.PrimaryKeyConstraint(\"id\"),\n        sa.UniqueConstraint(\"public_id\"),\n    )\n\n\ndef downgrade() -&gt; None:\n    op.drop_table(\"my_new_table\")\n</code></pre>"},{"location":"development/database-migrations/#step-4-apply","title":"Step 4 \u2014 Apply","text":"<pre><code>alembic upgrade head\n</code></pre>"},{"location":"development/database-migrations/#step-5-verify","title":"Step 5 \u2014 Verify","text":"<pre><code># Check the migration was applied\nalembic current\n\n# Or connect to the database\njust db-shell\n\\dt  -- list tables\n</code></pre>"},{"location":"development/database-migrations/#data-migrations","title":"Data Migrations","text":"<p>For data migrations (transforming existing data, not just schema), use <code>op.execute()</code>:</p> <pre><code>def upgrade() -&gt; None:\n    # Add column\n    op.add_column(\"events\", sa.Column(\"category\", sa.String(50), nullable=True))\n\n    # Backfill data\n    op.execute(\"UPDATE events SET category = 'sensor' WHERE event_type = 'numerical'\")\n\n    # Now make it non-nullable\n    op.alter_column(\"events\", \"category\", nullable=False)\n</code></pre>"},{"location":"development/database-migrations/#async-considerations","title":"Async Considerations","text":"<p>The <code>env.py</code> handles async engines transparently:</p> <pre><code>async def run_async_migrations() -&gt; None:\n    connectable = async_engine_from_config(\n        config.get_section(config.config_ini_section, {}),\n        prefix=\"sqlalchemy.\",\n        poolclass=pool.NullPool,\n    )\n    async with connectable.connect() as connection:\n        await connection.run_sync(do_run_migrations)\n    await connectable.dispose()\n</code></pre> <p>You don't need to do anything special \u2014 just run <code>alembic upgrade head</code> as normal.</p>"},{"location":"development/database-migrations/#docker-production","title":"Docker / Production","text":"<p>In production, migrations run automatically on startup via the Docker entrypoint:</p> <pre><code># In the backend Dockerfile entrypoint\nalembic upgrade head &amp;&amp; uvicorn webmacs_backend.main:app\n</code></pre> <p>For manual production migrations:</p> <pre><code>docker compose exec backend alembic upgrade head\n</code></pre>"},{"location":"development/database-migrations/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/database-migrations/#cant-locate-revision","title":"\"Can't locate revision\"","text":"<pre><code># Reset Alembic version tracking\nalembic stamp head\n</code></pre>"},{"location":"development/database-migrations/#target-database-is-not-up-to-date","title":"\"Target database is not up to date\"","text":"<pre><code># Apply pending migrations first\nalembic upgrade head\n</code></pre>"},{"location":"development/database-migrations/#psycopg2-not-installed","title":"psycopg2 Not Installed","text":"<pre><code>ModuleNotFoundError: No module named 'psycopg2'\n</code></pre> <p>Install it:</p> <pre><code>uv add psycopg2-binary --dev\n</code></pre>"},{"location":"development/database-migrations/#next-steps","title":"Next Steps","text":"<ul> <li>Database Architecture \u2014 table schemas and relationships</li> <li>Testing \u2014 writing tests with database fixtures</li> <li>Contributing \u2014 development workflow</li> </ul>"},{"location":"development/plugin-development/","title":"Plugin Development Guide","text":"<p>Build custom device plugins for WebMACS. This guide walks you through the SDK, the plugin lifecycle, and a complete example \u2014 from a blank file to an installable <code>.whl</code> package.</p>"},{"location":"development/plugin-development/#architecture","title":"Architecture","text":"<pre><code>graph LR\n    subgraph Plugin Package .whl\n        EP[\"Entry Point&lt;br/&gt;webmacs.plugins\"]\n    end\n    EP --&gt;|discovered by| Registry[\"PluginRegistry&lt;br/&gt;(Controller)\"]\n    Registry --&gt;|instantiate| Instance[\"DevicePlugin&lt;br/&gt;instance\"]\n    Instance --&gt;|read channels| Bridge[\"PluginBridge\"]\n    Bridge --&gt;|telemetry| Backend[\"Backend API\"]\n    Backend --&gt;|DB + WS| Dashboard[\"Dashboard\"]</code></pre> <p>Plugins are Python packages that register themselves via the <code>webmacs.plugins</code> entry point group. The controller discovers them at startup, instantiates the configured plugin classes, and reads their channels in the same polling loop as hardware I/O.</p>"},{"location":"development/plugin-development/#quick-start","title":"Quick Start","text":""},{"location":"development/plugin-development/#1-create-the-package-structure","title":"1. Create the Package Structure","text":"<pre><code>my-plugin/\n\u251c\u2500\u2500 pyproject.toml\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 src/\n    \u2514\u2500\u2500 my_plugin/\n        \u2514\u2500\u2500 __init__.py\n</code></pre>"},{"location":"development/plugin-development/#2-define-the-plugin-class","title":"2. Define the Plugin Class","text":"src/my_plugin/__init__.py<pre><code>from webmacs_plugins_core import (\n    ChannelDescriptor,\n    ChannelDirection,\n    ChannelValue,\n    DevicePlugin,\n    PluginMeta,\n    SimulationSpec,\n)\n\n\nclass MyPlugin(DevicePlugin):\n    \"\"\"A minimal example plugin.\"\"\"\n\n    meta = PluginMeta(\n        id=\"my-plugin\",\n        name=\"My Custom Plugin\",\n        version=\"1.0.0\",\n        vendor=\"My Company\",\n        description=\"Reads data from my custom sensor.\",\n        url=\"https://example.com\",\n    )\n\n    def get_channels(self) -&gt; list[ChannelDescriptor]:\n        return [\n            ChannelDescriptor(\n                id=\"temperature\",\n                name=\"Temperature\",\n                direction=ChannelDirection.input,\n                unit=\"\u00b0C\",\n                min_value=-40.0,\n                max_value=125.0,\n                simulation=SimulationSpec(\n                    profile=\"sine_wave\",\n                    base_value=22.0,\n                    amplitude=5.0,\n                    period_seconds=120,\n                ),\n            ),\n            ChannelDescriptor(\n                id=\"heater\",\n                name=\"Heater Output\",\n                direction=ChannelDirection.output,\n                unit=\"%\",\n                min_value=0.0,\n                max_value=100.0,\n                safe_value=0.0,  # Turn off on disconnect\n            ),\n        ]\n\n    async def _do_connect(self) -&gt; None:\n        # Initialize your hardware connection here\n        pass\n\n    async def _do_disconnect(self) -&gt; None:\n        # Clean up hardware resources here\n        pass\n\n    async def _do_read(self, channel_id: str) -&gt; ChannelValue | None:\n        # Read a value from your hardware\n        if channel_id == \"temperature\":\n            return 23.5  # Replace with actual hardware read\n        return None\n\n    async def _do_write(self, channel_id: str, value: ChannelValue) -&gt; None:\n        # Write a value to your hardware\n        if channel_id == \"heater\":\n            pass  # Replace with actual hardware write\n</code></pre>"},{"location":"development/plugin-development/#3-configure-the-package","title":"3. Configure the Package","text":"pyproject.toml<pre><code>[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"\n\n[project]\nname = \"webmacs-plugin-my-plugin\"\nversion = \"1.0.0\"\ndescription = \"My custom WebMACS plugin\"\nrequires-python = \"&gt;=3.12\"\ndependencies = [\"webmacs-plugins-core&gt;=0.1.0\"]\n\n[project.entry-points.\"webmacs.plugins\"]\nmy-plugin = \"my_plugin:MyPlugin\"\n\n[tool.hatch.build.targets.wheel]\npackages = [\"src/my_plugin\"]\n</code></pre> <p>Entry Point</p> <p>The <code>[project.entry-points.\"webmacs.plugins\"]</code> section is required. Without it, the plugin will not be discovered. The key (<code>my-plugin</code>) should match <code>meta.id</code>.</p>"},{"location":"development/plugin-development/#4-build-and-upload","title":"4. Build and Upload","text":"<pre><code># Build the wheel\npip install build\npython -m build --wheel\n\n# Upload via the WebMACS UI\n# Go to Plugins \u2192 Packages \u2192 Upload\n# Select dist/webmacs_plugin_my_plugin-1.0.0-py3-none-any.whl\n</code></pre>"},{"location":"development/plugin-development/#plugin-sdk-reference","title":"Plugin SDK Reference","text":""},{"location":"development/plugin-development/#deviceplugin-async","title":"<code>DevicePlugin</code> (async)","text":"<p>The primary base class. All methods are async.</p>"},{"location":"development/plugin-development/#class-variables","title":"Class Variables","text":"Variable Type Required Description <code>meta</code> <code>PluginMeta</code> Yes Identity, version, vendor info <code>config_schema</code> <code>type[PluginInstanceConfig]</code> No Custom config model (default: <code>PluginInstanceConfig</code>)"},{"location":"development/plugin-development/#lifecycle","title":"Lifecycle","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; discovered: Plugin class loaded\n    discovered --&gt; configured: configure(config)\n    configured --&gt; connecting: connect()\n    connecting --&gt; connected: _do_connect() succeeds\n    connected --&gt; running: read()/write() calls\n    running --&gt; disconnecting: disconnect()\n    disconnecting --&gt; disconnected: _do_disconnect() succeeds\n    connected --&gt; error: exception\n    running --&gt; error: exception\n    error --&gt; connecting: health monitor retry</code></pre>"},{"location":"development/plugin-development/#abstract-methods-to-implement","title":"Abstract Methods to Implement","text":"Method Signature Description <code>get_channels</code> <code>() \u2192 list[ChannelDescriptor]</code> Define the channels this plugin exposes <code>_do_connect</code> <code>() \u2192 None</code> Connect to hardware (skipped in demo mode) <code>_do_disconnect</code> <code>() \u2192 None</code> Disconnect from hardware <code>_do_read</code> <code>(channel_id: str) \u2192 ChannelValue \\| None</code> Read a single channel value <code>_do_write</code> <code>(channel_id: str, value: ChannelValue) \u2192 None</code> Write a value to a channel"},{"location":"development/plugin-development/#built-in-behaviour","title":"Built-in Behaviour","text":"<p>You get these features for free:</p> <ul> <li>Demo mode simulation \u2014 each channel's <code>SimulationSpec</code> generates realistic sensor data</li> <li>Value conversion \u2014 <code>read_conversion</code> / <code>write_conversion</code> on channels (linear, divide, clamp)</li> <li>Output clamping \u2014 values are clamped to <code>[min_value, max_value]</code> on write</li> <li>Safe state \u2014 on disconnect or error, all outputs with <code>safe_value</code> are written automatically</li> <li>Health monitoring \u2014 automatic reconnection with exponential backoff</li> <li>Context manager \u2014 <code>async with plugin:</code> handles connect/disconnect</li> </ul>"},{"location":"development/plugin-development/#syncdeviceplugin","title":"<code>SyncDevicePlugin</code>","text":"<p>For hardware libraries that are not async-compatible. Wraps blocking calls in <code>asyncio.to_thread()</code> with a per-instance lock.</p> Method Replaces <code>connect_sync()</code> <code>_do_connect()</code> <code>disconnect_sync()</code> <code>_do_disconnect()</code> <code>read_sync(channel_id)</code> <code>_do_read(channel_id)</code> <code>write_sync(channel_id, value)</code> <code>_do_write(channel_id, value)</code> <pre><code>from webmacs_plugins_core import SyncDevicePlugin\n\nclass MyBlockingPlugin(SyncDevicePlugin):\n    meta = PluginMeta(id=\"blocking\", name=\"Blocking Plugin\", version=\"1.0.0\")\n\n    def get_channels(self) -&gt; list[ChannelDescriptor]:\n        return [...]\n\n    def connect_sync(self) -&gt; None:\n        self.device = MyBlockingLibrary.connect(\"/dev/ttyUSB0\")\n\n    def disconnect_sync(self) -&gt; None:\n        self.device.close()\n\n    def read_sync(self, channel_id: str) -&gt; ChannelValue | None:\n        return self.device.read(channel_id)\n\n    def write_sync(self, channel_id: str, value: ChannelValue) -&gt; None:\n        self.device.write(channel_id, value)\n</code></pre>"},{"location":"development/plugin-development/#channel-configuration","title":"Channel Configuration","text":""},{"location":"development/plugin-development/#channeldescriptor","title":"<code>ChannelDescriptor</code>","text":"Field Type Default Description <code>id</code> <code>str</code> \u2014 Unique channel identifier <code>name</code> <code>str</code> \u2014 Human-readable display name <code>direction</code> <code>ChannelDirection</code> \u2014 <code>input</code>, <code>output</code>, or <code>bidirectional</code> <code>data_type</code> <code>str</code> <code>\"float\"</code> Value type hint <code>unit</code> <code>str</code> <code>\"\"</code> Engineering unit (\u00b0C, %, bar, \u2026) <code>min_value</code> <code>float</code> <code>0.0</code> Minimum allowed value <code>max_value</code> <code>float</code> <code>100.0</code> Maximum allowed value <code>read_conversion</code> <code>ConversionSpec</code> identity Raw \u2192 engineering value conversion <code>write_conversion</code> <code>ConversionSpec</code> identity Engineering \u2192 raw value conversion <code>simulation</code> <code>SimulationSpec</code> sine wave Demo mode signal shape <code>safe_value</code> <code>float \\| None</code> <code>None</code> Value written on disconnect/error <code>ui_hints</code> <code>dict[str, str]</code> <code>{}</code> Frontend hints: <code>icon</code>, <code>color</code>, <code>widget_type</code>"},{"location":"development/plugin-development/#value-conversions","title":"Value Conversions","text":"<p>Built-in converters transform raw hardware values to engineering units:</p> Type Parameters Formula <code>\"none\"</code> \u2014 <code>y = x</code> (identity) <code>\"linear\"</code> <code>scale</code>, <code>offset</code> <code>y = x * scale + offset</code> <code>\"divide\"</code> <code>divisor</code> <code>y = x / divisor</code> <code>\"clamp\"</code> <code>min</code>, <code>max</code> <code>y = clamp(x, min, max)</code> <pre><code>ChannelDescriptor(\n    id=\"pressure_bar\",\n    name=\"Pressure\",\n    direction=ChannelDirection.input,\n    unit=\"bar\",\n    read_conversion=ConversionSpec(\n        type=\"linear\",\n        params={\"scale\": 0.001, \"offset\": -1.013},\n    ),\n)\n</code></pre>"},{"location":"development/plugin-development/#simulation-profiles","title":"Simulation Profiles","text":"<p>Available profiles for demo mode:</p> Profile Description <code>sine_wave</code> Smooth oscillation around <code>base_value</code> <code>sawtooth</code> Linear ramp up, then reset <code>random_walk</code> Brownian motion drift <code>step</code> Alternates between <code>base_value - amplitude</code> and <code>base_value + amplitude</code> <code>constant</code> Fixed <code>base_value</code> (useful for outputs) <p>Add Gaussian noise to any profile with <code>noise &gt; 0</code>:</p> <pre><code>SimulationSpec(\n    profile=\"sine_wave\",\n    base_value=22.0,\n    amplitude=3.0,\n    period_seconds=60,\n    noise=0.5,  # \u03c3 = 0.5\n)\n</code></pre>"},{"location":"development/plugin-development/#custom-configuration","title":"Custom Configuration","text":"<p>Subclass <code>PluginInstanceConfig</code> to add settings for your plugin:</p> <pre><code>from webmacs_plugins_core import PluginInstanceConfig\n\nclass MyPluginConfig(PluginInstanceConfig):\n    serial_port: str = \"/dev/ttyUSB0\"\n    baud_rate: int = 9600\n    timeout_seconds: float = 5.0\n\nclass MyPlugin(DevicePlugin):\n    meta = PluginMeta(id=\"my-plugin\", name=\"My Plugin\", version=\"1.0.0\")\n    config_schema = MyPluginConfig  # Tell the SDK to use your config model\n\n    async def _do_connect(self) -&gt; None:\n        port = self.config.serial_port  # Access typed config\n        baud = self.config.baud_rate\n        # ...\n</code></pre> <p>Users pass custom config as a JSON string via the <code>config_json</code> field when creating a plugin instance.</p>"},{"location":"development/plugin-development/#error-handling","title":"Error Handling","text":"<p>The SDK provides a structured error hierarchy:</p> Error When <code>PluginLoadError</code> Entry point fails to load <code>PluginConfigError</code> Configuration validation fails <code>PluginConnectionError</code> Hardware connection fails <code>PluginTimeoutError</code> Read/write times out <code>CapabilityNotFoundError</code> Unknown channel ID <code>PluginStateError</code> Operation called in wrong lifecycle state <p>All errors extend <code>PluginError(plugin_id, message)</code>.</p> <p>The health monitor catches connection errors automatically and retries with exponential backoff (configurable via <code>RetryPolicy</code>).</p>"},{"location":"development/plugin-development/#packaging-rules","title":"Packaging Rules","text":"<p>For a <code>.whl</code> to pass the upload validator:</p> <ol> <li>File extension must be <code>.whl</code></li> <li>Maximum file size: 50 MB</li> <li>Must be a valid ZIP archive</li> <li>Must contain a <code>*.dist-info/METADATA</code> file with <code>Name</code> and <code>Version</code></li> <li>Must contain a <code>*.dist-info/entry_points.txt</code> with a <code>[webmacs.plugins]</code> section</li> </ol> <p>Naming Convention</p> <p>Use the prefix <code>webmacs-plugin-</code> for your package name (e.g., <code>webmacs-plugin-my-sensor</code>). This helps with discovery and makes the plugin's purpose clear.</p>"},{"location":"development/plugin-development/#example-system-monitor-plugin","title":"Example: System Monitor Plugin","text":"<p>The bundled System Monitor plugin is a good reference implementation:</p> <pre><code>class SystemPlugin(DevicePlugin):\n    meta = PluginMeta(\n        id=\"system\",\n        name=\"System Monitor\",\n        version=\"0.1.0\",\n        vendor=\"WebMACS\",\n        description=\"CPU, memory, disk and temperature monitoring.\",\n    )\n\n    def get_channels(self) -&gt; list[ChannelDescriptor]:\n        channels = [\n            ChannelDescriptor(\n                id=\"cpu_percent\",\n                name=\"CPU Usage\",\n                direction=ChannelDirection.input,\n                unit=\"%\",\n                min_value=0.0,\n                max_value=100.0,\n                simulation=SimulationSpec(\n                    profile=\"sine_wave\",\n                    base_value=35.0,\n                    amplitude=25.0,\n                    period_seconds=120,\n                    noise=2.0,\n                ),\n            ),\n            # ... more channels\n        ]\n        return channels\n\n    async def _do_connect(self) -&gt; None:\n        import psutil\n        psutil.cpu_percent()  # Prime the counter\n\n    async def _do_disconnect(self) -&gt; None:\n        pass  # Nothing to clean up\n\n    async def _do_read(self, channel_id: str) -&gt; ChannelValue | None:\n        import psutil\n        match channel_id:\n            case \"cpu_percent\":\n                return psutil.cpu_percent(interval=None)\n            case \"memory_percent\":\n                return psutil.virtual_memory().percent\n            # ...\n        return None\n\n    async def _do_write(self, channel_id: str, value: ChannelValue) -&gt; None:\n        pass  # System Monitor is read-only\n</code></pre> <p>Source code: <code>plugins/system/src/webmacs_plugin_system/__init__.py</code></p>"},{"location":"development/plugin-development/#testing-your-plugin","title":"Testing Your Plugin","text":"<p>Use the <code>PluginRegistry</code> in tests:</p> <pre><code>import pytest\nfrom webmacs_plugins_core import PluginRegistry\n\n@pytest.fixture\ndef registry():\n    reg = PluginRegistry()\n    reg.register_plugin_class(MyPlugin)\n    return reg\n\nasync def test_plugin_reads_data(registry):\n    instance_id = registry.create_instance(\n        \"my-plugin\",\n        {\"instance_name\": \"test\", \"demo_mode\": True},\n    )\n    await registry.connect_instance(instance_id)\n\n    value = await registry.read(instance_id, \"temperature\")\n    assert value is not None\n    assert isinstance(value, (int, float))\n\n    await registry.disconnect_instance(instance_id)\n</code></pre>"},{"location":"development/plugin-development/#next-steps","title":"Next Steps","text":"<ul> <li>User Guide: Plugins \u2014 end-user documentation</li> <li>API Reference: Plugins \u2014 REST endpoint details</li> <li>Architecture: Backend \u2014 how the backend manages plugins</li> <li>Architecture: Controller \u2014 how the controller runs plugins</li> </ul>"},{"location":"development/plugin-development/#complete-example-weather-station-plugin","title":"Complete Example: Weather Station Plugin","text":"<p>A full, ready-to-build example plugin lives in <code>examples/custom-plugin/</code>. It implements a Weather Station with five sensor channels (temperature, humidity, wind speed, barometric pressure, rainfall) and includes:</p> <ul> <li><code>pyproject.toml</code> \u2014 package metadata and entry-point registration</li> <li><code>plugin.py</code> \u2014 <code>WeatherStationPlugin(DevicePlugin)</code> with realistic <code>SimulationSpec</code> values</li> <li><code>tests/test_weather.py</code> \u2014 conformance test suite (inherits all tests from <code>PluginConformanceSuite</code>)</li> <li><code>README.md</code> \u2014 step-by-step build, upload, and adaptation instructions</li> </ul> <pre><code># Build the example\ncd examples/custom-plugin\npip install build\npython -m build --wheel\n\n# Upload the .whl via the UI or API\n</code></pre> <p>Use this example as a starting point for your own plugins.</p>"},{"location":"development/testing/","title":"Testing","text":"<p>WebMACS has three test suites: backend (Python), controller (Python), and frontend (TypeScript).</p>"},{"location":"development/testing/#test-structure","title":"Test Structure","text":"<pre><code>\u251c\u2500\u2500 backend/tests/\n\u2502   \u251c\u2500\u2500 conftest.py           # Fixtures (async session, test client, auth)\n\u2502   \u251c\u2500\u2500 test_auth.py          # Login, JWT validation, logout\n\u2502   \u251c\u2500\u2500 test_datapoints.py    # Datapoints batch, latest, CRUD\n\u2502   \u2514\u2500\u2500 test_events.py        # Events CRUD + duplicates\n\u251c\u2500\u2500 controller/tests/\n\u2502   \u251c\u2500\u2500 conftest.py           # Fixtures (mock API client)\n\u2502   \u251c\u2500\u2500 test_api_client.py    # HTTP client + retry logic\n\u2502   \u251c\u2500\u2500 test_hardware.py      # Hardware abstraction tests\n\u2502   \u2514\u2500\u2500 test_sensor_manager.py # Sensor reading tests\n\u2514\u2500\u2500 frontend/src/\n    \u251c\u2500\u2500 composables/__tests__/  # useFormatters, useNotification\n    \u251c\u2500\u2500 stores/__tests__/       # auth, events, experiments, datapoints\n    \u251c\u2500\u2500 services/__tests__/     # api, websocket\n    \u2514\u2500\u2500 types/__tests__/        # TypeScript enum validation\n</code></pre>"},{"location":"development/testing/#running-tests","title":"Running Tests","text":""},{"location":"development/testing/#all-tests","title":"All Tests","text":"<pre><code>just test\n</code></pre>"},{"location":"development/testing/#by-component","title":"By Component","text":"<pre><code>just test-backend       # Backend only\njust test-controller    # Controller only\njust test-frontend      # Frontend only\n</code></pre>"},{"location":"development/testing/#with-coverage","title":"With Coverage","text":"<pre><code>cd backend &amp;&amp; uv run pytest tests/ -v --cov --cov-report=html\n</code></pre> <p>Open <code>htmlcov/index.html</code> to view the coverage report.</p>"},{"location":"development/testing/#backend-test-setup","title":"Backend Test Setup","text":"<p>Tests use an in-memory SQLite database by default (overridable via <code>DATABASE_URL</code> env var).</p>"},{"location":"development/testing/#key-fixtures-conftestpy","title":"Key Fixtures (<code>conftest.py</code>)","text":"Fixture Scope Description <code>engine</code> session Async SQLAlchemy engine <code>session</code> function Async session (auto-rolled-back) <code>client</code> function <code>httpx.AsyncClient</code> against the test app <code>auth_headers</code> function <code>{\"Authorization\": \"Bearer ...\"}</code> for authenticated requests <code>admin_user</code> function Pre-seeded admin user"},{"location":"development/testing/#example-test","title":"Example Test","text":"<pre><code>@pytest.mark.asyncio\nasync def test_create_experiment(client, auth_headers):\n    response = await client.post(\n        \"/api/v1/experiments\",\n        json={\"name\": \"Test Run\"},\n        headers=auth_headers,\n    )\n    assert response.status_code == 201\n    data = response.json()\n    assert data[\"name\"] == \"Test Run\"\n    assert data[\"started_on\"] is not None\n</code></pre>"},{"location":"development/testing/#controller-test-setup","title":"Controller Test Setup","text":"<p>Controller tests mock the HTTP client to avoid needing a running backend:</p> <pre><code>@pytest.fixture\ndef mock_api_client(mocker):\n    client = mocker.MagicMock(spec=APIClient)\n    client.post = mocker.AsyncMock(return_value={\"status\": \"ok\"})\n    return client\n</code></pre>"},{"location":"development/testing/#frontend-tests","title":"Frontend Tests","text":"<pre><code>cd frontend\nnpm run test -- --run     # Single run\nnpm run test -- --watch   # Watch mode\n</code></pre> <p>Uses Vitest with Vue Test Utils.</p>"},{"location":"development/testing/#ci-integration","title":"CI Integration","text":"<p>GitHub Actions runs the full test matrix:</p> Job Python OS Services <code>python</code> 3.13 ubuntu-latest PostgreSQL 17 <code>frontend</code> \u2014 ubuntu-latest \u2014 <p>Coverage reports are uploaded to Codecov.</p>"},{"location":"development/testing/#test-markers","title":"Test Markers","text":"<pre><code>@pytest.mark.unit          # Fast, no external deps\n@pytest.mark.integration   # Needs database\n@pytest.mark.e2e           # Full stack\n</code></pre> <p>Run specific markers:</p> <pre><code>uv run pytest -m unit\nuv run pytest -m integration\n</code></pre>"},{"location":"development/testing/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing \u2014 development workflow</li> <li>Code Style \u2014 formatting and linting rules</li> </ul>"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>WebMACS is configured entirely through environment variables. Copy <code>.env.example</code> to <code>.env</code> and customise as needed.</p>"},{"location":"getting-started/configuration/#backend-settings","title":"Backend Settings","text":"Variable Default Description <code>DATABASE_URL</code> <code>postgresql+asyncpg://webmacs:webmacs@localhost:5432/webmacs</code> Async SQLAlchemy connection string <code>SECRET_KEY</code> (empty \u2014 must set) JWT signing key. Generate with <code>openssl rand -hex 32</code> <code>ACCESS_TOKEN_EXPIRE_MINUTES</code> <code>1440</code> JWT token lifetime (default 24 h) <code>ALGORITHM</code> <code>HS256</code> JWT algorithm <code>BACKEND_HOST</code> <code>0.0.0.0</code> Uvicorn bind address <code>BACKEND_PORT</code> <code>8000</code> Uvicorn port <code>CORS_ORIGINS</code> <code>[\"http://localhost:3000\",\"http://localhost:5173\"]</code> Allowed CORS origins (JSON array) <code>DEBUG</code> <code>false</code> Enable debug mode <code>STORAGE_BACKEND</code> <code>postgresql</code> Database backend: <code>postgresql</code> or <code>timescale</code> <code>SENTRY_DSN</code> (empty) Optional Sentry error tracking <code>WS_HEARTBEAT_INTERVAL</code> <code>30</code> WebSocket heartbeat interval (seconds) <code>TIMEZONE</code> <code>Europe/Berlin</code> Default timezone for timestamps"},{"location":"getting-started/configuration/#initial-admin-user","title":"Initial Admin User","text":"Variable Default Description <code>INITIAL_ADMIN_EMAIL</code> <code>admin@webmacs.io</code> Email for the auto-seeded admin <code>INITIAL_ADMIN_USERNAME</code> <code>admin</code> Username <code>INITIAL_ADMIN_PASSWORD</code> <code>admin123</code> Password \u2014 change in production!"},{"location":"getting-started/configuration/#controller-settings","title":"Controller Settings","text":"Variable Default Description <code>WEBMACS_ENV</code> <code>development</code> Environment (<code>development</code> / <code>production</code>) <code>WEBMACS_SERVER_URL</code> <code>http://localhost</code> Backend base URL <code>WEBMACS_SERVER_PORT</code> <code>8000</code> Backend port <code>WEBMACS_ADMIN_EMAIL</code> <code>admin@example.com</code> Credentials for controller \u2194 backend auth <code>WEBMACS_ADMIN_PASSWORD</code> (set in .env) Password for auto-login <code>WEBMACS_POLL_INTERVAL</code> <code>0.5</code> Sensor polling interval (seconds) <code>WEBMACS_REQUEST_TIMEOUT</code> <code>30.0</code> HTTP request timeout <code>WEBMACS_TELEMETRY_MODE</code> <code>http</code> <code>http</code> or <code>websocket</code> <code>WEBMACS_RULE_EVENT_ID</code> (empty) Event public_id triggering rule evaluation <code>WEBMACS_REVPI_MAPPING</code> <code>{}</code> JSON mapping of RevPi I/O pins to event ids"},{"location":"getting-started/configuration/#docker-compose-variables","title":"Docker Compose Variables","text":"<p>These are used by <code>docker-compose.yml</code>:</p> Variable Default Description <code>DB_PASSWORD</code> <code>webmacs_dev_password</code> PostgreSQL password <code>ADMIN_EMAIL</code> <code>admin@webmacs.io</code> Passed to backend + controller <code>ADMIN_USERNAME</code> <code>admin</code> Admin username <code>ADMIN_PASSWORD</code> <code>admin123</code> Admin password <code>TELEMETRY_MODE</code> <code>http</code> Controller telemetry transport"},{"location":"getting-started/configuration/#generating-a-secret-key","title":"Generating a Secret Key","text":"<pre><code>openssl rand -hex 32\n</code></pre> <p>Copy the output into <code>SECRET_KEY</code> in your <code>.env</code> file.</p>"},{"location":"getting-started/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Docker Deployment \u2014 production Docker setup</li> <li>Environment Variables Reference \u2014 full reference</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#two-deployment-paths","title":"Two Deployment Paths","text":"Path Target Audience Method Production (RevPi / Server) Operators, customers <code>scripts/install.sh</code> \u2014 fully automated Development (local) Developers <code>docker compose up</code> or local services <p>For most users</p> <p>The easiest way to install and run WebMACS is the <code>install.sh</code> script in the <code>scripts/</code> directory. It handles Docker installation, credential generation, and service startup \u2014 no manual setup required.</p>"},{"location":"getting-started/installation/#production-installation-recommended","title":"Production Installation (Recommended)","text":""},{"location":"getting-started/installation/#using-scriptsinstallsh","title":"Using <code>scripts/install.sh</code>","text":"<p>The install script is designed for Revolution Pi, Raspberry Pi, or any Debian/Ubuntu server. It performs a complete, hands-free installation:</p> <pre><code># On the target device:\nsudo bash scripts/install.sh webmacs-update-2.0.0.tar.gz\n</code></pre> <p>What the script does (in order):</p> <ol> <li>Installs Docker + Docker Compose (if missing)</li> <li>Creates <code>/opt/webmacs</code> with an <code>updates/</code> directory structure</li> <li>Generates a secure <code>.env</code> file with random <code>SECRET_KEY</code>, <code>DB_PASSWORD</code>, and admin password</li> <li>Extracts and loads Docker images from the bundle (SHA-256 verified)</li> <li>Starts all 4 containers via <code>docker-compose.prod.yml</code></li> <li>Creates a systemd service (<code>webmacs.service</code>) for auto-start on boot</li> </ol> <p>Save Your Credentials</p> <p>The admin password is shown only once during installation. It is also stored in <code>/opt/webmacs/.env</code>.</p> <p>After installation, open <code>http://&lt;device-ip&gt;</code> in a browser and log in.</p>"},{"location":"getting-started/installation/#using-scriptsbuild-update-bundlesh","title":"Using <code>scripts/build-update-bundle.sh</code>","text":"<p>Developers use this script to create the <code>.tar.gz</code> update bundle that <code>install.sh</code> consumes:</p> <pre><code>./scripts/build-update-bundle.sh 2.1.0\n# Output: dist/webmacs-update-2.1.0.tar.gz\n</code></pre> <p>What the script does:</p> <ol> <li>Builds all Docker images via <code>docker compose build --no-cache</code></li> <li>Tags images with the version number</li> <li>Exports images to a single <code>images.tar</code></li> <li>Computes SHA-256 checksum</li> <li>Creates <code>manifest.json</code> with version, checksum, and image list</li> <li>Packages everything into a <code>.tar.gz</code> bundle</li> </ol> <p>The resulting bundle is fully self-contained \u2014 it can be deployed to an airgapped device via USB stick.</p> <p>CI/CD Alternative</p> <p>Instead of building locally, push a git tag (<code>v2.1.0</code>) and GitHub Actions builds a multi-arch bundle automatically. See OTA Updates for details.</p>"},{"location":"getting-started/installation/#development-setup","title":"Development Setup","text":"<p>Docker Compose for Development Only</p> <p>The <code>docker-compose.yml</code> in the project root is intended for local development. For production deployments, always use <code>scripts/install.sh</code> with the production compose file.</p>"},{"location":"getting-started/installation/#docker-full-stack","title":"Docker (Full Stack)","text":"<p>The fastest way to spin up the entire stack locally:</p> <pre><code>cp .env.example .env\ndocker compose up --build -d\n</code></pre> <p>This spins up:</p> Service Port Description <code>db</code> 5432 PostgreSQL 17-alpine <code>backend</code> 8000 FastAPI (Uvicorn) <code>frontend</code> 80 Vue 3 SPA (Nginx) <code>controller</code> \u2014 IoT telemetry agent <p>Verify everything is healthy:</p> <pre><code>docker compose ps\n</code></pre>"},{"location":"getting-started/installation/#local-services-without-docker","title":"Local Services (Without Docker)","text":"<p>For faster iteration without rebuilding containers:</p>"},{"location":"getting-started/installation/#prerequisites-development","title":"Prerequisites (Development)","text":"Tool Version Purpose Python 3.13+ Backend &amp; Controller Node.js 22+ Frontend build PostgreSQL 17+ Database just 1.x Task runner (optional, recommended)"},{"location":"getting-started/installation/#backend","title":"Backend","text":"<pre><code>cd backend\nuv sync --all-extras\nuv run uvicorn webmacs_backend.main:create_app --factory --reload --port 8000\n</code></pre>"},{"location":"getting-started/installation/#frontend","title":"Frontend","text":"<pre><code>cd frontend\nnpm install\nnpm run dev          # \u2192 http://localhost:5173\n</code></pre>"},{"location":"getting-started/installation/#controller","title":"Controller","text":"<pre><code>cd controller\nuv sync --all-extras\nuv run python -m webmacs_controller\n</code></pre>"},{"location":"getting-started/installation/#install-just-task-runner","title":"Install <code>just</code> (Task Runner)","text":"<pre><code># macOS\nbrew install just\n\n# Linux\ncurl --proto '=https' --tlsv1.2 -sSf https://just.systems/install.sh | bash -s -- --to /usr/local/bin\n\n# Windows (scoop)\nscoop install just\n</code></pre> <p>Then run <code>just</code> from the project root to see all available commands:</p> <pre><code>just          # lists all recipes\njust dev      # start full dev stack\njust test     # run all tests\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start \u2014 first login and experiment</li> <li>Configuration \u2014 environment variables reference</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>This guide walks you through your first WebMACS session \u2014 from login to seeing live sensor data on a dashboard.</p>"},{"location":"getting-started/quick-start/#1-start-the-stack","title":"1. Start the Stack","text":"<pre><code>cd webmacs\ndocker compose up -d\n</code></pre> <p>Open http://localhost in your browser.</p>"},{"location":"getting-started/quick-start/#2-log-in","title":"2. Log In","text":"<p>The backend automatically seeds an initial admin user on first startup:</p> Field Default Email <code>admin@webmacs.io</code> Password <code>admin123</code> <p>Change the default password</p> <p>Set <code>INITIAL_ADMIN_PASSWORD</code> in your <code>.env</code> file before deploying to any shared environment.</p>"},{"location":"getting-started/quick-start/#3-set-up-a-plugin-data-source","title":"3. Set Up a Plugin (Data Source)","text":"<p>WebMACS receives sensor data through plugins. A plugin is a device driver that reads hardware (or simulated) channels and feeds values into the telemetry pipeline.</p> <p>Development mode auto-setup</p> <p>In development mode (the default when using <code>docker compose up</code>), the controller automatically creates a Simulated Device plugin instance with 9 demo channels on first boot. You can skip to Step 4 and come back here when you want to add your own data sources.</p>"},{"location":"getting-started/quick-start/#create-a-plugin-instance","title":"Create a Plugin Instance","text":"<ol> <li>Navigate to Plugins in the sidebar.</li> <li>Click  New Instance.</li> <li>Select a plugin \u2014 e.g., Simulated Device for testing or System Monitor for real host metrics.</li> <li>Enter an instance name (e.g., <code>Lab Sensors</code>).</li> <li>Toggle Demo Mode on if you don't have real hardware connected.</li> <li>Click Create.</li> </ol> <p>The plugin automatically discovers its channels (e.g., <code>temperature</code>, <code>humidity</code>, <code>cpu_percent</code>) and creates matching events for each channel.</p>"},{"location":"getting-started/quick-start/#verify-channel-event-mapping","title":"Verify Channel \u2192 Event Mapping","text":"<p>Once the instance is created, its channels are listed under the instance card. Each channel is auto-linked to a WebMACS event:</p> <ul> <li>Navigate to Events in the sidebar to see the newly created events.</li> <li>Each event has a type (sensor, actuator, range), a unit, and a unique <code>public_id</code>.</li> </ul> <p>How data flows</p> <p>Plugin channel \u2192 Event \u2192 Datapoint stream \u2192 Dashboard / Rules / Webhooks / CSV export. Without at least one active plugin instance, no sensor data reaches the system.</p>"},{"location":"getting-started/quick-start/#4-explore-the-dashboard","title":"4. Explore the Dashboard","text":"<p>The Dashboard shows real-time sensor data from your active plugin instances:</p> <ul> <li>WebSocket mode \u2014 data streams in via <code>/ws/datapoints/stream</code> (green indicator)</li> <li>Polling fallback \u2014 if WebSocket fails after 3 attempts, the dashboard falls back to HTTP polling (amber indicator)</li> </ul> <p>You should now see live values from the channels you configured in the previous step. If using demo mode, the values follow realistic simulation profiles (sine waves, random walks, etc.).</p>"},{"location":"getting-started/quick-start/#5-create-an-experiment","title":"5. Create an Experiment","text":"<ol> <li>Navigate to Experiments in the sidebar</li> <li>Click New Experiment</li> <li>Enter a name (e.g. <code>Test Run 01</code>)</li> <li>Click Start \u2014 all incoming datapoints are now associated with this experiment</li> </ol>"},{"location":"getting-started/quick-start/#6-stop-export","title":"6. Stop &amp; Export","text":"<ol> <li>Go back to Experiments</li> <li>Click Stop on the running experiment</li> <li>Click the CSV download button to export all datapoints</li> </ol>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Plugins Guide \u2014 manage plugin instances, channels, and custom packages</li> <li>Configuration \u2014 customise settings via environment variables</li> <li>Dashboard Guide \u2014 deep dive into real-time monitoring</li> <li>Architecture Overview \u2014 understand how the pieces fit together</li> </ul>"},{"location":"guide/","title":"User Guide","text":"<p>Welcome to the WebMACS User Guide. This section explains every feature of the platform \u2014 from live sensor monitoring to automated alerting and data export.</p> <p>WebMACS (Web-based Monitoring and Control System) is designed for operators who need to monitor industrial sensors, control actuators, run timed experiments, and export data \u2014 all from a browser.</p>"},{"location":"guide/#what-can-i-do-with-webmacs","title":"What Can I Do with WebMACS?","text":"Feature What It Does Dashboard See all sensor values live, toggle actuators, adjust range controls, view a real-time chart Custom Dashboards Build your own monitoring views \u2014 pick from line charts, gauges, stat cards, and actuator toggles, place them on a 12-column grid with size presets, connect each widget to a live sensor. Create as many dashboards as you need \u2014 one per zone, process, or team. No code required. Events &amp; Sensors Define sensors, actuators, and range controls that the controller reads from hardware :material-play-circle: Custom Dashboard in action \u2014 create, resize, and monitor in real time <p>|  Experiments | Group datapoints into time-bounded experiments for later analysis | |  Datapoints | Browse the raw data stream collected from every sensor | |  Automation Rules | Trigger alerts or webhooks when sensor values exceed thresholds | |  Webhooks | Push HMAC-signed events to Slack, Teams, Node-RED, Home Assistant \u2014 or any HTTP endpoint | |  Integrations | Connect WebMACS to anything: REST API + WebSocket + webhooks \u2014 your Swiss army knife for lab data | |  CSV Export | Download experiment data as a spreadsheet-ready CSV file | |  OTA Updates | Update the system firmware over the network | |  Plugins | Extend WebMACS with custom device drivers \u2014 bundled or uploaded | |  Logs | View system log entries (info, warnings, errors) | |  Users | Manage operator and admin accounts |</p>"},{"location":"guide/#quick-overview","title":"Quick Overview","text":"<pre><code>flowchart LR\n    HW[Hardware Sensors] --&gt; CTRL[IoT Controller]\n    CTRL --&gt;|WebSocket + HTTP| BE[Backend API]\n    BE --&gt;|WebSocket| FE[Browser Dashboard]\n    BE --&gt;|Webhooks| EXT[External Systems]\n    BE --&gt;|CSV| DL[Data Export]\n    FE --&gt;|Actuator commands| BE\n    BE --&gt;|Write| DB[(Database)]</code></pre>"},{"location":"guide/#recommended-reading-order","title":"Recommended Reading Order","text":"<ol> <li>Dashboard \u2014 understand the live view and controls</li> <li>Custom Dashboards \u2014 build your own monitoring views</li> <li>Events &amp; Sensors \u2014 configure what you monitor</li> <li>Experiments \u2014 group data into experiments</li> <li>CSV Export \u2014 get data out for analysis</li> <li>Automation Rules \u2014 set up threshold-based alerts</li> <li>Webhooks \u2014 notify external systems</li> <li>OTA Updates \u2014 manage firmware deployments</li> <li>Plugins \u2014 add custom device integrations</li> </ol>"},{"location":"guide/#user-roles","title":"User Roles","text":"<p>WebMACS has two user roles:</p> Role Can Access Operator Dashboard, Events, Experiments, Datapoints, CSV Export, Logs Admin Everything above + Rules, Webhooks, OTA Updates, User Management <p>Admin-only pages are marked with a  icon in the sidebar.</p>"},{"location":"guide/#need-help","title":"Need Help?","text":"<ul> <li>Configuration Guide \u2014 environment variables and settings</li> <li>Architecture Overview \u2014 technical deep dive</li> <li>API Reference \u2014 REST endpoint documentation</li> <li>GitHub Issues \u2014 report bugs or request features</li> </ul>"},{"location":"guide/csv-export/","title":"CSV Export","text":"<p>WebMACS lets you download all datapoints from a completed experiment as a CSV file \u2014 ready to open in Excel, Google Sheets, or import into analysis tools like Python/pandas or MATLAB.</p>"},{"location":"guide/csv-export/#how-it-works","title":"How It Works","text":"<p>The CSV is generated on-the-fly using streaming. This means:</p> <ul> <li> No temporary file is created on the server</li> <li> Memory usage stays constant regardless of dataset size</li> <li> Download starts immediately, even for millions of rows</li> <li> Data is ordered by timestamp (oldest first)</li> </ul>"},{"location":"guide/csv-export/#using-the-ui","title":"Using the UI","text":"<ol> <li>Navigate to Experiments in the sidebar</li> <li>Find a stopped experiment</li> <li>Click the  CSV button</li> <li>The browser downloads a file named like <code>experiment_Fluidised_Bed_Run_07_a1b2c3d4.csv</code></li> </ol> <p>Running experiments</p> <p>You can only export data from stopped experiments. Stop the experiment first if it's still running.</p>"},{"location":"guide/csv-export/#using-the-api","title":"Using the API","text":"<pre><code>curl -o results.csv \\\n  http://localhost:8000/api/v1/experiments/$EXP_ID/export/csv \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/csv-export/#response-headers","title":"Response Headers","text":"<pre><code>Content-Type: text/csv; charset=utf-8\nContent-Disposition: attachment; filename=\"experiment_My_Run_a1b2c3d4.csv\"\nTransfer-Encoding: chunked\n</code></pre>"},{"location":"guide/csv-export/#csv-format","title":"CSV Format","text":"<pre><code>timestamp,event_name,event_public_id,value,unit,datapoint_public_id\n2025-01-15T14:32:10.000000,Inlet Temperature,evt_temp01,23.45,\u00b0C,dp_001\n2025-01-15T14:32:10.000000,Chamber Pressure,evt_pres01,1.23,bar,dp_002\n2025-01-15T14:32:10.500000,Inlet Temperature,evt_temp01,23.51,\u00b0C,dp_003\n</code></pre>"},{"location":"guide/csv-export/#columns","title":"Columns","text":"Column Description <code>timestamp</code> ISO 8601 timestamp (UTC) <code>event_name</code> Human-readable sensor/actuator name <code>event_public_id</code> Event unique identifier <code>value</code> Measured value (float) <code>unit</code> Measurement unit (\u00b0C, bar, L/min, \u2026) <code>datapoint_public_id</code> Unique datapoint identifier"},{"location":"guide/csv-export/#working-with-the-data","title":"Working with the Data","text":"Excel / Google SheetsPython / pandasMATLAB <p>Simply open the downloaded <code>.csv</code> file. Columns are comma-separated with UTF-8 encoding. Most spreadsheet applications detect the format automatically.</p> <pre><code>import pandas as pd\n\ndf = pd.read_csv(\"experiment_Run_07_a1b2c3d4.csv\", parse_dates=[\"timestamp\"])\n\n# Filter by sensor\ntemp = df[df[\"event_name\"] == \"Inlet Temperature\"]\n\n# Plot\ntemp.plot(x=\"timestamp\", y=\"value\", title=\"Inlet Temperature\")\n</code></pre> <pre><code>data = readtable('experiment_Run_07_a1b2c3d4.csv');\ntemp = data(strcmp(data.event_name, 'Inlet Temperature'), :);\nplot(temp.timestamp, temp.value);\n</code></pre>"},{"location":"guide/csv-export/#tips","title":"Tips","text":"<p>Recommendations</p> <ul> <li>Export frequently \u2014 CSV files are the easiest way to back up experiment data</li> <li>Filter in your analysis tool \u2014 the CSV contains all events mixed together; filter by <code>event_name</code> or <code>event_public_id</code> to isolate individual sensors</li> <li>Timestamps are UTC \u2014 convert to your local timezone in your analysis tool if needed</li> <li>Large datasets \u2014 the streaming approach handles millions of rows, but very large files may take a moment to download</li> </ul>"},{"location":"guide/csv-export/#next-steps","title":"Next Steps","text":"<ul> <li>Experiments \u2014 manage experiment lifecycle</li> <li>Events &amp; Sensors \u2014 understand what data is collected</li> <li>Dashboard \u2014 monitor live data while an experiment runs</li> </ul>"},{"location":"guide/dashboard/","title":"Dashboard","text":"<p>The Dashboard is your primary control centre. It shows live sensor readings, lets you toggle actuators, adjust range controls, and displays a real-time chart \u2014 all updating in real time.</p>"},{"location":"guide/dashboard/#at-a-glance","title":"At a Glance","text":"<p>When you open the Dashboard you see four sections:</p> Section What It Shows Stats bar Total sensor count, actuator count, range control count, and connection status Sensor cards One card per sensor with current value, unit, and min/max range indicator Actuator controls ON / OFF toggle for each actuator Range controls Adjustable slider for each range-type event Live chart Scrolling line chart with the last 60 readings per sensor"},{"location":"guide/dashboard/#connection-status","title":"Connection Status","text":"<p>The stats bar shows how data is being received:</p> Indicator Mode Meaning Live (green) WebSocket Data streams in real time \u2014 best experience Poll (amber) HTTP Polling WebSocket unavailable, polling every 1.5 s Connecting \u2014 Establishing connection <p>Connection tips</p> <ul> <li>Live mode is the default and recommended. Data appears instantly.</li> <li>If you see Poll mode, check that the backend WebSocket endpoint is reachable. The system switches to polling automatically after 3 failed WebSocket reconnection attempts.</li> </ul>"},{"location":"guide/dashboard/#how-automatic-fallback-works","title":"How Automatic Fallback Works","text":"<pre><code>flowchart TD\n    A[Dashboard opens] --&gt; B{WebSocket connects?}\n    B --&gt;|Yes| C[Live mode \u2014 stream data]\n    B --&gt;|No| D{Retry count &lt; 3?}\n    D --&gt;|Yes| B\n    D --&gt;|No| E[Switch to HTTP polling]\n    C --&gt;|Connection drops| D\n    E --&gt; F[Poll GET /api/v1/datapoints/latest every 1.5 s]</code></pre>"},{"location":"guide/dashboard/#sensor-cards","title":"Sensor Cards","text":"<p>Each sensor event gets its own card displaying:</p> <ul> <li>Name \u2014 the sensor label (e.g. \"Inlet Temperature\")</li> <li>Current value \u2014 large, easy-to-read number</li> <li>Unit \u2014 measurement unit (\u00b0C, bar, L/min, \u2026)</li> <li>Range bar \u2014 visual min/max indicator showing where the current value falls</li> </ul> <p>Values update automatically whenever new data arrives via the real-time connection.</p>"},{"location":"guide/dashboard/#actuator-controls","title":"Actuator Controls","text":"<p>Each actuator event is shown as an ON / OFF toggle button. Toggling sends a datapoint with value <code>1</code> (ON) or <code>0</code> (OFF) to the backend, which the IoT controller picks up to switch hardware outputs.</p> <p>Actuators affect physical hardware</p> <p>Toggling an actuator immediately sends a command to the controller. Make sure the connected equipment is in a safe state before switching.</p>"},{"location":"guide/dashboard/#range-controls","title":"Range Controls","text":"<p>Range events appear as sliders bounded by the event's <code>min_value</code> and <code>max_value</code>. Dragging the slider sends the selected value as a new datapoint.</p> <p>Use range controls for setpoints like target temperatures, flow rates, or motor speeds.</p>"},{"location":"guide/dashboard/#live-chart","title":"Live Chart","text":"<p>The bottom section shows a scrolling line chart powered by Chart.js:</p> <ul> <li>One line per sensor \u2014 up to 8 colours are cycled automatically</li> <li>Last 60 data points per sensor</li> <li>Smooth curves \u2014 filled area under each line for easy visual separation</li> <li>Auto-scrolling \u2014 oldest data drops off the left edge as new data arrives</li> </ul> <p>The chart updates every time a new datapoint batch is received.</p> <p>Chart visibility</p> <p>The live chart section only appears when at least one sensor event exists.</p>"},{"location":"guide/dashboard/#typical-workflow","title":"Typical Workflow","text":"<ol> <li>Create events \u2014 go to Events &amp; Sensors and define your sensors, actuators, and range controls</li> <li>Start the controller \u2014 the IoT controller reads hardware and pushes datapoints to the backend</li> <li>Open the Dashboard \u2014 sensor cards fill with live values, the chart starts plotting</li> <li>Interact \u2014 toggle actuators, adjust range sliders, monitor trends</li> <li>(Optional) Start an experiment \u2014 go to Experiments to begin grouping datapoints</li> </ol>"},{"location":"guide/dashboard/#configuration-reference","title":"Configuration Reference","text":"Setting Where Default Description Poll interval Frontend composable 1.5 s Time between HTTP polls in fallback mode WS heartbeat Backend config 30 s Server-side ping to keep WebSocket alive Max WS retries Frontend composable 3 Reconnection attempts before switching to polling"},{"location":"guide/dashboard/#custom-dashboards","title":"Custom Dashboards","text":"<p>Build your own monitoring view</p> <p>The system dashboard above shows everything at once. Custom dashboards let you build purpose-built views with only the widgets you need \u2014 one for the reactor, one for the cooling loop, one for the client demo.</p> Custom Dashboard \u2014 create widgets, resize them, and monitor your process in real time"},{"location":"guide/dashboard/#creating-a-dashboard","title":"Creating a Dashboard","text":"<ol> <li>Navigate to Dashboards in the sidebar</li> <li>Click New Dashboard</li> <li>Enter a name (e.g., \"Reactor Zone A\")</li> <li>Optionally check \"Visible to all users\" to make it a global dashboard</li> <li>Click Create</li> </ol> <p>Visibility</p> <p>Each user sees their own dashboards plus any dashboard marked as global. Only the dashboard owner can edit or delete it.</p>"},{"location":"guide/dashboard/#widget-types","title":"Widget Types","text":"<p>Click Add Widget to choose from four types:</p> Widget Type Purpose Refresh Rate Line Chart <code>line_chart</code> Time-series trend with labelled X-axis (timestamps) and Y-axis (unit from linked event, e.g. \u00b0C, bar, %) 5 seconds Gauge <code>gauge</code> Radial meter with colour coding (green/yellow/red), unit label, and min/max scale from the linked event 3 seconds Stat Card <code>stat_card</code> Large current value with label and unit from the linked event 3 seconds Actuator Toggle <code>actuator_toggle</code> ON/OFF button for valves, relays, motors 3 seconds <p>Each widget connects to a sensor event and refreshes automatically via HTTP polling at the rate shown above.</p>"},{"location":"guide/dashboard/#size-presets","title":"Size Presets","text":"<p>When adding a widget, pick a size:</p> Preset Columns Rows Good For Small 3 2 Stat cards, toggles Medium 4 3 Gauges Wide 6 3 Charts with moderate detail Large 6 4 Primary charts Full Width 12 4 Full-width trend lines <p>The dashboard uses a 12-column CSS grid with 80 px row height. Widgets flow automatically into available space.</p>"},{"location":"guide/dashboard/#grid-layout-example","title":"Grid Layout Example","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Stat Card   \u2502  Stat Card   \u2502    Gauge     \u2502\n\u2502  (3 col)     \u2502  (3 col)     \u2502   (3 col)   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         Line Chart          \u2502   Actuator   \u2502\n\u2502         (6 col, 2 rows)     \u2502   Toggle     \u2502\n\u2502                             \u2502   (3 col)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"guide/dashboard/#edit-lock-mode","title":"Edit &amp; Lock Mode","text":"<ul> <li>Click Edit to reveal pencil and trash icons on each widget</li> <li>Click Lock to hide edit controls and prevent accidental changes</li> <li>Widgets can be edited (change title, data source, size) or deleted with a   two-step confirmation</li> </ul>"},{"location":"guide/dashboard/#time-range-selector","title":"Time Range Selector","text":"<p>Each custom dashboard has a time range selector with six presets:</p> Preset Minutes Typical Use 20 min 20 Live troubleshooting 1 hour 60 Short experiment 6 hours 360 Half-shift monitoring 24 hours 1440 Daily overview 7 days 10080 Weekly trends 10 days 14400 Extended campaign <p>The selected range is remembered per dashboard in your browser and synced to the URL (<code>?range=60</code>), so you can bookmark a specific view.</p>"},{"location":"guide/dashboard/#managing-via-api","title":"Managing via API","text":"<pre><code># Create a dashboard\ncurl -X POST http://localhost:8000/api/v1/dashboards \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Reactor Overview\", \"is_global\": false}'\n\n# Add a line chart widget\ncurl -X POST http://localhost:8000/api/v1/dashboards/$DASH_ID/widgets \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"widget_type\": \"line_chart\",\n    \"title\": \"Inlet Temperature\",\n    \"event_public_id\": \"evt_abc123\",\n    \"x\": 0, \"y\": 0, \"w\": 6, \"h\": 3\n  }'\n\n# List all dashboards\ncurl http://localhost:8000/api/v1/dashboards \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/dashboard/#example-reactor-monitoring-dashboard","title":"Example: Reactor Monitoring Dashboard","text":"<ol> <li>Create dashboard \"Reactor Zone A\"</li> <li>Add a <code>stat_card</code> (Small) \u2192 \"Inlet Temp\" sensor</li> <li>Add a <code>stat_card</code> (Small) \u2192 \"Outlet Temp\" sensor</li> <li>Add a <code>gauge</code> (Medium) \u2192 \"Pressure\" sensor</li> <li>Add an <code>actuator_toggle</code> (Small) \u2192 \"Emergency Valve\"</li> <li>Add a <code>line_chart</code> (Full Width) \u2192 \"Inlet Temp\" sensor</li> </ol> <p>Result: A single-screen view with live values, a safety gauge, an emergency control, and a trend line \u2014 all updating automatically every few seconds.</p>"},{"location":"guide/dashboard/#next-steps","title":"Next Steps","text":"<ul> <li>Integrations &amp; Extensibility \u2014 connect WebMACS to Slack, Node-RED, and more</li> <li>Events &amp; Sensors \u2014 define what data feeds the dashboard</li> <li>Experiments \u2014 start grouping data into experiments</li> <li>Automation Rules \u2014 get alerted when values cross thresholds</li> </ul>"},{"location":"guide/datapoints/","title":"Datapoints","text":"<p>Datapoints are the raw data stream of WebMACS. Every sensor reading, actuator command, and range adjustment is stored as a datapoint \u2014 a timestamped value linked to an event and optionally to an experiment.</p>"},{"location":"guide/datapoints/#what-is-a-datapoint","title":"What Is a Datapoint?","text":"Field Description Value The measured or commanded value (float) Timestamp When the reading was recorded (UTC) Event Which sensor/actuator produced this value Experiment The running experiment at the time (if any) Public ID Unique identifier"},{"location":"guide/datapoints/#how-datapoints-are-created","title":"How Datapoints Are Created","text":"<p>Datapoints are created automatically by the system \u2014 you rarely create them manually.</p> <pre><code>flowchart LR\n    CTRL[IoT Controller] --&gt;|POST /datapoints/batch| BE[Backend]\n    UI[Dashboard toggle/slider] --&gt;|POST /datapoints| BE\n    BE --&gt; DB[(Database)]\n    BE --&gt; WS[WebSocket broadcast]\n    BE --&gt; RULE[Rule evaluation]\n    BE --&gt; WH[Webhook dispatch]</code></pre> Source How Description Controller <code>POST /api/v1/datapoints/batch</code> Pushes sensor readings every ~0.5 s Dashboard <code>POST /api/v1/datapoints</code> Actuator toggles and range slider changes API client <code>POST /api/v1/datapoints</code> External systems can push data too"},{"location":"guide/datapoints/#what-happens-on-each-datapoint","title":"What Happens on Each Datapoint","text":"<p>When a new datapoint arrives, the backend:</p> <ol> <li>Persists it to the database</li> <li>Links to active experiment \u2014 if an experiment is running, the datapoint is associated automatically</li> <li>Evaluates rules \u2014 all enabled automation rules for the event are checked</li> <li>Fires webhooks \u2014 <code>sensor.reading</code> webhooks are dispatched</li> <li>Broadcasts \u2014 the value is pushed to all connected browser dashboards via WebSocket</li> </ol>"},{"location":"guide/datapoints/#browsing-datapoints","title":"Browsing Datapoints","text":""},{"location":"guide/datapoints/#via-the-ui","title":"Via the UI","text":"<p>Navigate to Datapoints in the sidebar to see a paginated table of all recorded values:</p> Column Description Public ID Unique identifier Event Sensor/actuator name Value Measured value Created Timestamp <p>The table shows a total count badge and is paginated.</p>"},{"location":"guide/datapoints/#via-the-api","title":"Via the API","text":"<pre><code># List datapoints (paginated, newest first)\ncurl http://localhost:8000/api/v1/datapoints?page=1&amp;page_size=50 \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# Get the latest reading per event (used by the Dashboard)\ncurl http://localhost:8000/api/v1/datapoints/latest \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# Get a single datapoint\ncurl http://localhost:8000/api/v1/datapoints/$DP_ID \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/datapoints/#creating-datapoints-via-api","title":"Creating Datapoints via API","text":""},{"location":"guide/datapoints/#single-datapoint","title":"Single Datapoint","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/datapoints \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"value\": 23.45,\n    \"event_public_id\": \"evt_temp_inlet\"\n  }'\n</code></pre>"},{"location":"guide/datapoints/#batch-multiple-datapoints","title":"Batch (Multiple Datapoints)","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/datapoints/batch \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"datapoints\": [\n      {\"value\": 23.45, \"event_public_id\": \"evt_temp_inlet\"},\n      {\"value\": 1.05, \"event_public_id\": \"evt_pressure_01\"},\n      {\"value\": 4.2, \"event_public_id\": \"evt_flow_rate\"}\n    ]\n  }'\n</code></pre> <p>Use batch for performance</p> <p>The batch endpoint is significantly more efficient than individual POSTs when sending multiple readings at once. The IoT controller uses this by default.</p>"},{"location":"guide/datapoints/#deleting-datapoints","title":"Deleting Datapoints","text":"<pre><code>curl -X DELETE http://localhost:8000/api/v1/datapoints/$DP_ID \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Deletion is permanent</p> <p>Deleted datapoints cannot be recovered. Consider CSV export before deleting experiment data.</p>"},{"location":"guide/datapoints/#data-volume","title":"Data Volume","text":"<p>In a typical setup with 7 sensors reading every 0.5 seconds:</p> Period Datapoints 1 minute ~840 1 hour ~50,400 24 hours ~1.2 million 1 week ~8.5 million <p>WebMACS handles this volume efficiently with streaming CSV export and paginated API responses.</p>"},{"location":"guide/datapoints/#next-steps","title":"Next Steps","text":"<ul> <li>Dashboard \u2014 see datapoints visualised in real time</li> <li>Experiments \u2014 group datapoints into time-bounded experiments</li> <li>CSV Export \u2014 download experiment data for analysis</li> <li>API Reference \u2014 full datapoints endpoint documentation</li> </ul>"},{"location":"guide/events/","title":"Events &amp; Sensors","text":"<p>Events represent the physical sensors and actuators connected to the IoT controller. Every datapoint recorded by WebMACS belongs to exactly one event.</p> <p>Think of events as channel definitions \u2014 they describe what is being measured (or controlled), while datapoints hold the actual values.</p>"},{"location":"guide/events/#event-types","title":"Event Types","text":"<p>WebMACS supports six event types:</p> Type Icon Description Dashboard Widget <code>sensor</code> Continuous measurement (temperature, pressure, flow) Value card with range bar <code>actuator</code> Binary on/off control (valves, heaters, motors) ON / OFF toggle <code>range</code> Adjustable value within min/max bounds Slider control <code>cmd_button</code> Momentary command button \u2014 <code>cmd_opened</code> Open-state command \u2014 <code>cmd_closed</code> Close-state command \u2014 <p>Choosing the right type</p> <ul> <li>Use sensor for anything you want to monitor passively (readings from the hardware).</li> <li>Use actuator for anything the operator needs to switch on or off.</li> <li>Use range for setpoints where the operator picks a value within a defined range.</li> </ul>"},{"location":"guide/events/#event-properties","title":"Event Properties","text":"Field Required Description Name Yes Human-readable label (must be unique) Type Yes One of the six types above Unit No Measurement unit (\u00b0C, bar, L/min, %, rpm) Min Value No Lower bound (used for range bar / slider) Max Value No Upper bound (used for range bar / slider) <p>Min / Max values</p> <p>For range events, <code>min_value</code> and <code>max_value</code> define the slider boundaries. For sensor events they define the range bar visual on the Dashboard. If not set, the range bar is not displayed.</p>"},{"location":"guide/events/#managing-events-via-the-ui","title":"Managing Events via the UI","text":""},{"location":"guide/events/#creating-an-event","title":"Creating an Event","text":"<ol> <li>Navigate to Events in the sidebar</li> <li>Click New Event</li> <li>Fill in the fields:<ul> <li>Name \u2014 e.g. \"Inlet Temperature\"</li> <li>Type \u2014 select from dropdown</li> <li>Unit \u2014 e.g. \"\u00b0C\"</li> <li>Min / Max Value \u2014 optional range bounds</li> </ul> </li> <li>Click Create</li> </ol>"},{"location":"guide/events/#editing-an-event","title":"Editing an Event","text":"<p>Click the  edit button on any event row. Change the fields you need and save.</p>"},{"location":"guide/events/#deleting-an-event","title":"Deleting an Event","text":"<p>Click the  delete button and confirm. Deleting an event does not delete its historical datapoints.</p>"},{"location":"guide/events/#managing-events-via-the-api","title":"Managing Events via the API","text":""},{"location":"guide/events/#list-events","title":"List Events","text":"<pre><code>curl http://localhost:8000/api/v1/events \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Response is paginated. Use <code>?page=1&amp;page_size=50</code> query parameters.</p>"},{"location":"guide/events/#create-an-event","title":"Create an Event","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/events \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"Inlet Temperature\",\n    \"type\": \"sensor\",\n    \"unit\": \"\u00b0C\",\n    \"min_value\": 0,\n    \"max_value\": 300\n  }'\n</code></pre> <p>Duplicate names</p> <p>Event names must be unique. Attempting to create an event with an existing name returns 409 Conflict.</p>"},{"location":"guide/events/#update-an-event","title":"Update an Event","text":"<pre><code>curl -X PUT http://localhost:8000/api/v1/events/$EVENT_ID \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"unit\": \"K\"}'\n</code></pre>"},{"location":"guide/events/#delete-an-event","title":"Delete an Event","text":"<pre><code>curl -X DELETE http://localhost:8000/api/v1/events/$EVENT_ID \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/events/#controller-mapping","title":"Controller Mapping","text":"<p>The IoT controller maps physical I/O pins to event Public IDs. This is configured via the <code>WEBMACS_REVPI_MAPPING</code> environment variable:</p> <pre><code>{\n  \"Input_1\": \"evt_temp_inlet\",\n  \"Input_2\": \"evt_pressure_chamber\",\n  \"Output_1\": \"evt_valve_main\"\n}\n</code></pre> <p>The controller reads hardware values for each mapped input and sends them as datapoints to the backend. For output events (actuators), the controller watches for new datapoints and writes the value to the physical output.</p> <p>No mapping, no data</p> <p>Only events that appear in the controller mapping will produce live data. You can create events in the UI first, then configure the mapping on the controller.</p>"},{"location":"guide/events/#best-practices","title":"Best Practices","text":"<ul> <li>Name descriptively: \"Inlet Temperature Reactor A\" is better than \"Temp1\"</li> <li>Set units: They appear on the Dashboard and in CSV exports</li> <li>Set min/max: Enables range bars on the Dashboard and <code>between</code>/<code>not_between</code> operators in Rules</li> <li>Use the right type: The Dashboard renders different widgets per type</li> </ul>"},{"location":"guide/events/#next-steps","title":"Next Steps","text":"<ul> <li>Dashboard \u2014 see events in action</li> <li>Experiments \u2014 group datapoints by experiment</li> <li>Automation Rules \u2014 alert when sensor values cross thresholds</li> <li>API Reference \u2014 full events endpoint documentation</li> </ul>"},{"location":"guide/examples/","title":"Examples","text":"<p>WebMACS ships with complete, ready-to-use examples in the <code>examples/</code> directory. Each example is a standalone project with its own <code>README</code>, source code, and tests.</p>"},{"location":"guide/examples/#weather-station-plugin","title":"Weather Station Plugin","text":"<p>Path: <code>examples/custom-plugin/</code></p> <p>A beginner-friendly example showing how to write a custom WebMACS plugin from scratch.</p> Channel Direction Unit Range <code>temperature</code> input \u00b0C \u221240 \u2026 60 <code>humidity</code> input % 0 \u2026 100 <code>wind_speed</code> input km/h 0 \u2026 200 <code>pressure</code> input hPa 900 \u2026 1 100 <code>rainfall</code> input mm/h 0 \u2026 100 <p>What you'll learn:</p> <ul> <li>Plugin structure (<code>pyproject.toml</code>, entry points)</li> <li>Defining input channels with metadata</li> <li>Building and uploading a <code>.whl</code> file</li> <li>Demo mode with simulated data</li> </ul> <pre><code>cd examples/custom-plugin\npip install build &amp;&amp; python -m build\n# Upload dist/*.whl via WebMACS UI \u2192 Settings \u2192 Plugins\n</code></pre> <p>See Plugin Development Guide for the full documentation.</p>"},{"location":"guide/examples/#modbus-tcp-sensor-plugin","title":"Modbus TCP Sensor Plugin","text":"<p>Path: <code>examples/modbus-plugin/</code></p> <p>A production-style example demonstrating Modbus TCP communication with both input sensors and output actuators.</p> Channel Direction Unit Range <code>temperature</code> input \u00b0C 0 \u2013 500 <code>flow_rate</code> input L/min 0 \u2013 100 <code>valve_setpoint</code> output % 0 \u2013 100 <p>What you'll learn:</p> <ul> <li>Custom configuration \u2014 <code>ModbusSensorConfig</code> with host, port, unit_id fields</li> <li>Output channels \u2014 writing values back to hardware actuators</li> <li>Error handling \u2014 connection failures, read timeouts, graceful disconnect</li> <li>Conversion specs \u2014 raw Modbus register values \u2192 engineering units</li> <li>Health checks \u2014 custom health reporting with connection latency</li> </ul> <pre><code>cd examples/modbus-plugin\npip install build &amp;&amp; python -m build\n# Includes 23 tests: pytest\n</code></pre> <p>Demo Mode</p> <p>The plugin ships with simulated hardware by default. Replace the <code>_do_*</code> methods with real <code>pymodbus</code> calls for production.</p>"},{"location":"guide/examples/#webhook-receiver","title":"Webhook Receiver","text":"<p>Path: <code>examples/webhook-receiver/</code></p> <p>A complete example showing how to receive, verify, and process webhook deliveries from WebMACS.</p> File Purpose <code>receiver.py</code> Minimal stdlib-based HTTP receiver <code>receiver_fastapi.py</code> Production FastAPI receiver with HMAC verification <code>register_webhook.py</code> Script to register a webhook via the REST API <code>verify.py</code> HMAC-SHA256 signature verification helper <p>Supported events:</p> Event When <code>sensor.threshold_exceeded</code> Rule triggers on threshold crossing <code>sensor.reading</code> New datapoint recorded <code>experiment.started</code> Experiment starts <code>experiment.stopped</code> Experiment stops <code>system.health_changed</code> Controller health changes <p>Quick start:</p> <pre><code>cd examples/webhook-receiver\n\n# Start the receiver\npython receiver_fastapi.py\n\n# In another terminal, register it with WebMACS\npython register_webhook.py --url http://your-server:9000/webhook --secret my-secret\n</code></pre> <p>See Webhooks Guide and Security \u2014 HMAC Signatures for payload format and verification details.</p>"},{"location":"guide/examples/#running-example-tests","title":"Running Example Tests","text":"<pre><code># Run all example tests\njust test-example-plugin\n\n# Run modbus plugin tests specifically\ncd examples/modbus-plugin &amp;&amp; pytest\n</code></pre>"},{"location":"guide/examples/#next-steps","title":"Next Steps","text":"<ul> <li>Plugin Development \u2014 full plugin SDK reference</li> <li>Webhooks \u2014 configuring webhook subscriptions</li> <li>Security \u2014 HMAC signatures, authentication</li> </ul>"},{"location":"guide/experiments/","title":"Experiments","text":"<p>Experiments let you group datapoints into time-bounded runs. While an experiment is active, every datapoint recorded by the system is automatically linked to it. When you stop the experiment, you can download all associated data as a CSV file.</p>"},{"location":"guide/experiments/#lifecycle","title":"Lifecycle","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Created: POST /experiments\n    Created --&gt; Running: Experiment starts immediately\n    Running --&gt; Stopped: PUT /experiments/{id}/stop\n    Stopped --&gt; [*]: Download CSV / Delete</code></pre> <p>One experiment at a time</p> <p>Only one experiment can be running at any time. Starting a new experiment requires stopping the current one first.</p>"},{"location":"guide/experiments/#what-happens-during-an-experiment","title":"What Happens During an Experiment?","text":"<ol> <li>Create \u2014 you give the experiment a name. It starts running immediately (<code>started_on</code> is set automatically).</li> <li>Data collection \u2014 every datapoint pushed by the controller is automatically tagged with the experiment's ID. You don't need to do anything.</li> <li>Stop \u2014 you stop the experiment. <code>stopped_on</code> is recorded. No more datapoints are linked.</li> <li>Export \u2014 download all linked datapoints as a CSV file.</li> </ol>"},{"location":"guide/experiments/#using-the-ui","title":"Using the UI","text":""},{"location":"guide/experiments/#creating-an-experiment","title":"Creating an Experiment","text":"<ol> <li>Navigate to Experiments in the sidebar</li> <li>Click New Experiment</li> <li>Enter a descriptive name (e.g. \"Fluidised Bed Run 07 \u2014 200\u00b0C\")</li> <li>Click Create</li> </ol> <p>The experiment starts running immediately. You will see it in the table with a green Running badge.</p>"},{"location":"guide/experiments/#stopping-an-experiment","title":"Stopping an Experiment","text":"<p>Click the  Stop button on a running experiment. The badge changes to Stopped and the stop timestamp is recorded.</p>"},{"location":"guide/experiments/#downloading-data","title":"Downloading Data","text":"<p>Click the  CSV button on a stopped experiment to download all datapoints. See CSV Export for format details.</p>"},{"location":"guide/experiments/#deleting-an-experiment","title":"Deleting an Experiment","text":"<p>Click the  Delete button and confirm. This permanently removes the experiment and all its linked datapoints.</p> <p>Deletion is permanent</p> <p>Deleting an experiment also deletes every datapoint associated with it. Export to CSV first if you need the data.</p>"},{"location":"guide/experiments/#experiment-table-columns","title":"Experiment Table Columns","text":"Column Description Name Experiment label Status  Running (green) or  Stopped (grey) Started Timestamp when the experiment was created Stopped Timestamp when the experiment was stopped (empty if still running) Actions CSV download, Stop, Delete"},{"location":"guide/experiments/#using-the-api","title":"Using the API","text":""},{"location":"guide/experiments/#create-an-experiment","title":"Create an Experiment","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/experiments \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Fluidised Bed Run 07\"}'\n</code></pre> <p>Returns the experiment with <code>started_on</code> already set.</p>"},{"location":"guide/experiments/#list-experiments","title":"List Experiments","text":"<pre><code>curl http://localhost:8000/api/v1/experiments \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Supports <code>?page=1&amp;page_size=50</code> pagination.</p>"},{"location":"guide/experiments/#stop-an-experiment","title":"Stop an Experiment","text":"<pre><code>curl -X PUT http://localhost:8000/api/v1/experiments/$EXP_ID/stop \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/experiments/#download-csv","title":"Download CSV","text":"<pre><code>curl -o results.csv \\\n  http://localhost:8000/api/v1/experiments/$EXP_ID/export/csv \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/experiments/#delete-an-experiment","title":"Delete an Experiment","text":"<pre><code>curl -X DELETE http://localhost:8000/api/v1/experiments/$EXP_ID \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/experiments/#best-practices","title":"Best Practices","text":"<p>Recommendations</p> <ul> <li>Name experiments descriptively \u2014 include parameters, date, or batch number (e.g. \"Run 12 \u2014 Inlet 180\u00b0C, Flow 5 L/min\")</li> <li>Export CSV before deleting \u2014 deletion is irreversible and removes all linked datapoints</li> <li>Stop experiments promptly \u2014 a running experiment captures all data, including calibration or idle readings you may not want</li> </ul>"},{"location":"guide/experiments/#next-steps","title":"Next Steps","text":"<ul> <li>CSV Export \u2014 download and analyse experiment data</li> <li>Events &amp; Sensors \u2014 configure the sensors that feed experiments</li> <li>Dashboard \u2014 monitor the live data while an experiment runs</li> </ul>"},{"location":"guide/integrations/","title":"Integrations &amp; Extensibility","text":"<p>WebMACS is designed as a building block \u2014 not a closed box. Every feature is accessible through open APIs, so you can connect WebMACS to the rest of your toolchain with zero vendor involvement.</p> <p>Think of WebMACS as a Swiss army knife for lab and plant data: it does the job on its own, but it also plugs into anything you already use.</p>"},{"location":"guide/integrations/#three-ways-to-integrate","title":"Three Ways to Integrate","text":""},{"location":"guide/integrations/#1-rest-api-build-on-top","title":"1. REST API \u2014 Build On Top","text":"<p>The REST API exposes 30+ endpoints covering every resource in the system: experiments, events, datapoints, rules, webhooks, dashboards, users, OTA, and system health.</p> <p>Use cases:</p> <ul> <li>Pull experiment data into a custom reporting dashboard</li> <li>Automate experiment start/stop from a CI/CD pipeline</li> <li>Sync sensor configurations across environments</li> <li>Build a mobile companion app</li> </ul> <pre><code># Example: get the latest datapoint per sensor\ncurl http://webmacs.local/api/v1/datapoints/latest \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Full REST Reference \u2192</p>"},{"location":"guide/integrations/#2-websocket-stream-in-real-time","title":"2. WebSocket \u2014 Stream in Real Time","text":"<p>The WebSocket API delivers sensor data with sub-second latency. Connect any custom UI, data logger, or monitoring tool to a live data stream.</p> <p>Use cases:</p> <ul> <li>Feed a wall-mounted Grafana dashboard with live sensor values</li> <li>Build a custom HMI touch-screen interface</li> <li>Log data to InfluxDB or TimescaleDB in real time</li> <li>Trigger alerts in external systems instantly</li> </ul> <pre><code>// Connect to the live datapoint stream\nconst ws = new WebSocket(\n  `ws://webmacs.local/ws/datapoints/stream?token=${jwt}`\n);\n\nws.onmessage = (event) =&gt; {\n  const msg = JSON.parse(event.data);\n  if (msg.type === \"datapoints_batch\") {\n    console.log(\"Live readings:\", msg.datapoints);\n  }\n};\n</code></pre> <p>WebSocket API Reference \u2192</p>"},{"location":"guide/integrations/#3-webhooks-react-to-events","title":"3. Webhooks \u2014 React to Events","text":"<p>Webhooks push HMAC-signed HTTP POST requests to any endpoint whenever something happens. No polling required \u2014 WebMACS calls you.</p> <p>Use cases:</p> <ul> <li>Send Slack alerts when a sensor exceeds a threshold</li> <li>Trigger a Node-RED flow to activate a safety interlock</li> <li>Notify Home Assistant to turn on ventilation</li> <li>Post experiment results to a central data lake</li> </ul> <pre><code>graph LR\n    WM[WebMACS] --&gt;|\"sensor.threshold_exceeded\"| Slack[Slack Channel]\n    WM --&gt;|\"sensor.threshold_exceeded\"| NR[Node-RED Safety Flow]\n    WM --&gt;|\"experiment.stopped\"| Lake[Data Lake / S3]\n    WM --&gt;|\"system.health_changed\"| PD[PagerDuty / Ops]</code></pre> <p>Webhook Guide \u2192</p>"},{"location":"guide/integrations/#integration-at-a-glance","title":"Integration at a Glance","text":"Layer Direction Latency Best For REST API Pull (you request) ~50 ms CRUD operations, data pipelines, mobile apps WebSocket Stream (continuous) ~10 ms Live dashboards, custom UIs, real-time logging Webhooks Push (we notify you) ~100 ms Alerts, cross-system automation, event-driven workflows <p>Mix and match</p> <p>Most real-world setups combine all three layers. Use the REST API to set up experiments, WebSocket for live monitoring, and webhooks for alerts and automation triggers.</p>"},{"location":"guide/integrations/#real-world-integration-architectures","title":"Real-World Integration Architectures","text":""},{"location":"guide/integrations/#university-lab-with-slack-alerts","title":"University Lab with Slack Alerts","text":"<pre><code>graph LR\n    Reactor[Fluidised-Bed Reactor] --&gt; WM[WebMACS]\n    WM --&gt;|Custom Dashboard| Browser[Researcher's Browser]\n    WM --&gt;|Webhook| Slack[Lab Slack Channel]\n    WM --&gt;|CSV Export| Analysis[Python / MATLAB]</code></pre> <ul> <li>Custom dashboard for live monitoring during experiments</li> <li>Slack webhook fires when temperature crosses 200 \u00b0C</li> <li>CSV export after each experiment for thesis data analysis</li> </ul>"},{"location":"guide/integrations/#pilot-plant-with-node-red-safety-layer","title":"Pilot Plant with Node-RED Safety Layer","text":"<pre><code>graph LR\n    Sensors[Temperature + Pressure] --&gt; WM[WebMACS]\n    WM --&gt;|Dashboard| ControlRoom[Control Room Screen]\n    WM --&gt;|Webhook| NR[Node-RED]\n    NR --&gt;|Modbus| Valve[Emergency Shutoff Valve]\n    NR --&gt;|HTTP| WM\n    WM --&gt;|Webhook| Teams[MS Teams Ops Channel]</code></pre> <ul> <li>Custom dashboard on a wall screen with gauges and live charts</li> <li>Node-RED receives <code>sensor.threshold_exceeded</code> \u2192 closes safety valve via Modbus</li> <li>Teams webhook notifies the operations team</li> </ul>"},{"location":"guide/integrations/#multi-site-monitoring-with-central-data-lake","title":"Multi-Site Monitoring with Central Data Lake","text":"<pre><code>graph TB\n    Site1[WebMACS Site 1] --&gt;|REST API| Collector[Data Collector Service]\n    Site2[WebMACS Site 2] --&gt;|REST API| Collector\n    Site3[WebMACS Site 3] --&gt;|REST API| Collector\n    Collector --&gt; Lake[(Central Data Lake)]\n    Lake --&gt; BI[Business Intelligence Dashboard]</code></pre> <ul> <li>Each site runs WebMACS independently (no cloud dependency)</li> <li>A central service polls each site's REST API for experiment data</li> <li>BI dashboard aggregates across all sites</li> </ul>"},{"location":"guide/integrations/#webhook-event-types","title":"Webhook Event Types","text":"Event Fires When <code>sensor.reading</code> Every new datapoint (high volume \u2014 use carefully) <code>sensor.threshold_exceeded</code> An automation rule detects an out-of-range value <code>experiment.started</code> An experiment begins recording <code>experiment.stopped</code> An experiment ends <code>system.health_changed</code> System goes degraded or recovers <p>Every webhook delivery is HMAC-SHA256 signed when a secret is configured, so you can verify authenticity even over public networks.</p>"},{"location":"guide/integrations/#integration-checklist","title":"Integration Checklist","text":"Step Action 1 Get a JWT token via <code>POST /api/v1/auth/login</code> 2 Decide your pattern: pull (REST), stream (WebSocket), or push (webhook) 3 For webhooks: create a subscription with target URL, secret, and event types 4 For REST: use <code>Authorization: Bearer &lt;token&gt;</code> header 5 For WebSocket: append <code>?token=&lt;jwt&gt;</code> to the connection URL 6 Verify HMAC signatures on incoming webhooks (see verification guide) 7 Test with <code>sensor.threshold_exceeded</code> before subscribing to <code>sensor.reading</code>"},{"location":"guide/integrations/#what-makes-this-different","title":"What Makes This Different?","text":"<p>Most industrial monitoring systems charge extra for API access or limit integrations to approved partners. WebMACS is fully open from day one:</p> Feature WebMACS Typical SCADA REST API Full CRUD, 30+ endpoints, free Limited or paid add-on WebSocket Native, sub-second streaming Proprietary protocol Webhooks 5 event types, HMAC-signed, retry logic Not available Data export Streaming CSV, unlimited Per-query limits or extra license Custom integrations Unlimited, no approval needed Vendor-gated marketplace <p>The Bottom Line</p> <p>WebMACS doesn't compete with your other tools \u2014 it connects them. Your existing alerting, automation, and analytics stack gets a new real-time data source with zero licensing friction. One Lego brick that fits everywhere.</p>"},{"location":"guide/integrations/#next-steps","title":"Next Steps","text":"<ul> <li>Custom Dashboards \u2014 build your own monitoring views</li> <li>Webhooks \u2014 detailed webhook configuration and HMAC verification</li> <li>REST API Reference \u2014 all 30+ endpoints</li> <li>WebSocket API \u2014 real-time streaming protocol</li> </ul>"},{"location":"guide/logs/","title":"Logs","text":"<p>The Logs page shows system log entries \u2014 informational messages, warnings, and errors generated by WebMACS during operation.</p> <p>Automatic entries</p> <p>Most log entries are created automatically by the system (e.g. when an automation rule triggers). You can also create log entries via the API.</p>"},{"location":"guide/logs/#viewing-logs","title":"Viewing Logs","text":"<p>Navigate to Logs in the sidebar. The table shows:</p> Column Description Timestamp When the log entry was created (relative time, e.g. \"2 minutes ago\") Type  Info (blue),  Warning (amber),  Error (red) Status <code>unread</code> or <code>read</code> Message Log content (up to 500 characters) <p>The table is paginated (50 entries per page) and ordered newest first.</p>"},{"location":"guide/logs/#log-types","title":"Log Types","text":"Type When It Appears Info Rule triggers, system events, general status updates Warning Degraded conditions, approaching thresholds, retries Error Failed webhook deliveries, hardware communication issues, unexpected errors"},{"location":"guide/logs/#log-sources","title":"Log Sources","text":"<p>Logs are generated by various system components:</p> Source Example Message Rule evaluation \"Rule 'High Temp Alert' triggered: Inlet Temperature = 215.3\u00b0C (&gt; 200)\" Webhook delivery \"Webhook delivery to https://hooks.example.com/... failed: timeout\" System health \"Database connection restored\" OTA updates \"Firmware update v2.1.0 applied successfully\""},{"location":"guide/logs/#managing-logs-via-api","title":"Managing Logs via API","text":""},{"location":"guide/logs/#list-logs","title":"List Logs","text":"<pre><code>curl http://localhost:8000/api/v1/logging?page=1&amp;page_size=50 \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/logs/#create-a-log-entry","title":"Create a Log Entry","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/logging \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"content\": \"Manual calibration completed for Sensor A\",\n    \"logging_type\": \"info\"\n  }'\n</code></pre> <p>Valid <code>logging_type</code> values: <code>info</code>, <code>warning</code>, <code>error</code></p>"},{"location":"guide/logs/#mark-a-log-as-read","title":"Mark a Log as Read","text":"<pre><code>curl -X PUT http://localhost:8000/api/v1/logging/$LOG_ID \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"status_type\": \"read\"}'\n</code></pre>"},{"location":"guide/logs/#best-practices","title":"Best Practices","text":"<p>Recommendations</p> <ul> <li>Review logs regularly \u2014 especially after setting up new automation rules</li> <li>Check error logs after webhook failures \u2014 they may indicate endpoint misconfiguration</li> <li>Use log entries for compliance \u2014 combine with rule-based <code>log</code> actions for automatic audit trails</li> </ul>"},{"location":"guide/logs/#next-steps","title":"Next Steps","text":"<ul> <li>Automation Rules \u2014 rules generate log entries when they fire</li> <li>Webhooks \u2014 failed deliveries appear as error logs</li> <li>Dashboard \u2014 monitor real-time data</li> </ul>"},{"location":"guide/ota/","title":"OTA Updates","text":"<p>Complete guide to WebMACS Over-The-Air updates \u2014 from building a release to customer deployment.</p> <p>Quick Start</p> <p>The <code>scripts/</code> directory contains two ready-to-use scripts that handle everything:</p> <ul> <li><code>scripts/build-update-bundle.sh &lt;version&gt;</code> \u2014 builds a self-contained <code>.tar.gz</code> update bundle</li> <li><code>scripts/install.sh &lt;bundle.tar.gz&gt;</code> \u2014 installs WebMACS on a fresh device (Docker, credentials, systemd \u2014 all automated)</li> </ul> <p>See Installation Guide for detailed first-time setup.</p>"},{"location":"guide/ota/#how-ota-works","title":"How OTA Works","text":"<pre><code>sequenceDiagram\n    participant Dev as Developer\n    participant GH as GitHub\n    participant CI as GitHub Actions\n    participant Device as RevPi / Device\n    participant Updater as Updater Daemon\n\n    Dev-&gt;&gt;GH: git tag v2.1.0 &amp;&amp; git push --tags\n    GH-&gt;&gt;CI: Trigger release workflow\n    CI-&gt;&gt;CI: Run tests (lint, mypy, pytest)\n    CI-&gt;&gt;CI: Build multi-arch Docker images\n    CI-&gt;&gt;CI: Create update bundle (.tar.gz)\n    CI-&gt;&gt;GH: Upload to GitHub Release\n    Note over GH: webmacs-update-2.1.0.tar.gz\n    Dev-&gt;&gt;Device: Download &amp; upload via UI\n    Device-&gt;&gt;Updater: Bundle saved to /updates/\n    Updater-&gt;&gt;Updater: Verify SHA-256 checksum\n    Updater-&gt;&gt;Updater: Backup database\n    Updater-&gt;&gt;Updater: docker load images\n    Updater-&gt;&gt;Updater: docker compose up -d\n    Updater-&gt;&gt;Updater: Health check \u2713</code></pre>"},{"location":"guide/ota/#whats-in-a-bundle","title":"What's in a Bundle?","text":"File Purpose <code>manifest.json</code> Version, SHA-256 checksum, changelog, image list <code>images.tar</code> All Docker images (<code>backend</code>, <code>frontend</code>, <code>controller</code>) <code>docker-compose.prod.yml</code> Production compose file <code>install.sh</code> First-time installation script"},{"location":"guide/ota/#for-developers-releasing-a-new-version","title":"For Developers: Releasing a New Version","text":""},{"location":"guide/ota/#option-a-via-github-recommended","title":"Option A \u2014 Via GitHub (Recommended)","text":"<p>Push a git tag and GitHub Actions builds the bundle automatically:</p> <pre><code># 1. Make your code changes\ngit add .\ngit commit -m \"feat: new sensor calibration\"\n\n# 2. Tag the release\ngit tag v2.1.0\ngit push origin main --tags\n</code></pre> <p>What happens automatically:</p> <ol> <li>CI runs all tests (ruff, mypy, pytest, eslint, vitest)</li> <li>Docker images are built for AMD64 + ARM64 (cross-platform)</li> <li>Images are packaged into <code>webmacs-update-2.1.0.tar.gz</code></li> <li>A GitHub Release is created with the bundle attached</li> </ol> <p>Download the bundle from the Releases page and deliver it to the customer.</p>"},{"location":"guide/ota/#option-b-local-build-with-scriptsbuild-update-bundlesh","title":"Option B \u2014 Local Build with <code>scripts/build-update-bundle.sh</code>","text":"<p>Build manually on your machine (for testing or airgapped environments):</p> <pre><code>./scripts/build-update-bundle.sh 2.1.0\n# Output: dist/webmacs-update-2.1.0.tar.gz\n</code></pre> <p>The script performs these steps:</p> Step Action 1. Build <code>docker compose build --no-cache</code> \u2014 builds all 3 images 2. Tag Tags images as <code>webmacs-backend:2.1.0</code>, etc. 3. Export <code>docker save</code> \u2192 <code>images.tar</code> 4. Checksum SHA-256 hash of <code>images.tar</code> 5. Manifest <code>manifest.json</code> with version, checksum, image list 6. Package Combines everything into <code>dist/webmacs-update-2.1.0.tar.gz</code> <p>The bundle is fully self-contained and can be deployed to an airgapped device via USB stick.</p> <p>Architecture</p> <p><code>just bundle</code> builds for your host architecture only. If you build on x86_64 and deploy to an ARM RevPi, it won't work. Use the GitHub Actions workflow for multi-arch builds.</p>"},{"location":"guide/ota/#for-customers-installation","title":"For Customers: Installation","text":""},{"location":"guide/ota/#first-time-install-with-scriptsinstallsh","title":"First-Time Install with <code>scripts/install.sh</code>","text":"<p>You receive a <code>.tar.gz</code> bundle from your system integrator or download it from GitHub Releases.</p>"},{"location":"guide/ota/#step-1-transfer-to-device","title":"Step 1 \u2014 Transfer to Device","text":"Via SCP (network)Via USB stick <pre><code>scp webmacs-update-2.0.0.tar.gz pi@&lt;device-ip&gt;:/tmp/\n</code></pre> <pre><code>sudo mount /dev/sda1 /mnt\ncp /mnt/webmacs-update-2.0.0.tar.gz /tmp/\nsudo umount /mnt\n</code></pre>"},{"location":"guide/ota/#step-2-run-installer","title":"Step 2 \u2014 Run Installer","text":"<pre><code>ssh pi@&lt;device-ip&gt;\n\n# Run the install script with the bundle\nsudo bash scripts/install.sh /tmp/webmacs-update-2.0.0.tar.gz\n</code></pre> <p>One Command Does Everything</p> <p><code>scripts/install.sh</code> is a single, self-contained script. You don't need to install anything manually \u2014 it handles Docker, credentials, images, and systemd auto-start.</p> <p>The installer handles everything:</p> Step Action Docker Installs Docker + Compose (if missing) Directories Creates <code>/opt/webmacs</code> with update folders Credentials Generates random <code>SECRET_KEY</code>, <code>DB_PASSWORD</code>, admin password Images Loads Docker images from the bundle Services Starts all 4 containers Boot Creates systemd service for auto-start <p>Save Your Credentials</p> <p>The admin password is shown only once during installation. It is also stored in <code>/opt/webmacs/.env</code>.</p>"},{"location":"guide/ota/#step-3-open-browser","title":"Step 3 \u2014 Open Browser","text":"<p>Navigate to <code>http://&lt;device-ip&gt;</code> and log in.</p> <p>Finding the Device IP</p> <p>Run <code>hostname -I</code> on the device.</p>"},{"location":"guide/ota/#applying-updates","title":"Applying Updates","text":"<p>Three options to update an existing installation:</p> Web UI (Easiest)SCP / USB (Automatic)Command Line (Manual) <ol> <li>Download the <code>.tar.gz</code> bundle</li> <li>Open WebMACS \u2192 OTA Updates</li> <li>Click Upload Bundle and select the file</li> <li>The system verifies, backs up, loads images, and restarts (~3-8 min)</li> </ol> <p>Copy the bundle to the update directory: <pre><code>scp webmacs-update-2.1.0.tar.gz pi@&lt;ip&gt;:/opt/webmacs/updates/\n</code></pre> The updater daemon detects and applies it within 30 seconds.</p> <pre><code>cd /opt/webmacs\nsudo tar -xzf /path/to/webmacs-update-2.1.0.tar.gz -C /tmp/update\nsudo docker load -i /tmp/update/images.tar\nsudo sed -i \"s/^WEBMACS_VERSION=.*/WEBMACS_VERSION=2.1.0/\" .env\nsudo docker compose -f docker-compose.prod.yml --env-file .env up -d\n</code></pre>"},{"location":"guide/ota/#managing-updates-in-the-ui","title":"Managing Updates in the UI","text":"<p>Navigate to OTA Updates in the sidebar.</p>"},{"location":"guide/ota/#system-version-github-check","title":"System Version &amp; GitHub Check","text":"<p>The card at the top shows the running version and whether an update is available. Click Check for Updates to query both the local database and GitHub Releases.</p> <p>The GitHub Releases card below shows:</p> State What You See Release exists, newer than installed \"newer\" badge + Download Bundle button Release exists, same as installed \"installed\" badge + link to release page No releases published yet \"No releases published yet\" message GitHub unreachable (offline device) Warning with the error message <p>Automatic version check</p> <p>The OTA page checks for updates automatically when opened. On devices without internet access, the GitHub check times out gracefully and the local database is still checked.</p> <p>Container-only updates</p> <p>The OTA update system works with Docker containers only. It uses <code>docker load</code> + <code>docker compose up</code> to apply updates. Native (non-Docker) installations are not supported by the self-updater.</p>"},{"location":"guide/ota/#uploading-a-bundle","title":"Uploading a Bundle","text":"<ol> <li>Click Upload Bundle</li> <li>Select the <code>.tar.gz</code> file</li> <li>A progress bar shows the upload status</li> <li>Once uploaded, the updater daemon applies it automatically</li> </ol>"},{"location":"guide/ota/#creating-an-update-record","title":"Creating an Update Record","text":"<p>Click New Update to manually register a version:</p> Field Required Description Version Yes Semantic version (e.g. <code>2.1.0</code>) Release Notes No Description of changes"},{"location":"guide/ota/#update-statuses","title":"Update Statuses","text":"Status Description <code>pending</code> Registered, not yet applied <code>downloading</code> Firmware being downloaded <code>verifying</code> Integrity check in progress <code>applying</code> Images being loaded, services restarting <code>completed</code> Successfully applied <code>failed</code> Update failed \u2014 check logs <code>rolled_back</code> Reverted to previous version"},{"location":"guide/ota/#state-machine","title":"State Machine","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; pending: Upload / Register\n    pending --&gt; downloading: Start update\n    downloading --&gt; verifying: Download complete\n    verifying --&gt; applying: Checksum valid\n    verifying --&gt; failed: Checksum mismatch\n    applying --&gt; completed: Health check \u2713\n    applying --&gt; failed: Health check \u2717\n    completed --&gt; rolled_back: Rollback\n    failed --&gt; [*]: Manual intervention\n    rolled_back --&gt; [*]: Previous version restored</code></pre>"},{"location":"guide/ota/#rolling-back","title":"Rolling Back","text":"<p>Click Rollback on a <code>completed</code> update to revert:</p> <pre><code>completed \u2192 rolled_back\n</code></pre>"},{"location":"guide/ota/#why-not-balena","title":"Why Not Balena?","text":"WebMACS OTA Balena Cost Free (GitHub Actions) Paid (after 10 devices) Offline \u2705 Full offline support \u274c Requires cloud Dependencies Docker only Balena OS + account Control Full \u2014 your code, your infra Vendor lock-in Ideal for Single devices, small fleets Large fleets (100+) <p>WebMACS OTA is designed for single-device or small-fleet deployments. If you later manage 50+ devices, you can add Balena on top \u2014 the application code doesn't change.</p>"},{"location":"guide/ota/#safety-recovery","title":"Safety &amp; Recovery","text":""},{"location":"guide/ota/#integrity-verification","title":"Integrity Verification","text":"<p>Every bundle includes a SHA-256 checksum in <code>manifest.json</code>. The updater verifies this before loading images.</p>"},{"location":"guide/ota/#automatic-database-backup","title":"Automatic Database Backup","text":"<p>Before every update, <code>pg_dump</code> saves a timestamped backup to <code>/opt/webmacs/updates/backups/</code>.</p>"},{"location":"guide/ota/#health-check","title":"Health Check","text":"<p>After restarting, the updater checks <code>GET /health</code> (10 retries \u00d7 5s). Failures are marked and logged.</p>"},{"location":"guide/ota/#failed-update-recovery","title":"Failed Update Recovery","text":"<p>On failure:</p> <ol> <li>Compose file restored from <code>.bak</code></li> <li>Bundle moved to <code>updates/failed/</code> (no retry loop)</li> <li>Previous version keeps running</li> </ol> <p>Manual recovery:</p> <pre><code>cd /opt/webmacs\n\n# Restore database backup\ncat updates/backups/webmacs_backup_*.sql | \\\n  docker compose -f docker-compose.prod.yml exec -T db psql -U webmacs webmacs\n\n# Restart\nsudo systemctl restart webmacs\n</code></pre>"},{"location":"guide/ota/#file-structure","title":"File Structure","text":"<pre><code>/opt/webmacs/\n\u251c\u2500\u2500 .env                          # Credentials &amp; version (auto-managed)\n\u251c\u2500\u2500 docker-compose.prod.yml       # Production compose file\n\u2514\u2500\u2500 updates/\n    \u251c\u2500\u2500 webmacs-update-2.1.0.tar.gz   # \u2190 drop bundles here\n    \u251c\u2500\u2500 applied/                       # Successfully applied\n    \u251c\u2500\u2500 backups/                       # Database backups (pre-update)\n    \u2514\u2500\u2500 failed/                        # Failed bundles (won't retry)\n</code></pre>"},{"location":"guide/ota/#faq","title":"FAQ","text":"<p>How long does an update take? : On a RevPi (~ARM Cortex-A53): 3\u20138 minutes. Most time is <code>docker load</code>.</p> <p>Can I update without internet? : Yes. Copy the <code>.tar.gz</code> via USB or local network. Everything is self-contained.</p> <p>What if power is lost during an update? : After reboot, systemd restarts the previous containers. The failed bundle moves to <code>updates/failed/</code>.</p> <p>Can I skip versions? : Yes. Bundles are self-contained. Go from v2.0.0 to v2.5.0 directly.</p> <p>How do I check the current version? : Web UI \u2192 OTA Updates, or <code>cat /opt/webmacs/.env | grep WEBMACS_VERSION</code>, or <code>curl http://localhost/api/v1/ota/check</code>.</p>"},{"location":"guide/ota/#next-steps","title":"Next Steps","text":"<ul> <li>Installation Guide \u2014 detailed first-time setup</li> <li>Docker Deployment \u2014 container architecture</li> <li>API Reference \u2014 programmatic OTA endpoints</li> </ul>"},{"location":"guide/plugins/","title":"Plugins","text":"<p>Extend WebMACS with device plugins \u2014 additional I/O sources that feed sensor data into the same telemetry pipeline as your hardware channels.</p> <p>Bundled Plugins</p> <p>WebMACS ships with three plugins out of the box \u2014 no installation required:</p> Plugin What It Does Simulated Device Virtual sensors &amp; actuators for testing and demos System Monitor CPU, memory, disk, and temperature of the host system Revolution Pi Direct hardware I/O via the piCtory process image"},{"location":"guide/plugins/#concepts","title":"Concepts","text":""},{"location":"guide/plugins/#plugin-vs-plugin-instance","title":"Plugin vs. Plugin Instance","text":"<p>A plugin is a reusable device driver (e.g., \"System Monitor\"). A plugin instance is a configured, running copy of that plugin (e.g., \"Lab PC Monitor\" with demo mode enabled). You can create multiple instances of the same plugin with different settings.</p>"},{"location":"guide/plugins/#channels","title":"Channels","text":"<p>Each plugin instance exposes channels \u2014 named data points with a direction (<code>input</code>, <code>output</code>, or <code>bidirectional</code>), a unit, and an optional link to a WebMACS event. When a channel is mapped to an event, its values appear on dashboards and in the datapoint stream automatically.</p>"},{"location":"guide/plugins/#demo-mode","title":"Demo Mode","text":"<p>Every plugin instance can run in demo mode. Instead of reading real hardware, it simulates realistic sensor values (sine waves, random walks, sawtooth patterns) \u2014 perfect for testing dashboards and rules without physical devices.</p>"},{"location":"guide/plugins/#managing-plugin-instances","title":"Managing Plugin Instances","text":"<p>Navigate to Plugins in the sidebar to see all active plugin instances.</p>"},{"location":"guide/plugins/#create-an-instance","title":"Create an Instance","text":"<ol> <li>Click  New Instance.</li> <li>Select a plugin from the list of available plugins (e.g., \"System Monitor\").</li> <li>Enter an instance name (e.g., \"Production Server Metrics\").</li> <li>Toggle Demo Mode on or off.</li> <li>Click Create.</li> </ol> <p>The plugin auto-discovers its channels. You'll see them listed under the instance \u2014 e.g., <code>cpu_percent</code>, <code>memory_percent</code>, <code>disk_percent</code> for the System Monitor.</p>"},{"location":"guide/plugins/#configure-an-instance","title":"Configure an Instance","text":"<p>Click the Configure button on any instance card to:</p> <ul> <li>Rename the instance</li> <li>Enable or disable it</li> <li>Toggle demo mode</li> <li>Map channels to WebMACS events (so their values appear on dashboards)</li> </ul>"},{"location":"guide/plugins/#map-a-channel-to-an-event","title":"Map a Channel to an Event","text":"<p>Each channel can be linked to a WebMACS event. Once linked, the plugin's sensor values flow into the standard telemetry pipeline:</p> <ol> <li>Open the plugin instance detail page.</li> <li>Find the channel you want (e.g., <code>cpu_percent</code>).</li> <li>Select a target event from the dropdown.</li> <li>The channel now feeds live data into that event's datapoint stream.</li> </ol>"},{"location":"guide/plugins/#delete-an-instance","title":"Delete an Instance","text":"<p>Click the  Delete button on the instance card and confirm. All channel mappings are removed automatically.</p>"},{"location":"guide/plugins/#plugin-packages","title":"Plugin Packages","text":"<p> Navigate to Plugins \u2192 Packages to manage installed plugin packages.</p>"},{"location":"guide/plugins/#bundled-vs-uploaded","title":"Bundled vs. Uploaded","text":"Type Badge Removable? Bundled bundled No \u2014 ships with WebMACS Uploaded uploaded Yes \u2014 admin can uninstall"},{"location":"guide/plugins/#upload-a-plugin-package","title":"Upload a Plugin Package","text":"<ol> <li>Click  Upload Plugin.</li> <li>Select a <code>.whl</code> (Python wheel) file from your computer.</li> <li>A progress bar shows the upload status.</li> <li>On success, the package appears in the list with its name, version, and contained plugin IDs.</li> </ol> <p>Restart Required</p> <p>After uploading or uninstalling a package, restart the controller to activate the changes. The new plugins will be discovered automatically on next startup.</p>"},{"location":"guide/plugins/#validation","title":"Validation","text":"<p>The system validates every uploaded wheel:</p> <ul> <li>File must be a <code>.whl</code> (Python wheel)</li> <li>Maximum size: 50 MB</li> <li>Must contain valid wheel metadata (<code>METADATA</code> file)</li> <li>Must declare a <code>[webmacs.plugins]</code> entry point</li> </ul> <p>Invalid files are rejected with a clear error message.</p>"},{"location":"guide/plugins/#uninstall-a-package","title":"Uninstall a Package","text":"<p>Click  Uninstall on any uploaded package. Bundled packages cannot be removed.</p>"},{"location":"guide/plugins/#status-indicators","title":"Status Indicators","text":"<p>Each plugin instance shows a status badge:</p> Status Meaning connected Running and reading real hardware demo Running in demo/simulation mode inactive Not yet started or disabled error Something went wrong \u2014 check the error message"},{"location":"guide/plugins/#tips-best-practices","title":"Tips &amp; Best Practices","text":"<p>Start with Demo Mode</p> <p>Create your first plugin instance in demo mode. This lets you verify that dashboards, rules, and webhooks work correctly before connecting to real hardware.</p> <p>One Instance per Device</p> <p>Create separate instances for each physical device or system you want to monitor. This keeps channel mappings clean and makes it easy to disable individual sources.</p> <p>Channel \u2192 Event Mapping</p> <p>The real power of plugins is the channel-to-event mapping. Once a channel is linked to an event, all existing WebMACS features work automatically: live dashboards, threshold rules, webhooks, CSV export.</p>"},{"location":"guide/plugins/#next-steps","title":"Next Steps","text":"<ul> <li>Plugin Development Guide \u2014 build your own plugin</li> <li>API Reference: Plugins \u2014 REST endpoint documentation</li> <li>Dashboard Guide \u2014 visualize plugin data on custom dashboards</li> </ul>"},{"location":"guide/rules/","title":"Automation Rules","text":"<p>Rules let you define threshold-based automations: when a sensor value meets a condition, WebMACS can log an alert or trigger a webhook delivery \u2014 without any code on your part.</p> <p>Admin only</p> <p>Rule management requires an admin account.</p>"},{"location":"guide/rules/#how-rules-work","title":"How Rules Work","text":"<pre><code>flowchart LR\n    DP[New Datapoint] --&gt; EVAL{Rule matches?}\n    EVAL --&gt;|No| SKIP[Skip]\n    EVAL --&gt;|Yes| CD{Cooldown expired?}\n    CD --&gt;|No| SKIP\n    CD --&gt;|Yes| ACT[Fire action]\n    ACT --&gt; LOG[Log entry]\n    ACT --&gt; WH[Webhook delivery]</code></pre> <p>Every time a datapoint is created, WebMACS evaluates all enabled rules that target the same event:</p> <ol> <li>Condition check \u2014 compare the datapoint value against the rule's operator and threshold</li> <li>Cooldown check \u2014 skip if the rule fired recently (within <code>cooldown_seconds</code>)</li> <li>Action \u2014 log the alert and/or trigger a webhook delivery</li> </ol>"},{"location":"guide/rules/#creating-a-rule","title":"Creating a Rule","text":""},{"location":"guide/rules/#via-the-ui","title":"Via the UI","text":"<ol> <li>Navigate to Rules in the sidebar (admin only)</li> <li>Click New Rule</li> <li>Configure:</li> </ol> Field Required Description Name Yes Descriptive label (e.g. \"High Temp Alert \u2014 Reactor A\") Event Yes Which sensor event to monitor (dropdown) Operator Yes Comparison operator (see table below) Threshold Yes The value to compare against Threshold High Only for <code>between</code> / <code>not between</code> Upper bound of the range Action Type Yes <code>log</code> or <code>webhook</code> Webhook Event Type Only for <code>webhook</code> actions Which webhook event type to dispatch Cooldown (seconds) Yes Minimum seconds between consecutive triggers Active Yes Enable or disable the rule <ol> <li>Click Create</li> </ol>"},{"location":"guide/rules/#via-the-api","title":"Via the API","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/rules \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"High Temp Alert\",\n    \"event_public_id\": \"evt_temp_inlet\",\n    \"operator\": \"gt\",\n    \"threshold\": 200,\n    \"action_type\": \"webhook\",\n    \"webhook_event_type\": \"sensor.threshold_exceeded\",\n    \"cooldown_seconds\": 300,\n    \"enabled\": true\n  }'\n</code></pre>"},{"location":"guide/rules/#operators","title":"Operators","text":"Operator Symbol Condition Example <code>gt</code> &gt; Value is greater than threshold Temperature &gt; 200 <code>lt</code> &lt; Value is less than threshold Pressure &lt; 0.5 <code>gte</code> \u2265 Greater than or equal Flow \u2265 10 <code>lte</code> \u2264 Less than or equal Level \u2264 5 <code>eq</code> = Equal (\u03b5 = 1e-9) Status = 1 <code>between</code> min \u2264 x \u2264 max Value is within range 20 \u2264 Temp \u2264 80 <code>not_between</code> x &lt; min or x &gt; max Value is outside range Temp &lt; 20 or &gt; 80 <p>Between vs Not Between</p> <p>Use <code>between</code> to trigger when values are within a normal range \u2014 useful for confirming steady-state. Use <code>not_between</code> to trigger when values go outside the safe range \u2014 this is the most common alerting pattern.</p>"},{"location":"guide/rules/#action-types","title":"Action Types","text":""},{"location":"guide/rules/#log","title":"Log","text":"<p>Creates a structured log entry when the condition is met. Visible on the Logs page. Useful for audit trails and post-experiment review.</p>"},{"location":"guide/rules/#webhook","title":"Webhook","text":"<p>Dispatches a <code>sensor.threshold_exceeded</code> (or other) webhook event to all matching webhook subscriptions. Use this to send alerts to Slack, Teams, or custom APIs.</p> <p>Combined setup</p> <p>Create two rules for the same event:</p> <ol> <li><code>Inlet Temp &gt; 200 \u2192 log</code> (always log for audit)</li> <li><code>Inlet Temp &gt; 250 \u2192 webhook</code> (alert team only when critical)</li> </ol>"},{"location":"guide/rules/#cooldown-period","title":"Cooldown Period","text":"<p>The cooldown prevents rules from firing repeatedly when a sensor value stays above a threshold.</p> Cooldown Behaviour 60 s (default) At most one trigger per minute 300 s At most once every 5 minutes 0 s Fire on every matching datapoint (use with caution) <p>Alert fatigue</p> <p>Setting cooldown to 0 with a <code>webhook</code> action can generate hundreds of deliveries per minute. Use a reasonable cooldown (60\u2013300 s) for alerting.</p> <pre><code>gantt\n    title Cooldown example (300 s)\n    dateFormat X\n    axisFormat %s\n    section Rule fires\n    Trigger 1           :done, 0, 1\n    Cooldown (skip)     :active, 1, 300\n    Trigger 2           :done, 300, 301\n    Cooldown (skip)     :active, 301, 600</code></pre>"},{"location":"guide/rules/#rule-table-columns","title":"Rule Table Columns","text":"Column Description Name Rule label Event Monitored sensor name Operator Comparison symbol ( &gt;, &lt;, \u2265, \u2264, =, between, not between) Threshold Threshold value (or range for between/not_between) Action <code>webhook</code> or <code>log</code> badge Active Enabled/disabled Cooldown Seconds between triggers Last Triggered Timestamp of last activation Created Creation date"},{"location":"guide/rules/#example-scenarios","title":"Example Scenarios","text":"Temperature alertPressure out of rangeAudit logging <p>Event: Inlet Temperature Operator: <code>gt</code> (&gt;) Threshold: 200 Action: <code>webhook</code> \u2192 <code>sensor.threshold_exceeded</code> Cooldown: 300 s</p> <p>Sends a Slack notification when inlet temperature exceeds 200\u00b0C, at most once every 5 minutes.</p> <p>Event: Chamber Pressure Operator: <code>not_between</code> Threshold: 0.8 / Threshold High: 1.2 Action: <code>webhook</code> \u2192 <code>sensor.threshold_exceeded</code> Cooldown: 60 s</p> <p>Alerts when pressure goes below 0.8 bar or above 1.2 bar.</p> <p>Event: Valve Status Operator: <code>eq</code> (=) Threshold: 1 Action: <code>log</code> Cooldown: 0 s</p> <p>Logs every time the valve opens (value = 1). Good for compliance trails.</p>"},{"location":"guide/rules/#best-practices","title":"Best Practices","text":"<p>Recommendations</p> <ul> <li>Name rules descriptively \u2014 include the sensor name and threshold in the rule name</li> <li>Set reasonable cooldowns \u2014 60-300 s for webhook alerts, 0 s only for log-only actions</li> <li>Combine <code>log</code> and <code>webhook</code> rules \u2014 log everything, webhook only critical thresholds</li> <li>Use <code>not_between</code> for safe-range monitoring \u2014 it triggers when values leave the normal window</li> <li>Review the Last Triggered column \u2014 rules that never fire may have incorrect thresholds</li> </ul>"},{"location":"guide/rules/#next-steps","title":"Next Steps","text":"<ul> <li>Webhooks \u2014 configure where webhook alerts are delivered</li> <li>Events &amp; Sensors \u2014 set up the sensors that rules monitor</li> <li>Logs \u2014 view rule-triggered log entries</li> </ul>"},{"location":"guide/security/","title":"Security","text":"<p>WebMACS implements defence-in-depth from the transport layer down to individual plugin uploads. This page documents every security control so operators can evaluate compliance and auditors can verify posture.</p>"},{"location":"guide/security/#authentication","title":"Authentication","text":""},{"location":"guide/security/#jwt-bearer-tokens","title":"JWT Bearer Tokens","text":"<p>All API endpoints (except <code>/health</code>) require a valid JWT token in the <code>Authorization: Bearer &lt;token&gt;</code> header.</p> Property Value Algorithm HS256 (HMAC-SHA256) TTL 24 hours (configurable via <code>ACCESS_TOKEN_EXPIRE_MINUTES</code>) Claims <code>sub</code> (user ID), <code>exp</code> (expiry), <code>iat</code> (issued at) Library <code>python-jose</code> <pre><code># Token creation (simplified)\npayload = {\"sub\": str(user_id), \"exp\": now + timedelta(minutes=1440), \"iat\": now}\njwt.encode(payload, SECRET_KEY, algorithm=\"HS256\")\n</code></pre>"},{"location":"guide/security/#password-hashing","title":"Password Hashing","text":"<p>Passwords are hashed with bcrypt (auto-salted). The raw password is never stored or logged.</p> <pre><code>bcrypt.hashpw(password.encode(\"utf-8\"), bcrypt.gensalt())\n</code></pre>"},{"location":"guide/security/#token-blacklisting-logout","title":"Token Blacklisting (Logout)","text":"<p>When a user logs out, their token is added to the <code>blacklist_tokens</code> table. Every authentication check queries this table first. A background task runs hourly to prune expired blacklist entries (tokens older than the JWT TTL).</p>"},{"location":"guide/security/#websocket-authentication","title":"WebSocket Authentication","text":"<p>WebSocket connections use the same JWT token, passed as a query parameter:</p> <pre><code>ws://host/ws/controller/telemetry?token=&lt;jwt&gt;\n</code></pre> <p>The token is validated on the WebSocket handshake \u2014 no unauthenticated connections are possible.</p>"},{"location":"guide/security/#secret_key-validation","title":"SECRET_KEY Validation","text":"<p>The <code>SECRET_KEY</code> environment variable signs all JWTs. WebMACS enforces minimum security:</p> Environment Behaviour Production (<code>ENV=production</code>) Startup fails if <code>SECRET_KEY</code> is empty or &lt; 32 characters Development Logs a warning but allows startup <p>Generate a strong key:</p> <pre><code>python -c 'import secrets; print(secrets.token_urlsafe(64))'\n</code></pre>"},{"location":"guide/security/#rate-limiting","title":"Rate Limiting","text":"<p>An in-memory ASGI middleware enforces per-IP request limits.</p> Setting Default Limit 300 requests per minute per IP Window 60 seconds (sliding) Response <code>429 Too Many Requests</code> (JSON body) Cleanup Stale IPs pruned every 60 s"},{"location":"guide/security/#exempt-paths","title":"Exempt Paths","text":"<p>These paths are not rate-limited:</p> Path Reason <code>/ws/*</code> WebSocket upgrade requests <code>/health</code> Health check probes <code>/api/v1/ota/*</code> Large firmware uploads <code>POST /api/v1/datapoints</code> High-frequency controller telemetry"},{"location":"guide/security/#trusted-networks","title":"Trusted Networks","text":"<p>Requests from Docker bridge / loopback networks (<code>172.16.0.0/12</code>, <code>10.0.0.0/8</code>, <code>192.168.0.0/16</code>, <code>127.0.0.0/8</code>) are exempt from rate limiting.</p>"},{"location":"guide/security/#reverse-proxy-headers","title":"Reverse Proxy Headers","text":"<p>The middleware respects <code>X-Forwarded-For</code> (first hop) and <code>X-Real-IP</code> to identify the true client behind nginx.</p> <p>Single-Worker Assumption</p> <p>Rate-limit state is in-memory (per process). For multi-worker deployments, use Redis-backed rate limiting instead.</p>"},{"location":"guide/security/#cors","title":"CORS","text":"<p>Cross-Origin Resource Sharing is configured via <code>CORS_ORIGINS</code>:</p> <pre><code># Default (development)\ncors_origins = [\"http://localhost:3000\", \"http://localhost:5173\"]\n</code></pre> <p>In production, set <code>CORS_ORIGINS</code> to the actual frontend URL. All methods and headers are allowed for authenticated requests.</p>"},{"location":"guide/security/#webhook-hmac-signatures","title":"Webhook HMAC Signatures","text":"<p>When a webhook has a <code>secret</code> configured, every delivery includes a cryptographic signature:</p> Header Value <code>X-Webhook-Signature</code> <code>HMAC-SHA256(secret, \"{timestamp}.{payload}\")</code> <code>X-Webhook-Timestamp</code> Unix timestamp (seconds)"},{"location":"guide/security/#verification-python","title":"Verification (Python)","text":"<pre><code>import hmac, hashlib\n\ndef verify_signature(payload: str, signature: str, timestamp: str, secret: str) -&gt; bool:\n    expected = hmac.new(\n        secret.encode(),\n        f\"{timestamp}.{payload}\".encode(),\n        hashlib.sha256,\n    ).hexdigest()\n    return hmac.compare_digest(expected, signature)\n</code></pre>"},{"location":"guide/security/#replay-protection","title":"Replay Protection","text":"<p>The timestamp is included in the signed message. Receivers should reject payloads where the timestamp is older than 5 minutes.</p>"},{"location":"guide/security/#retry-policy","title":"Retry Policy","text":"Attempt Delay 1st retry 2 s 2nd retry 4 s 3rd retry 8 s After 3 failures Marked as <code>dead_letter</code>"},{"location":"guide/security/#plugin-upload-validation","title":"Plugin Upload Validation","text":"<p>Plugin packages (<code>.whl</code> files) are validated before installation:</p> Check Details File format Must be a valid Python wheel (<code>.whl</code>) Size limit Max 50 MB per upload Entry point Must declare a <code>webmacs.plugins</code> entry point Isolation Installed via <code>pip install --no-deps</code> to prevent dependency conflicts <p>Plugin Trust</p> <p>Plugins execute arbitrary Python code in the controller process. Only install plugins from trusted sources.</p>"},{"location":"guide/security/#network-architecture","title":"Network Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     HTTPS (443)     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Browser   \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   nginx   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                     \u2502 (reverse  \u2502\n                                    \u2502  proxy)   \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n                                          \u2502 HTTP (8000)\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502  Backend   \u2502\n                                    \u2502 (FastAPI)  \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n                                          \u2502 WebSocket\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502 Controller  \u2502\n                                    \u2502 (Python)    \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                          \u2502 GPIO / Modbus\n                                    \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502  Hardware   \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"guide/security/#air-gapped-deployments","title":"Air-Gapped Deployments","text":"<p>WebMACS is designed to run without internet access:</p> <ul> <li>All Docker images are bundled in OTA update packages</li> <li>No external CDN or telemetry calls</li> <li>Plugin wheels are uploaded manually</li> <li>GitHub access is optional (only for update checks)</li> </ul>"},{"location":"guide/security/#security-checklist","title":"Security Checklist","text":"<p>Use this checklist before going to production:</p> <ul> <li>[ ] Set a strong <code>SECRET_KEY</code> (\u2265 32 characters)</li> <li>[ ] Set <code>ENV=production</code></li> <li>[ ] Change default admin password</li> <li>[ ] Configure <code>CORS_ORIGINS</code> to your frontend domain</li> <li>[ ] Enable HTTPS via nginx (see Production Guide)</li> <li>[ ] Set webhook secrets for all registered webhooks</li> <li>[ ] Review plugin sources before installation</li> <li>[ ] Configure firewall to restrict port access</li> <li>[ ] Set up database backups (see Production Guide)</li> </ul>"},{"location":"guide/security/#next-steps","title":"Next Steps","text":"<ul> <li>Environment Variables \u2014 all configuration options</li> <li>Production Deployment \u2014 HTTPS, backups, monitoring</li> <li>Webhooks \u2014 setting up webhook integrations</li> <li>Plugin Development \u2014 building trusted plugins</li> </ul>"},{"location":"guide/users/","title":"User Management","text":"<p>WebMACS supports multiple user accounts with two roles: Operator and Admin. Admins can create, manage, and delete user accounts.</p> <p>Admin only</p> <p>The Users page is only visible to admin accounts.</p>"},{"location":"guide/users/#user-roles","title":"User Roles","text":"Role Access Operator Dashboard, Events, Experiments, Datapoints, CSV Export, Logs Admin Everything above + Rules, Webhooks, OTA Updates, User Management <p>The sidebar automatically hides admin-only pages for operator accounts.</p>"},{"location":"guide/users/#default-admin-account","title":"Default Admin Account","text":"<p>On first startup, WebMACS creates an initial admin account from environment variables:</p> Variable Default <code>INITIAL_ADMIN_EMAIL</code> <code>admin@webmacs.io</code> <code>INITIAL_ADMIN_USERNAME</code> <code>admin</code> <code>INITIAL_ADMIN_PASSWORD</code> <code>admin123</code> <p>Change the default password immediately</p> <p>The default credentials are publicly documented. Change them as soon as the system is deployed, especially in production environments.</p>"},{"location":"guide/users/#managing-users-via-the-ui","title":"Managing Users via the UI","text":""},{"location":"guide/users/#viewing-users","title":"Viewing Users","text":"<p>Navigate to Users in the sidebar. The table shows:</p> Column Description Username Login name Email Email address Role  Admin or  User badge Registered Account creation date Actions Delete button"},{"location":"guide/users/#creating-a-user","title":"Creating a User","text":"<ol> <li>Click Add User</li> <li>Fill in:<ul> <li>Username \u2014 2\u201350 characters</li> <li>Email \u2014 must be unique</li> <li>Password \u2014 minimum 8 characters</li> </ul> </li> <li>Click Create</li> </ol> <p>New users are created as Operators by default.</p>"},{"location":"guide/users/#deleting-a-user","title":"Deleting a User","text":"<p>Click the  delete button on a user row and confirm.</p> <p>Cannot delete yourself</p> <p>You cannot delete the account you're currently logged in with.</p>"},{"location":"guide/users/#managing-users-via-api","title":"Managing Users via API","text":""},{"location":"guide/users/#list-all-users-admin-only","title":"List All Users (Admin Only)","text":"<pre><code>curl http://localhost:8000/api/v1/users \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/users/#create-a-user-admin-only","title":"Create a User (Admin Only)","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/users \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"username\": \"operator1\",\n    \"email\": \"operator1@example.com\",\n    \"password\": \"securepassword123\"\n  }'\n</code></pre>"},{"location":"guide/users/#update-a-user-self-or-admin","title":"Update a User (Self or Admin)","text":"<pre><code>curl -X PUT http://localhost:8000/api/v1/users/$USER_ID \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"password\": \"new-secure-password\"}'\n</code></pre>"},{"location":"guide/users/#delete-a-user-admin-only","title":"Delete a User (Admin Only)","text":"<pre><code>curl -X DELETE http://localhost:8000/api/v1/users/$USER_ID \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre>"},{"location":"guide/users/#authentication","title":"Authentication","text":""},{"location":"guide/users/#login","title":"Login","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"admin@webmacs.io\",\n    \"password\": \"admin123\"\n  }'\n</code></pre> <p>Returns:</p> <pre><code>{\n  \"access_token\": \"eyJhbGci...\",\n  \"public_id\": \"usr_abc123\",\n  \"username\": \"admin\"\n}\n</code></pre>"},{"location":"guide/users/#using-the-token","title":"Using the Token","text":"<p>Include the token in all subsequent requests:</p> <pre><code>-H \"Authorization: Bearer eyJhbGci...\"\n</code></pre> <p>Tokens expire after 24 hours by default (configurable via <code>ACCESS_TOKEN_EXPIRE_MINUTES</code>).</p>"},{"location":"guide/users/#logout","title":"Logout","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/auth/logout \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Logout blacklists the token \u2014 it cannot be reused even before expiry. Expired blacklisted tokens are cleaned up automatically.</p>"},{"location":"guide/users/#security-best-practices","title":"Security Best Practices","text":"<p>Recommendations</p> <ul> <li>Change the default admin password immediately after first login</li> <li>Use strong passwords \u2014 minimum 8 characters, mix of letters, numbers, and symbols</li> <li>Set a strong <code>SECRET_KEY</code> \u2014 in production, must be at least 32 characters</li> <li>Create operator accounts for regular users \u2014 don't share admin credentials</li> <li>Use HTTPS in production \u2014 tokens are sent in HTTP headers and must be protected in transit</li> </ul>"},{"location":"guide/users/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration \u2014 environment variables for auth settings</li> <li>Dashboard \u2014 get started monitoring data</li> <li>API Reference \u2014 full user and auth endpoint documentation</li> </ul>"},{"location":"guide/webhooks/","title":"Webhooks","text":""},{"location":"guide/webhooks/#push-events-to-any-system-automatically","title":"Push Events to Any System \u2014 Automatically","text":"<p>Webhooks turn WebMACS into an active participant in your infrastructure. Instead of polling for changes, external systems receive instant notifications the moment something happens \u2014 a sensor spikes, an experiment ends, or the system health degrades.</p> <p>Combined with the REST API and WebSocket streaming, webhooks complete the integration trifecta: pull, stream, and push. See Integrations &amp; Extensibility for the full picture.</p> <p>Admin only</p> <p>Webhook management requires an admin account.</p>"},{"location":"guide/webhooks/#how-it-works","title":"How It Works","text":"<pre><code>sequenceDiagram\n    participant S as Sensor\n    participant B as WebMACS Backend\n    participant W as Your Webhook Endpoint\n\n    S-&gt;&gt;B: New datapoint\n    B-&gt;&gt;B: Check rules &amp; webhooks\n    B-&gt;&gt;W: POST payload (JSON)\n    W--&gt;&gt;B: 200 OK\n    B-&gt;&gt;B: Log delivery \u2713</code></pre> <ol> <li>A trigger occurs (new sensor reading, threshold exceeded, experiment started/stopped, \u2026)</li> <li>WebMACS finds all enabled webhook subscriptions matching that event type</li> <li>A JSON payload is sent via HTTP POST to each matching URL</li> <li>The delivery result is logged (success, failure, status code)</li> </ol>"},{"location":"guide/webhooks/#webhook-event-types","title":"Webhook Event Types","text":"Event Type When It Fires <code>sensor.reading</code> Every time a new sensor datapoint is recorded <code>sensor.threshold_exceeded</code> An automation rule triggers a threshold violation <code>experiment.started</code> An experiment is created and begins running <code>experiment.stopped</code> An experiment is stopped <code>system.health_changed</code> System health status changes (degraded / recovered) <p>Choose wisely</p> <p>Subscribing to <code>sensor.reading</code> generates a webhook delivery for every datapoint \u2014 potentially hundreds per minute. For most integrations, <code>sensor.threshold_exceeded</code> is more useful.</p>"},{"location":"guide/webhooks/#creating-a-webhook","title":"Creating a Webhook","text":""},{"location":"guide/webhooks/#via-the-ui","title":"Via the UI","text":"<ol> <li>Navigate to Webhooks in the sidebar (admin only)</li> <li>Click New Webhook</li> <li>Fill in the fields:</li> </ol> Field Required Description URL Yes The endpoint to receive POST requests (use HTTPS in production) Secret No Shared secret for HMAC-SHA256 signature verification Event Types Yes Select one or more event types to subscribe to Active Yes Toggle to enable or disable deliveries <ol> <li>Click Create</li> </ol>"},{"location":"guide/webhooks/#via-the-api","title":"Via the API","text":"<pre><code>curl -X POST http://localhost:8000/api/v1/webhooks \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"url\": \"https://hooks.example.com/services/T.../B.../xxx\",\n    \"secret\": \"my-shared-secret\",\n    \"events\": [\"sensor.threshold_exceeded\", \"experiment.stopped\"],\n    \"enabled\": true\n  }'\n</code></pre> <p>Duplicate URLs</p> <p>Each URL can only be registered once. Attempting to create a duplicate returns 409 Conflict.</p>"},{"location":"guide/webhooks/#payload-format","title":"Payload Format","text":"<p>Every delivery sends a JSON body:</p> <pre><code>{\n  \"type\": \"sensor.threshold_exceeded\",\n  \"time\": \"2025-01-15T10:30:00Z\",\n  \"sensor\": \"Inlet Temperature\",\n  \"value\": 215.3,\n  \"device\": \"webmacs-prod-01\"\n}\n</code></pre> <p>The <code>data</code> fields vary by event type. Experiment events include <code>experiment_name</code> and <code>experiment_id</code>.</p>"},{"location":"guide/webhooks/#hmac-signature-verification","title":"HMAC Signature Verification","text":"<p>If you set a secret, every delivery includes two headers for security:</p> Header Value <code>X-Webhook-Signature</code> <code>&lt;hex-digest&gt;</code> (bare HMAC-SHA256 hex) <code>X-Webhook-Timestamp</code> Unix timestamp of the delivery <p>The HMAC is computed over <code>{timestamp}.{payload_body}</code> using SHA-256.</p>"},{"location":"guide/webhooks/#verification-example-python","title":"Verification Example (Python)","text":"<pre><code>import hmac, hashlib\n\ndef verify(secret: str, timestamp: str, body: bytes, signature: str) -&gt; bool:\n    message = f\"{timestamp}.\".encode() + body\n    expected = hmac.new(secret.encode(), message, hashlib.sha256).hexdigest()\n    return hmac.compare_digest(expected, signature)\n</code></pre> <p>Replay protection</p> <p>Reject deliveries where <code>X-Webhook-Timestamp</code> is more than 5 minutes old.</p>"},{"location":"guide/webhooks/#delivery-log","title":"Delivery Log","text":"<p>Each webhook has a delivery log accessible via the API. Every delivery attempt is recorded with:</p> Field Description Status <code>pending</code> \u2192 <code>delivered</code> \u2192 or <code>failed</code> \u2192 <code>dead_letter</code> HTTP Status Response code from your endpoint (200, 500, timeout, \u2026) Attempts Number of delivery attempts (max 3) Error Error message if failed Timestamp When the delivery was attempted / completed"},{"location":"guide/webhooks/#retry-behaviour","title":"Retry Behaviour","text":"Attempt Delay Total Wait 1st attempt Immediate \u2014 2nd attempt 2 seconds 2 s 3rd attempt 4 seconds 6 s <p>After 3 total attempts, the delivery is marked as dead_letter and will not be retried.</p> <p>Delivery log</p> <p>Delivery history is available via the API (<code>GET /webhooks/{id}/deliveries</code>). A UI delivery log viewer is planned for a future release.</p>"},{"location":"guide/webhooks/#viewing-deliveries-via-api","title":"Viewing Deliveries via API","text":"<pre><code>curl http://localhost:8000/api/v1/webhooks/$WEBHOOK_ID/deliveries \\\n  -H \"Authorization: Bearer $TOKEN\"\n</code></pre> <p>Filter by status: <code>?status=failed</code></p>"},{"location":"guide/webhooks/#integration-examples","title":"Integration Examples","text":"SlackMicrosoft TeamsCustom API <p>Use a Slack Incoming Webhook URL:</p> <pre><code>https://hooks.example.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX\n</code></pre> <p>Slack expects a <code>text</code> field, so you may need a proxy/transform layer.</p> <p>Use a Teams Incoming Webhook connector URL.</p> <p>Point the webhook at any HTTPS endpoint that accepts POST with JSON body and returns 2xx.</p>"},{"location":"guide/webhooks/#best-practices","title":"Best Practices","text":"<p>Recommendations</p> <ul> <li>Always use HTTPS in production environments</li> <li>Set a webhook secret and verify HMAC signatures to prevent spoofing</li> <li>Monitor the delivery log \u2014 failed deliveries indicate connectivity or endpoint issues</li> <li>Disable unused webhooks to reduce unnecessary network traffic</li> <li>Use <code>sensor.threshold_exceeded</code> instead of <code>sensor.reading</code> for alerting \u2014 it fires only when rules trigger, not on every reading</li> <li>Set appropriate timeouts on your receiving endpoint \u2014 WebMACS waits up to 10 seconds per delivery</li> </ul>"},{"location":"guide/webhooks/#next-steps","title":"Next Steps","text":"<ul> <li>Automation Rules \u2014 define thresholds that trigger <code>sensor.threshold_exceeded</code> webhooks</li> <li>Events &amp; Sensors \u2014 configure what is monitored</li> <li>API Reference \u2014 full webhook endpoint documentation</li> </ul>"}]}

